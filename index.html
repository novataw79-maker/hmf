<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>HomeFix - Professional Home Services</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Design System Colors */
            --primary-50: #FEF2F2;
            --primary-100: #FEE2E2;
            --primary-200: #FECACA;
            --primary-500: #A53B2B;
            --primary-600: #DC2626;
            --primary-700: #B91C1C;
            
            --neutral-50: #FAFAFA;
            --neutral-100: #F5F5F5;
            --neutral-200: #E5E5E5;
            --neutral-300: #D4D4D4;
            --neutral-400: #A3A3A3;
            --neutral-500: #737373;
            --neutral-700: #404040;
            --neutral-800: #262626;
            --neutral-900: #171717;
            
            --success-500: #22C55E;
            --white: #FFFFFF;
            
            /* Spacing */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-2xl: 48px;
            --spacing-3xl: 64px;
            
            /* Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;
            
            /* Enhanced Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 8px rgba(0, 0, 0, 0.15);
            --shadow-xl: 0 8px 16px rgba(0, 0, 0, 0.1);
            --shadow-2xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-glow: 0 0 20px rgba(165, 59, 43, 0.3);
            
            /* Glass Morphism */
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.18);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            
            /* Animation Durations */
            --duration-fast: 0.15s;
            --duration-normal: 0.3s;
            --duration-slow: 0.5s;
            --duration-slower: 0.8s;
            
            /* Animation Easing */
            --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
            --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        /* Global Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            background-attachment: fixed;
            color: var(--neutral-900);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            animation: fadeIn var(--duration-normal) var(--ease-out);
        }

        * {
            -webkit-tap-highlight-color: transparent;
        }

        /* Glass Morphism Utility Classes */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        .glass-strong {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
            transition: all var(--duration-normal) var(--ease-out);
        }

        .glass-card:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-4px);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.3);
        }

        /* Animation Classes */
        .animate-fade-in {
            animation: fadeIn var(--duration-normal) var(--ease-out);
        }

        .animate-fade-in-up {
            animation: fadeInUp var(--duration-slow) var(--ease-out);
        }

        .animate-slide-in-right {
            animation: slideInRight var(--duration-normal) var(--ease-out);
        }

        .animate-slide-in-left {
            animation: slideInLeft var(--duration-normal) var(--ease-out);
        }

        .animate-scale-in {
            animation: scaleIn var(--duration-normal) var(--ease-bounce);
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        /* Cookie Consent Banner */
        .cookie-consent-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 10000;
            padding: var(--spacing-lg);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transform: translateY(100%);
            transition: all var(--duration-slow) var(--ease-out);
        }

        .cookie-consent-banner.cookie-consent-show {
            opacity: 1;
            transform: translateY(0);
        }

        .cookie-consent-banner.cookie-consent-hide {
            opacity: 0;
            transform: translateY(100%);
        }

        .cookie-consent-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            max-width: 1200px;
            width: 100%;
            box-shadow: 0 -8px 32px 0 rgba(31, 38, 135, 0.3);
            display: flex;
            align-items: center;
            gap: var(--spacing-xl);
            animation: slideInUp var(--duration-slow) var(--ease-out);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .cookie-consent-icon {
            font-size: 48px;
            flex-shrink: 0;
            animation: float 3s ease-in-out infinite;
        }

        .cookie-consent-text {
            flex: 1;
        }

        .cookie-consent-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .cookie-consent-description {
            font-size: 15px;
            color: var(--neutral-700);
            line-height: 1.6;
            margin: 0;
        }

        .cookie-link {
            color: var(--primary-500);
            text-decoration: none;
            font-weight: 600;
            transition: color var(--duration-fast) var(--ease-out);
        }

        .cookie-link:hover {
            color: var(--primary-600);
            text-decoration: underline;
        }

        .cookie-consent-actions {
            display: flex;
            gap: var(--spacing-md);
            flex-shrink: 0;
        }

        .cookie-btn {
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .cookie-consent-content {
                flex-direction: column;
                text-align: center;
                gap: var(--spacing-lg);
            }

            .cookie-consent-actions {
                width: 100%;
                flex-direction: column;
            }

            .cookie-btn {
                width: 100%;
            }

            .cookie-consent-icon {
                font-size: 36px;
            }

            .cookie-consent-title {
                font-size: 18px;
            }

            .cookie-consent-description {
                font-size: 14px;
            }
        }

        /* Top Navigation Bar - Enhanced with Glass */
        .top-nav {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            transition: all var(--duration-normal) var(--ease-out);
        }

        .top-nav::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            z-index: -1;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            cursor: pointer;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-500);
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .logo img {
            height: 40px;
            width: auto;
        }

        .logo-video {
            height: 40px;
            width: auto;
            object-fit: contain;
            display: inline-block;
            vertical-align: middle;
            pointer-events: none;
            user-select: none;
            -webkit-user-select: none;
            border-radius: var(--radius-sm);
            background: transparent;
            opacity: 1;
            transition: opacity var(--duration-fast) var(--ease-out);
        }

        /* Ensure video doesn't show controls or pause on click */
        .logo-video::-webkit-media-controls {
            display: none !important;
        }

        .logo-video::-webkit-media-controls-enclosure {
            display: none !important;
        }

        /* Mobile responsive video */
        @media (max-width: 768px) {
            .logo-video {
                height: 32px;
            }
        }

        @media (max-width: 480px) {
            .logo-video {
                height: 28px;
            }
        }

        .location-badge {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs) var(--spacing-sm);
            background: var(--neutral-50);
            border-radius: var(--radius-full);
            font-size: 12px;
            color: var(--neutral-700);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            background: var(--success-500);
            border-radius: 50%;
        }

        .nav-search {
            flex: 1;
            max-width: 600px;
            margin: 0 var(--spacing-xl);
            position: relative;
        }

        .search-wrapper {
            display: flex;
            align-items: center;
            background: var(--neutral-50);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: 0 var(--spacing-md);
            transition: all 0.2s;
        }

        .search-wrapper:focus-within {
            border-color: var(--primary-500);
            background: var(--white);
            box-shadow: 0 0 0 3px rgba(165, 59, 43, 0.1);
        }

        .search-input {
            flex: 1;
            padding: var(--spacing-md) 0;
            border: none;
            background: transparent;
            font-size: 15px;
            color: var(--neutral-900);
            outline: none;
        }

        .search-input::placeholder {
            color: var(--neutral-400);
        }

        .search-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: var(--spacing-sm);
            color: var(--neutral-500);
            display: flex;
            align-items: center;
        }

        .search-btn:hover {
            color: var(--primary-500);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .nav-link {
            color: var(--neutral-700);
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }

        .nav-link:hover {
            color: var(--primary-500);
            background: var(--primary-50);
        }

        .premium-badge {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: var(--white);
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .user-menu {
            position: relative;
        }

        .user-avatar,
        .profile-avatar,
        .task-avatar,
        .task-provider-avatar,
        .avatar-preview {
            object-fit: cover;
            border-radius: 50%;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--neutral-200);
            transition: border-color 0.2s;
        }

        .user-avatar:hover {
            border-color: var(--primary-500);
        }

        /* Hero Section - Fiverr Style */
        .hero-section {
            background: linear-gradient(135deg, rgba(165, 59, 43, 0.1) 0%, rgba(255, 255, 255, 0.9) 100%), url('images/bird-s-eye-view-shanghai.png');
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
            padding: var(--spacing-3xl) var(--spacing-lg);
            text-align: center;
            position: relative;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);
            opacity: 0.7;
            z-index: 0;
        }

        .hero-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .hero-title {
            font-size: 48px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
            line-height: 1.2;
        }

        .hero-subtitle {
            font-size: 24px;
            color: var(--neutral-700);
            margin-bottom: var(--spacing-2xl);
            font-weight: 400;
        }

        .hero-search {
            max-width: 700px;
            margin: 0 auto;
            position: relative;
        }

        .hero-search-wrapper {
            display: flex;
            background: var(--white);
            border: 2px solid var(--primary-500);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-xl);
        }

        .hero-search-input {
            flex: 1;
            padding: var(--spacing-lg) var(--spacing-xl);
            border: none;
            font-size: 18px;
            outline: none;
        }

        .hero-search-btn {
            background: var(--primary-500);
            color: var(--white);
            border: none;
            padding: 0 var(--spacing-2xl);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .hero-search-btn:hover {
            background: var(--primary-600);
        }

        /* Smooth Scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-3xl) var(--spacing-lg);
            animation: fadeIn var(--duration-slow) var(--ease-out);
        }

        /* Screen Container */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* Premium Banner */
        .premium-banner {
            background-image: url('images/exclusive.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: var(--white);
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            margin-bottom: var(--spacing-3xl);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .premium-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(165, 59, 43, 0.75) 0%, rgba(220, 38, 38, 0.75) 100%);
            z-index: 0;
        }

        .premium-banner .banner-content,
        .premium-banner .banner-image {
            position: relative;
            z-index: 1;
        }

        .banner-content {
            flex: 1;
        }

        .banner-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }

        .banner-subtitle {
            font-size: 18px;
            opacity: 0.95;
            margin-bottom: var(--spacing-md);
        }

        .coupon-container {
            background: rgba(255, 255, 255, 0.2);
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-full);
            display: inline-block;
            margin-top: var(--spacing-sm);
        }

        .coupon-text {
            font-size: 16px;
            font-weight: 600;
        }

        .banner-image {
            width: 150px;
            height: 150px;
            opacity: 0.9;
        }

        /* Categories Section - Fiverr Style */
        .categories-section {
            margin-bottom: var(--spacing-3xl);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-2xl);
        }

        .section-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--neutral-900);
        }

        .section-subtitle {
            font-size: 18px;
            color: var(--neutral-500);
            margin-top: var(--spacing-xs);
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-xl);
        }

        .category-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-out);
            text-decoration: none;
            color: inherit;
            display: block;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            animation: fadeInUp var(--duration-slow) var(--ease-out) backwards;
        }

        .category-card:nth-child(1) { animation-delay: 0.1s; }
        .category-card:nth-child(2) { animation-delay: 0.2s; }
        .category-card:nth-child(3) { animation-delay: 0.3s; }
        .category-card:nth-child(4) { animation-delay: 0.4s; }
        .category-card:nth-child(5) { animation-delay: 0.5s; }
        .category-card:nth-child(6) { animation-delay: 0.6s; }

        .category-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 16px 48px 0 rgba(31, 38, 135, 0.25), 0 0 0 1px rgba(165, 59, 43, 0.1);
            border-color: rgba(165, 59, 43, 0.3);
            background: rgba(255, 255, 255, 0.95);
        }

        .category-icon-wrapper {
            width: 64px;
            height: 64px;
            background: var(--primary-50);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
        }

        .category-icon {
            width: 36px;
            height: 36px;
            color: var(--primary-500);
        }

        .category-icon-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: var(--radius-lg);
        }

        .category-label {
            font-size: 20px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .category-description {
            font-size: 14px;
            color: var(--neutral-500);
            line-height: 1.5;
        }

        /* Tasks Screen */
        .tasks-header {
            margin-bottom: var(--spacing-2xl);
        }

        .tasks-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
        }

        .tabs-row {
            display: flex;
            gap: var(--spacing-lg);
            border-bottom: 2px solid var(--neutral-200);
            margin-bottom: var(--spacing-2xl);
        }

        .tab {
            padding: var(--spacing-md) var(--spacing-lg);
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
            color: var(--neutral-500);
            position: relative;
            transition: color 0.2s;
        }

        .tab:hover {
            color: var(--neutral-900);
        }

        .tab.active {
            color: var(--primary-500);
            font-weight: 600;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-500);
        }

        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: var(--spacing-xl);
        }

        .task-card {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: var(--radius-xl);
            overflow: hidden;
            transition: all var(--duration-normal) var(--ease-out);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            animation: fadeInUp var(--duration-normal) var(--ease-out) backwards;
        }

        .task-card:hover {
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.25);
            transform: translateY(-6px) scale(1.01);
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(165, 59, 43, 0.2);
        }

        .task-card-header {
            background: var(--primary-50);
            padding: var(--spacing-md);
            text-align: center;
        }

        .task-card-header-text {
            color: var(--primary-500);
            font-weight: 600;
            font-size: 14px;
        }

        .task-card-body {
            padding: var(--spacing-xl);
        }

        .task-card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--neutral-900);
        }

        .task-card-row {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
            font-size: 15px;
            color: var(--neutral-700);
        }

        .task-assignee {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--neutral-200);
        }

        .task-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
        }

        .assignee-name {
            font-weight: 500;
            color: var(--neutral-900);
        }

        .task-card-footer {
            padding: var(--spacing-md) var(--spacing-xl);
            border-top: 1px solid var(--neutral-200);
            display: flex;
            justify-content: flex-end;
        }

        .btn-text {
            background: none;
            border: none;
            color: var(--primary-500);
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }

        .btn-text:hover {
            background: var(--primary-50);
        }

        /* Profile Screen */
        .profile-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .profile-header {
            margin-bottom: var(--spacing-2xl);
        }

        .profile-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
        }

        .profile-card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .profile-info-card {
            display: flex;
            align-items: center;
            gap: var(--spacing-xl);
            padding-bottom: var(--spacing-xl);
            border-bottom: 1px solid var(--neutral-200);
            margin-bottom: var(--spacing-xl);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            color: var(--neutral-900);
        }

        .profile-email {
            font-size: 16px;
            color: var(--neutral-500);
        }

        .menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            cursor: pointer;
            transition: background 0.2s;
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-sm);
        }

        .menu-item:hover {
            background: var(--neutral-50);
        }

        .menu-item-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .menu-item-icon {
            width: 24px;
            height: 24px;
            color: var(--neutral-500);
        }

        .menu-item-title {
            font-size: 16px;
            color: var(--neutral-900);
            font-weight: 500;
        }

        .menu-item-arrow {
            width: 20px;
            height: 20px;
            color: var(--neutral-400);
        }

        .logout-btn {
            width: 100%;
            color: var(--primary-500);
            background: var(--primary-50);
            border: 1px solid var(--primary-200);
            padding: var(--spacing-md) var(--spacing-lg);
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            border-radius: var(--radius-md);
            margin-top: var(--spacing-lg);
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: var(--primary-100);
        }

        /* Buttons */
        .btn {
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: var(--radius-lg);
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-out);
            min-height: 44px; /* Touch-friendly */
            touch-action: manipulation;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        @media (max-width: 768px) {
            .btn {
                min-height: 48px; /* Larger touch target on mobile */
                padding: var(--spacing-md) var(--spacing-lg);
            }
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(165, 59, 43, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            box-shadow: 0 6px 20px rgba(165, 59, 43, 0.4);
            transform: translateY(-2px);
        }

        .btn-primary:active {
            transform: translateY(0) scale(0.98);
        }

        .btn-ghost {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: var(--primary-500);
            border: 1px solid rgba(165, 59, 43, 0.3);
        }

        .btn-ghost:hover {
            background: rgba(254, 242, 242, 0.8);
            border-color: var(--primary-500);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(165, 59, 43, 0.15);
        }

        /* Profile Notification */
        .profile-notification {
            background: var(--white);
            border: 1px solid var(--primary-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-2xl);
            position: relative;
            display: none;
        }

        .profile-notification.show {
            display: block;
        }

        .notification-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-xl);
        }

        .notification-text {
            flex: 1;
        }

        .notification-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-500);
            margin-bottom: var(--spacing-xs);
        }

        .notification-desc {
            font-size: 15px;
            color: var(--neutral-500);
        }

        .notification-actions {
            display: flex;
            gap: var(--spacing-md);
        }

        .close-button {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            padding: var(--spacing-xs);
            cursor: pointer;
            color: var(--neutral-500);
            background: none;
            border: none;
            font-size: 24px;
            line-height: 1;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }

        .close-button:hover {
            background: var(--neutral-100);
            color: var(--neutral-700);
        }

        /* Mobile styles for profile notification */
        @media (max-width: 768px) {
            .profile-notification {
                padding: var(--spacing-lg);
                margin-bottom: var(--spacing-lg);
            }

            .notification-content {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-lg);
            }

            .notification-text {
                width: 100%;
            }

            .notification-title {
                font-size: 18px;
            }

            .notification-desc {
                font-size: 14px;
            }

            .notification-actions {
                width: 100%;
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            .notification-actions .btn {
                width: 100%;
            }

            .close-button {
                top: var(--spacing-sm);
                right: var(--spacing-sm);
                width: 36px;
                height: 36px;
            }
        }

        /* Service Detail Page */
        .service-detail-header {
            background: linear-gradient(135deg, rgba(165, 59, 43, 0.1) 0%, rgba(255, 255, 255, 0.9) 100%);
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
            padding: var(--spacing-3xl) var(--spacing-lg);
            margin-bottom: var(--spacing-3xl);
            position: relative;
        }

        .service-detail-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);
            opacity: 0.7;
            z-index: 0;
        }

        .service-detail-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--neutral-700);
            text-decoration: none;
            font-size: 15px;
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }

        .back-button:hover {
            background: var(--neutral-50);
            color: var(--primary-500);
        }

        .service-header-content {
            display: flex;
            align-items: center;
            gap: var(--spacing-2xl);
        }

        .service-icon-large {
            width: 120px;
            height: 120px;
            background: var(--white);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .service-icon-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .service-icon-large svg {
            width: 64px;
            height: 64px;
        }

        .service-header-text h1 {
            font-size: 42px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .service-header-text p {
            font-size: 18px;
            color: var(--neutral-500);
            margin-bottom: var(--spacing-xl);
        }

        .service-features {
            display: flex;
            gap: var(--spacing-xl);
            flex-wrap: wrap;
        }

        .service-feature {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--neutral-700);
            font-size: 15px;
        }

        .service-feature svg {
            width: 20px;
            height: 20px;
            color: var(--primary-500);
        }

        .service-detail-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--spacing-3xl);
            margin-bottom: var(--spacing-3xl);
        }

        .service-info-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-xl);
            padding: var(--spacing-2xl);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            transition: all var(--duration-normal) var(--ease-out);
        }

        .service-info-card:hover {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.2);
        }

        .service-info-section {
            margin-bottom: var(--spacing-2xl);
        }

        .service-info-section:last-child {
            margin-bottom: 0;
        }

        .service-info-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-lg);
        }

        .service-info-text {
            font-size: 16px;
            color: var(--neutral-700);
            line-height: 1.8;
        }

        .service-info-list {
            list-style: none;
            padding: 0;
        }

        .service-info-list li {
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--neutral-200);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            font-size: 15px;
            color: var(--neutral-700);
        }

        .service-info-list li:last-child {
            border-bottom: none;
        }

        .service-info-list li svg {
            width: 20px;
            height: 20px;
            color: var(--primary-500);
            flex-shrink: 0;
        }

        .service-cta-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-xl);
            padding: var(--spacing-2xl);
            position: sticky;
            top: 90px;
            height: fit-content;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
            animation: scaleIn var(--duration-slow) var(--ease-bounce);
        }

        .service-cta-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-lg);
        }

        .service-cta-price {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary-500);
            margin-bottom: var(--spacing-sm);
        }

        .service-cta-note {
            font-size: 14px;
            color: var(--neutral-500);
            margin-bottom: var(--spacing-xl);
        }

        .service-cta-btn {
            width: 100%;
            padding: var(--spacing-lg);
            font-size: 16px;
            margin-bottom: var(--spacing-md);
        }

        /* Survey Page */
        .survey-container {
            max-width: 800px;
            margin: 0 auto;
            padding: var(--spacing-3xl) var(--spacing-lg);
        }

        .survey-header {
            text-align: center;
            margin-bottom: var(--spacing-3xl);
        }

        .survey-title {
            font-size: 36px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .survey-subtitle {
            font-size: 18px;
            color: var(--neutral-500);
        }

        .survey-form {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
        }

        .form-group {
            margin-bottom: var(--spacing-2xl);
        }

        .form-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
        }

        .form-label .required {
            color: var(--primary-500);
        }

        .form-input {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all var(--duration-normal) var(--ease-out);
        }

        .form-input:focus {
            background: rgba(255, 255, 255, 0.95);
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(165, 59, 43, 0.1), 0 4px 12px rgba(0, 0, 0, 0.05);
            transform: translateY(-1px);
        }

        /* Legacy form-input styles */
        .form-textarea,
        .form-select {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-md);
            font-size: 15px;
            font-family: inherit;
            transition: all var(--duration-normal) var(--ease-out);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(165, 59, 43, 0.1), 0 4px 12px rgba(0, 0, 0, 0.05);
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-1px);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-radio-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .form-radio {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
        }

        .form-radio:hover {
            border-color: var(--primary-500);
            background: var(--primary-50);
        }

        .form-radio input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .form-radio input[type="radio"]:checked + label {
            color: var(--primary-500);
            font-weight: 600;
        }

        .form-checkbox-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .form-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .form-actions {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-3xl);
            padding-top: var(--spacing-2xl);
            border-top: 1px solid var(--neutral-200);
        }

        .form-actions .btn {
            flex: 1;
        }

        /* Task Detail Page */
        .task-detail-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: var(--spacing-3xl) var(--spacing-lg);
        }

        .task-detail-header {
            margin-bottom: var(--spacing-2xl);
        }

        .task-detail-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
        }

        .task-status-badge {
            display: inline-block;
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: var(--spacing-lg);
        }

        .task-status-badge.pending {
            background: var(--primary-50);
            color: var(--primary-500);
        }

        .task-status-badge.completed {
            background: var(--success-500);
            color: var(--white);
        }

        .task-detail-card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
            margin-bottom: var(--spacing-xl);
        }

        .task-detail-section {
            margin-bottom: var(--spacing-2xl);
        }

        .task-detail-section:last-child {
            margin-bottom: 0;
        }

        .task-detail-section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .task-detail-section-title svg {
            width: 20px;
            height: 20px;
            color: var(--primary-500);
        }

        .task-detail-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
        }

        .task-detail-info-item {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .task-detail-info-label {
            font-size: 13px;
            color: var(--neutral-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .task-detail-info-value {
            font-size: 16px;
            color: var(--neutral-900);
            font-weight: 500;
        }

        .task-provider-card {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            padding: var(--spacing-lg);
            background: var(--neutral-50);
            border-radius: var(--radius-md);
        }

        .task-provider-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
        }

        .task-provider-info {
            flex: 1;
        }

        .task-provider-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .task-provider-role {
            font-size: 14px;
            color: var(--neutral-500);
        }

        .task-description {
            font-size: 15px;
            color: var(--neutral-700);
            line-height: 1.8;
            white-space: pre-wrap;
        }

        /* Invoice Page */
        .invoice-container {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--spacing-3xl) var(--spacing-lg);
        }

        .invoice-header {
            text-align: center;
            margin-bottom: var(--spacing-3xl);
        }

        .invoice-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .invoice-card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-3xl);
            margin-bottom: var(--spacing-xl);
        }

        .invoice-header-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-3xl);
            padding-bottom: var(--spacing-2xl);
            border-bottom: 2px solid var(--neutral-200);
        }

        .invoice-company-info h2 {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-500);
            margin-bottom: var(--spacing-sm);
        }

        .invoice-company-info p {
            font-size: 14px;
            color: var(--neutral-500);
            line-height: 1.6;
        }

        .invoice-details {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            text-align: right;
        }

        .invoice-details-label {
            font-size: 13px;
            color: var(--neutral-500);
            text-transform: uppercase;
        }

        .invoice-details-value {
            font-size: 16px;
            color: var(--neutral-900);
            font-weight: 500;
        }

        .invoice-items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-2xl);
        }

        .invoice-items-table th {
            text-align: left;
            padding: var(--spacing-md);
            border-bottom: 2px solid var(--neutral-200);
            font-size: 14px;
            font-weight: 600;
            color: var(--neutral-700);
            text-transform: uppercase;
        }

        .invoice-items-table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--neutral-200);
            font-size: 15px;
            color: var(--neutral-700);
        }

        .invoice-items-table tr:last-child td {
            border-bottom: none;
        }

        .invoice-total-section {
            display: flex;
            justify-content: flex-end;
            margin-top: var(--spacing-xl);
        }

        .invoice-total-table {
            width: 300px;
        }

        .invoice-total-row {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            font-size: 15px;
        }

        .invoice-total-row.total {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-500);
            padding-top: var(--spacing-md);
            border-top: 2px solid var(--neutral-200);
            margin-top: var(--spacing-sm);
        }

        .invoice-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            margin-top: var(--spacing-2xl);
        }

        /* Confirmation Page */
        .confirmation-container {
            max-width: 600px;
            margin: 0 auto;
            padding: var(--spacing-3xl) var(--spacing-lg);
            text-align: center;
        }

        .confirmation-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto var(--spacing-2xl);
            background: var(--success-500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
        }

        .confirmation-icon svg {
            width: 64px;
            height: 64px;
        }

        .confirmation-title {
            font-size: 36px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
        }

        .confirmation-message {
            font-size: 18px;
            color: var(--neutral-500);
            margin-bottom: var(--spacing-3xl);
            line-height: 1.8;
        }

        .confirmation-details {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
            margin-bottom: var(--spacing-2xl);
            text-align: left;
        }

        .confirmation-details-item {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--neutral-200);
        }

        .confirmation-details-item:last-child {
            border-bottom: none;
        }

        .confirmation-details-label {
            font-size: 15px;
            color: var(--neutral-500);
        }

        .confirmation-details-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--neutral-900);
        }

        .confirmation-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
        }

        /* Settings Pages */
        .settings-container {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--spacing-3xl) var(--spacing-lg);
        }

        .settings-header {
            margin-bottom: var(--spacing-2xl);
        }

        .settings-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .settings-subtitle {
            font-size: 16px;
            color: var(--neutral-500);
        }

        .settings-card {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: var(--radius-xl);
            padding: var(--spacing-2xl);
            margin-bottom: var(--spacing-xl);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            transition: all var(--duration-normal) var(--ease-out);
        }

        .settings-card:hover {
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.2);
        }

        .settings-section {
            margin-bottom: var(--spacing-2xl);
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--neutral-200);
        }

        .avatar-upload {
            display: flex;
            align-items: center;
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-2xl);
        }

        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid var(--neutral-200);
            object-fit: cover;
        }

        .avatar-upload-actions {
            flex: 1;
        }

        .avatar-upload-btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            margin-right: var(--spacing-md);
        }

        .avatar-upload-note {
            font-size: 13px;
            color: var(--neutral-500);
            margin-top: var(--spacing-sm);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        .form-group-settings {
            margin-bottom: var(--spacing-xl);
        }

        .form-label-settings {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .form-label-settings .required {
            color: var(--primary-500);
        }

        .form-hint {
            font-size: 13px;
            color: var(--neutral-500);
            margin-top: var(--spacing-xs);
        }

        .settings-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: flex-end;
            padding-top: var(--spacing-xl);
            border-top: 1px solid var(--neutral-200);
            margin-top: var(--spacing-xl);
        }

        /* Payment Methods */
        .payment-methods-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }

        .payment-method-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }

        .payment-method-card:hover {
            border-color: var(--primary-500);
            box-shadow: var(--shadow-sm);
        }

        .payment-method-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .payment-method-icon {
            width: 48px;
            height: 48px;
            background: var(--neutral-50);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-500);
        }

        .payment-method-details {
            flex: 1;
        }

        .payment-method-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .payment-method-number {
            font-size: 14px;
            color: var(--neutral-500);
        }

        .payment-method-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .payment-method-badge {
            padding: var(--spacing-xs) var(--spacing-sm);
            background: var(--success-500);
            color: var(--white);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
        }

        /* Notification Settings */
        .notification-group {
            margin-bottom: var(--spacing-xl);
        }

        .notification-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--neutral-200);
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item-info {
            flex: 1;
        }

        .notification-item-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .notification-item-desc {
            font-size: 14px;
            color: var(--neutral-500);
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--neutral-300);
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: var(--white);
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: var(--primary-500);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* Help & Support */
        .help-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
        }

        .help-category-card {
            background: var(--neutral-50);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            cursor: pointer;
            transition: all 0.2s;
        }

        .help-category-card:hover {
            border-color: var(--primary-500);
            box-shadow: var(--shadow-md);
        }

        .help-category-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-500);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            margin-bottom: var(--spacing-md);
        }

        .help-category-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .help-category-desc {
            font-size: 14px;
            color: var(--neutral-500);
        }

        .faq-section {
            margin-top: var(--spacing-3xl);
        }

        .faq-item {
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            overflow: hidden;
        }

        .faq-question {
            padding: var(--spacing-lg);
            background: var(--white);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .faq-question:hover {
            background: var(--neutral-50);
        }

        .faq-question-text {
            font-size: 16px;
            font-weight: 500;
            color: var(--neutral-900);
        }

        .faq-answer {
            padding: 0 var(--spacing-lg) var(--spacing-lg);
            font-size: 15px;
            color: var(--neutral-700);
            line-height: 1.6;
            display: none;
        }

        .faq-item.active .faq-answer {
            display: block;
        }

        .contact-support {
            background: var(--primary-50);
            border: 1px solid var(--primary-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
            text-align: center;
            margin-top: var(--spacing-2xl);
        }

        .contact-support-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-500);
            margin-bottom: var(--spacing-sm);
        }

        .contact-support-desc {
            font-size: 15px;
            color: var(--neutral-700);
            margin-bottom: var(--spacing-lg);
        }

        /* Security Settings */
        .security-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
        }

        .security-item-info {
            flex: 1;
        }

        .security-item-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .security-item-desc {
            font-size: 14px;
            color: var(--neutral-500);
        }

        .security-status {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            margin-left: var(--spacing-md);
        }

        .security-status.active {
            background: var(--success-500);
            color: var(--white);
        }

        .security-status.inactive {
            background: var(--neutral-200);
            color: var(--neutral-700);
        }

        /* Session Management */
        .session-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            transition: opacity 0.3s ease;
        }

        .session-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .session-device {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .session-device-name {
            font-size: 16px;
            font-weight: 500;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .session-location {
            font-size: 14px;
            color: var(--neutral-600);
            margin-bottom: var(--spacing-xs);
        }

        .session-time {
            font-size: 12px;
            color: var(--neutral-500);
        }

        .session-status {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            margin-left: var(--spacing-md);
        }

        .session-status.active {
            background: var(--success-500);
            color: var(--white);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .nav-search {
                max-width: 400px;
            }

            .hero-title {
                font-size: 36px;
            }

            .hero-subtitle {
                font-size: 20px;
            }

            .category-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }
        }

        /* Comprehensive Mobile Responsive Styles */
        @media (max-width: 768px) {
            /* Base Mobile Adjustments */
            body {
                font-size: 15px;
            }

            /* Navigation */
            .nav-container {
                flex-direction: column;
                align-items: stretch;
                flex-wrap: wrap;
                height: auto;
                padding: var(--spacing-md);
                gap: var(--spacing-sm);
            }

            .logo-section {
                flex: 1;
                min-width: 0;
                width: 100%;
                justify-content: space-between;
            }

            .logo {
                font-size: 22px;
            }

            .logo img {
                height: 32px;
            }

            .location-badge {
                display: none; /* Hide on mobile to save space */
            }

            .nav-search {
                order: 3;
                width: 100%;
                max-width: 100%;
                margin: var(--spacing-md) 0 0 0;
            }

            .nav-right {
                order: 2;
                width: 100%;
                display: flex;
                justify-content: flex-start;
                flex-wrap: wrap;
                gap: var(--spacing-sm);
            }

            .nav-link {
                font-size: 14px;
                padding: var(--spacing-xs) var(--spacing-sm);
            }

            .premium-badge {
                font-size: 10px;
                padding: var(--spacing-xs) var(--spacing-sm);
            }

            .user-avatar {
                width: 28px;
                height: 28px;
            }

            /* Hero Section */
            .hero-section {
                padding: var(--spacing-2xl) var(--spacing-md);
            }

            .hero-title {
                font-size: 28px;
                line-height: 1.3;
            }

            .hero-subtitle {
                font-size: 18px;
            }

            .hero-search-wrapper {
                flex-direction: column;
                border-radius: var(--radius-lg);
            }

            .hero-search-input {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: var(--spacing-md) var(--spacing-lg);
                border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            }

            .hero-search-btn {
                width: 100%;
                padding: var(--spacing-md);
                border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            }

            /* Main Container */
            .main-container {
                padding: var(--spacing-xl) var(--spacing-md);
            }

            /* Category Grid */
            .category-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: var(--spacing-md);
            }

            .category-card {
                padding: var(--spacing-lg);
            }

            .category-icon-wrapper {
                width: 56px;
                height: 56px;
            }

            .category-label {
                font-size: 18px;
            }

            /* Tasks Grid */
            .tasks-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }

            .task-card {
                border-radius: var(--radius-lg);
            }

            .task-card-body {
                padding: var(--spacing-lg);
            }

            .task-card-title {
                font-size: 18px;
            }

            .task-card-footer {
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            .task-card-footer .btn,
            .task-card-footer .btn-text {
                width: 100%;
            }

            /* Premium Banner */
            .premium-banner {
                flex-direction: column;
                text-align: center;
                padding: var(--spacing-xl) var(--spacing-lg);
            }

            .banner-image {
                width: 100px;
                height: 100px;
            }

            .banner-title {
                font-size: 28px;
            }

            .banner-subtitle {
                font-size: 16px;
            }

            /* Service Details */
            .service-detail-content {
                grid-template-columns: 1fr;
                gap: var(--spacing-xl);
            }

            .service-header-content {
                flex-direction: column;
                text-align: center;
            }

            .service-cta-card {
                position: relative;
                top: 0;
            }

            /* Forms */
            .survey-form {
                padding: var(--spacing-lg);
            }

            .form-group {
                margin-bottom: var(--spacing-lg);
            }

            .form-label {
                font-size: 15px;
            }

            .form-input,
            .form-textarea,
            .form-select {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: var(--spacing-md);
            }

            /* Invoice Card */
            .invoice-card {
                padding: var(--spacing-lg);
            }

            .invoice-header-section {
                flex-direction: column;
                gap: var(--spacing-lg);
            }

            .invoice-details {
                text-align: left;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 24px;
            }

            .nav-right {
                gap: var(--spacing-sm);
            }

            .nav-link {
                font-size: 13px;
                padding: var(--spacing-xs) var(--spacing-sm);
            }

            .category-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Authentication Pages */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);
            padding: var(--spacing-lg);
        }

        .auth-wrapper {
            width: 100%;
            max-width: 450px;
        }

        .auth-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            padding: var(--spacing-3xl);
            border: 1px solid var(--neutral-200);
        }

        .auth-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }

        .auth-logo {
            font-size: 36px;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            justify-content: center;
            font-weight: 700;
            color: var(--primary-500);
            margin-bottom: var(--spacing-sm);
            letter-spacing: -0.5px;
        }

        .auth-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .auth-subtitle {
            font-size: 15px;
            color: var(--neutral-500);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .form-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--neutral-700);
        }

        .form-input {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            border: 1px solid var(--neutral-300);
            border-radius: var(--radius-md);
            font-size: 15px;
            color: var(--neutral-900);
            transition: all 0.2s;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(165, 59, 43, 0.1);
        }

        .form-input::placeholder {
            color: var(--neutral-400);
        }

        .password-wrapper {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: var(--spacing-md);
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--neutral-500);
            cursor: pointer;
            padding: var(--spacing-xs);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .password-toggle:hover {
            color: var(--primary-500);
        }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            cursor: pointer;
        }

        .form-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary-500);
        }

        .form-checkbox-label {
            font-size: 14px;
            color: var(--neutral-700);
            cursor: pointer;
        }

        .auth-link {
            color: var(--primary-500);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }

        .auth-link:hover {
            color: var(--primary-600);
            text-decoration: underline;
        }

        .auth-divider {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin: var(--spacing-lg) 0;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--neutral-200);
        }

        .auth-divider-text {
            font-size: 14px;
            color: var(--neutral-500);
        }

        .social-auth {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .social-btn {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            border: 1px solid var(--neutral-300);
            border-radius: var(--radius-md);
            background: var(--white);
            color: var(--neutral-700);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .social-btn:hover {
            border-color: var(--neutral-400);
            background: var(--neutral-50);
        }

        .auth-footer {
            text-align: center;
            margin-top: var(--spacing-xl);
            font-size: 14px;
            color: var(--neutral-500);
        }

        .error-message {
            background: var(--primary-50);
            border: 1px solid var(--primary-200);
            color: var(--primary-700);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            font-size: 14px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .success-message {
            background: #F0FDF4;
            border: 1px solid #86EFAC;
            color: #166534;
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            font-size: 14px;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .main-content {
            display: none;
        }

        .main-content.authenticated {
            display: block;
        }

        .auth-container.hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .auth-container {
                padding: var(--spacing-md);
            }

            .auth-card {
                padding: var(--spacing-xl);
            }

            .auth-title {
                font-size: 24px;
            }

            .auth-subtitle {
                font-size: 14px;
            }

            .form-input {
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }

        @media (max-width: 480px) {
            .auth-container {
                padding: var(--spacing-sm);
            }

            .auth-card {
                padding: var(--spacing-lg);
            }

            .auth-title {
                font-size: 22px;
            }

            .auth-logo {
                font-size: 28px;
            }

            .social-btn {
                font-size: 14px;
                padding: var(--spacing-sm) var(--spacing-md);
            }
        }

        /* Landing Page Styles */
        .landing-page {
            min-height: 100vh;
            background: var(--white);
            display: block; /* Ensure it's visible by default */
        }

        .landing-nav {
            background: var(--white);
            border-bottom: 1px solid var(--neutral-200);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
        }

        .landing-nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
            width: 100%;
            box-sizing: border-box;
        }

        @media (max-width: 768px) {
            .landing-nav-container {
                padding: 0 var(--spacing-md);
            }
        }

        .landing-logo {
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 700;
            color: var(--primary-500);
            letter-spacing: -0.5px;
            cursor: pointer;
        }

        .landing-nav-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .landing-nav-link {
            color: var(--neutral-700);
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            transition: color 0.2s;
        }

        .landing-nav-link:hover {
            color: var(--primary-500);
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: var(--spacing-sm);
            color: var(--neutral-700);
            min-width: 44px;
            min-height: 44px;
            align-items: center;
            justify-content: center;
        }

        .mobile-menu-toggle svg {
            width: 24px;
            height: 24px;
        }

        .mobile-menu {
            display: none;
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            background: var(--white);
            border-bottom: 1px solid var(--neutral-200);
            box-shadow: var(--shadow-lg);
            z-index: 999;
            padding: var(--spacing-lg);
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .mobile-menu.active {
            display: flex;
        }

        .mobile-menu-link {
            color: var(--neutral-700);
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }

        .mobile-menu-link:hover {
            background: var(--neutral-50);
            color: var(--primary-500);
        }

        .landing-hero {
            background: linear-gradient(135deg, rgba(165, 59, 43, 0.1) 0%, rgba(255, 255, 255, 0.9) 100%), url('images/bird-s-eye-view-shanghai.png');
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
            padding: var(--spacing-3xl) var(--spacing-lg);
            text-align: center;
            position: relative;
        }

        .landing-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);
            opacity: 0.7;
            z-index: 0;
        }

        .landing-hero-container {
            position: relative;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .landing-hero {
                padding: var(--spacing-2xl) var(--spacing-md);
            }
        }

        .landing-hero-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .landing-hero-title {
            font-size: 56px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-lg);
            line-height: 1.2;
        }

        .landing-hero-subtitle {
            font-size: 24px;
            color: var(--neutral-700);
            margin-bottom: var(--spacing-2xl);
            font-weight: 400;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .landing-hero-cta {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
        }

        .landing-section {
            padding: var(--spacing-3xl) var(--spacing-lg);
        }

        @media (max-width: 768px) {
            .landing-section {
                padding: var(--spacing-2xl) var(--spacing-md);
            }
        }

        .landing-section-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .landing-section-title {
            font-size: 42px;
            font-weight: 700;
            color: var(--neutral-900);
            text-align: center;
            margin-bottom: var(--spacing-md);
        }

        .landing-section-subtitle {
            font-size: 18px;
            color: var(--neutral-500);
            text-align: center;
            margin-bottom: var(--spacing-3xl);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-2xl);
            margin-top: var(--spacing-2xl);
        }

        .feature-card {
            text-align: center;
            padding: var(--spacing-2xl);
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            transition: all 0.3s;
        }

        @media (max-width: 768px) {
            .feature-card {
                padding: var(--spacing-xl);
            }
        }

        .feature-card:hover {
            border-color: var(--primary-500);
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            background: var(--primary-500);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--spacing-lg);
            color: var(--white);
        }

        .feature-icon svg {
            width: 40px;
            height: 40px;
        }

        .feature-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .feature-desc {
            font-size: 15px;
            color: var(--neutral-500);
            line-height: 1.6;
        }

        .how-it-works {
            background: var(--neutral-50);
        }

        .steps-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-2xl);
            margin-top: var(--spacing-2xl);
        }

        .step-card {
            background: var(--white);
            padding: var(--spacing-2xl);
            border-radius: var(--radius-lg);
            border: 1px solid var(--neutral-200);
            position: relative;
        }

        @media (max-width: 768px) {
            .step-card {
                padding: var(--spacing-xl);
            }
        }

        .step-number {
            width: 48px;
            height: 48px;
            background: var(--primary-500);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: var(--spacing-lg);
        }

        .step-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .step-desc {
            font-size: 15px;
            color: var(--neutral-500);
            line-height: 1.6;
        }

        .stats-section {
            position: relative;
            color: var(--white);
            text-align: center;
            padding: var(--spacing-3xl) var(--spacing-lg);
            overflow: hidden;
        }

        .stats-slideshow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .stats-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .stats-slide.active {
            opacity: 1;
        }

        .stats-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(165, 59, 43, 0.85) 0%, rgba(220, 38, 38, 0.85) 100%);
            z-index: 1;
        }

        .stats-section .landing-section-container {
            position: relative;
            z-index: 2;
        }

        .stats-section .stats-grid {
            position: relative;
            z-index: 2;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-2xl);
            margin-top: var(--spacing-2xl);
        }

        .stat-card {
            text-align: center;
        }

        .stat-number {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }

        .stat-label {
            font-size: 18px;
            opacity: 0.9;
        }

        /* Footer Styles */
        .site-footer {
            background: var(--neutral-900);
            color: var(--white);
            padding: var(--spacing-3xl) var(--spacing-lg);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .site-footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-500), transparent);
        }

        .footer-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: var(--spacing-3xl);
        }

        .footer-left {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .footer-copyright {
            font-size: 16px;
            font-weight: 600;
            color: var(--white);
        }

        .footer-disclaimer {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            max-width: 600px;
        }

        .footer-links {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-xs);
        }

        .footer-link {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.2s;
        }

        .footer-link:hover {
            color: rgba(254, 202, 202, 0.9);
        }

        .footer-link-separator {
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
        }

        .footer-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: var(--spacing-lg);
        }

        .footer-logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: var(--white);
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-full);
        }

        .footer-logo img {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        .footer-logo-text {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-500);
        }

        .footer-social {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }

        .social-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            border-radius: 50%;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.1);
        }

        .social-icon:hover {
            background: var(--primary-500);
            color: var(--white);
            transform: translateY(-2px);
        }

        .social-icon svg {
            width: 20px;
            height: 20px;
        }

        @media (max-width: 768px) {
            .footer-content {
                flex-direction: column;
                gap: var(--spacing-xl);
            }

            .footer-right {
                align-items: flex-start;
                width: 100%;
            }

            .footer-social {
                justify-content: flex-start;
            }

            .footer-disclaimer {
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .site-footer {
                padding: var(--spacing-2xl) var(--spacing-md);
            }

            .footer-copyright {
                font-size: 14px;
            }

            .footer-disclaimer {
                font-size: 13px;
            }

            .footer-links {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-xs);
            }

            .footer-link-separator {
                display: none;
            }
        }

        .cta-section {
            position: relative;
            color: var(--white);
            text-align: center;
            padding: var(--spacing-3xl) var(--spacing-lg);
            overflow: hidden;
        }

        .cta-slideshow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .cta-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .cta-slide.active {
            opacity: 1;
        }

        .cta-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(165, 59, 43, 0.85) 0%, rgba(220, 38, 38, 0.85) 100%);
            z-index: 1;
        }

        .cta-section .landing-section-container {
            position: relative;
            z-index: 2;
        }

        @media (max-width: 768px) {
            .cta-section {
                padding: var(--spacing-2xl) var(--spacing-md);
            }
        }

        .cta-title {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: var(--spacing-lg);
        }

        .cta-subtitle {
            font-size: 20px;
            margin-bottom: var(--spacing-2xl);
            opacity: 0.95;
        }

        .cta-buttons {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-white {
            background: var(--white);
            color: var(--primary-500);
            border: none;
        }

        .btn-white:hover {
            background: var(--neutral-100);
        }

        .btn-outline-white {
            background: transparent;
            color: var(--white);
            border: 2px solid var(--white);
        }

        .btn-outline-white:hover {
            background: var(--white);
            color: var(--primary-500);
        }

        .landing-page.hidden {
            display: none;
        }

        /* Agent Login & Dashboard Styles */
        .agent-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);
            padding: var(--spacing-lg);
        }

        .agent-container.hidden {
            display: none;
        }

        .agent-login-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            padding: var(--spacing-3xl);
            border: 1px solid var(--neutral-200);
            max-width: 450px;
            width: 100%;
        }

        .agent-dashboard {
            min-height: 100vh;
            background: var(--neutral-50);
            display: none;
        }

        .agent-dashboard.active {
            display: block;
        }

        .agent-header {
            background: var(--white);
            border-bottom: 1px solid var(--neutral-200);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .agent-header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .agent-header-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-500);
        }

        .agent-header-actions {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }

        .agent-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-2xl) var(--spacing-lg);
        }

        .requests-section {
            margin-bottom: var(--spacing-3xl);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
        }

        .section-header-actions {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }

        .view-toggle {
            display: flex;
            gap: var(--spacing-xs);
            background: var(--neutral-100);
            border-radius: var(--radius-lg);
            padding: 4px;
        }

        .view-toggle-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            color: var(--neutral-600);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .view-toggle-btn:hover {
            background: var(--neutral-200);
            color: var(--neutral-900);
        }

        .view-toggle-btn.active {
            background: var(--primary-500);
            color: var(--white);
        }

        /* List View Styles */
        .requests-list-view {
            display: none;
        }

        .requests-list-view.active {
            display: block;
        }

        .requests-grid-view {
            display: block;
        }

        .requests-grid-view.hidden {
            display: none;
        }

        .requests-table {
            width: 100%;
            background: var(--white);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--neutral-200);
        }

        .requests-table-header {
            background: var(--neutral-50);
            padding: var(--spacing-lg);
            display: grid;
            grid-template-columns: 2fr 1.5fr 1fr 1fr 1fr 1.2fr;
            gap: var(--spacing-md);
            font-weight: 600;
            color: var(--neutral-700);
            border-bottom: 2px solid var(--neutral-200);
            font-size: 14px;
        }

        .requests-table-row {
            padding: var(--spacing-lg);
            display: grid;
            grid-template-columns: 2fr 1.5fr 1fr 1fr 1fr 1.2fr;
            gap: var(--spacing-md);
            align-items: center;
            border-bottom: 1px solid var(--neutral-200);
            transition: all 0.2s;
            cursor: pointer;
        }

        .requests-table-row:hover {
            background: var(--neutral-50);
        }

        .requests-table-row:last-child {
            border-bottom: none;
        }

        .table-cell {
            font-size: 14px;
            color: var(--neutral-700);
        }

        .table-cell-service {
            font-weight: 600;
            color: var(--neutral-900);
        }

        .table-cell-client {
            color: var(--neutral-700);
        }

        .table-cell-status {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .table-cell-payment {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-weight: 600;
        }

        .payment-badge {
            padding: 4px 10px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .payment-badge.paid {
            background: #D1FAE5;
            color: #065F46;
        }

        .payment-badge.pending {
            background: #FEF3C7;
            color: #92400E;
        }

        .payment-badge.no-invoice {
            background: var(--neutral-100);
            color: var(--neutral-600);
        }

        .section-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--neutral-900);
        }

        .request-card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            transition: all 0.2s;
        }

        .request-card:hover {
            box-shadow: var(--shadow-md);
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--neutral-200);
        }

        .request-info h3 {
            font-size: 20px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .request-meta {
            display: flex;
            gap: var(--spacing-lg);
            flex-wrap: wrap;
            font-size: 14px;
            color: var(--neutral-500);
        }

        .request-status {
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
        }

        .request-status.pending {
            background: #FEF3C7;
            color: #92400E;
        }

        .request-status.assigned {
            background: #DBEAFE;
            color: #1E40AF;
        }

        .request-status.completed {
            background: #D1FAE5;
            color: #065F46;
        }

        .request-details {
            margin-bottom: var(--spacing-lg);
        }

        .request-detail-row {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            font-size: 15px;
        }

        .request-detail-label {
            font-weight: 600;
            color: var(--neutral-700);
            min-width: 120px;
        }

        .request-detail-value {
            color: var(--neutral-600);
        }

        .request-actions {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .assign-provider-form {
            background: var(--neutral-50);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-top: var(--spacing-lg);
            display: none;
        }

        .assign-provider-form.active {
            display: block;
        }

        /* Agent Tabs */
        .agent-tabs {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xl);
            border-bottom: 2px solid var(--neutral-200);
        }

        .agent-tab {
            padding: var(--spacing-md) var(--spacing-xl);
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 16px;
            font-weight: 600;
            color: var(--neutral-600);
            cursor: pointer;
            transition: all 0.2s;
        }

        .agent-tab:hover {
            color: var(--primary-500);
        }

        .agent-tab.active {
            color: var(--primary-500);
            border-bottom-color: var(--primary-500);
        }

        .agent-tab-content {
            display: none;
        }

        .agent-tab-content.active {
            display: block;
        }

        /* Chat Styles */
        .chat-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-2xl) var(--spacing-lg);
        }

        .chat-header {
            margin-bottom: var(--spacing-2xl);
        }

        .chat-header-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--neutral-900);
            margin: var(--spacing-md) 0 var(--spacing-sm) 0;
        }

        .chat-header-subtitle {
            font-size: 16px;
            color: var(--neutral-600);
        }

        .chat-wrapper {
            background: var(--white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-xl);
            background: var(--neutral-50);
        }

        .chat-welcome {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
        }

        .chat-welcome-icon {
            font-size: 64px;
            margin-bottom: var(--spacing-md);
        }

        .chat-welcome-text {
            font-size: 18px;
            color: var(--neutral-600);
        }

        .chat-message {
            display: flex;
            margin-bottom: var(--spacing-lg);
            animation: fadeIn 0.3s;
        }

        .chat-message.user {
            justify-content: flex-end;
        }

        .chat-message.agent {
            justify-content: flex-start;
        }

        .chat-message-bubble {
            max-width: 70%;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-lg);
            word-wrap: break-word;
        }

        .chat-message.user .chat-message-bubble {
            background: var(--primary-500);
            color: var(--white);
            border-bottom-right-radius: 4px;
        }

        .chat-message.agent .chat-message-bubble {
            background: var(--white);
            color: var(--neutral-900);
            border: 1px solid var(--neutral-200);
            border-bottom-left-radius: 4px;
        }

        .chat-message-time {
            font-size: 12px;
            color: var(--neutral-500);
            margin-top: var(--spacing-xs);
            text-align: right;
        }

        .chat-message.agent .chat-message-time {
            text-align: left;
        }

        .chat-input-container {
            display: flex;
            gap: var(--spacing-sm);
            padding: var(--spacing-lg);
            background: var(--white);
            border-top: 1px solid var(--neutral-200);
        }

        .chat-input {
            flex: 1;
            padding: var(--spacing-md) var(--spacing-lg);
            border: 1px solid var(--neutral-300);
            border-radius: var(--radius-lg);
            font-size: 15px;
            outline: none;
            transition: all 0.2s;
        }

        .chat-input:focus {
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(165, 59, 43, 0.1);
        }

        .chat-send-btn {
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--primary-500);
            color: var(--white);
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-send-btn:hover {
            background: var(--primary-600);
            transform: translateY(-1px);
        }

        /* Agent Chat Styles */
        .chats-list {
            display: grid;
            gap: var(--spacing-md);
        }

        .chat-item {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            cursor: pointer;
            transition: all 0.2s;
        }

        .chat-item:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary-300);
        }

        .chat-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .chat-item-user {
            font-weight: 600;
            color: var(--neutral-900);
        }

        .chat-item-time {
            font-size: 12px;
            color: var(--neutral-500);
        }

        .chat-item-preview {
            font-size: 14px;
            color: var(--neutral-600);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .chat-view {
            background: var(--white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .chat-view-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--neutral-200);
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .chat-view-user-info {
            flex: 1;
        }

        .chat-view-user-name {
            font-weight: 600;
            color: var(--neutral-900);
            font-size: 18px;
        }

        .chat-view-user-email {
            font-size: 14px;
            color: var(--neutral-600);
        }

        .chat-view-messages {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-xl);
            background: var(--neutral-50);
        }

        .chat-view-input {
            display: flex;
            gap: var(--spacing-sm);
            padding: var(--spacing-lg);
            background: var(--white);
            border-top: 1px solid var(--neutral-200);
        }

        /* Notification Toast */
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            padding: var(--spacing-lg);
            min-width: 320px;
            max-width: 400px;
            z-index: 10000;
            display: none;
            animation: slideInRight 0.3s ease-out;
        }

        .notification-toast.show {
            display: block;
        }

        .notification-toast-content {
            display: flex;
            gap: var(--spacing-md);
            align-items: flex-start;
        }

        .notification-toast-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .notification-toast-text {
            flex: 1;
        }

        .notification-toast-title {
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
            font-size: 16px;
        }

        .notification-toast-message {
            font-size: 14px;
            color: var(--neutral-600);
            line-height: 1.5;
        }

        .notification-toast-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--neutral-500);
            cursor: pointer;
            padding: 0;
            line-height: 1;
            flex-shrink: 0;
        }

        .notification-toast-close:hover {
            color: var(--neutral-900);
        }

        .notification-badge {
            background: var(--primary-500);
            color: var(--white);
            border-radius: var(--radius-full);
            padding: 2px 8px;
            font-size: 12px;
            font-weight: 600;
            margin-left: var(--spacing-sm);
        }

        /* Floating Chat Button */
        .floating-chat-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            border-radius: 50%;
            box-shadow: 0 4px 20px rgba(165, 59, 43, 0.4);
            display: none; /* Hidden by default, shown when user logs in */
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 9999;
            transition: all 0.3s ease;
            color: var(--white);
        }

        /* Hide on landing page and agent dashboard */
        #landing-page ~ .floating-chat-button,
        .agent-dashboard.active ~ .floating-chat-button {
            display: none !important;
        }

        .floating-chat-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(165, 59, 43, 0.5);
        }

        .floating-chat-button:active {
            transform: scale(0.95);
        }

        .floating-chat-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #EF4444;
            color: var(--white);
            border-radius: var(--radius-full);
            padding: 4px 8px;
            font-size: 12px;
            font-weight: 700;
            min-width: 20px;
            text-align: center;
            border: 2px solid var(--white);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        @media (max-width: 768px) {
            .floating-chat-button {
                width: 56px;
                height: 56px;
                bottom: 15px;
                right: 15px;
            }

            .floating-chat-button svg {
                width: 22px;
                height: 22px;
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .invoice-section {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-top: var(--spacing-lg);
            display: none;
        }

        .invoice-section.active {
            display: block;
        }

        .invoice-items {
            margin: var(--spacing-lg) 0;
        }

        .invoice-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--neutral-200);
            align-items: center;
        }

        .invoice-item:last-child {
            border-bottom: none;
        }

        .invoice-total {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-lg);
            background: var(--neutral-50);
            border-radius: var(--radius-md);
            font-size: 18px;
            font-weight: 700;
            margin-top: var(--spacing-lg);
        }

        @media (max-width: 768px) {
            .agent-login-card {
                padding: var(--spacing-xl);
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .invoice-item {
                grid-template-columns: 1fr;
                gap: var(--spacing-sm);
            }

            .request-header {
                flex-direction: column;
                gap: var(--spacing-md);
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-md);
            }

            /* Mobile styles for agent dashboard */
            .agent-header {
                padding: var(--spacing-md);
            }

            .agent-header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-md);
            }

            .agent-header-title {
                font-size: 20px;
            }

            .agent-header-actions {
                width: 100%;
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            .agent-header-actions .btn {
                width: 100%;
            }

            .agent-content {
                padding: var(--spacing-lg) var(--spacing-md);
            }

            .section-title {
                font-size: 22px;
            }

            .request-card {
                padding: var(--spacing-lg);
            }

            /* Mobile chat styles */
            .chat-container {
                padding: var(--spacing-lg) var(--spacing-md);
            }

            .chat-wrapper {
                height: calc(100vh - 200px);
            }

            .chat-header-title {
                font-size: 24px;
            }

            .chat-message-bubble {
                max-width: 85%;
            }

            .chat-view {
                height: calc(100vh - 150px);
            }

            .agent-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .agent-tab {
                padding: var(--spacing-sm) var(--spacing-md);
                font-size: 14px;
                white-space: nowrap;
            }

            .notification-toast {
                right: 10px;
                left: 10px;
                max-width: none;
                min-width: auto;
            }

            /* Mobile list view */
            .requests-table-header,
            .requests-table-row {
                grid-template-columns: 1fr;
                gap: var(--spacing-sm);
            }

            .requests-table-header {
                display: none;
            }

            .requests-table-row {
                padding: var(--spacing-md);
                border: 1px solid var(--neutral-200);
                border-radius: var(--radius-md);
                margin-bottom: var(--spacing-sm);
            }

            .table-cell {
                display: flex;
                justify-content: space-between;
                padding: var(--spacing-xs) 0;
            }

            .table-cell::before {
                content: attr(data-label);
                font-weight: 600;
                color: var(--neutral-600);
            }

            .table-cell-service::before { content: 'Service: '; }
            .table-cell-client::before { content: 'Client: '; }
            .table-cell-status::before { content: 'Status: '; }
            .table-cell::nth-child(4)::before { content: 'Date: '; }
            .table-cell::nth-child(5)::before { content: 'Amount: '; }
            .table-cell-payment::before { content: 'Payment: '; }
        }

        @media (max-width: 480px) {
            .agent-header {
                padding: var(--spacing-sm) var(--spacing-md);
            }

            .agent-header-title {
                font-size: 18px;
            }

            .agent-content {
                padding: var(--spacing-md);
            }

            .section-title {
                font-size: 20px;
            }

            .request-card {
                padding: var(--spacing-md);
            }
        }

        @media (max-width: 768px) {
            .landing-hero-title {
                font-size: 36px;
            }

            .landing-hero-subtitle {
                font-size: 18px;
            }

            .landing-section-title {
                font-size: 32px;
            }

            .landing-section-subtitle {
                font-size: 16px;
            }

            .features-grid,
            .steps-container,
            .stats-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-lg);
            }

            .landing-nav-right {
                gap: var(--spacing-sm);
            }

            .landing-nav-link {
                display: none;
            }

            #desktop-join-btn {
                display: none !important;
            }

            .mobile-menu-toggle {
                display: flex;
            }

            .landing-hero-cta {
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            .landing-hero-cta .btn {
                width: 100%;
            }

            .cta-buttons {
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            .cta-buttons .btn {
                width: 100%;
            }

            .stat-number {
                font-size: 36px;
            }

            .stat-label {
                font-size: 16px;
            }

            .feature-icon {
                width: 64px;
                height: 64px;
            }

            .feature-icon svg {
                width: 32px;
                height: 32px;
            }

            .step-number {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .landing-nav-container {
                padding: 0 var(--spacing-md);
            }

            .landing-logo {
                font-size: 24px;
            }

            .landing-hero {
                padding: var(--spacing-xl) var(--spacing-md);
            }

            .landing-hero-title {
                font-size: 28px;
                margin-bottom: var(--spacing-md);
            }

            .landing-hero-subtitle {
                font-size: 16px;
                margin-bottom: var(--spacing-xl);
            }

            .landing-section {
                padding: var(--spacing-xl) var(--spacing-md);
            }

            .landing-section-title {
                font-size: 28px;
                margin-bottom: var(--spacing-sm);
            }

            .landing-section-subtitle {
                font-size: 14px;
                margin-bottom: var(--spacing-2xl);
            }

            .cta-title {
                font-size: 28px;
            }

            .cta-subtitle {
                font-size: 16px;
            }

            .feature-card {
                padding: var(--spacing-lg);
            }

            .feature-title {
                font-size: 18px;
            }

            .feature-desc {
                font-size: 14px;
            }

            .step-card {
                padding: var(--spacing-lg);
            }

            .step-title {
                font-size: 18px;
            }

            .step-desc {
                font-size: 14px;
            }

            .stat-number {
                font-size: 32px;
            }

            .stat-label {
                font-size: 14px;
            }

            .stats-section {
                padding: var(--spacing-xl) var(--spacing-md);
            }
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Paystack Inline JS -->
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <script>
        // ============================================
        // Firebase Configuration
        // ============================================
        // SETUP INSTRUCTIONS:
        // 1. Go to https://console.firebase.google.com/
        // 2. Create a new project (or select existing)
        // 3. Enable Authentication:
        //    - Go to Authentication > Sign-in method
        //    - Enable "Email/Password"
        // 4. Enable Firestore Database:
        //    - Go to Firestore Database > Create database
        //    - Start in test mode (for development)
        //    - Choose a location
        // 5. Get your config:
        //    - Go to Project Settings > General
        //    - Scroll to "Your apps" section
        //    - Click the </> icon to add a web app
        //    - Copy the firebaseConfig object
        // 6. Replace the values below with your config
        // 7. Set Firestore Security Rules (Firestore > Rules):
        //    rules_version = '2';
        //    service cloud.firestore {
        //      match /databases/{database}/documents {
        //        match /users/{userId} {
        //          allow read, write: if request.auth != null && request.auth.uid == userId;
        //        }
        //        match /requests/{requestId} {
        //          allow read: if request.auth != null;
        //          allow create: if request.auth != null;
        //          allow update, delete: if request.auth != null;
        //        }
        //      }
        //    }
        const firebaseConfig = {
            apiKey: "AIzaSyAIfMwzFE5Kgi1s1n77R8CL66anwR6HPOw",
            authDomain: "homefix-dd9d4.firebaseapp.com",
            projectId: "homefix-dd9d4",
            storageBucket: "homefix-dd9d4.firebasestorage.app",
            messagingSenderId: "634866197350",
            appId: "1:634866197350:web:26a4218947dfe652f05ea7",
            measurementId: "G-S6S707G0G8"
        };

        // Initialize Firebase
        let firebaseInitialized = false;
        try {
            firebase.initializeApp(firebaseConfig);
            firebaseInitialized = true;
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
            alert('Firebase configuration error. Please check your Firebase config.');
        }
        
        // Initialize Firebase services
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Check if Firebase is properly initialized
        if (!firebaseInitialized) {
            console.error('Firebase is not initialized. Please check your configuration.');
        }
        
        // ============================================
        // Firebase Service Functions
        // ============================================
        
        // Authentication Service
        const firebaseAuth = {
            // Sign up new user
            async signUp(email, password, userData) {
                try {
                    console.log('Attempting to create user with email:', email);
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;
                    console.log('User created successfully:', user.uid);
                    
                    // Save user data to Firestore
                    try {
                        await db.collection('users').doc(user.uid).set({
                            email: email,
                            name: userData.name,
                            phone: userData.phone,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        console.log('User data saved to Firestore');
                    } catch (firestoreError) {
                        console.error('Error saving user data to Firestore:', firestoreError);
                        // User is created but data save failed - still return success
                        // The user can update their profile later
                    }
                    
                    return { success: true, user: user };
                } catch (error) {
                    console.error('Firebase signUp error:', error);
                    console.error('Error code:', error.code);
                    console.error('Error message:', error.message);
                    return { success: false, error: error.message || error.code || 'Unknown error' };
                }
            },
            
            // Sign in existing user
            async signIn(email, password) {
                try {
                    const userCredential = await auth.signInWithEmailAndPassword(email, password);
                    return { success: true, user: userCredential.user };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            // Sign out
            async signOut() {
                try {
                    await auth.signOut();
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            // Get current user
            getCurrentUser() {
                const user = auth.currentUser;
                console.log('getCurrentUser called, user:', user ? user.uid : 'null');
                return user;
            },
            
            // Wait for auth state to be ready
            async waitForAuthState() {
                return new Promise((resolve) => {
                    if (auth.currentUser) {
                        resolve(auth.currentUser);
                    } else {
                        const unsubscribe = auth.onAuthStateChanged((user) => {
                            unsubscribe();
                            resolve(user);
                        });
                    }
                });
            },
            
            // Listen to auth state changes
            onAuthStateChanged(callback) {
                return auth.onAuthStateChanged(callback);
            },

            // Sign in with Google
            async signInWithGoogle() {
                try {
                    const provider = new firebase.auth.GoogleAuthProvider();
                    const result = await auth.signInWithPopup(provider);
                    const user = result.user;
                    
                    // Check if user already exists in Firestore
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    
                    if (!userDoc.exists) {
                        // New user - save to Firestore
                        const name = user.displayName || user.email.split('@')[0];
                        await db.collection('users').doc(user.uid).set({
                            email: user.email,
                            name: name,
                            phone: user.phoneNumber || '',
                            photoURL: user.photoURL || '',
                            provider: 'google',
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    } else {
                        // Existing user - update last login
                        await db.collection('users').doc(user.uid).update({
                            lastLoginAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                    
                    return { success: true, user: user };
                } catch (error) {
                    console.error('Google sign-in error:', error);
                    return { success: false, error: error.message };
                }
            }
        };
        
        // Firestore Service - Users
        const firebaseUsers = {
            async getUser(uid) {
                try {
                    const doc = await db.collection('users').doc(uid).get();
                    if (doc.exists) {
                        return { success: true, data: doc.data() };
                    }
                    return { success: false, error: 'User not found' };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async updateUser(uid, data) {
                try {
                    await db.collection('users').doc(uid).update(data);
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
        };
        
        // Paystack Payment Configuration
        const PAYSTACK_PUBLIC_KEY = 'pk_test_e9e87ccee455380ede7a75f676e5d42fe127b88b'; // Your Paystack Public Key
        
        // Paystack Payment Service
        const paystackAPI = {
            // Initialize Paystack payment
            async initializePayment(email, amount, invoiceId, metadata = {}) {
                return new Promise((resolve, reject) => {
                    const handler = PaystackPop.setup({
                        key: PAYSTACK_PUBLIC_KEY,
                        email: email,
                        amount: Math.round(amount * 100), // Convert to kobo/pesewas (smallest currency unit)
                        currency: 'GHS', // Ghana Cedis
                        ref: `INV-${invoiceId}-${Date.now()}`, // Unique reference
                        metadata: {
                            custom_fields: [
                                {
                                    display_name: "Invoice ID",
                                    variable_name: "invoice_id",
                                    value: invoiceId
                                },
                                ...Object.entries(metadata).map(([key, value]) => ({
                                    display_name: key,
                                    variable_name: key,
                                    value: value
                                }))
                            ]
                        },
                        callback: function(response) {
                            // Payment successful
                            resolve({
                            success: true,
                                reference: response.reference,
                                transactionId: response.reference,
                                status: 'success'
                            });
                        },
                        onClose: function() {
                            // User closed the payment modal
                            reject({
                                success: false,
                                error: 'Payment cancelled by user',
                                cancelled: true
                            });
                        }
                    });
                    
                    handler.openIframe();
                });
            },
            
            // Verify payment (optional - for server-side verification)
            async verifyPayment(reference) {
                // This would typically be done on your backend
                // For now, we'll trust the callback response
                        return {
                            success: true,
                    reference: reference,
                    status: 'success'
                };
            }
        };
        
        // Firestore Service - Requests
        const firebaseRequests = {
            async createRequest(requestData) {
                try {
                    console.log(' Creating request in Firestore:', {
                        clientEmail: requestData.clientEmail,
                        clientName: requestData.clientName,
                        service: requestData.service,
                        status: requestData.status
                    });
                    
                    const docRef = await db.collection('requests').add({
                        ...requestData,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    console.log(' Request created successfully with ID:', docRef.id);
                    return { success: true, id: docRef.id };
                } catch (error) {
                    console.error(' Error creating request:', error);
                    return { success: false, error: error.message };
                }
            },
            
            async getRequest(requestId) {
                try {
                    const doc = await db.collection('requests').doc(requestId).get();
                    if (doc.exists) {
                        return { success: true, data: { id: doc.id, ...doc.data() } };
                    }
                    return { success: false, error: 'Request not found' };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async updateRequest(requestId, data) {
                try {
                    await db.collection('requests').doc(requestId).update({
                        ...data,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async getUserRequests(userUid) {
                try {
                    console.log(' getUserRequests - Searching for user UID:', userUid);
                    
                    if (!userUid) {
                        console.error(' No user UID provided');
                        return { success: false, error: 'No user UID provided' };
                    }
                    
                    const requests = [];
                    
                    // Query requests by user UID
                    try {
                        // Try with orderBy first (faster if index exists)
                        let snapshot;
                        try {
                            snapshot = await db.collection('requests')
                                .where('clientUid', '==', userUid)
                                .orderBy('createdAt', 'desc')
                                .get();
                        } catch (orderByError) {
                            // If orderBy fails (no index), try without it
                            console.warn(' orderBy failed, trying without orderBy:', orderByError.message);
                            try {
                                snapshot = await db.collection('requests')
                                    .where('clientUid', '==', userUid)
                                    .get();
                            } catch (whereError) {
                                // If where also fails, get all and filter client-side
                                console.warn(' where query failed, fetching all and filtering:', whereError.message);
                                const allSnapshot = await db.collection('requests').get();
                                snapshot = {
                                    forEach: (callback) => {
                                        allSnapshot.forEach(doc => {
                                            const data = doc.data();
                                            if (data.clientUid === userUid) {
                                                callback({ id: doc.id, data: () => data });
                                            }
                                        });
                                    },
                                    size: allSnapshot.size
                                };
                            }
                        }
                        
                        console.log(' Total requests found for user:', snapshot.size || 0);
                        
                        snapshot.forEach(doc => {
                            const data = doc.data ? doc.data() : doc;
                            console.log(' Request found:', {
                                id: doc.id,
                                service: data.service,
                                status: data.status,
                                clientUid: data.clientUid
                            });
                            requests.push({ id: doc.id, ...data });
                        });
                        
                        console.log(` Total matching requests: ${requests.length}`);
                    } catch (error) {
                        console.error(' Error fetching requests:', error);
                        return { success: false, error: error.message };
                    }
                    
                    return { success: true, data: requests };
                } catch (error) {
                    console.error(' getUserRequests error:', error);
                    return { success: false, error: error.message };
                }
            },
            
            async getAllRequests() {
                try {
                    const snapshot = await db.collection('requests')
                        .orderBy('createdAt', 'desc')
                        .get();
                    
                    const requests = [];
                    snapshot.forEach(doc => {
                        requests.push({ id: doc.id, ...doc.data() });
                    });
                    
                    return { success: true, data: requests };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
        };
        
        // Helper function to convert Firestore timestamp to date
        function convertTimestamp(timestamp) {
            if (timestamp && timestamp.toDate) {
                return timestamp.toDate();
            }
            return new Date();
        }

        // Firestore Service - Notifications
        const firebaseNotifications = {
            async createNotification(userUid, notificationData) {
                try {
                    const docRef = await db.collection('notifications').add({
                        userId: userUid,
                        ...notificationData,
                        read: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    return { success: true, id: docRef.id };
                } catch (error) {
                    console.error('Error creating notification:', error);
                    return { success: false, error: error.message };
                }
            },

            async getUserNotifications(userUid) {
                try {
                    const snapshot = await db.collection('notifications')
                        .where('userId', '==', userUid)
                        .orderBy('createdAt', 'desc')
                        .limit(50)
                        .get();
                    
                    const notifications = [];
                    snapshot.forEach(doc => {
                        notifications.push({ id: doc.id, ...doc.data() });
                    });
                    return { success: true, data: notifications };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },

            async markAsRead(notificationId) {
                try {
                    await db.collection('notifications').doc(notificationId).update({
                        read: true,
                        readAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },

            // Real-time listener for notifications
            onNotificationsChange(userUid, callback) {
                return db.collection('notifications')
                    .where('userId', '==', userUid)
                    .where('read', '==', false)
                    .orderBy('createdAt', 'desc')
                    .onSnapshot((snapshot) => {
                        const notifications = [];
                        snapshot.forEach(doc => {
                            notifications.push({ id: doc.id, ...doc.data() });
                        });
                        callback(notifications);
                    }, (error) => {
                        console.error('Error listening to notifications:', error);
                    });
            }
        };

        // Firestore Service - Chat
        const firebaseChat = {
            async createChat(userUid, agentId, requestId) {
                try {
                    // Check if chat already exists
                    const existingChats = await db.collection('chats')
                        .where('userUid', '==', userUid)
                        .where('requestId', '==', requestId)
                        .get();
                    
                    if (!existingChats.empty) {
                        return { success: true, id: existingChats.docs[0].id, exists: true };
                    }

                    const docRef = await db.collection('chats').add({
                        userUid: userUid,
                        agentId: agentId || 'admin',
                        requestId: requestId || null,
                        lastMessage: '',
                        lastMessageAt: firebase.firestore.FieldValue.serverTimestamp(),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    return { success: true, id: docRef.id, exists: false };
                } catch (error) {
                    console.error('Error creating chat:', error);
                    return { success: false, error: error.message };
                }
            },

            async sendMessage(chatId, senderId, senderType, message) {
                try {
                    await db.collection('chats').doc(chatId).collection('messages').add({
                        senderId: senderId,
                        senderType: senderType, // 'user' or 'agent'
                        message: message,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // Update chat last message
                    await db.collection('chats').doc(chatId).update({
                        lastMessage: message,
                        lastMessageAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    return { success: true };
                } catch (error) {
                    console.error('Error sending message:', error);
                    return { success: false, error: error.message };
                }
            },

            async getUserChats(userUid) {
                try {
                    const snapshot = await db.collection('chats')
                        .where('userUid', '==', userUid)
                        .orderBy('lastMessageAt', 'desc')
                        .get();
                    
                    const chats = [];
                    snapshot.forEach(doc => {
                        chats.push({ id: doc.id, ...doc.data() });
                    });
                    return { success: true, data: chats };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },

            async getAllChats() {
                try {
                    const snapshot = await db.collection('chats')
                        .orderBy('lastMessageAt', 'desc')
                        .get();
                    
                    const chats = [];
                    snapshot.forEach(doc => {
                        chats.push({ id: doc.id, ...doc.data() });
                    });
                    return { success: true, data: chats };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },

            async getChatMessages(chatId) {
                try {
                    const snapshot = await db.collection('chats').doc(chatId)
                        .collection('messages')
                        .orderBy('createdAt', 'asc')
                        .get();
                    
                    const messages = [];
                    snapshot.forEach(doc => {
                        messages.push({ id: doc.id, ...doc.data() });
                    });
                    return { success: true, data: messages };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },

            // Real-time listener for messages
            onMessagesChange(chatId, callback) {
                return db.collection('chats').doc(chatId)
                    .collection('messages')
                    .orderBy('createdAt', 'asc')
                    .onSnapshot((snapshot) => {
                        const messages = [];
                        snapshot.forEach(doc => {
                            messages.push({ id: doc.id, ...doc.data() });
                        });
                        callback(messages);
                    }, (error) => {
                        console.error('Error listening to messages:', error);
                    });
            },

            // Real-time listener for all chats (for agents)
            onChatsChange(callback) {
                return db.collection('chats')
                    .orderBy('lastMessageAt', 'desc')
                    .onSnapshot((snapshot) => {
                        const chats = [];
                        snapshot.forEach(doc => {
                            chats.push({ id: doc.id, ...doc.data() });
                        });
                        callback(chats);
                    }, (error) => {
                        console.error('Error listening to chats:', error);
                    });
            }
        };
    </script>
    <script>
        // ============================================
        // IndexedDB Database Module
        // ============================================
        const DB_NAME = 'HomeFixDB';
        const DB_VERSION = 1;
        let idb = null;

        // Initialize IndexedDB
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    idb = request.result;
                    resolve(idb);
                };

                request.onupgradeneeded = (event) => {
                    const db = event.target.result;

                    // Users store
                    if (!db.objectStoreNames.contains('users')) {
                        const usersStore = db.createObjectStore('users', { keyPath: 'email' });
                        usersStore.createIndex('email', 'email', { unique: true });
                    }

                    // Requests store
                    if (!db.objectStoreNames.contains('requests')) {
                        const requestsStore = db.createObjectStore('requests', { keyPath: 'id', autoIncrement: true });
                        requestsStore.createIndex('clientEmail', 'clientEmail', { unique: false });
                        requestsStore.createIndex('status', 'status', { unique: false });
                        requestsStore.createIndex('createdAt', 'createdAt', { unique: false });
                    }

                    // Sessions store (for authentication state)
                    if (!db.objectStoreNames.contains('sessions')) {
                        const sessionsStore = db.createObjectStore('sessions', { keyPath: 'key' });
                    }

                    // Agents store
                    if (!db.objectStoreNames.contains('agents')) {
                        const agentsStore = db.createObjectStore('agents', { keyPath: 'username' });
                    }
                };
            });
        }

        // Database API - Users
        const userDB = {
            async getAll() {
                if (!idb) await initDB();
                const tx = idb.transaction('users', 'readonly');
                const store = tx.objectStore('users');
                return store.getAll();
            },

            async get(email) {
                if (!idb) await initDB();
                const tx = idb.transaction('users', 'readonly');
                const store = tx.objectStore('users');
                return store.get(email);
            },

            async add(user) {
                if (!idb) await initDB();
                const tx = idb.transaction('users', 'readwrite');
                const store = tx.objectStore('users');
                return store.add(user);
            },

            async update(email, user) {
                if (!idb) await initDB();
                const tx = idb.transaction('users', 'readwrite');
                const store = tx.objectStore('users');
                return store.put({ ...user, email });
            },

            async delete(email) {
                if (!idb) await initDB();
                const tx = idb.transaction('users', 'readwrite');
                const store = tx.objectStore('users');
                return store.delete(email);
            },

            async findByEmail(email) {
                const user = await this.get(email);
                return user;
            }
        };

        // Database API - Requests
        const requestDB = {
            async getAll() {
                if (!idb) await initDB();
                const tx = idb.transaction('requests', 'readonly');
                const store = tx.objectStore('requests');
                return store.getAll();
            },

            async get(id) {
                if (!idb) await initDB();
                const tx = idb.transaction('requests', 'readonly');
                const store = tx.objectStore('requests');
                return store.get(id);
            },

            async add(request) {
                if (!idb) await initDB();
                return new Promise((resolve, reject) => {
                    const tx = idb.transaction('requests', 'readwrite');
                    const store = tx.objectStore('requests');
                    const request_obj = store.add(request);
                    request_obj.onsuccess = () => {
                        resolve(request_obj.result); // Returns the auto-generated ID
                    };
                    request_obj.onerror = () => reject(request_obj.error);
                });
            },

            async update(id, request) {
                if (!idb) await initDB();
                const tx = idb.transaction('requests', 'readwrite');
                const store = tx.objectStore('requests');
                return store.put({ ...request, id });
            },

            async delete(id) {
                if (!idb) await initDB();
                const tx = idb.transaction('requests', 'readwrite');
                const store = tx.objectStore('requests');
                return store.delete(id);
            },

            async getByEmail(email) {
                if (!idb) await initDB();
                const tx = idb.transaction('requests', 'readonly');
                const store = tx.objectStore('requests');
                const index = store.index('clientEmail');
                return index.getAll(email);
            },

            async getByStatus(status) {
                if (!idb) await initDB();
                const tx = idb.transaction('requests', 'readonly');
                const store = tx.objectStore('requests');
                const index = store.index('status');
                return index.getAll(status);
            }
        };

        // Database API - Sessions
        const sessionDB = {
            async get(key) {
                if (!idb) await initDB();
                const tx = idb.transaction('sessions', 'readonly');
                const store = tx.objectStore('sessions');
                const result = await store.get(key);
                return result ? result.value : null;
            },

            async set(key, value) {
                if (!idb) await initDB();
                const tx = idb.transaction('sessions', 'readwrite');
                const store = tx.objectStore('sessions');
                return store.put({ key, value });
            },

            async remove(key) {
                if (!idb) await initDB();
                const tx = idb.transaction('sessions', 'readwrite');
                const store = tx.objectStore('sessions');
                return store.delete(key);
            },

            async clear() {
                if (!idb) await initDB();
                const tx = idb.transaction('sessions', 'readwrite');
                const store = tx.objectStore('sessions');
                return store.clear();
            }
        };

        // Database API - Agents
        const agentDB = {
            async getAll() {
                if (!idb) await initDB();
                const tx = idb.transaction('agents', 'readonly');
                const store = tx.objectStore('agents');
                return store.getAll();
            },

            async get(username) {
                if (!idb) await initDB();
                const tx = idb.transaction('agents', 'readonly');
                const store = tx.objectStore('agents');
                return store.get(username);
            },

            async add(agent) {
                if (!idb) await initDB();
                const tx = idb.transaction('agents', 'readwrite');
                const store = tx.objectStore('agents');
                return store.add(agent);
            },

            async update(username, agent) {
                if (!idb) await initDB();
                const tx = idb.transaction('agents', 'readwrite');
                const store = tx.objectStore('agents');
                return store.put({ ...agent, username });
            }
        };

        // Migrate data from localStorage to IndexedDB
        async function migrateFromLocalStorage() {
            try {
                // Check if migration already done
                const migrationDone = await sessionDB.get('migration_done');
                if (migrationDone) return;

                // Migrate users
                const users = JSON.parse(localStorage.getItem('homefix_users') || '[]');
                for (const user of users) {
                    try {
                        await userDB.add(user);
                    } catch (e) {
                        // User might already exist, skip
                    }
                }

                // Migrate requests
                const agentRequests = JSON.parse(localStorage.getItem('agent_requests') || '[]');
                for (const request of agentRequests) {
                    try {
                        await requestDB.add(request);
                    } catch (e) {
                        // Request might already exist, skip
                    }
                }

                // Migrate user-specific requests
                const keys = Object.keys(localStorage);
                for (const key of keys) {
                    if (key.startsWith('user_requests_')) {
                        const email = key.replace('user_requests_', '');
                        const userRequests = JSON.parse(localStorage.getItem(key) || '[]');
                        for (const request of userRequests) {
                            try {
                                // Check if request already exists
                                const existing = await requestDB.get(request.id);
                                if (!existing) {
                                    await requestDB.add(request);
                                }
                            } catch (e) {
                                // Request might already exist, skip
                            }
                        }
                    }
                }

                // Migrate authentication state
                const isAuthenticated = localStorage.getItem('homefix_authenticated') === 'true';
                if (isAuthenticated) {
                    await sessionDB.set('homefix_authenticated', 'true');
                    const userData = JSON.parse(localStorage.getItem('homefix_user') || '{}');
                    if (userData.email) {
                        await sessionDB.set('homefix_user', userData);
                    }
                }

                const isAgentAuthenticated = localStorage.getItem('agent_authenticated') === 'true';
                if (isAgentAuthenticated) {
                    await sessionDB.set('agent_authenticated', 'true');
                    const agentUsername = localStorage.getItem('agent_username');
                    if (agentUsername) {
                        await sessionDB.set('agent_username', agentUsername);
                    }
                }

                // Mark migration as done
                await sessionDB.set('migration_done', 'true');
                console.log('Data migration completed successfully');
            } catch (error) {
                console.error('Migration error:', error);
            }
        }

        // Initialize database on page load
        async function initializeDatabase() {
            try {
                await initDB();
                await migrateFromLocalStorage();
                console.log('Database initialized successfully');
            } catch (error) {
                console.error('Database initialization error:', error);
            }
        }

        // Ensure landing page is visible immediately on page load
        window.addEventListener('load', async function() {
            await initializeDatabase();
            
            const landingPage = document.getElementById('landing-page');
            const isAgentAuthenticated = await sessionDB.get('agent_authenticated') === 'true';
            const isAuthenticated = await sessionDB.get('homefix_authenticated') === 'true';
            
            if (!isAgentAuthenticated && !isAuthenticated && landingPage) {
                landingPage.classList.remove('hidden');
                landingPage.style.display = 'block';
            }
        });
    </script>
</head>
<body>
    <!-- Landing Page -->
    <div class="landing-page" id="landing-page">
        <!-- Landing Navigation -->
        <nav class="landing-nav">
            <div class="landing-nav-container">
                <div class="landing-logo">
                    <video class="logo-video" autoplay loop muted playsinline preload="auto" style="height: 50px; width: auto;" aria-hidden="true">
                        <source src="images/vidanimation.mp4" type="video/mp4">
                        <img src="images/logo.png" alt="HomeFix Logo" width=50 height=50 style="display: none;">
                    </video>
                    <span>HomeFix</span>
                </div>
                <div class="landing-nav-right">
                    <a href="#" class="landing-nav-link" onclick="scrollToSection('features'); return false;">Services</a>
                    <a href="#" class="landing-nav-link" onclick="scrollToSection('how-it-works'); return false;">How It Works</a>
                    <a href="#" class="landing-nav-link" onclick="showAuthPage('signin'); return false;">Sign In</a>
                    <button class="btn btn-primary" onclick="showAuthPage('register')" id="desktop-join-btn">Join</button>
                    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" id="mobile-menu-btn">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="mobile-menu" id="mobile-menu">
                <a href="#" class="mobile-menu-link" onclick="scrollToSection('features'); toggleMobileMenu(); return false;">Services</a>
                <a href="#" class="mobile-menu-link" onclick="scrollToSection('how-it-works'); toggleMobileMenu(); return false;">How It Works</a>
                <a href="#" class="mobile-menu-link" onclick="showAuthPage('signin'); toggleMobileMenu(); return false;">Sign In</a>
                <button class="btn btn-primary" onclick="showAuthPage('register'); toggleMobileMenu();" style="width: 100%; margin-top: var(--spacing-sm);">Join</button>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="landing-hero">
            <div class="landing-hero-container">
                <h1 class="landing-hero-title">
                    Find the perfect home service professional
                </h1>
                <p class="landing-hero-subtitle">
                    Connect with skilled professionals for all your home service needs. Quality work, fair prices, done right.
                </p>
                <div class="landing-hero-cta">
                    <button class="btn btn-primary" onclick="showAuthPage('register')" style="padding: var(--spacing-md) var(--spacing-2xl); font-size: 18px;">
                        Get Started
                    </button>
                    <button class="btn btn-ghost" onclick="scrollToSection('how-it-works')" style="padding: var(--spacing-md) var(--spacing-2xl); font-size: 18px;">
                        Learn More
                    </button>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="landing-section" id="features">
            <div class="landing-section-container">
                <h2 class="landing-section-title">Why Choose HomeFix?</h2>
                <p class="landing-section-subtitle">
                    We make it easy to find and hire trusted professionals for all your home service needs
                </p>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                        </div>
                        <h3 class="feature-title">Verified Professionals</h3>
                        <p class="feature-desc">
                            All service providers are thoroughly vetted and verified to ensure quality and reliability
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="feature-title">Fair & Transparent Pricing</h3>
                        <p class="feature-desc">
                            Get upfront quotes with no hidden fees. Compare prices and choose what works for your budget
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="feature-title">Quick & Reliable Service</h3>
                        <p class="feature-desc">
                            Book services in minutes and get work done on time. Our professionals are committed to meeting deadlines
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="feature-title">Satisfaction Guaranteed</h3>
                        <p class="feature-desc">
                            We stand behind every job. If you're not happy, we'll make it right or refund your money
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <h3 class="feature-title">Easy Booking</h3>
                        <p class="feature-desc">
                            Book services instantly through our platform. Track progress and communicate with professionals in real-time
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                        <h3 class="feature-title">Wide Range of Services</h3>
                        <p class="feature-desc">
                            From plumbing to electrical, cleaning to repairs - find professionals for every home service need
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section class="landing-section how-it-works" id="how-it-works">
            <div class="landing-section-container">
                <h2 class="landing-section-title">How It Works</h2>
                <p class="landing-section-subtitle">
                    Getting started is simple. Follow these easy steps to get your home services done
                </p>
                <div class="steps-container">
                    <div class="step-card">
                        <div class="step-number">1</div>
                        <h3 class="step-title">Create Your Account</h3>
                        <p class="step-desc">
                            Sign up in seconds with your email or social account. It's free and takes less than a minute
                        </p>
                    </div>
                    <div class="step-card">
                        <div class="step-number">2</div>
                        <h3 class="step-title">Browse Services</h3>
                        <p class="step-desc">
                            Search through our wide range of home services. Filter by category, price, and ratings
                        </p>
                    </div>
                    <div class="step-card">
                        <div class="step-number">3</div>
                        <h3 class="step-title">Book a Professional</h3>
                        <p class="step-desc">
                            Choose a verified professional, see their portfolio, read reviews, and book your service
                        </p>
                    </div>
                    <div class="step-card">
                        <div class="step-number">4</div>
                        <h3 class="step-title">Get It Done</h3>
                        <p class="step-desc">
                            Your professional arrives on time, completes the work, and you pay securely through our platform
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stats Section -->
        <section class="landing-section stats-section" id="stats-section">
            <div class="stats-slideshow">
                <div class="stats-slide active" style="background-image: url('images/slide1.jpg');"></div>
                <div class="stats-slide" style="background-image: url('images/slide2.jpg');"></div>
                <div class="stats-slide" style="background-image: url('images/slide3.jpg');"></div>
                <div class="stats-slide" style="background-image: url('images/slide4.jpg');"></div>
                <div class="stats-slide" style="background-image: url('images/slide5.jpg');"></div>
            </div>
            <div class="landing-section-container">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" data-target="10000" data-suffix="K+" data-prefix="">0</div>
                        <div class="stat-label">Happy Customers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" data-target="5000" data-suffix="K+" data-prefix="">0</div>
                        <div class="stat-label">Verified Professionals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" data-target="50000" data-suffix="K+" data-prefix="">0</div>
                        <div class="stat-label">Completed Jobs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" data-target="4.8" data-suffix="" data-prefix="" data-decimal="1">0</div>
                        <div class="stat-label">Average Rating</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="cta-section">
            <div class="cta-slideshow">
                <div class="cta-slide active" style="background-image: url('images/slide1.jpg');"></div>
                <div class="cta-slide" style="background-image: url('images/slide2.jpg');"></div>
                <div class="cta-slide" style="background-image: url('images/slide3.jpg');"></div>
                <div class="cta-slide" style="background-image: url('images/slide4.jpg');"></div>
                <div class="cta-slide" style="background-image: url('images/slide5.jpg');"></div>
            </div>
            <div class="landing-section-container">
                <h2 class="cta-title">Ready to Get Started?</h2>
                <p class="cta-subtitle">
                    Join thousands of satisfied customers who trust HomeFix for all their home service needs
                </p>
                <div class="cta-buttons">
                    <button class="btn btn-white" onclick="showAuthPage('register')" style="padding: var(--spacing-md) var(--spacing-2xl); font-size: 18px;">
                        Create Free Account
                    </button>
                    <button class="btn btn-outline-white" onclick="showAuthPage('signin')" style="padding: var(--spacing-md) var(--spacing-2xl); font-size: 18px;">
                        Sign In
                    </button>
                </div>
            </div>
        </section>

        <!-- Agent Login Section -->
        <section class="landing-section" id="agent-section" style="background: var(--neutral-50); border-top: 2px solid var(--neutral-200);">
            <div class="landing-section-container" style="text-align: center;">
                <h2 class="landing-section-title" style="font-size: 32px; margin-bottom: var(--spacing-md);">Agent Portal</h2>
                <p class="landing-section-subtitle" style="margin-bottom: var(--spacing-xl);">
                    Are you an agent? Access your dashboard to manage requests and assignments
                </p>
                <button class="btn btn-primary" onclick="showAgentLogin()" style="padding: var(--spacing-md) var(--spacing-2xl); font-size: 16px;">
                    Agent Login
                </button>
            </div>
        </section>

        <!-- Footer Section -->
        <footer class="site-footer">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-left">
                        <div class="footer-copyright"> 2025 HomeFix. All rights reserved.</div>
                        <div class="footer-disclaimer">
                            HomeFix is a professional home services platform connecting customers with verified service providers. 
                            All services are provided by independent contractors licensed in their respective fields.
                        </div>
                        <div class="footer-links">
                            <a href="#" class="footer-link" onclick="showScreen('privacy-policy'); return false;">Privacy Policy</a>
                            <span class="footer-link-separator">|</span>
                            <a href="#" class="footer-link" onclick="showScreen('terms-conditions'); return false;">Terms and Conditions</a>
                        </div>
                    </div>
                    <div class="footer-right">
                        <div class="footer-logo">
                            <img src="images/logo.png" alt="HomeFix Logo" width="60" height="60">
                            <span class="footer-logo-text">HomeFix</span>
                        </div>
                        <div class="footer-social">
                            <a href="https://twitter.com/homefix" target="_blank" rel="noopener noreferrer" class="social-icon" aria-label="Twitter">
                                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                                </svg>
                            </a>
                            <a href="https://instagram.com/homefix" target="_blank" rel="noopener noreferrer" class="social-icon" aria-label="Instagram">
                                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                                </svg>
                            </a>
                            <a href="https://www.tiktok.com/@homefixgh?_r=1&_t=ZM-91SzSbMhzLP" target="_blank" rel="noopener noreferrer" class="social-icon" aria-label="TikTok">
                                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Authentication Container -->
    <div class="auth-container" id="auth-container">
        <div class="auth-wrapper">
            <!-- Sign In Page -->
            <div class="auth-card" id="signin-card">
                <div style="margin-bottom: var(--spacing-md);">
                    <a href="#" class="auth-link" onclick="showLandingPage(); return false;" style="display: inline-flex; align-items: center; gap: var(--spacing-xs);">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Back to Home
                    </a>
                </div>
                <div class="auth-header">
                    <div class="auth-logo">
                        <img src="images/logo.png" alt="HomeFix Logo" width=50 height=50>
                        <span>HomeFix</span>
                    </div>
                    <h1 class="auth-title">Welcome Back</h1>
                    <p class="auth-subtitle">Sign in to continue to your account</p>
                </div>

                <div class="error-message" id="signin-error"></div>
                <div class="success-message" id="signin-success"></div>

                <form class="auth-form" id="signin-form" onsubmit="handleSignIn(event)">
                    <div class="form-group">
                        <label class="form-label" for="signin-email">Email Address</label>
                        <input 
                            type="email" 
                            id="signin-email" 
                            class="form-input" 
                            placeholder="Enter your email"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="signin-password">Password</label>
                        <div class="password-wrapper">
                            <input 
                                type="password" 
                                id="signin-password" 
                                class="form-input" 
                                placeholder="Enter your password"
                                required
                            >
                            <button 
                                type="button" 
                                class="password-toggle" 
                                onclick="togglePassword('signin-password', this)"
                            >
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="form-group" style="flex-direction: row; justify-content: space-between; align-items: center;">
                        <label class="form-checkbox">
                            <input type="checkbox" id="remember-me">
                            <span class="form-checkbox-label">Remember me</span>
                        </label>
                        <a href="#" class="auth-link" onclick="showScreen('password-reset'); return false;">Forgot password?</a>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Sign In
                    </button>
                </form>

                <div class="auth-divider">
                    <span class="auth-divider-text">Or continue with</span>
                </div>

                <div class="social-auth">
                    <button type="button" class="social-btn" onclick="handleSocialAuth('google')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                        </svg>
                        Continue with Google
                    </button>
                    <button type="button" class="social-btn" onclick="handleSocialAuth('facebook')">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                        Continue with Facebook
                    </button>
                </div>

                <div class="auth-footer">
                    Don't have an account? <a href="#" class="auth-link" onclick="switchToRegister(); return false;">Sign up</a>
                </div>
            </div>

            <!-- Register Page -->
            <div class="auth-card" id="register-card" style="display: none;">
                <div style="margin-bottom: var(--spacing-md);">
                    <a href="#" class="auth-link" onclick="showLandingPage(); return false;" style="display: inline-flex; align-items: center; gap: var(--spacing-xs);">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Back to Home
                    </a>
                </div>
                <div class="auth-header">
                    <div class="auth-logo">
                        <img src="images/logo.png" alt="HomeFix Logo" width=50 height=50>
                        <span>HomeFix</span>
                    </div>
                    <h1 class="auth-title">Create Account</h1>
                    <p class="auth-subtitle">Join HomeFix and get started today</p>
                </div>

                <div class="error-message" id="register-error"></div>
                <div class="success-message" id="register-success"></div>

                <form class="auth-form" id="register-form" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label class="form-label" for="register-name">Full Name</label>
                        <input 
                            type="text" 
                            id="register-name" 
                            class="form-input" 
                            placeholder="Enter your full name"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="register-email">Email Address</label>
                        <input 
                            type="email" 
                            id="register-email" 
                            class="form-input" 
                            placeholder="Enter your email"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="register-phone">Phone Number</label>
                        <input 
                            type="tel" 
                            id="register-phone" 
                            class="form-input" 
                            placeholder="Enter your phone number"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="register-password">Password</label>
                        <div class="password-wrapper">
                            <input 
                                type="password" 
                                id="register-password" 
                                class="form-input" 
                                placeholder="Create a password"
                                required
                                minlength="6"
                            >
                            <button 
                                type="button" 
                                class="password-toggle" 
                                onclick="togglePassword('register-password', this)"
                            >
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="register-confirm-password">Confirm Password</label>
                        <div class="password-wrapper">
                            <input 
                                type="password" 
                                id="register-confirm-password" 
                                class="form-input" 
                                placeholder="Confirm your password"
                                required
                                minlength="6"
                            >
                            <button 
                                type="button" 
                                class="password-toggle" 
                                onclick="togglePassword('register-confirm-password', this)"
                            >
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-checkbox">
                            <input type="checkbox" id="terms-checkbox" required>
                            <span class="form-checkbox-label">I agree to the <a href="#" class="auth-link" onclick="showScreen('terms-conditions'); return false;">Terms of Service</a> and <a href="#" class="auth-link" onclick="showScreen('privacy-policy'); return false;">Privacy Policy</a></span>
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Create Account
                    </button>
                </form>

                <div class="auth-divider">
                    <span class="auth-divider-text">Or continue with</span>
                </div>

                <div class="social-auth">
                    <button type="button" class="social-btn" onclick="handleSocialAuth('google')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                        </svg>
                        Continue with Google
                    </button>
                </div>

                <div class="auth-footer">
                    Already have an account? <a href="#" class="auth-link" onclick="switchToSignIn(); return false;">Sign in</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content (Hidden until authenticated) -->
    <div class="main-content" id="main-content">
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="logo-section" onclick="showScreen('home')">
                <div class="logo">
                    <video class="logo-video" autoplay loop muted playsinline preload="auto" aria-hidden="true">
                        <source src="images/vidanimation.mp4" type="video/mp4">
                        <img src="images/logo.png" alt="HomeFix Logo" style="display: none;">
                    </video>
                    <span>HomeFix</span>
                </div>
                <div class="location-badge">
                    <div class="status-indicator"></div>
                    <span>Accra, Ghana</span>
                </div>
            </div>
            
            <div class="nav-search">
                <div class="search-wrapper">
                    <input type="text" class="search-input" id="nav-search-input" placeholder="Search for services..." oninput="filterCategories()">
                    <button class="search-btn">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="nav-right">
                <a href="#" class="nav-link" onclick="showScreen('tasks'); return false;">My Tasks</a>
                <div class="premium-badge">PREMIUM</div>
                <div class="user-menu" onclick="showScreen('profile')">
                    <img src="images/person.png" alt="User" class="user-avatar">
                </div>
                <a href="#" class="nav-link" onclick="logout(); return false;" style="margin-left: var(--spacing-md);">Logout</a>
            </div>
        </div>
    </nav>

    <!-- Home Screen -->
    <div class="screen active" id="home-screen">
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-container">
                <h1 class="hero-title">Find the perfect home service professional</h1>
                <p class="hero-subtitle">Get quality services delivered on time, every time</p>
                <div class="hero-search">
                    <div class="hero-search-wrapper">
                        <input type="text" class="hero-search-input" id="hero-search-input" placeholder="What service do you need?" oninput="filterCategories()">
                        <button class="hero-search-btn">Search</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-container">
            <!-- Profile Notification -->
            <div class="profile-notification" id="profile-notification">
                <div class="notification-content">
                    <div class="notification-text">
                        <div class="notification-title">Complete Your Profile</div>
                        <div class="notification-desc">Unlock premium features and personalized recommendations</div>
                    </div>
                    <div class="notification-actions">
                        <button class="btn btn-primary" onclick="completeProfile()">Complete Profile</button>
                        <button class="btn btn-ghost" onclick="hideProfileNotification()">Later</button>
                    </div>
                </div>
                <button class="close-button" onclick="hideProfileNotification()"></button>
            </div>

            <!-- Premium Banner -->
            <div class="premium-banner">
                <div class="banner-content">
                    <div class="banner-title">EXCLUSIVE</div>
                    <div class="banner-subtitle">Premium Service Access</div>
                    <div class="coupon-container">
                        <div class="coupon-text">CODE: PREMIUM24</div>
                    </div>
                </div>
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='150'%3E%3Ccircle cx='75' cy='75' r='60' fill='white' opacity='0.2'/%3E%3Cpath d='M45 75 L60 90 L105 45' stroke='white' stroke-width='4' fill='none'/%3E%3C/svg%3E" alt="Premium" class="banner-image">
            </div>

            <!-- Categories Section -->
            <div class="categories-section">
                <div class="section-header">
                    <div>
                        <div class="section-title">Professional Services</div>
                        <div class="section-subtitle">Browse our wide range of home services</div>
                    </div>
                </div>
                <div class="category-grid" id="category-grid">
                    <!-- Categories will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Tasks Screen -->
    <div class="screen" id="tasks-screen">
        <div class="main-container">
            <div class="tasks-header">
                <h1 class="tasks-title">My Tasks</h1>
                <div class="tabs-row">
                    <button class="tab active" onclick="switchTaskTab('current', event)">Current Tasks</button>
                    <button class="tab" onclick="switchTaskTab('past', event)">Past Tasks</button>
                </div>
            </div>

            <div class="tasks-grid" id="tasks-container">
                <!-- Tasks will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Profile Screen -->
    <div class="screen" id="profile-screen">
        <div class="main-container">
            <div class="profile-container">
                <div class="profile-header">
                    <h1 class="profile-title">Account Settings</h1>
                </div>

                <div class="profile-card">
                    <div class="profile-info-card">
                        <img src="images/person.png" alt="Avatar" class="profile-avatar">
                        <div class="profile-info">
                            <div class="profile-name">User</div>
                            <div class="profile-email">user@example.com</div>
                        </div>
                    </div>

                    <div class="menu-item" onclick="showScreen('personal-info')">
                        <div class="menu-item-left">
                            <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <span class="menu-item-title">Personal Info</span>
                        </div>
                        <svg class="menu-item-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <div class="menu-item" onclick="showScreen('account-security')">
                        <div class="menu-item-left">
                            <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                            <span class="menu-item-title">Account & Security</span>
                        </div>
                        <svg class="menu-item-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <div class="menu-item" onclick="showScreen('payment-settings')">
                        <div class="menu-item-left">
                            <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                            </svg>
                            <span class="menu-item-title">Payment</span>
                        </div>
                        <svg class="menu-item-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <div class="menu-item" onclick="showScreen('notification-settings')">
                        <div class="menu-item-left">
                            <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                            </svg>
                            <span class="menu-item-title">Notification</span>
                        </div>
                        <svg class="menu-item-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <div class="menu-item" onclick="showScreen('live-chat')">
                        <div class="menu-item-left">
                            <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                            </svg>
                            <span class="menu-item-title">Live Chat</span>
                            <span class="notification-badge" id="chat-notification-badge" style="display: none;">1</span>
                        </div>
                        <svg class="menu-item-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <div class="menu-item" onclick="showScreen('help-support')">
                        <div class="menu-item-left">
                            <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span class="menu-item-title">Help & Support</span>
                        </div>
                        <svg class="menu-item-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <button class="logout-btn" onclick="alert('Logout functionality')">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Service Detail Screen -->
    <div class="screen" id="service-detail-screen">
        <div class="service-detail-header">
            <div class="service-detail-container">
                <a href="#" class="back-button" onclick="showScreen('home'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Services
                </a>
                <div class="service-header-content" id="service-detail-header">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
        <div class="service-detail-content">
            <div class="service-info-card">
                <div class="service-info-section">
                    <h2 class="service-info-title">About This Service</h2>
                    <p class="service-info-text" id="service-about">
                        <!-- Content will be populated by JavaScript -->
                    </p>
                </div>
                <div class="service-info-section">
                    <h2 class="service-info-title">What's Included</h2>
                    <ul class="service-info-list" id="service-includes">
                        <!-- Content will be populated by JavaScript -->
                    </ul>
                </div>
            </div>
            <div class="service-cta-card">
                <h3 class="service-cta-title">Get Started</h3>
                <div class="service-cta-price" id="service-price">Starting at $50</div>
                <p class="service-cta-note">Price may vary based on requirements</p>
                <button class="btn btn-primary service-cta-btn" onclick="startSurvey()">Request Service</button>
                <button class="btn btn-ghost service-cta-btn" onclick="showScreen('home')">Browse More</button>
            </div>
        </div>
    </div>

    <!-- Survey Screen -->
    <div class="screen" id="survey-screen">
        <div class="survey-container">
            <div class="survey-header">
                <h1 class="survey-title">Service Request Form</h1>
                <p class="survey-subtitle">Please provide details about your service needs</p>
            </div>
            <form class="survey-form" id="survey-form" onsubmit="submitSurvey(event)">
                <div class="form-group">
                    <label class="form-label">Service Type <span class="required">*</span></label>
                    <input type="text" class="form-input" id="survey-service" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Preferred Date <span class="required">*</span></label>
                    <input type="date" class="form-input" id="survey-date" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Preferred Time <span class="required">*</span></label>
                    <select class="form-select" id="survey-time" required>
                        <option value="">Select time</option>
                        <option value="morning">Morning (8:00 AM - 12:00 PM)</option>
                        <option value="afternoon">Afternoon (12:00 PM - 5:00 PM)</option>
                        <option value="evening">Evening (5:00 PM - 8:00 PM)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Service Location <span class="required">*</span></label>
                    <input type="text" class="form-input" id="survey-location" placeholder="Enter your address" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Urgency Level <span class="required">*</span></label>
                    <div class="form-radio-group">
                        <label class="form-radio">
                            <input type="radio" name="urgency" value="low" required>
                            <span>Low - Can wait a few days</span>
                        </label>
                        <label class="form-radio">
                            <input type="radio" name="urgency" value="medium" required>
                            <span>Medium - Within 24-48 hours</span>
                        </label>
                        <label class="form-radio">
                            <input type="radio" name="urgency" value="high" required>
                            <span>High - Emergency, need ASAP</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Service Description <span class="required">*</span></label>
                    <textarea class="form-textarea" id="survey-description" placeholder="Describe what you need..." required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Additional Requirements</label>
                    <div class="form-checkbox-group">
                        <label class="form-checkbox">
                            <input type="checkbox" name="requirements" value="materials">
                            <span>I need materials/supplies</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" name="requirements" value="permit">
                            <span>Permit may be required</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" name="requirements" value="followup">
                            <span>Follow-up service needed</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Contact Phone <span class="required">*</span></label>
                    <input type="tel" class="form-input" id="survey-phone" placeholder="+1234567890" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-ghost" onclick="goBackFromSurvey()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Submit Request</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Detail Screen -->
    <div class="screen" id="task-detail-screen">
        <div class="task-detail-container">
            <div class="task-detail-header">
                <a href="#" class="back-button" onclick="showScreen('tasks'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Tasks
                </a>
                <h1 class="task-detail-title" id="task-detail-title">Task Details</h1>
                <span class="task-status-badge" id="task-status-badge">Pending</span>
            </div>
            <div class="task-detail-card">
                <div class="task-detail-section">
                    <h2 class="task-detail-section-title">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        Task Information
                    </h2>
                    <div class="task-detail-info" id="task-detail-info">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                </div>
                <div class="task-detail-section">
                    <h2 class="task-detail-section-title">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Description
                    </h2>
                    <p class="task-description" id="task-description"></p>
                </div>
                <div class="task-detail-section">
                    <h2 class="task-detail-section-title">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Assigned Provider
                    </h2>
                    <div class="task-provider-card" id="task-provider-card">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Screen -->
    <div class="screen" id="invoice-screen">
        <div class="invoice-container">
            <div class="invoice-header">
                <h1 class="invoice-title">Invoice</h1>
            </div>
            <div class="invoice-card">
                <div class="invoice-header-section">
                    <div class="invoice-company-info">
                        <h2>HomeFix</h2>
                        <p>123 Service Street<br>Accra, Ghana<br>Phone: +233 XX XXX XXXX</p>
                    </div>
                    <div class="invoice-details">
                        <div>
                            <div class="invoice-details-label">Invoice Number</div>
                            <div class="invoice-details-value" id="invoice-number">INV-2025-001</div>
                        </div>
                        <div>
                            <div class="invoice-details-label">Date</div>
                            <div class="invoice-details-value" id="invoice-date">Mon Mar 10, 2025</div>
                        </div>
                        <div>
                            <div class="invoice-details-label">Status</div>
                            <div class="invoice-details-value">Paid</div>
                        </div>
                    </div>
                </div>
                <table class="invoice-items-table">
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Quantity</th>
                            <th>Unit Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="invoice-items">
                        <!-- Content will be populated by JavaScript -->
                    </tbody>
                </table>
                <div class="invoice-total-section">
                    <div class="invoice-total-table">
                        <div class="invoice-total-row">
                            <span>Subtotal</span>
                            <span id="invoice-subtotal">$0.00</span>
                        </div>
                        <div class="invoice-total-row">
                            <span>Tax (10%)</span>
                            <span id="invoice-tax">$0.00</span>
                        </div>
                        <div class="invoice-total-row total">
                            <span>Total</span>
                            <span id="invoice-total">$0.00</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="invoice-actions">
                <button class="btn btn-primary" onclick="window.print()">Print Invoice</button>
                <button class="btn btn-ghost" onclick="showScreen('tasks')">Back to Tasks</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Screen -->
    <div class="screen" id="confirmation-screen">
        <div class="confirmation-container">
            <div class="confirmation-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h1 class="confirmation-title">Request Submitted Successfully!</h1>
            <p class="confirmation-message">
                Your service request has been received. Our team will review your request and assign a qualified professional to your task. You'll receive a notification once a provider has been assigned.
            </p>
            <div class="confirmation-details" id="confirmation-details">
                <!-- Content will be populated by JavaScript -->
            </div>
            <div class="confirmation-actions">
                <button class="btn btn-primary" onclick="showScreen('tasks')">View My Tasks</button>
                <button class="btn btn-ghost" onclick="showScreen('home')">Browse More Services</button>
            </div>
        </div>
    </div>

    <!-- Personal Info Settings -->
    <div class="screen" id="personal-info-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('profile'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Settings
                </a>
                <h1 class="settings-title">Personal Information</h1>
                <p class="settings-subtitle">Update your personal details and profile information</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">Profile Photo</h2>
                    <div class="avatar-upload">
                        <img src="images/person.png" alt="Avatar" class="avatar-preview" id="avatar-preview">
                        <div class="avatar-upload-actions">
                            <button type="button" class="btn btn-primary avatar-upload-btn" onclick="document.getElementById('avatar-input').click()">Change Photo</button>
                            <button type="button" class="btn btn-ghost avatar-upload-btn" onclick="removeAvatar()">Remove</button>
                            <input type="file" id="avatar-input" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
                            <p class="avatar-upload-note">JPG, PNG or GIF. Max size 2MB</p>
                        </div>
                    </div>
                </div>

                <form onsubmit="savePersonalInfo(event)">
                    <div class="settings-section">
                        <h2 class="settings-section-title">Basic Information</h2>
                        <div class="form-row">
                            <div class="form-group-settings">
                                <label class="form-label-settings">First Name <span class="required">*</span></label>
                                <input type="text" class="form-input" id="first-name" value="User" required>
                            </div>
                            <div class="form-group-settings">
                                <label class="form-label-settings">Last Name <span class="required">*</span></label>
                                <input type="text" class="form-input" id="last-name" value="" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group-settings">
                                <label class="form-label-settings">Email <span class="required">*</span></label>
                                <input type="email" class="form-input" id="email" value="user@example.com" required>
                                <p class="form-hint">This email will be used for account notifications</p>
                            </div>
                            <div class="form-group-settings">
                                <label class="form-label-settings">Phone Number</label>
                                <input type="tel" class="form-input" id="phone" value="" placeholder="+1234567890">
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2 class="settings-section-title">Location</h2>
                        <div class="form-row">
                            <div class="form-group-settings">
                                <label class="form-label-settings">Address</label>
                                <input type="text" class="form-input" id="address" placeholder="Street address">
                            </div>
                            <div class="form-group-settings">
                                <label class="form-label-settings">City</label>
                                <input type="text" class="form-input" id="city" value="Accra">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group-settings">
                                <label class="form-label-settings">State/Region</label>
                                <input type="text" class="form-input" id="state" value="">
                            </div>
                            <div class="form-group-settings">
                                <label class="form-label-settings">Country</label>
                                <input type="text" class="form-input" id="country" value="Ghana">
                            </div>
                        </div>
                    </div>

                    <div class="settings-actions">
                        <button type="button" class="btn btn-ghost" onclick="showScreen('profile')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Account & Security Settings -->
    <div class="screen" id="account-security-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('profile'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Settings
                </a>
                <h1 class="settings-title">Account & Security</h1>
                <p class="settings-subtitle">Manage your account security and privacy settings</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">Password</h2>
                    <form onsubmit="changePassword(event)">
                        <div class="form-group-settings">
                            <label class="form-label-settings">Current Password <span class="required">*</span></label>
                            <input type="password" class="form-input" id="current-password" required>
                        </div>
                        <div class="form-group-settings">
                            <label class="form-label-settings">New Password <span class="required">*</span></label>
                            <input type="password" class="form-input" id="new-password" required>
                            <p class="form-hint">Must be at least 8 characters with letters and numbers</p>
                        </div>
                        <div class="form-group-settings">
                            <label class="form-label-settings">Confirm New Password <span class="required">*</span></label>
                            <input type="password" class="form-input" id="confirm-password" required>
                        </div>
                        <div class="settings-actions">
                            <button type="submit" class="btn btn-primary">Update Password</button>
                        </div>
                    </form>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Security Features</h2>
                    <div class="security-item">
                        <div class="security-item-info">
                            <div class="security-item-title">Two-Factor Authentication</div>
                            <div class="security-item-desc">Add an extra layer of security to your account</div>
                        </div>
                        <span class="security-status inactive">Inactive</span>
                        <button class="btn btn-ghost" style="margin-left: var(--spacing-md);" onclick="showScreen('2fa-settings')">Enable</button>
                    </div>
                    <div class="security-item">
                        <div class="security-item-info">
                            <div class="security-item-title">Login Alerts</div>
                            <div class="security-item-desc">Get notified when someone logs into your account</div>
                        </div>
                        <span class="security-status active">Active</span>
                    </div>
                    <div class="security-item">
                        <div class="security-item-info">
                            <div class="security-item-title">Active Sessions</div>
                            <div class="security-item-desc">Manage devices where you're logged in</div>
                        </div>
                        <button class="btn btn-ghost" onclick="showScreen('active-sessions')">View All</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Settings -->
    <div class="screen" id="payment-settings-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('profile'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Settings
                </a>
                <h1 class="settings-title">Payment Methods</h1>
                <p class="settings-subtitle">Manage your payment methods and billing information</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">Payment Methods</h2>
                    <div style="padding: var(--spacing-lg); background: var(--neutral-50); border-radius: var(--radius-lg);">
                        <p style="margin-bottom: var(--spacing-md); color: var(--neutral-700);">
                            <strong> Paystack Payment Gateway</strong>
                        </p>
                        <p style="color: var(--neutral-600); font-size: 14px; line-height: 1.6; margin-bottom: var(--spacing-md);">
                            We use Paystack for secure payment processing. When you make a payment, you'll be redirected to Paystack's secure payment page where you can choose from:
                        </p>
                        <ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-600); font-size: 14px; line-height: 1.8;">
                            <li> Debit/Credit Cards (Visa, Mastercard, Verve)</li>
                            <li> Mobile Money (MTN, Vodafone, AirtelTigo)</li>
                            <li> Bank Transfer</li>
                            <li> USSD</li>
                        </ul>
                        <p style="margin-top: var(--spacing-md); color: var(--neutral-600); font-size: 14px;">
                            <strong> Security:</strong> Your payment information is securely processed by Paystack. We never store your card or account details.
                        </p>
                    </div>
                </div>

                <div class="settings-section" id="add-payment-section" style="display: none;">
                    <h2 class="settings-section-title">Payment Information</h2>
                    <div style="padding: var(--spacing-lg); background: var(--neutral-50); border-radius: var(--radius-lg); margin-bottom: var(--spacing-lg);">
                        <p style="margin-bottom: var(--spacing-md); color: var(--neutral-700);">
                            <strong> Paystack Payment Gateway</strong>
                        </p>
                        <p style="color: var(--neutral-600); font-size: 14px; line-height: 1.6;">
                            We use Paystack for secure payments. You can pay using:
                        </p>
                        <ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-600); font-size: 14px;">
                            <li>Debit/Credit Cards (Visa, Mastercard, Verve)</li>
                            <li>Mobile Money (MTN, Vodafone, AirtelTigo)</li>
                            <li>Bank Transfer</li>
                            <li>USSD</li>
                        </ul>
                        <p style="margin-top: var(--spacing-md); color: var(--neutral-600); font-size: 14px;">
                            Your payment information is securely processed by Paystack. We never store your card details.
                        </p>
                        </div>
                        <div class="settings-actions">
                        <button type="button" class="btn btn-ghost" onclick="hideAddPaymentMethod()">Close</button>
                        </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Settings -->
    <div class="screen" id="notification-settings-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('profile'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Settings
                </a>
                <h1 class="settings-title">Notification Preferences</h1>
                <p class="settings-subtitle">Choose how you want to be notified</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">Email Notifications</h2>
                    <div class="notification-group">
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">Service Updates</div>
                                <div class="notification-item-desc">Get notified about your service requests and appointments</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked onchange="updateNotification('email-service', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">Provider Assignment</div>
                                <div class="notification-item-desc">Notifications when a provider is assigned to your task</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked onchange="updateNotification('email-provider', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">Payment & Invoices</div>
                                <div class="notification-item-desc">Receive invoices and payment confirmations</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked onchange="updateNotification('email-payment', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">Promotions & Offers</div>
                                <div class="notification-item-desc">Special deals and promotional offers</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" onchange="updateNotification('email-promo', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Push Notifications</h2>
                    <div class="notification-group">
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">Enable Push Notifications</div>
                                <div class="notification-item-desc">Receive notifications on your device</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked onchange="updateNotification('push-enabled', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">Task Reminders</div>
                                <div class="notification-item-desc">Reminders for upcoming service appointments</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked onchange="updateNotification('push-reminders', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help & Support -->
    <div class="screen" id="help-support-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('profile'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Settings
                </a>
                <h1 class="settings-title">Help & Support</h1>
                <p class="settings-subtitle">Get help and find answers to common questions</p>
            </div>

            <div class="help-categories">
                <div class="help-category-card" onclick="showScreen('getting-started')">
                    <div class="help-category-icon">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <div class="help-category-title">Getting Started</div>
                    <div class="help-category-desc">Learn how to use HomeFix</div>
                </div>
                <div class="help-category-card" onclick="showScreen('booking-help')">
                    <div class="help-category-icon">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                    <div class="help-category-title">Booking Services</div>
                    <div class="help-category-desc">How to book and manage services</div>
                </div>
                <div class="help-category-card" onclick="showScreen('payment-help')">
                    <div class="help-category-icon">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                        </svg>
                    </div>
                    <div class="help-category-title">Payments & Billing</div>
                    <div class="help-category-desc">Payment methods and invoices</div>
                </div>
                <div class="help-category-card" onclick="showScreen('account-help')">
                    <div class="help-category-icon">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <div class="help-category-title">Account Settings</div>
                    <div class="help-category-desc">Manage your account</div>
                </div>
            </div>

            <div class="faq-section">
                <h2 class="settings-section-title">Frequently Asked Questions</h2>
                <div class="faq-item" onclick="toggleFAQ(this)">
                    <div class="faq-question">
                        <span class="faq-question-text">How do I book a service?</span>
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="faq-answer">Browse our services, select the one you need, fill out the service request form with your requirements, and submit. Our team will assign a qualified professional to your task.</div>
                </div>
                <div class="faq-item" onclick="toggleFAQ(this)">
                    <div class="faq-question">
                        <span class="faq-question-text">How are service providers assigned?</span>
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="faq-answer">Our admin team reviews your service request and assigns the most qualified provider based on your location, service type, and requirements. You'll be notified once a provider is assigned.</div>
                </div>
                <div class="faq-item" onclick="toggleFAQ(this)">
                    <div class="faq-question">
                        <span class="faq-question-text">What payment methods are accepted?</span>
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="faq-answer">We accept payments through Paystack, which supports multiple payment methods including debit/credit cards, mobile money (MTN, Vodafone, AirtelTigo), bank transfers, and USSD. All payments are processed securely through Paystack's payment gateway.</div>
                </div>
                <div class="faq-item" onclick="toggleFAQ(this)">
                    <div class="faq-question">
                        <span class="faq-question-text">Can I cancel or reschedule a service?</span>
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="faq-answer">Yes, you can cancel or reschedule your service request from the task details page. Please note that cancellation policies may apply depending on the timing.</div>
                </div>
                <div class="faq-item" onclick="toggleFAQ(this)">
                    <div class="faq-question">
                        <span class="faq-question-text">How do I contact support?</span>
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="faq-answer">You can contact our support team through the contact form below, email us at support@homefix.com, or call us at +233 XX XXX XXXX during business hours.</div>
                </div>
            </div>

            <div class="contact-support">
                <h3 class="contact-support-title">Still need help?</h3>
                <p class="contact-support-desc">Our support team is here to assist you</p>
                <div style="display: flex; gap: var(--spacing-md); justify-content: center; margin-top: var(--spacing-lg);">
                    <button class="btn btn-primary" onclick="showScreen('contact-support')">Contact Support</button>
                    <button class="btn btn-ghost" onclick="showScreen('live-chat')">Live Chat</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Live Chat Screen -->
    <div class="screen" id="live-chat-screen">
        <div class="chat-container">
            <div class="chat-header">
                <a href="#" class="back-button" onclick="showScreen('profile'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Settings
                </a>
                <h1 class="chat-header-title">Live Chat</h1>
                <p class="chat-header-subtitle">Chat with our support team</p>
            </div>

            <div class="chat-wrapper">
                <div class="chat-messages" id="chat-messages">
                    <div class="chat-welcome">
                        <div class="chat-welcome-icon"></div>
                        <div class="chat-welcome-text">Start a conversation with our support team</div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chat-input" placeholder="Type your message..." onkeypress="handleChatKeyPress(event)">
                    <button class="chat-send-btn" onclick="sendChatMessage()">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Screen -->
    <div class="screen" id="privacy-policy-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showLandingPage(); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Home
                </a>
                <h1 class="settings-title">Privacy Policy</h1>
                <p class="settings-subtitle">Last updated: January 2025</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">1. Introduction</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        Welcome to HomeFix. We are committed to protecting your personal information and your right to privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our platform.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">2. Information We Collect</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        We collect information that you provide directly to us, including:
                    </p>
                    <ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                        <li>Personal identification information (name, email, phone number)</li>
                        <li>Service request details and preferences</li>
                        <li>Payment information (processed securely through Paystack)</li>
                        <li>Communication records with service providers</li>
                        <li>Location data for service delivery</li>
                    </ul>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">3. How We Use Your Information</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        We use the information we collect to:
                    </p>
                    <ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                        <li>Provide, maintain, and improve our services</li>
                        <li>Process transactions and send related information</li>
                        <li>Match you with appropriate service providers</li>
                        <li>Send you technical notices and support messages</li>
                        <li>Respond to your comments and questions</li>
                        <li>Monitor and analyze trends and usage</li>
                    </ul>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">4. Information Sharing</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        We share your information only in the following circumstances:
                    </p>
                    <ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                        <li>With service providers assigned to your requests</li>
                        <li>With payment processors (Paystack) for transaction processing</li>
                        <li>When required by law or to protect our rights</li>
                        <li>With your explicit consent</li>
                    </ul>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">5. Data Security</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        We implement appropriate technical and organizational security measures to protect your personal information. However, no method of transmission over the Internet is 100% secure.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">6. Your Rights</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        You have the right to:
                    </p>
                    <ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                        <li>Access and update your personal information</li>
                        <li>Request deletion of your account and data</li>
                        <li>Opt-out of marketing communications</li>
                        <li>Request a copy of your data</li>
                    </ul>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">7. Contact Us</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8;">
                        If you have questions about this Privacy Policy, please contact us at <a href="mailto:privacy@homefix.com" style="color: var(--primary-600);">privacy@homefix.com</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Terms and Conditions Screen -->
    <div class="screen" id="terms-conditions-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showLandingPage(); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Home
                </a>
                <h1 class="settings-title">Terms and Conditions</h1>
                <p class="settings-subtitle">Last updated: January 2025</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">1. Acceptance of Terms</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        By accessing and using HomeFix, you accept and agree to be bound by these Terms and Conditions. If you do not agree, please do not use our platform.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">2. Service Description</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        HomeFix is a platform that connects customers with verified home service providers. We facilitate the connection but are not a party to the service agreement between you and the service provider.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">3. User Responsibilities</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        You agree to:
                    </p>
                    <ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                        <li>Provide accurate and complete information</li>
                        <li>Use the platform only for lawful purposes</li>
                        <li>Respect service providers and other users</li>
                        <li>Pay for services as agreed</li>
                        <li>Not engage in fraudulent or harmful activities</li>
                    </ul>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">4. Service Provider Relationship</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        Service providers are independent contractors. HomeFix is not responsible for the quality, safety, or legality of services provided. Any disputes should be resolved directly with the service provider.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">5. Payments and Refunds</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        All payments are processed securely through Paystack. Refund policies are determined by individual service providers. HomeFix may facilitate refund requests but is not responsible for refund decisions.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">6. Limitation of Liability</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        HomeFix shall not be liable for any indirect, incidental, special, or consequential damages arising from your use of the platform or services provided by third parties.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">7. Modifications</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        We reserve the right to modify these terms at any time. Continued use of the platform after changes constitutes acceptance of the modified terms.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">8. Contact Information</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8;">
                        For questions about these Terms, contact us at <a href="mailto:legal@homefix.com" style="color: var(--primary-600);">legal@homefix.com</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Reset Screen -->
    <div class="screen" id="password-reset-screen">
        <div class="auth-container">
            <div class="auth-wrapper">
                <div class="auth-card">
                    <div style="margin-bottom: var(--spacing-md);">
                        <a href="#" class="auth-link" onclick="switchToSignIn(); return false;" style="display: inline-flex; align-items: center; gap: var(--spacing-xs);">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                            Back to Sign In
                        </a>
                    </div>
                    <div class="auth-header">
                        <div class="auth-logo">
                            <img src="images/logo.png" alt="HomeFix Logo" width=50 height=50>
                            <span>HomeFix</span>
                        </div>
                        <h1 class="auth-title">Reset Password</h1>
                        <p class="auth-subtitle">Enter your email address and we'll send you a link to reset your password</p>
                    </div>

                    <div class="error-message" id="reset-error"></div>
                    <div class="success-message" id="reset-success"></div>

                    <form class="auth-form" id="reset-form" onsubmit="handlePasswordReset(event)">
                        <div class="form-group">
                            <label class="form-label" for="reset-email">Email Address</label>
                            <input 
                                type="email" 
                                id="reset-email" 
                                class="form-input" 
                                placeholder="Enter your email"
                                required
                            >
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            Send Reset Link
                        </button>
                    </form>

                    <div class="auth-footer">
                        Remember your password? <a href="#" class="auth-link" onclick="switchToSignIn(); return false;">Sign in</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 2FA Settings Screen -->
    <div class="screen" id="2fa-settings-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('account-security'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Security
                </a>
                <h1 class="settings-title">Two-Factor Authentication</h1>
                <p class="settings-subtitle">Add an extra layer of security to your account</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">What is 2FA?</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        Two-Factor Authentication (2FA) adds an extra layer of security to your account. After enabling 2FA, you'll need to enter a code from your authenticator app in addition to your password when signing in.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Enable 2FA</h2>
                    <div class="security-item">
                        <div class="security-item-info">
                            <div class="security-item-title">Two-Factor Authentication</div>
                            <div class="security-item-desc">Currently inactive</div>
                        </div>
                        <span class="security-status inactive">Inactive</span>
                    </div>
                    <div style="margin-top: var(--spacing-lg); padding: var(--spacing-lg); background: var(--neutral-50); border-radius: var(--radius-lg);">
                        <h3 style="margin-bottom: var(--spacing-md); color: var(--neutral-900);">Steps to Enable:</h3>
                        <ol style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                            <li>Download an authenticator app (Google Authenticator, Authy, or Microsoft Authenticator)</li>
                            <li>Click the "Enable 2FA" button below</li>
                            <li>Scan the QR code with your authenticator app</li>
                            <li>Enter the verification code to complete setup</li>
                        </ol>
                        <button class="btn btn-primary" style="margin-top: var(--spacing-md);" onclick="enable2FA()">Enable 2FA</button>
                    </div>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Recovery Codes</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        Save your recovery codes in a safe place. You can use these codes to access your account if you lose access to your authenticator app.
                    </p>
                    <button class="btn btn-ghost" onclick="generateRecoveryCodes()">Generate Recovery Codes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Sessions Screen -->
    <div class="screen" id="active-sessions-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('account-security'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Security
                </a>
                <h1 class="settings-title">Active Sessions</h1>
                <p class="settings-subtitle">Manage devices where you're logged in</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">Current Sessions</h2>
                    <div class="session-item">
                        <div class="session-info">
                            <div class="session-device">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: var(--spacing-md);">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                                <div>
                                    <div class="session-device-name">Windows PC - Chrome</div>
                                    <div class="session-location">Accra, Ghana</div>
                                    <div class="session-time">Last active: Just now</div>
                                </div>
                            </div>
                            <span class="session-status active">Current Session</span>
                        </div>
                    </div>
                    <div class="session-item">
                        <div class="session-info">
                            <div class="session-device">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: var(--spacing-md);">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                </svg>
                                <div>
                                    <div class="session-device-name">iPhone 13 - Safari</div>
                                    <div class="session-location">Accra, Ghana</div>
                                    <div class="session-time">Last active: 2 hours ago</div>
                                </div>
                            </div>
                            <button class="btn btn-ghost" onclick="revokeSession(this)">Revoke</button>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Security Actions</h2>
                    <button class="btn btn-primary" onclick="revokeAllSessions()">Sign Out All Other Devices</button>
                    <p style="color: var(--neutral-600); font-size: 14px; margin-top: var(--spacing-md);">
                        This will sign you out of all devices except this one.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Getting Started Guide Screen -->
    <div class="screen" id="getting-started-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('help-support'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Help
                </a>
                <h1 class="settings-title">Getting Started Guide</h1>
                <p class="settings-subtitle">Learn how to use HomeFix</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">Welcome to HomeFix!</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        HomeFix makes it easy to find and book professional home services. Follow this guide to get started.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Step 1: Create Your Account</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        Sign up with your email address or use Google to create your account. Make sure to verify your email address.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Step 2: Complete Your Profile</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        Add your personal information, location, and preferences. A complete profile helps us match you with the best service providers.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Step 3: Browse Services</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        Explore our wide range of home services including plumbing, electrical, cleaning, painting, and more. Use the search bar to find specific services.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Step 4: Request a Service</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        Click on a service category, fill out the service request form with your requirements, and submit. Our team will review and assign a qualified provider.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Step 5: Track Your Tasks</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        Monitor your service requests in the "My Tasks" section. You'll receive updates when a provider is assigned and can communicate directly through the platform.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Step 6: Make Payments</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        Once you receive an invoice, you can pay securely through Paystack using various payment methods including cards, mobile money, or bank transfer.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Help Screen -->
    <div class="screen" id="booking-help-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('help-support'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Help
                </a>
                <h1 class="settings-title">Booking Services</h1>
                <p class="settings-subtitle">How to book and manage services</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">How to Book a Service</h2>
                    <ol style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                        <li>Browse our service categories or use the search bar to find what you need</li>
                        <li>Click on the service category you're interested in</li>
                        <li>Fill out the service request form with:
                            <ul style="margin-top: var(--spacing-xs); padding-left: var(--spacing-lg);">
                                <li>Service description and requirements</li>
                                <li>Preferred date and time</li>
                                <li>Location details</li>
                                <li>Any special instructions</li>
                            </ul>
                        </li>
                        <li>Submit your request</li>
                        <li>Wait for our team to assign a qualified provider</li>
                    </ol>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Managing Your Bookings</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        You can view and manage all your service requests in the "My Tasks" section:
                    </p>
                    <ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                        <li>View current and past service requests</li>
                        <li>Check the status of your bookings</li>
                        <li>Communicate with assigned providers</li>
                        <li>View and pay invoices</li>
                        <li>Cancel or reschedule services</li>
                    </ul>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Cancellation Policy</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        You can cancel or reschedule your service request at any time before the service begins. Cancellation fees may apply depending on the timing. Check with your service provider for specific cancellation policies.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Help Screen -->
    <div class="screen" id="payment-help-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('help-support'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Help
                </a>
                <h1 class="settings-title">Payments & Billing</h1>
                <p class="settings-subtitle">Payment methods and invoices</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">Accepted Payment Methods</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        We accept payments through Paystack, which supports:
                    </p>
                    <ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                        <li> Debit/Credit Cards (Visa, Mastercard, Verve)</li>
                        <li> Mobile Money (MTN, Vodafone, AirtelTigo)</li>
                        <li> Bank Transfer</li>
                        <li> USSD</li>
                    </ul>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">How to Pay</h2>
                    <ol style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                        <li>After your service is completed, you'll receive an invoice</li>
                        <li>Click on the invoice in your task details</li>
                        <li>Review the invoice items and total amount</li>
                        <li>Click "Pay Now" to proceed to payment</li>
                        <li>You'll be redirected to Paystack's secure payment page</li>
                        <li>Choose your preferred payment method and complete the transaction</li>
                        <li>You'll receive a payment confirmation</li>
                    </ol>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Payment Security</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        All payments are processed securely through Paystack. We never store your card or account details. Paystack is PCI DSS compliant and uses industry-standard encryption to protect your payment information.
                    </p>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Refunds</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        Refund policies are determined by individual service providers. If you need a refund, contact the service provider directly or reach out to our support team for assistance.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Account Help Screen -->
    <div class="screen" id="account-help-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('help-support'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Help
                </a>
                <h1 class="settings-title">Account Settings</h1>
                <p class="settings-subtitle">Manage your account</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">Updating Your Profile</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        To update your personal information:
                    </p>
                    <ol style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                        <li>Go to Profile  Personal Info</li>
                        <li>Update your name, email, phone number, or address</li>
                        <li>Click "Save Changes"</li>
                    </ol>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Changing Your Password</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        To change your password:
                    </p>
                    <ol style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                        <li>Go to Profile  Account & Security</li>
                        <li>Enter your current password</li>
                        <li>Enter your new password (must be at least 8 characters)</li>
                        <li>Confirm your new password</li>
                        <li>Click "Update Password"</li>
                    </ol>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Managing Notifications</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        Control how you receive notifications:
                    </p>
                    <ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                        <li>Go to Profile  Notification</li>
                        <li>Toggle email notifications on or off</li>
                        <li>Enable or disable push notifications</li>
                        <li>Customize notification preferences for different types of updates</li>
                    </ul>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Account Security</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        Enhance your account security:
                    </p>
                    <ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-700); line-height: 1.8;">
                        <li>Enable Two-Factor Authentication (2FA)</li>
                        <li>Review active sessions and sign out from unknown devices</li>
                        <li>Keep your password strong and unique</li>
                        <li>Enable login alerts to be notified of suspicious activity</li>
                    </ul>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Deleting Your Account</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-md);">
                        To delete your account, please contact our support team. We'll process your request and permanently delete your account and associated data.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Support Screen -->
    <div class="screen" id="contact-support-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('help-support'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Help
                </a>
                <h1 class="settings-title">Contact Support</h1>
                <p class="settings-subtitle">We're here to help you</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">Get in Touch</h2>
                    <p style="color: var(--neutral-700); line-height: 1.8; margin-bottom: var(--spacing-lg);">
                        Have a question or need assistance? Reach out to our support team through any of the following methods:
                    </p>

                    <div style="display: grid; gap: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
                        <div style="padding: var(--spacing-lg); background: var(--neutral-50); border-radius: var(--radius-lg);">
                            <h3 style="margin-bottom: var(--spacing-sm); color: var(--neutral-900); display: flex; align-items: center; gap: var(--spacing-sm);">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                                Email Support
                            </h3>
                            <p style="color: var(--neutral-700); margin-bottom: var(--spacing-sm);">Send us an email and we'll respond within 24 hours:</p>
                            <a href="mailto:support@homefix.com" style="color: var(--primary-600); font-weight: 500;">support@homefix.com</a>
                        </div>

                        <div style="padding: var(--spacing-lg); background: var(--neutral-50); border-radius: var(--radius-lg);">
                            <h3 style="margin-bottom: var(--spacing-sm); color: var(--neutral-900); display: flex; align-items: center; gap: var(--spacing-sm);">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                </svg>
                                Phone Support
                            </h3>
                            <p style="color: var(--neutral-700); margin-bottom: var(--spacing-sm);">Call us during business hours (Monday - Friday, 9 AM - 5 PM):</p>
                            <a href="tel:+233XXXXXXXXX" style="color: var(--primary-600); font-weight: 500;">+233 XX XXX XXXX</a>
                        </div>

                        <div style="padding: var(--spacing-lg); background: var(--neutral-50); border-radius: var(--radius-lg);">
                            <h3 style="margin-bottom: var(--spacing-sm); color: var(--neutral-900); display: flex; align-items: center; gap: var(--spacing-sm);">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                                Live Chat
                            </h3>
                            <p style="color: var(--neutral-700); margin-bottom: var(--spacing-md);">Chat with our support team in real-time:</p>
                            <button class="btn btn-primary" onclick="showScreen('live-chat')">Start Live Chat</button>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Send us a Message</h2>
                    <form class="auth-form" id="support-form" onsubmit="handleSupportForm(event)">
                        <div class="form-group">
                            <label class="form-label" for="support-name">Your Name</label>
                            <input type="text" id="support-name" class="form-input" placeholder="Enter your name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="support-email">Email Address</label>
                            <input type="email" id="support-email" class="form-input" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="support-subject">Subject</label>
                            <input type="text" id="support-subject" class="form-input" placeholder="What is this regarding?" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="support-message">Message</label>
                            <textarea id="support-message" class="form-input" rows="5" placeholder="Describe your issue or question..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Send Message</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div class="notification-toast" id="notification-toast">
        <div class="notification-toast-content">
            <div class="notification-toast-icon"></div>
            <div class="notification-toast-text">
                <div class="notification-toast-title" id="notification-toast-title"></div>
                <div class="notification-toast-message" id="notification-toast-message"></div>
            </div>
            <button class="notification-toast-close" onclick="closeNotificationToast()"></button>
        </div>
    </div>

    <!-- Floating Chat Button -->
    <div class="floating-chat-button" id="floating-chat-button" onclick="openFloatingChat()">
        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
        </svg>
        <span class="floating-chat-badge" id="floating-chat-badge" style="display: none;">0</span>
    </div>

    <script>
        // Service Categories Data with descriptions
        const serviceCategories = [
            { 
                key: 'cleaning', 
                label: 'Cleaning Services', 
                description: 'Professional cleaning for your home or office',
                icon: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z',
                image: 'images/cleaning-service.png'
            },
            { 
                key: 'plumbing', 
                label: 'Plumbing', 
                description: 'Expert plumbers for repairs and installations',
                icon: 'M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z',
                image: 'images/plumbing.png'
            },
            { 
                key: 'electrical', 
                label: 'Electrical', 
                description: 'Licensed electricians for all your electrical needs',
                icon: 'M13 10V3L4 14h7v7l9-11h-7z',
                image: 'images/electrical.png'
            },
            { 
                key: 'carpentry', 
                label: 'Carpentry', 
                description: 'Skilled carpenters for custom woodwork',
                icon: 'M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4',
                image: 'images/Carpentry.png'
            },
            { 
                key: 'painting', 
                label: 'Painting', 
                description: 'Professional painters for interior and exterior',
                icon: 'M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01',
                image: 'images/Painting.png'
            },
            { 
                key: 'gardening', 
                label: 'Gardening', 
                description: 'Landscaping and garden maintenance services',
                icon: 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253',
                image: 'images/gardener-garden-with-hut-cuts-tree-with-hedgehogs-against-sky.png'
            },
        ];

        // Mock Tasks Data
        const mockTasks = {
            current: [
                {
                    id: 't1',
                    title: 'Plumbing Repair',
                    date: 'Wed Apr 23, 2025',
                    time: '11:30 AM',
                    assignee: 'Samuel',
                    status: 'current',
                    hasInvoice: false
                }
            ],
            past: [
                {
                    id: 't0',
                    title: 'TV Mount Installation',
                    date: 'Mon Mar 10, 2025',
                    time: '02:00 PM',
                    assignee: 'Ava',
                    status: 'past',
                    hasInvoice: true
                }
            ]
        };

        let currentTaskTab = 'current';

        // Initialize
        function init() {
            renderCategories();
            renderTasks();
            // Show profile notification if needed
            setTimeout(() => {
                document.getElementById('profile-notification').classList.add('show');
            }, 1000);
        }

        // Screen Navigation
        async function showScreen(screen) {
            // Handle password reset screen (it's in auth-container, not main-content)
            if (screen === 'password-reset') {
                const authContainer = document.getElementById('auth-container');
                const mainContent = document.getElementById('main-content');
                const landingPage = document.getElementById('landing-page');
                if (authContainer) {
                    authContainer.style.display = 'flex';
                    document.getElementById('signin-card').style.display = 'none';
                    document.getElementById('register-card').style.display = 'none';
                }
                if (mainContent) {
                    mainContent.style.display = 'none';
                }
                if (landingPage) {
                    landingPage.style.display = 'none';
                }
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                const passwordResetScreen = document.getElementById('password-reset-screen');
                if (passwordResetScreen) {
                    passwordResetScreen.classList.add('active');
                }
                window.scrollTo(0, 0);
                return;
            }
            
            // Handle public pages (Privacy Policy, Terms) - accessible from landing page
            const publicPages = ['privacy-policy', 'terms-conditions'];
            if (publicPages.includes(screen)) {
                const landingPage = document.getElementById('landing-page');
                const mainContent = document.getElementById('main-content');
                const authContainer = document.getElementById('auth-container');
                
                if (landingPage) landingPage.style.display = 'none';
                if (authContainer) authContainer.style.display = 'none';
                if (mainContent) mainContent.style.display = 'none';
                
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                const targetScreen = document.getElementById(`${screen}-screen`);
                if (targetScreen) {
                    targetScreen.classList.add('active');
                }
                window.scrollTo(0, 0);
                return;
            }
            
            // Hide auth container when showing other screens
            const authContainer = document.getElementById('auth-container');
            if (authContainer && screen !== 'password-reset') {
                authContainer.style.display = 'none';
            }
            
            // Hide landing page for authenticated screens
            const landingPage = document.getElementById('landing-page');
            if (landingPage && !publicPages.includes(screen)) {
                landingPage.style.display = 'none';
            }
            
            // Show main content for authenticated screens
            const mainContent = document.getElementById('main-content');
            if (mainContent && screen !== 'password-reset' && !publicPages.includes(screen)) {
                mainContent.style.display = 'block';
            }
            
            // Hide all screens
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            
            // Show selected screen
            const targetScreen = document.getElementById(`${screen}-screen`);
            if (targetScreen) {
                targetScreen.classList.add('active');
            }
            
            // Load tasks when tasks screen is shown
            if (screen === 'tasks') {
                renderTasks();
            }
            
            // Load profile data when profile screen is shown
            if (screen === 'profile') {
                await loadProfileData();
            }
            
            // Load personal info when personal-info screen is shown
            if (screen === 'personal-info') {
                await loadPersonalInfo();
            }
            
            // Initialize chat when live-chat screen is shown
            if (screen === 'live-chat') {
                await initializeChat();
            } else if (chatMessageListener) {
                // Clean up listener when leaving chat
                chatMessageListener();
                chatMessageListener = null;
                currentChatId = null;
            }
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
        
        // Load profile data from Firestore
        async function loadProfileData() {
            try {
                const currentUser = firebaseAuth.getCurrentUser();
                if (!currentUser) {
                    console.warn('No user logged in');
                    return;
                }
                
                const userDataResult = await firebaseUsers.getUser(currentUser.uid);
                if (userDataResult.success) {
                    const userData = userDataResult.data;
                    
                    // Update profile display
                    const profileName = document.querySelector('.profile-name');
                    const profileEmail = document.querySelector('.profile-email');
                    
                    if (profileName) {
                        profileName.textContent = userData.name || 'User';
                    }
                    if (profileEmail) {
                        profileEmail.textContent = userData.email || 'user@example.com';
                    }
                }
            } catch (error) {
                console.error('Error loading profile data:', error);
            }
        }
        
        // Load personal info into form
        async function loadPersonalInfo() {
            try {
                const currentUser = firebaseAuth.getCurrentUser();
                if (!currentUser) {
                    console.warn('No user logged in');
                    return;
                }
                
                const userDataResult = await firebaseUsers.getUser(currentUser.uid);
                if (userDataResult.success) {
                    const userData = userDataResult.data;
                    
                    // Split name into first and last name
                    const nameParts = (userData.name || '').split(' ');
                    const firstName = nameParts[0] || '';
                    const lastName = nameParts.slice(1).join(' ') || '';
                    
                    // Populate form fields
                    const firstNameInput = document.getElementById('first-name');
                    const lastNameInput = document.getElementById('last-name');
                    const emailInput = document.getElementById('email');
                    const phoneInput = document.getElementById('phone');
                    const addressInput = document.getElementById('address');
                    const cityInput = document.getElementById('city');
                    const stateInput = document.getElementById('state');
                    const countryInput = document.getElementById('country');
                    
                    if (firstNameInput) firstNameInput.value = firstName;
                    if (lastNameInput) lastNameInput.value = lastName;
                    if (emailInput) emailInput.value = userData.email || '';
                    if (phoneInput) phoneInput.value = userData.phone || '';
                    if (addressInput) addressInput.value = userData.address || '';
                    if (cityInput) cityInput.value = userData.city || '';
                    if (stateInput) stateInput.value = userData.state || '';
                    if (countryInput) countryInput.value = userData.country || '';
                }
            } catch (error) {
                console.error('Error loading personal info:', error);
            }
        }

        // Render Categories
        function renderCategories(categories = serviceCategories) {
            const grid = document.getElementById('category-grid');
            grid.innerHTML = categories.map(cat => `
                <a href="#" class="category-card" onclick="selectCategory('${cat.key}'); return false;">
                    <div class="category-icon-wrapper">
                        <img src="${cat.image}" alt="${cat.label}" class="category-icon-image">
                    </div>
                    <div class="category-label">${cat.label}</div>
                    <div class="category-description">${cat.description}</div>
                </a>
            `).join('');
        }

        // Filter Categories
        function filterCategories() {
            const query = (document.getElementById('nav-search-input')?.value || 
                          document.getElementById('hero-search-input')?.value || '').toLowerCase();
            const filtered = serviceCategories.filter(cat => 
                cat.label.toLowerCase().includes(query) ||
                cat.description.toLowerCase().includes(query)
            );
            renderCategories(filtered);
        }

        // Service detail data
        const serviceDetails = {
            cleaning: {
                label: 'Cleaning Services',
                description: 'Professional cleaning services for your home or office. Our experienced team ensures a spotless environment.',
                about: 'Our professional cleaning services are designed to keep your space immaculate. We use eco-friendly products and modern techniques to ensure a thorough clean while being safe for your family and pets.',
                includes: [
                    'Deep cleaning of all rooms',
                    'Kitchen and bathroom sanitization',
                    'Dusting and vacuuming',
                    'Window cleaning',
                    'Trash removal',
                    'Eco-friendly cleaning products'
                ],
                price: 'Starting at $50',
                icon: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z',
                image: 'images/cleaning-service.png',
                backgroundImage: 'images/bucket-with-cleaning-products-defocused-father-son.jpg'
            },
            plumbing: {
                label: 'Plumbing',
                description: 'Expert plumbers for all your plumbing repairs and installations.',
                about: 'Our licensed plumbers handle everything from minor leaks to major installations. We provide 24/7 emergency services and guarantee our work.',
                includes: [
                    'Leak detection and repair',
                    'Pipe installation and repair',
                    'Fixture installation',
                    'Drain cleaning',
                    'Water heater service',
                    'Emergency repairs'
                ],
                price: 'Starting at $75',
                icon: 'M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z',
                image: 'images/plumbing.png',
                backgroundImage: 'images/plumber-icon.png'
            },
            electrical: {
                label: 'Electrical',
                description: 'Licensed electricians for all your electrical needs.',
                about: 'Professional electrical services with certified electricians. We ensure all work meets safety standards and local codes.',
                includes: [
                    'Electrical repairs',
                    'Wiring installation',
                    'Outlet and switch installation',
                    'Circuit breaker service',
                    'Light fixture installation',
                    'Safety inspections'
                ],
                price: 'Starting at $80',
                icon: 'M13 10V3L4 14h7v7l9-11h-7z',
                image: 'images/electrical.png',
                backgroundImage: 'images/electric-machines-switches-isolated-white-close-up-connect-marker-cable-device-with-red-screwdriver.jpg'
            },
            carpentry: {
                label: 'Carpentry',
                description: 'Skilled carpenters for custom woodwork and repairs.',
                about: 'Expert carpentry services for custom projects, repairs, and installations. Quality craftsmanship guaranteed.',
                includes: [
                    'Custom furniture',
                    'Cabinet installation',
                    'Door and window repair',
                    'Deck and fence construction',
                    'Trim and molding',
                    'Shelving installation'
                ],
                price: 'Starting at $60',
                icon: 'M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4',
                image: 'images/Carpentry.png',
                backgroundImage: 'images/man-wears-safety-goggles-while-using-chisel-hammer-avoid-injury.jpg'
            },
            painting: {
                label: 'Painting',
                description: 'Professional painters for interior and exterior painting.',
                about: 'Transform your space with professional painting services. We use premium paints and proper preparation techniques.',
                includes: [
                    'Interior painting',
                    'Exterior painting',
                    'Color consultation',
                    'Surface preparation',
                    'Primer application',
                    'Clean-up included'
                ],
                price: 'Starting at $100',
                icon: 'M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01',
                image: 'images/Painting.png',
                backgroundImage: 'images/male-hand-paints-with-white-paint-wood.jpg'
            },
            gardening: {
                label: 'Gardening',
                description: 'Landscaping and garden maintenance services.',
                about: 'Keep your outdoor space beautiful with our professional landscaping and garden maintenance services.',
                includes: [
                    'Lawn mowing and care',
                    'Garden design',
                    'Planting and pruning',
                    'Weed control',
                    'Fertilization',
                    'Seasonal cleanup'
                ],
                price: 'Starting at $40',
                icon: 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253',
                image: 'images/gardener-garden-with-hut-cuts-tree-with-hedgehogs-against-sky.png',
                backgroundImage: 'images/gardener-garden-with-hut-cuts-tree-with-hedgehogs-against-sky.png'
            }
        };

        let currentServiceKey = null;

        // Select Category
        function selectCategory(key) {
            currentServiceKey = key;
            const service = serviceDetails[key];
            if (!service) return;

            // Populate service detail header
            const header = document.getElementById('service-detail-header');
            // Set background image if available
            if (service.backgroundImage) {
                header.style.backgroundImage = `linear-gradient(135deg, rgba(165, 59, 43, 0.1) 0%, rgba(255, 255, 255, 0.9) 100%), url('${service.backgroundImage}')`;
            }
            header.innerHTML = `
                <div class="service-icon-large">
                    <img src="${service.image || 'images/logo.png'}" alt="${service.label}">
                </div>
                <div class="service-header-text">
                    <h1>${service.label}</h1>
                    <p>${service.description}</p>
                    <div class="service-features">
                        <div class="service-feature">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>Licensed Professionals</span>
                        </div>
                        <div class="service-feature">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>24/7 Support</span>
                        </div>
                        <div class="service-feature">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                            <span>Guaranteed Quality</span>
                        </div>
                    </div>
                </div>
            `;

            // Populate service info
            document.getElementById('service-about').textContent = service.about;
            document.getElementById('service-price').textContent = service.price;
            
            const includesList = document.getElementById('service-includes');
            includesList.innerHTML = service.includes.map(item => `
                <li>
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    ${item}
                </li>
            `).join('');

            showScreen('service-detail');
        }

        // Start Survey
        function startSurvey() {
            if (!currentServiceKey) return;
            const service = serviceDetails[currentServiceKey];
            document.getElementById('survey-service').value = service.label;
            showScreen('survey');
        }

        // Go back from survey
        function goBackFromSurvey() {
            showScreen('service-detail');
        }

        // Submit Survey
        async function submitSurvey(event) {
            try {
                event.preventDefault();
                console.log(' Survey form submitted');
                
                // Get form values with error checking
                const serviceEl = document.getElementById('survey-service');
                const dateEl = document.getElementById('survey-date');
                const timeEl = document.getElementById('survey-time');
                const locationEl = document.getElementById('survey-location');
                const urgencyEl = document.querySelector('input[name="urgency"]:checked');
                const descriptionEl = document.getElementById('survey-description');
                const phoneEl = document.getElementById('survey-phone');
                
                if (!serviceEl || !dateEl || !timeEl || !locationEl || !urgencyEl || !descriptionEl || !phoneEl) {
                    console.error(' Missing form elements:', {
                        service: !!serviceEl,
                        date: !!dateEl,
                        time: !!timeEl,
                        location: !!locationEl,
                        urgency: !!urgencyEl,
                        description: !!descriptionEl,
                        phone: !!phoneEl
                    });
                    alert('Error: Some form fields are missing. Please refresh the page and try again.');
                    return;
                }
                
                const formData = {
                    service: serviceEl.value,
                    date: dateEl.value,
                    time: timeEl.value,
                    location: locationEl.value,
                    urgency: urgencyEl.value,
                    description: descriptionEl.value,
                    phone: phoneEl.value,
                    requirements: Array.from(document.querySelectorAll('input[name="requirements"]:checked')).map(cb => cb.value)
                };
                
                console.log(' Form data collected:', formData);
                
                // Validate required fields
                if (!formData.service || !formData.date || !formData.time || !formData.location || !formData.urgency || !formData.description || !formData.phone) {
                    alert('Please fill in all required fields.');
                    console.error(' Missing required fields');
                    return;
                }

                // Get current user - must be logged in
                const currentUser = firebaseAuth.getCurrentUser();
                console.log(' Current user check:', currentUser ? { uid: currentUser.uid, email: currentUser.email } : 'Not logged in');
                
                if (!currentUser || !currentUser.uid) {
                    alert('Please sign in to submit a service request.');
                    showAuthPage('signin');
                    return;
                }
                
                // Get user information
                let userData = await sessionDB.get('homefix_user') || {};
                let userName = userData.name;
                let userEmail = userData.email || currentUser.email;
                
                // If name not available, try to get from Firebase user data
                if (!userName) {
                    const userDataResult = await firebaseUsers.getUser(currentUser.uid);
                    if (userDataResult.success && userDataResult.data) {
                        userName = userDataResult.data.name;
                        userEmail = userDataResult.data.email || userEmail;
                    }
                }
                
                // Fallback to email username if no name
                if (!userName) {
                    userName = userEmail ? userEmail.split('@')[0] : 'User';
                }
                
                console.log('Creating request for user:', { uid: currentUser.uid, userName, userEmail, service: formData.service });
                
                const newRequest = {
                    clientUid: currentUser.uid, // Store user ID for easy querying
                    clientName: userName || 'User',
                    clientEmail: userEmail || '',
                    clientPhone: formData.phone,
                    service: formData.service,
                    description: formData.description,
                    location: formData.location,
                    date: new Date(formData.date).toLocaleDateString(),
                    preferredTime: formData.time,
                    urgency: formData.urgency,
                    requirements: formData.requirements,
                    status: 'pending'
                };
                
                // Save request to Firestore
                console.log(' Saving request to Firestore...');
                const result = await firebaseRequests.createRequest(newRequest);
                
                if (!result.success) {
                    alert('Error creating request: ' + (result.error || 'Unknown error') + '. Please try again.');
                    console.error(' Error creating request:', result.error);
                    return;
                }
                
                newRequest.id = result.id; // Store the generated ID
                console.log(' Request created successfully:', newRequest.id, newRequest);

                // Populate confirmation details
                const confirmationDetails = document.getElementById('confirmation-details');
                if (!confirmationDetails) {
                    console.error(' Confirmation details element not found');
                    alert('Request created but confirmation screen not found. Request ID: ' + newRequest.id);
                    showScreen('tasks'); // Fallback to tasks screen
                    return;
                }
                
                confirmationDetails.innerHTML = `
                    <div class="confirmation-details-item">
                        <span class="confirmation-details-label">Service</span>
                        <span class="confirmation-details-value">${formData.service}</span>
                    </div>
                    <div class="confirmation-details-item">
                        <span class="confirmation-details-label">Date</span>
                        <span class="confirmation-details-value">${new Date(formData.date).toLocaleDateString()}</span>
                    </div>
                    <div class="confirmation-details-item">
                        <span class="confirmation-details-label">Time</span>
                        <span class="confirmation-details-value">${formData.time}</span>
                    </div>
                    <div class="confirmation-details-item">
                        <span class="confirmation-details-label">Location</span>
                        <span class="confirmation-details-value">${formData.location}</span>
                    </div>
                    <div class="confirmation-details-item">
                        <span class="confirmation-details-label">Urgency</span>
                        <span class="confirmation-details-value">${formData.urgency.charAt(0).toUpperCase() + formData.urgency.slice(1)}</span>
                    </div>
                `;

                console.log(' Survey submitted successfully');
                console.log(' Request details:', newRequest);
                
                showScreen('confirmation');
            } catch (error) {
                console.error(' Error in submitSurvey:', error);
                alert('An error occurred while submitting your request: ' + error.message + '. Please try again.');
            }
        }

        // Task Tab Switching
        function switchTaskTab(tab, event) {
            currentTaskTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // Fallback: find the button by tab value
                document.querySelectorAll('.tab').forEach(btn => {
                    if (btn.textContent.trim().toLowerCase().includes(tab === 'current' ? 'current' : 'past')) {
                        btn.classList.add('active');
                    }
                });
            }
            renderTasks();
        }

        // Render Tasks
        async function renderTasks() {
            const container = document.getElementById('tasks-container');
            
            if (!container) {
                console.error('Tasks container not found');
                return;
            }
            
            // Get current user - must be logged in
            const currentUser = firebaseAuth.getCurrentUser();
            
            if (!currentUser || !currentUser.uid) {
                console.error(' No user logged in');
                container.innerHTML = '<div style="text-align: center; padding: 60px; color: var(--neutral-500); font-size: 18px;">Please sign in to view your requests</div>';
                return;
            }
            
            console.log(' Current user UID:', currentUser.uid);
            
            // Show loading state
            container.innerHTML = '<div style="text-align: center; padding: 60px; color: var(--neutral-500); font-size: 18px;">Loading your requests...</div>';
            
            // Load user's actual requests from Firestore using UID
            console.log(' Fetching requests for user UID:', currentUser.uid);
            const result = await firebaseRequests.getUserRequests(currentUser.uid);
            console.log(' getUserRequests result:', {
                success: result.success,
                count: result.data ? result.data.length : 0,
                error: result.error
            });
            
            if (!result.success) {
                console.error(' Error loading requests:', result.error);
                container.innerHTML = `<div style="text-align: center; padding: 60px; color: var(--error-500); font-size: 18px;">Error loading requests: ${result.error}</div>`;
                return;
            }
            
            const userRequests = result.data || [];
            console.log(` User requests found: ${userRequests.length}`, userRequests.map(r => ({
                id: r.id,
                service: r.service,
                status: r.status,
                clientEmail: r.clientEmail
            })));
            
            // Convert Firestore timestamps to dates
            userRequests.forEach(request => {
                if (request.createdAt) {
                    const date = convertTimestamp(request.createdAt);
                    request.createdAt = date.toISOString();
                    if (!request.date) {
                        request.date = date.toLocaleDateString();
                    }
                }
            });
            
            // Filter by tab (current = pending/assigned, past = completed or has invoice)
            let filteredRequests = [];
            console.log(` Filtering requests. Current tab: "${currentTaskTab}"`);
            console.log(' All user requests:', userRequests.map(r => ({ 
                id: r.id, 
                service: r.service, 
                status: r.status, 
                hasInvoice: !!r.invoice,
                clientEmail: r.clientEmail 
            })));
            
            if (currentTaskTab === 'current') {
                // Current tasks: pending or assigned (but not completed and not invoiced)
                filteredRequests = userRequests.filter(r => {
                    const isCurrent = (r.status === 'pending' || r.status === 'assigned') && !r.invoice;
                    if (isCurrent) {
                        console.log(` Current task: ${r.id} - ${r.service} (${r.status})`);
                    }
                    return isCurrent;
                });
            } else {
                // Past tasks: completed OR has invoice (invoiced requests are considered done)
                filteredRequests = userRequests.filter(r => {
                    const isPast = r.status === 'completed' || r.invoice;
                    if (isPast) {
                        console.log(` Past task: ${r.id} - ${r.service} (${r.status}, invoice: ${!!r.invoice})`);
                    }
                    return isPast;
                });
            }
            
            console.log(` Filtered requests: ${filteredRequests.length} for "${currentTaskTab}" tab`);
            
            // Sort by date (newest first)
            filteredRequests.sort((a, b) => new Date(b.createdAt || b.date) - new Date(a.createdAt || a.date));
            
            if (filteredRequests.length === 0) {
                const message = `No ${currentTaskTab === 'current' ? 'active' : 'completed'} requests found. Total requests: ${userRequests.length}`;
                console.log(message);
                container.innerHTML = `<div style="text-align: center; padding: 60px; color: var(--neutral-500); font-size: 18px;">${message}</div>`;
                return;
            }

            container.innerHTML = filteredRequests.map(request => {
                const statusClass = request.status === 'pending' ? 'pending' : request.status === 'assigned' ? 'assigned' : 'completed';
                const statusText = request.status === 'pending' ? 'Pending' : request.status === 'assigned' ? 'Assigned' : 'Completed';
                
                return `
                <div class="task-card">
                    <div class="task-card-header">
                        <div class="task-card-header-text">${request.invoice ? 'Invoice Sent' : statusText}</div>
                    </div>
                    <div class="task-card-body">
                        <div class="task-card-title">${request.service}</div>
                        <div class="task-card-row">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--neutral-500);">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            ${request.date || 'N/A'}
                        </div>
                        <div class="task-card-row">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--neutral-500);">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            ${request.location || 'Location not specified'}
                        </div>
                        ${request.description ? `
                        <div style="padding: var(--spacing-sm) 0; color: var(--neutral-600); font-size: 14px; border-top: 1px solid var(--neutral-200); margin-top: var(--spacing-sm); padding-top: var(--spacing-sm);">
                            ${request.description.length > 100 ? request.description.substring(0, 100) + '...' : request.description}
                        </div>
                        ` : ''}
                        ${request.provider ? `
                        <div style="padding: var(--spacing-md); background: var(--primary-50); border-radius: var(--radius-md); margin-top: var(--spacing-md); border-left: 4px solid var(--primary-500);">
                            <div style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-xs);">
                                <img src="images/person.png" alt="${request.provider.name}" class="task-avatar" style="width: 32px; height: 32px; border-radius: 50%;">
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: var(--primary-700);">${request.provider.name}</div>
                                    <div style="font-size: 13px; color: var(--neutral-600);">${request.provider.specialization}</div>
                                </div>
                            </div>
                            <div style="font-size: 13px; color: var(--neutral-600); margin-top: var(--spacing-xs);">
                                 ${request.provider.phone} |  ${request.provider.email}
                            </div>
                        </div>
                        ` : request.status === 'pending' ? `
                        <div style="padding: var(--spacing-md); background: var(--neutral-50); border-radius: var(--radius-md); margin-top: var(--spacing-md); border-left: 4px solid var(--neutral-400);">
                            <div style="font-size: 14px; color: var(--neutral-600);"> Waiting for provider assignment...</div>
                        </div>
                        ` : ''}
                        ${request.invoice ? `
                        <div style="padding: var(--spacing-md); background: ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? 'linear-gradient(135deg, #F0FDF4 0%, #DCFCE7 100%)' : 'linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%)'}; border: 2px solid ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? '#86EFAC' : '#FCD34D'}; border-radius: var(--radius-md); margin-top: var(--spacing-md);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 12px; color: ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? '#166534' : '#92400E'}; font-weight: 600; text-transform: uppercase; margin-bottom: var(--spacing-xs);">
                                        ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? ' Invoice Paid' : ' Invoice Pending Payment'}
                                </div>
                                    <div style="font-size: 20px; color: ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? '#166534' : '#92400E'}; font-weight: 800;">${request.invoice.total.toFixed(2)}</div>
                                    <div style="font-size: 12px; color: ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? '#166534' : '#92400E'}; margin-top: var(--spacing-xs);">
                                        Invoice ID: ${request.invoice.id || 'N/A'}
                                        ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? `  Paid via ${request.invoice.paymentMethod || 'Paystack'}` : ''}
                                    </div>
                                </div>
                                <div style="font-size: 32px;">${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? '' : ''}</div>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    <div class="task-card-footer" style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                        ${request.invoice && request.invoice.status !== 'paid' && request.invoice.paymentStatus !== 'paid' ? `
                        <button class="btn btn-primary" onclick="payInvoiceFromTask('${request.id}')" style="flex: 1; min-width: 200px; font-weight: 600;">
                             Pay ${request.invoice.total.toFixed(2)}
                        </button>
                        <button class="btn-text" onclick="viewUserRequest('${request.id}')" style="flex: 1; min-width: 150px; text-align: center;">
                             View Invoice
                        </button>
                        ` : `
                        <button class="btn-text" onclick="viewUserRequest('${request.id}')" style="flex: 1; min-width: 200px; text-align: center;">
                            ${request.invoice ? ' View Invoice & Details' : ' View Details'}
                        </button>
                        `}
                    </div>
                </div>
            `;
            }).join('');
        }

        // Pay Invoice from Task Card (helper function)
        async function payInvoiceFromTask(requestId) {
            try {
                // Fetch the full request data
                const requestResult = await firebaseRequests.getRequest(requestId);
                if (!requestResult.success || !requestResult.data) {
                    alert('Error: Could not load invoice details. Please try again.');
                    return;
                }
                
                const request = requestResult.data;
                
                // Check if invoice exists
                if (!request.invoice) {
                    alert('No invoice found for this request.');
                    return;
                }
                
                // Check if already paid
                if (request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid') {
                    alert('This invoice has already been paid.');
                    renderTasks(); // Refresh to show updated status
                    return;
                }
                
                // Initiate payment
                await initiatePaystackPayment(request);
            } catch (error) {
                console.error('Error in payInvoiceFromTask:', error);
                alert('An error occurred while processing your payment. Please try again.');
            }
        }

        // Initiate Paystack Payment
        async function initiatePaystackPayment(request) {
            const invoice = request.invoice;
            const amount = invoice.total;
            
            // Get user information
            const currentUser = firebaseAuth.getCurrentUser();
            if (!currentUser) {
                alert('Please sign in to make a payment.');
                return;
            }
            
            // Get user email
            const userEmail = currentUser.email;
            if (!userEmail) {
                alert('Please ensure your account has an email address to make payments.');
                return;
            }
            
            // Confirm payment
            const confirmMessage = ` Paystack Payment\n\n` +
                `Invoice ID: ${invoice.id}\n` +
                `Amount: ${amount.toFixed(2)}\n` +
                `Email: ${userEmail}\n\n` +
                `You will be redirected to Paystack to complete your payment.\n\n` +
                `Continue?`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            try {
                // Initialize Paystack payment
                const paymentResult = await paystackAPI.initializePayment(
                    userEmail,
                amount,
                    invoice.id,
                    {
                        request_id: request.id,
                        client_name: request.clientName || 'Customer',
                        service_type: request.serviceType || 'Home Service'
                    }
                );
                
                if (paymentResult.success) {
                    // Payment successful - update invoice
                    const requestResult = await firebaseRequests.getRequest(request.id);
                        if (requestResult.success && requestResult.data) {
                            const updatedInvoice = {
                                ...request.invoice,
                                status: 'paid',
                                paymentStatus: 'paid',
                                paidAt: new Date().toISOString(),
                            transactionId: paymentResult.reference,
                            paymentMethod: 'Paystack'
                            };
                            
                        await firebaseRequests.updateRequest(request.id, {
                                invoice: updatedInvoice
                            });
                            
                            alert(` Payment Successful!\n\n` +
                            `Invoice ID: ${invoice.id}\n` +
                            `Amount Paid: ${amount.toFixed(2)}\n` +
                            `Transaction Reference: ${paymentResult.reference}\n\n` +
                                `Thank you for your payment!`);
                            
                            // Refresh tasks
                            renderTasks();
                        }
                    }
            } catch (error) {
                if (error.cancelled) {
                    // User cancelled - no need to show error
                    return;
                }
                
                console.error('Paystack payment error:', error);
                alert(`Payment failed: ${error.error || error.message || 'An error occurred'}\n\nPlease try again or contact support.`);
                }
        }

        // View User Request (new function for actual user requests)
        async function viewUserRequest(requestId) {
            // Check if user is logged in using Firebase auth
            const currentUser = firebaseAuth.getCurrentUser();
            
            if (!currentUser || !currentUser.uid) {
                alert('Please sign in to view request details.');
                return;
            }
            
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            const result = await firebaseRequests.getRequest(id);
            
            if (!result.success || !result.data) {
                alert('Request not found.');
                return;
            }
            
            const request = result.data;
            
            // Convert Firestore timestamp if needed
            if (request.createdAt) {
                const date = convertTimestamp(request.createdAt);
                request.createdAt = date.toISOString();
                if (!request.date) {
                    request.date = date.toLocaleDateString();
                }
            }
            
            if (request.invoice) {
                // Show invoice with full details
                showUserInvoice(request);
            } else {
                // Show request details
                showUserRequestDetail(request);
            }
        }
        
        // Show User Request Detail
        function showUserRequestDetail(request) {
            let message = ` REQUEST DETAILS\n`;
            message += `${'='.repeat(60)}\n\n`;
            message += `Service: ${request.service || 'N/A'}\n`;
            message += `Date: ${request.date || 'N/A'}\n`;
            message += `Location: ${request.location || 'N/A'}\n`;
            if (request.preferredTime) {
                message += `Preferred Time: ${request.preferredTime}\n`;
            }
            if (request.urgency) {
                message += `Urgency: ${request.urgency.charAt(0).toUpperCase() + request.urgency.slice(1)}\n`;
            }
            message += `\nDescription:\n${request.description || 'No description provided'}\n`;
            message += `\n${'-'.repeat(60)}\n`;
            message += `Status: ${request.status.toUpperCase()}\n`;
            
            if (request.provider) {
                message += `\n${'='.repeat(60)}\n`;
                message += ` ASSIGNED PROVIDER\n`;
                message += `${'-'.repeat(60)}\n`;
                message += `Name: ${request.provider.name}\n`;
                message += `Email: ${request.provider.email}\n`;
                message += `Phone: ${request.provider.phone}\n`;
                message += `Specialization: ${request.provider.specialization}\n`;
                if (request.provider.assignedAt) {
                    const assignedDate = new Date(request.provider.assignedAt);
                    message += `Assigned: ${assignedDate.toLocaleDateString()}\n`;
                }
            } else {
                message += `\n Provider assignment pending...\n`;
            }
            
            alert(message);
        }
        
        // Show User Invoice with full details and payment option
        function showUserInvoice(request) {
            const invoice = request.invoice;
            const isPaid = invoice.status === 'paid' || invoice.paymentStatus === 'paid';
            
            let message = ` INVOICE DETAILS\n`;
            message += `${'='.repeat(60)}\n\n`;
            message += `Invoice ID: ${invoice.id || 'N/A'}\n`;
            message += `Service: ${request.service || 'N/A'}\n`;
            message += `Date: ${invoice.date || 'N/A'} ${invoice.time || ''}\n`;
            message += `Status: ${isPaid ? 'PAID ' : (invoice.status ? invoice.status.toUpperCase() : 'PENDING PAYMENT')}\n`;
            
            if (request.provider) {
                message += `\n${'-'.repeat(60)}\n`;
                message += ` ASSIGNED PROVIDER\n`;
                message += `${'-'.repeat(60)}\n`;
                message += `Name: ${request.provider.name}\n`;
                message += `Email: ${request.provider.email}\n`;
                message += `Phone: ${request.provider.phone}\n`;
                message += `Specialization: ${request.provider.specialization}\n`;
            }
            
            message += `\n${'='.repeat(60)}\n`;
            message += `INVOICE ITEMS\n`;
            message += `${'-'.repeat(60)}\n\n`;
            
            if (invoice.items && invoice.items.length > 0) {
                invoice.items.forEach((item, index) => {
                    message += `${index + 1}. ${item.description || 'N/A'}\n`;
                    message += `   Quantity: ${item.quantity || 0}\n`;
                    message += `   Unit Price: ${(item.price || 0).toFixed(2)}\n`;
                    message += `   Subtotal: ${(item.total || 0).toFixed(2)}\n\n`;
                });
            } else {
                message += `No items found in invoice.\n\n`;
            }
            
            message += `${'-'.repeat(60)}\n`;
            message += `TOTAL AMOUNT: ${(invoice.total || 0).toFixed(2)}\n`;
            message += `${'='.repeat(60)}\n`;
            
            if (invoice.sentAt) {
                const sentDate = new Date(invoice.sentAt);
                message += `\nSent: ${sentDate.toLocaleDateString()} ${sentDate.toLocaleTimeString()}\n`;
            }
            
            if (invoice.paidAt) {
                const paidDate = new Date(invoice.paidAt);
                message += `\nPaid: ${paidDate.toLocaleDateString()} ${paidDate.toLocaleTimeString()}\n`;
            }
            
            // Show payment button if not paid
            if (!isPaid) {
                const shouldPay = confirm(message + `\n\nWould you like to pay this invoice now?`);
                if (shouldPay) {
                    initiatePaystackPayment(request);
                }
            } else {
                alert(message);
            }
        }

        // View Task (legacy function for mock tasks - kept for compatibility)
        function viewTask(id) {
            // Find task in current or past tasks
            let task = null;
            for (const taskList of Object.values(mockTasks)) {
                task = taskList.find(t => t.id === id);
                if (task) break;
            }
            
            if (!task) return;

            if (task.hasInvoice) {
                // Show invoice
                showInvoice(task);
            } else {
                // Show task detail
                showTaskDetail(task);
            }
        }

        // Show Task Detail
        function showTaskDetail(task) {
            document.getElementById('task-detail-title').textContent = task.title;
            const statusBadge = document.getElementById('task-status-badge');
            statusBadge.textContent = task.status === 'current' ? 'In Progress' : 'Completed';
            statusBadge.className = `task-status-badge ${task.status === 'current' ? 'pending' : 'completed'}`;

            // Populate task info
            document.getElementById('task-detail-info').innerHTML = `
                <div class="task-detail-info-item">
                    <div class="task-detail-info-label">Date</div>
                    <div class="task-detail-info-value">${task.date}</div>
                </div>
                <div class="task-detail-info-item">
                    <div class="task-detail-info-label">Time</div>
                    <div class="task-detail-info-value">${task.time}</div>
                </div>
                <div class="task-detail-info-item">
                    <div class="task-detail-info-label">Status</div>
                    <div class="task-detail-info-value">${task.status === 'current' ? 'In Progress' : 'Completed'}</div>
                </div>
                <div class="task-detail-info-item">
                    <div class="task-detail-info-label">Service Type</div>
                    <div class="task-detail-info-value">${task.title}</div>
                </div>
            `;

            document.getElementById('task-description').textContent = `Service request for ${task.title}. Professional service provider assigned.`;

            // Populate provider card
            document.getElementById('task-provider-card').innerHTML = `
                <img src="images/person.png" alt="${task.assignee}" class="task-provider-avatar">
                <div class="task-provider-info">
                    <div class="task-provider-name">${task.assignee}</div>
                    <div class="task-provider-role">Service Provider</div>
                </div>
            `;

            showScreen('task-detail');
        }

        // Show Invoice
        function showInvoice(task) {
            document.getElementById('invoice-number').textContent = `INV-2025-${task.id.replace('t', '').padStart(3, '0')}`;
            document.getElementById('invoice-date').textContent = task.date;

            // Mock invoice items
            const invoiceItems = [
                { description: task.title, quantity: 1, unitPrice: 150.00, total: 150.00 },
                { description: 'Labor', quantity: 2, unitPrice: 50.00, total: 100.00 },
                { description: 'Materials', quantity: 1, unitPrice: 30.00, total: 30.00 }
            ];

            const itemsTable = document.getElementById('invoice-items');
            itemsTable.innerHTML = invoiceItems.map(item => `
                <tr>
                    <td>${item.description}</td>
                    <td>${item.quantity}</td>
                    <td>$${item.unitPrice.toFixed(2)}</td>
                    <td>$${item.total.toFixed(2)}</td>
                </tr>
            `).join('');

            const subtotal = invoiceItems.reduce((sum, item) => sum + item.total, 0);
            const tax = subtotal * 0.10;
            const total = subtotal + tax;

            document.getElementById('invoice-subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('invoice-tax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('invoice-total').textContent = `$${total.toFixed(2)}`;

            showScreen('invoice');
        }

        // Hide Profile Notification
        function hideProfileNotification() {
            document.getElementById('profile-notification').classList.remove('show');
        }

        // Complete Profile - Opens profile screen
        function completeProfile() {
            hideProfileNotification();
            showScreen('profile');
        }

        // ============================================
        // Chat and Notification Functions
        // ============================================
        
        let currentChatId = null;
        let chatMessageListener = null;
        let globalChatListener = null; // Global listener for new messages
        let notificationListener = null;
        let agentChatsListener = null;
        let currentAgentChatId = null;
        let agentChatMessageListener = null;
        let lastMessageTimestamp = null; // Track last seen message
        let unreadMessageCount = 0;

        // Initialize notifications and chat listener
        async function initNotifications() {
            const currentUser = firebaseAuth.getCurrentUser();
            if (!currentUser) {
                // Hide floating chat button if not logged in
                const floatingButton = document.getElementById('floating-chat-button');
                if (floatingButton) floatingButton.style.display = 'none';
                return;
            }

            // Show floating chat button only if user is on authenticated pages
            const mainContent = document.getElementById('main-content');
            const landingPage = document.getElementById('landing-page');
            const floatingButton = document.getElementById('floating-chat-button');
            if (floatingButton && mainContent && !mainContent.classList.contains('hidden')) {
                // Only show if not on landing page
                if (!landingPage || landingPage.classList.contains('hidden')) {
                    floatingButton.style.display = 'flex';
                }
            }

            // Listen for new notifications
            notificationListener = firebaseNotifications.onNotificationsChange(currentUser.uid, (notifications) => {
                if (notifications.length > 0) {
                    const latest = notifications[0];
                    showNotificationToast(latest.title, latest.message);
                    
                    // Update notification badge
                    const badge = document.getElementById('chat-notification-badge');
                    if (badge) {
                        badge.textContent = notifications.length;
                        badge.style.display = 'inline-block';
                    }
                }
            });

            // Initialize global chat listener
            await initGlobalChatListener();
        }

        // Initialize global chat listener to receive messages even when chat screen is closed
        async function initGlobalChatListener() {
            const currentUser = firebaseAuth.getCurrentUser();
            if (!currentUser) return;

            // Get or create chat
            const chatResult = await firebaseChat.createChat(currentUser.uid, 'admin', null);
            if (chatResult.success) {
                currentChatId = chatResult.id;

                // Get last message timestamp
                const messagesResult = await firebaseChat.getChatMessages(currentChatId);
                if (messagesResult.success && messagesResult.data.length > 0) {
                    const lastMsg = messagesResult.data[messagesResult.data.length - 1];
                    if (lastMsg.createdAt && lastMsg.createdAt.toDate) {
                        lastMessageTimestamp = lastMsg.createdAt.toDate();
                    }
                }

                // Start global listener for new messages
                startGlobalChatListener();
            }
        }

        // Global chat listener that works even when chat screen is closed
        function startGlobalChatListener() {
            if (!currentChatId) return;

            // Remove existing global listener
            if (globalChatListener) {
                globalChatListener();
            }

            globalChatListener = firebaseChat.onMessagesChange(currentChatId, (messages) => {
                if (messages.length === 0) return;

                // Find new messages (messages after lastMessageTimestamp)
                const newMessages = messages.filter(msg => {
                    if (!lastMessageTimestamp) return true;
                    if (msg.createdAt && msg.createdAt.toDate) {
                        return msg.createdAt.toDate() > lastMessageTimestamp;
                    }
                    return false;
                });

                // Count unread agent messages
                const currentUser = firebaseAuth.getCurrentUser();
                if (currentUser) {
                    const agentMessages = newMessages.filter(msg => 
                        msg.senderType === 'agent' && msg.senderId !== currentUser.uid
                    );

                    if (agentMessages.length > 0) {
                        unreadMessageCount += agentMessages.length;
                        updateFloatingChatBadge();

                        // Show notification for new agent messages
                        if (agentMessages.length > 0) {
                            const latestMsg = agentMessages[agentMessages.length - 1];
                            showNotificationToast('New Message', latestMsg.message.substring(0, 50) + '...');
                        }
                    }
                }

                // Update last message timestamp
                const lastMsg = messages[messages.length - 1];
                if (lastMsg.createdAt && lastMsg.createdAt.toDate) {
                    lastMessageTimestamp = lastMsg.createdAt.toDate();
                }

                // Update chat screen if it's open
                const messagesContainer = document.getElementById('chat-messages');
                if (messagesContainer && messagesContainer.closest('.screen.active')) {
                    messagesContainer.innerHTML = '';
                    messages.forEach(msg => {
                        renderChatMessage(msg);
                    });
                    scrollChatToBottom();
                    unreadMessageCount = 0; // Reset when chat is open
                    updateFloatingChatBadge();
                }
            });
        }

        // Update floating chat badge
        function updateFloatingChatBadge() {
            const badge = document.getElementById('floating-chat-badge');
            if (badge) {
                if (unreadMessageCount > 0) {
                    badge.textContent = unreadMessageCount > 99 ? '99+' : unreadMessageCount;
                    badge.style.display = 'block';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        // Open chat from floating button
        function openFloatingChat() {
            // Reset unread count
            unreadMessageCount = 0;
            updateFloatingChatBadge();
            
            // Open chat screen
            showScreen('live-chat');
        }

        // Show notification toast
        function showNotificationToast(title, message) {
            const toast = document.getElementById('notification-toast');
            const titleEl = document.getElementById('notification-toast-title');
            const messageEl = document.getElementById('notification-toast-message');
            
            if (toast && titleEl && messageEl) {
                titleEl.textContent = title;
                messageEl.textContent = message;
                toast.classList.add('show');
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    closeNotificationToast();
                }, 5000);
            }
        }

        function closeNotificationToast() {
            const toast = document.getElementById('notification-toast');
            if (toast) {
                toast.classList.remove('show');
            }
        }

        // Chat Functions for Users
        async function initializeChat() {
            const currentUser = firebaseAuth.getCurrentUser();
            if (!currentUser) {
                alert('Please log in to use chat');
                return;
            }

            // If chat is already initialized, just load messages
            if (currentChatId) {
                loadChatMessages();
                startChatListener();
                // Reset unread count when opening chat
                unreadMessageCount = 0;
                updateFloatingChatBadge();
                return;
            }

            // Create or get existing chat
            const chatResult = await firebaseChat.createChat(currentUser.uid, 'admin', null);
            if (chatResult.success) {
                currentChatId = chatResult.id;
                loadChatMessages();
                startChatListener();
                // Reset unread count when opening chat
                unreadMessageCount = 0;
                updateFloatingChatBadge();
            } else {
                alert('Failed to initialize chat: ' + chatResult.error);
            }
        }

        async function loadChatMessages() {
            if (!currentChatId) return;

            const messagesContainer = document.getElementById('chat-messages');
            if (!messagesContainer) return;

            const result = await firebaseChat.getChatMessages(currentChatId);
            if (result.success) {
                messagesContainer.innerHTML = '';
                
                if (result.data.length === 0) {
                    messagesContainer.innerHTML = `
                        <div class="chat-welcome">
                            <div class="chat-welcome-icon"></div>
                            <div class="chat-welcome-text">Start a conversation with our support team</div>
                        </div>
                    `;
                } else {
                    result.data.forEach(msg => {
                        renderChatMessage(msg);
                    });
                }
                
                scrollChatToBottom();
            }
        }

        function renderChatMessage(msg) {
            const messagesContainer = document.getElementById('chat-messages');
            if (!messagesContainer) return;

            const currentUser = firebaseAuth.getCurrentUser();
            const isUser = msg.senderType === 'user' && msg.senderId === currentUser.uid;
            const messageClass = isUser ? 'user' : 'agent';
            
            const time = msg.createdAt && msg.createdAt.toDate ? 
                msg.createdAt.toDate().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : 
                new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${messageClass}`;
            messageDiv.innerHTML = `
                <div class="chat-message-bubble">
                    ${msg.message}
                    <div class="chat-message-time">${time}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            scrollChatToBottom();
        }

        function startChatListener() {
            if (!currentChatId) return;

            // Remove existing listener
            if (chatMessageListener) {
                chatMessageListener();
            }

            chatMessageListener = firebaseChat.onMessagesChange(currentChatId, (messages) => {
                const messagesContainer = document.getElementById('chat-messages');
                if (!messagesContainer) return;

                messagesContainer.innerHTML = '';
                messages.forEach(msg => {
                    renderChatMessage(msg);
                });
                scrollChatToBottom();
                
                // Reset unread count when viewing chat
                unreadMessageCount = 0;
                updateFloatingChatBadge();
            });
        }

        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            if (!input) return;

            const message = input.value.trim();
            if (!message) return;

            const currentUser = firebaseAuth.getCurrentUser();
            if (!currentUser) {
                alert('Please log in to send messages');
                return;
            }

            // Initialize chat if needed
            if (!currentChatId) {
                await initializeChat();
            }

            if (currentChatId) {
                const result = await firebaseChat.sendMessage(currentChatId, currentUser.uid, 'user', message);
                if (result.success) {
                    input.value = '';
                } else {
                    alert('Failed to send message: ' + result.error);
                }
            }
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function scrollChatToBottom() {
            const messagesContainer = document.getElementById('chat-messages');
            if (messagesContainer) {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }


        // Agent Chat Functions
        function switchAgentTab(tab) {
            document.querySelectorAll('.agent-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.agent-tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`.agent-tab[onclick*="${tab}"]`).classList.add('active');
            document.getElementById(`agent-${tab}-tab`).classList.add('active');
            
            if (tab === 'chats') {
                loadAgentChats();
            }
        }

        async function loadAgentChats() {
            const chatsList = document.getElementById('agent-chats-list');
            if (!chatsList) return;

            const result = await firebaseChat.getAllChats();
            if (result.success) {
                if (result.data.length === 0) {
                    chatsList.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--neutral-500);">No active chats</div>';
                } else {
                    chatsList.innerHTML = result.data.map(chat => {
                        const time = chat.lastMessageAt && chat.lastMessageAt.toDate ? 
                            chat.lastMessageAt.toDate().toLocaleString() : 
                            'Just now';
                        
                        return `
                            <div class="chat-item" onclick="openAgentChat('${chat.id}', '${chat.userUid}')">
                                <div class="chat-item-header">
                                    <div class="chat-item-user">User Chat</div>
                                    <div class="chat-item-time">${time}</div>
                                </div>
                                <div class="chat-item-preview">${chat.lastMessage || 'No messages yet'}</div>
                            </div>
                        `;
                    }).join('');
                }
            }

            // Start real-time listener
            if (agentChatsListener) {
                agentChatsListener();
            }
            agentChatsListener = firebaseChat.onChatsChange((chats) => {
                if (chatsList) {
                    if (chats.length === 0) {
                        chatsList.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--neutral-500);">No active chats</div>';
                    } else {
                        chatsList.innerHTML = chats.map(chat => {
                            const time = chat.lastMessageAt && chat.lastMessageAt.toDate ? 
                                chat.lastMessageAt.toDate().toLocaleString() : 
                                'Just now';
                            
                            return `
                                <div class="chat-item" onclick="openAgentChat('${chat.id}', '${chat.userUid}')">
                                    <div class="chat-item-header">
                                        <div class="chat-item-user">User Chat</div>
                                        <div class="chat-item-time">${time}</div>
                                    </div>
                                    <div class="chat-item-preview">${chat.lastMessage || 'No messages yet'}</div>
                                </div>
                            `;
                        }).join('');
                    }
                }
            });
        }

        async function openAgentChat(chatId, userUid) {
            currentAgentChatId = chatId;
            
            // Get user info
            const userResult = await firebaseUsers.getUser(userUid);
            const userName = userResult.success ? (userResult.data.name || 'User') : 'User';
            const userEmail = userResult.success ? (userResult.data.email || '') : '';

            document.getElementById('chat-view-user-name').textContent = userName;
            document.getElementById('chat-view-user-email').textContent = userEmail;

            // Show chat view, hide list
            document.getElementById('agent-chats-list').style.display = 'none';
            document.getElementById('agent-chat-view').style.display = 'flex';

            // Load messages
            await loadAgentChatMessages();
            startAgentChatListener();
        }

        async function loadAgentChatMessages() {
            if (!currentAgentChatId) return;

            const messagesContainer = document.getElementById('agent-chat-messages');
            if (!messagesContainer) return;

            const result = await firebaseChat.getChatMessages(currentAgentChatId);
            if (result.success) {
                messagesContainer.innerHTML = '';
                result.data.forEach(msg => {
                    renderAgentChatMessage(msg);
                });
                scrollAgentChatToBottom();
            }
        }

        function renderAgentChatMessage(msg) {
            const messagesContainer = document.getElementById('agent-chat-messages');
            if (!messagesContainer) return;

            const isAgent = msg.senderType === 'agent';
            const messageClass = isAgent ? 'agent' : 'user';
            
            const time = msg.createdAt && msg.createdAt.toDate ? 
                msg.createdAt.toDate().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : 
                new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${messageClass}`;
            messageDiv.innerHTML = `
                <div class="chat-message-bubble">
                    ${msg.message}
                    <div class="chat-message-time">${time}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            scrollAgentChatToBottom();
        }

        function startAgentChatListener() {
            if (!currentAgentChatId) return;

            if (agentChatMessageListener) {
                agentChatMessageListener();
            }

            agentChatMessageListener = firebaseChat.onMessagesChange(currentAgentChatId, (messages) => {
                const messagesContainer = document.getElementById('agent-chat-messages');
                if (!messagesContainer) return;

                messagesContainer.innerHTML = '';
                messages.forEach(msg => {
                    renderAgentChatMessage(msg);
                });
            });
        }

        async function sendAgentMessage() {
            const input = document.getElementById('agent-chat-input');
            if (!input) return;

            const message = input.value.trim();
            if (!message) return;

            if (!currentAgentChatId) {
                alert('No chat selected');
                return;
            }

            const result = await firebaseChat.sendMessage(currentAgentChatId, 'agent', 'agent', message);
            if (result.success) {
                input.value = '';
            } else {
                alert('Failed to send message: ' + result.error);
            }
        }

        function handleAgentChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendAgentMessage();
            }
        }

        function closeAgentChatView() {
            document.getElementById('agent-chats-list').style.display = 'block';
            document.getElementById('agent-chat-view').style.display = 'none';
            
            if (agentChatMessageListener) {
                agentChatMessageListener();
                agentChatMessageListener = null;
            }
            currentAgentChatId = null;
        }

        function scrollAgentChatToBottom() {
            const messagesContainer = document.getElementById('agent-chat-messages');
            if (messagesContainer) {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }

        // Settings Page Functions
        // Personal Info
        function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 2 * 1024 * 1024) {
                    alert('File size must be less than 2MB');
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('avatar-preview').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function removeAvatar() {
            document.getElementById('avatar-preview').src = "images/person.png";
        }

        async function savePersonalInfo(event) {
            event.preventDefault();
            
            const currentUser = firebaseAuth.getCurrentUser();
            if (!currentUser) {
                alert('You must be logged in to update your profile.');
                return;
            }
            
            const firstName = document.getElementById('first-name').value.trim();
            const lastName = document.getElementById('last-name').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const address = document.getElementById('address').value.trim();
            const city = document.getElementById('city').value.trim();
            const state = document.getElementById('state').value.trim();
            const country = document.getElementById('country').value.trim();
            
            // Validation
            if (!firstName || !lastName || !email) {
                alert('Please fill in all required fields (First Name, Last Name, Email).');
                return;
            }
            
            // Combine first and last name
            const fullName = `${firstName} ${lastName}`.trim();
            
            const updateData = {
                name: fullName,
                email: email,
                phone: phone || '',
                address: address || '',
                city: city || '',
                state: state || '',
                country: country || '',
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                // Update in Firestore
                const result = await firebaseUsers.updateUser(currentUser.uid, updateData);
                
                if (result.success) {
                    // Update local session
                    await sessionDB.set('homefix_user', {
                        uid: currentUser.uid,
                        name: fullName,
                        email: email,
                        phone: phone
                    });
                    
                    // Update profile display
                    const profileName = document.querySelector('.profile-name');
                    const profileEmail = document.querySelector('.profile-email');
                    
                    if (profileName) profileName.textContent = fullName;
                    if (profileEmail) profileEmail.textContent = email;
                    
                    alert('Personal information updated successfully!');
                    showScreen('profile');
                } else {
                    alert('Failed to update profile. Please try again.');
                    console.error('Update error:', result.error);
                }
            } catch (error) {
                console.error('Error saving personal info:', error);
                alert('An error occurred while saving. Please try again.');
            }
        }

        // Account & Security
        function changePassword(event) {
            event.preventDefault();
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (newPassword !== confirmPassword) {
                alert('New passwords do not match');
                return;
            }

            if (newPassword.length < 8) {
                alert('Password must be at least 8 characters');
                return;
            }

            console.log('Password changed');
            alert('Password updated successfully!');
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
        }

        // Payment Settings
        function showAddPaymentMethod() {
            document.getElementById('add-payment-section').style.display = 'block';
            document.getElementById('add-payment-section').scrollIntoView({ behavior: 'smooth' });
        }

        function hideAddPaymentMethod() {
            document.getElementById('add-payment-section').style.display = 'none';
            document.getElementById('mobile-money-provider').value = '';
            document.getElementById('mobile-money-number').value = '';
            document.getElementById('mobile-money-name').value = '';
            document.getElementById('set-default').checked = false;
        }

        function addPaymentMethod(event) {
            event.preventDefault();
            // Payment methods are handled by Paystack during checkout
            // No need to store payment methods locally
            hideAddPaymentMethod();
        }

        // Notification Settings
        function updateNotification(key, enabled) {
            console.log(`Notification ${key}: ${enabled ? 'enabled' : 'disabled'}`);
            // In real app, this would send to server
        }

        // Help & Support
        function toggleFAQ(item) {
            const isActive = item.classList.contains('active');
            document.querySelectorAll('.faq-item').forEach(faq => faq.classList.remove('active'));
            if (!isActive) {
                item.classList.add('active');
            }
        }

        // Landing Page Functions
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            const menuBtn = document.getElementById('mobile-menu-btn');
            
            mobileMenu.classList.toggle('active');
            
            // Change icon between hamburger and X
            if (mobileMenu.classList.contains('active')) {
                menuBtn.innerHTML = `
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                `;
            } else {
                menuBtn.innerHTML = `
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                `;
            }
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const mobileMenu = document.getElementById('mobile-menu');
            const menuBtn = document.getElementById('mobile-menu-btn');
            
            if (mobileMenu && mobileMenu.classList.contains('active')) {
                if (!mobileMenu.contains(event.target) && !menuBtn.contains(event.target)) {
                    mobileMenu.classList.remove('active');
                    menuBtn.innerHTML = `
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    `;
                }
            }
        });

        function showAuthPage(page) {
            const landingPage = document.getElementById('landing-page');
            const authContainer = document.getElementById('auth-container');
            
            landingPage.classList.add('hidden');
            landingPage.style.display = ''; // Remove inline style to allow CSS class to work
            authContainer.classList.remove('hidden');
            
            if (page === 'register') {
                switchToRegister();
            } else {
                switchToSignIn();
            }
        }

        function showLandingPage() {
            const landingPage = document.getElementById('landing-page');
            const authContainer = document.getElementById('auth-container');
            const agentContainer = document.getElementById('agent-container');
            const agentDashboard = document.getElementById('agent-dashboard');
            const mainContent = document.getElementById('main-content');
            
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            
            if (landingPage) {
                landingPage.classList.remove('hidden');
                landingPage.style.display = 'block';
            }
            if (authContainer) {
                authContainer.classList.add('hidden');
                authContainer.style.display = 'none';
            }
            if (agentContainer) {
                agentContainer.classList.add('hidden');
                agentContainer.style.display = 'none';
            }
            if (agentDashboard) {
                agentDashboard.classList.remove('active');
            }
            if (mainContent) {
                mainContent.classList.remove('authenticated');
                mainContent.style.display = 'none';
            }
        }

        // Authentication Functions
        async function checkAuthStatus() {
            // Check Firebase auth state - try multiple methods
            let currentUser = firebaseAuth.getCurrentUser();
            const isAgentAuthenticated = await sessionDB.get('agent_authenticated') === 'true';
            
            // If currentUser is null, check local session as fallback
            if (!currentUser) {
                const localAuth = await sessionDB.get('homefix_authenticated');
                if (localAuth === 'true') {
                    // User should be authenticated, wait for auth state to be ready
                    try {
                        currentUser = await firebaseAuth.waitForAuthState();
                        console.log('Auth state ready, currentUser:', currentUser ? currentUser.uid : 'null');
                    } catch (error) {
                        console.warn('Error waiting for auth state:', error);
                        // Fall back to getCurrentUser after a short delay
                        await new Promise(resolve => setTimeout(resolve, 300));
                        currentUser = firebaseAuth.getCurrentUser();
                    }
                }
            }
            
            console.log('checkAuthStatus - currentUser:', currentUser ? currentUser.uid : 'null');
            console.log('checkAuthStatus - isAgentAuthenticated:', isAgentAuthenticated);
            
            const landingPage = document.getElementById('landing-page');
            const authContainer = document.getElementById('auth-container');
            const agentContainer = document.getElementById('agent-container');
            const agentDashboard = document.getElementById('agent-dashboard');
            const mainContent = document.getElementById('main-content');
            
            if (isAgentAuthenticated) {
                // Don't interfere with agent dashboard
                console.log('Agent authenticated, skipping user auth check');
                return;
            }
            
            // Check if we have a local session even if currentUser is null (for timing issues)
            const localUser = await sessionDB.get('homefix_user');
            const hasLocalSession = await sessionDB.get('homefix_authenticated') === 'true';
            
            if (currentUser || (hasLocalSession && localUser)) {
                console.log('User is authenticated, updating UI');
                // User is authenticated with Firebase
                const userId = currentUser ? currentUser.uid : localUser.uid;
                
                // Sync user data from Firestore if needed
                if (currentUser) {
                    const userDataResult = await firebaseUsers.getUser(currentUser.uid);
                    if (userDataResult.success) {
                        await sessionDB.set('homefix_authenticated', 'true');
                        await sessionDB.set('homefix_user', {
                            uid: currentUser.uid,
                            name: userDataResult.data.name,
                            email: userDataResult.data.email,
                            phone: userDataResult.data.phone
                        });
                    }
                }
                
                // Show main content, hide everything else
                if (landingPage) {
                    landingPage.classList.add('hidden');
                }
                if (authContainer) authContainer.classList.add('hidden');
                if (agentContainer) agentContainer.classList.add('hidden');
                if (agentDashboard) agentDashboard.classList.remove('active');
                if (mainContent) {
                    mainContent.classList.add('authenticated');
                    mainContent.style.display = 'block'; // Force display
                }
                
                console.log('UI updated for authenticated user');
            } else {
                console.log('No user authenticated, showing landing page');
                // Show landing page by default, hide auth, agent, and main content
                if (landingPage) landingPage.classList.remove('hidden');
                if (authContainer) authContainer.classList.add('hidden');
                if (agentContainer) agentContainer.classList.add('hidden');
                if (agentDashboard) agentDashboard.classList.remove('active');
                if (mainContent) {
                    mainContent.classList.remove('authenticated');
                    mainContent.style.display = 'none'; // Explicitly hide main content
                }
            }
        }

        function switchToRegister() {
            document.getElementById('signin-card').style.display = 'none';
            document.getElementById('register-card').style.display = 'block';
            clearMessages();
        }

        function switchToSignIn() {
            document.getElementById('register-card').style.display = 'none';
            document.getElementById('signin-card').style.display = 'block';
            const passwordResetScreen = document.getElementById('password-reset-screen');
            if (passwordResetScreen) {
                passwordResetScreen.classList.remove('active');
            }
            clearMessages();
        }

        function clearMessages() {
            document.getElementById('signin-error').classList.remove('show');
            document.getElementById('signin-success').classList.remove('show');
            document.getElementById('register-error').classList.remove('show');
            document.getElementById('register-success').classList.remove('show');
            const resetError = document.getElementById('reset-error');
            const resetSuccess = document.getElementById('reset-success');
            if (resetError) resetError.classList.remove('show');
            if (resetSuccess) resetSuccess.classList.remove('show');
        }

        // Password Reset Handler
        async function handlePasswordReset(event) {
            event.preventDefault();
            const resetError = document.getElementById('reset-error');
            const resetSuccess = document.getElementById('reset-success');
            
            if (resetError) resetError.classList.remove('show');
            if (resetSuccess) resetSuccess.classList.remove('show');
            
            const email = document.getElementById('reset-email').value;
            
            if (!email) {
                if (resetError) {
                    resetError.textContent = 'Please enter your email address';
                    resetError.classList.add('show');
                }
                return;
            }
            
            try {
                // In a real implementation, you would call Firebase Auth sendPasswordResetEmail
                // For now, we'll show a success message
                if (resetSuccess) {
                    resetSuccess.textContent = 'Password reset link has been sent to your email address. Please check your inbox.';
                    resetSuccess.classList.add('show');
                }
                
                // Clear the form
                document.getElementById('reset-email').value = '';
                
                // Hide success message after 5 seconds
                setTimeout(() => {
                    if (resetSuccess) resetSuccess.classList.remove('show');
                }, 5000);
            } catch (error) {
                if (resetError) {
                    resetError.textContent = error.message || 'Failed to send reset link. Please try again.';
                    resetError.classList.add('show');
                }
            }
        }

        // Support Form Handler
        async function handleSupportForm(event) {
            event.preventDefault();
            
            const name = document.getElementById('support-name').value;
            const email = document.getElementById('support-email').value;
            const subject = document.getElementById('support-subject').value;
            const message = document.getElementById('support-message').value;
            
            if (!name || !email || !subject || !message) {
                alert('Please fill in all fields');
                return;
            }
            
            // In a real implementation, you would send this to your backend
            alert('Thank you for contacting us! We have received your message and will get back to you within 24 hours.');
            
            // Clear the form
            document.getElementById('support-form').reset();
        }

        // 2FA Functions
        function enable2FA() {
            alert('2FA setup will be implemented with QR code generation. For now, please use an authenticator app and contact support for setup assistance.');
        }

        function generateRecoveryCodes() {
            alert('Recovery codes will be generated when 2FA is enabled. Please enable 2FA first.');
        }

        // Session Management Functions
        function revokeSession(button) {
            if (confirm('Are you sure you want to revoke this session? You will be signed out from this device.')) {
                const sessionItem = button.closest('.session-item');
                if (sessionItem) {
                    sessionItem.style.opacity = '0.5';
                    sessionItem.style.pointerEvents = 'none';
                    button.textContent = 'Revoked';
                    alert('Session revoked successfully');
                }
            }
        }

        function revokeAllSessions() {
            if (confirm('Are you sure you want to sign out from all other devices? You will remain signed in on this device.')) {
                alert('All other sessions have been revoked. You are now signed in only on this device.');
            }
        }

        function showError(elementId, message) {
            const errorEl = document.getElementById(elementId);
            errorEl.textContent = message;
            errorEl.classList.add('show');
            setTimeout(() => {
                errorEl.classList.remove('show');
            }, 5000);
        }

        function showSuccess(elementId, message) {
            const successEl = document.getElementById(elementId);
            successEl.textContent = message;
            successEl.classList.add('show');
            setTimeout(() => {
                successEl.classList.remove('show');
            }, 3000);
        }

        function togglePassword(inputId, button) {
            const input = document.getElementById(inputId);
            const isPassword = input.type === 'password';
            input.type = isPassword ? 'text' : 'password';
            
            // Update icon
            button.innerHTML = isPassword 
                ? `<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
                   </svg>`
                : `<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                   </svg>`;
        }

        async function handleSignIn(event) {
            event.preventDefault();
            clearMessages();
            
            const email = document.getElementById('signin-email').value;
            const password = document.getElementById('signin-password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            
            // Simple validation
            if (!email || !password) {
                showError('signin-error', 'Please fill in all fields');
                return;
            }
            
            // Sign in with Firebase
            const result = await firebaseAuth.signIn(email, password);
            
            if (result.success) {
                // Wait for auth state to be fully ready
                await firebaseAuth.waitForAuthState();
                
                // Get user data from Firestore
                const userDataResult = await firebaseUsers.getUser(result.user.uid);
                
                if (userDataResult.success) {
                    const userData = userDataResult.data;
                    
                    // Store user session locally for quick access
                    await sessionDB.set('homefix_authenticated', 'true');
                    await sessionDB.set('homefix_user', {
                        uid: result.user.uid,
                        name: userData.name,
                        email: userData.email,
                        phone: userData.phone
                    });
                    
                    if (rememberMe) {
                        await sessionDB.set('homefix_remember', 'true');
                    }
                    
                    console.log('User signed in successfully:', result.user.uid);
                    
                    showSuccess('signin-success', 'Sign in successful! Redirecting...');
                    
                    // Immediately update UI - don't wait for checkAuthStatus
                    const authContainer = document.getElementById('auth-container');
                    const landingPage = document.getElementById('landing-page');
                    const mainContent = document.getElementById('main-content');
                    const agentContainer = document.getElementById('agent-container');
                    const agentDashboard = document.getElementById('agent-dashboard');
                    
                    // Hide auth and landing, show main content
                    if (authContainer) {
                        authContainer.classList.add('hidden');
                        console.log(' Auth container hidden');
                    }
                    if (landingPage) {
                        landingPage.classList.add('hidden');
                        console.log(' Landing page hidden');
                    }
                    if (agentContainer) agentContainer.classList.add('hidden');
                    if (agentDashboard) agentDashboard.classList.remove('active');
                    if (mainContent) {
                        mainContent.classList.add('authenticated');
                        mainContent.style.display = 'block'; // Force display
                        console.log(' Main content shown');
                    }
                    
                    // Navigate to home screen immediately
                    console.log('Navigating to home screen...');
                    showScreen('home');
                    
                    // Initialize the app
                    if (typeof init === 'function') {
                        init();
                        console.log(' App initialized');
                    }
                    
                    // Verify auth state in background (but don't block UI)
                    setTimeout(async () => {
                        await checkAuthStatus();
                    }, 500);
                } else {
                    showError('signin-error', 'Error loading user data. Please try again.');
                }
            } else {
                // Handle Firebase auth errors
                let errorMessage = 'Invalid email or password. Please try again.';
                if (result.error.includes('user-not-found')) {
                    errorMessage = 'No account found with this email.';
                } else if (result.error.includes('wrong-password')) {
                    errorMessage = 'Incorrect password.';
                } else if (result.error.includes('too-many-requests')) {
                    errorMessage = 'Too many failed attempts. Please try again later.';
                }
                showError('signin-error', errorMessage);
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            clearMessages();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const phone = document.getElementById('register-phone').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            const termsAccepted = document.getElementById('terms-checkbox').checked;
            
            // Validation
            if (!name || !email || !phone || !password || !confirmPassword) {
                showError('register-error', 'Please fill in all fields');
                return;
            }
            
            if (password.length < 6) {
                showError('register-error', 'Password must be at least 6 characters long');
                return;
            }
            
            if (password !== confirmPassword) {
                showError('register-error', 'Passwords do not match');
                return;
            }
            
            if (!termsAccepted) {
                showError('register-error', 'Please accept the Terms of Service and Privacy Policy');
                return;
            }
            
            // Create account with Firebase
            try {
                const result = await firebaseAuth.signUp(email, password, { name, phone });
                
                if (result.success && result.user) {
                    // User is automatically signed in after registration
                    // Firebase automatically signs in the user after createUserWithEmailAndPassword
                    const user = result.user;
                    
                    console.log('User registered and signed in:', user.uid);
                    console.log('User email:', user.email);
                    
                    // Wait for auth state to be fully ready
                    await firebaseAuth.waitForAuthState();
                    
                    // Get user data from Firestore (it should be there since we just saved it)
                    // Wait a bit for Firestore to be ready
                    await new Promise(resolve => setTimeout(resolve, 500));
                    const userDataResult = await firebaseUsers.getUser(user.uid);
                    
                    // Store user session locally
                    const userData = {
                        uid: user.uid,
                        name: userDataResult.success ? userDataResult.data.name : name,
                        email: userDataResult.success ? userDataResult.data.email : email,
                        phone: userDataResult.success ? userDataResult.data.phone : phone
                    };
                    
                    await sessionDB.set('homefix_authenticated', 'true');
                    await sessionDB.set('homefix_user', userData);
                    
                    console.log('User session stored locally:', userData);
                    
                    showSuccess('register-success', 'Account created successfully! Redirecting...');
                    
                    // Immediately update UI - don't wait for checkAuthStatus
                    const authContainer = document.getElementById('auth-container');
                    const landingPage = document.getElementById('landing-page');
                    const mainContent = document.getElementById('main-content');
                    const agentContainer = document.getElementById('agent-container');
                    const agentDashboard = document.getElementById('agent-dashboard');
                    
                    // Hide auth and landing, show main content
                    if (authContainer) {
                        authContainer.classList.add('hidden');
                        console.log(' Auth container hidden');
                    }
                    if (landingPage) {
                        landingPage.classList.add('hidden');
                        console.log(' Landing page hidden');
                    }
                    if (agentContainer) agentContainer.classList.add('hidden');
                    if (agentDashboard) agentDashboard.classList.remove('active');
                    if (mainContent) {
                        mainContent.classList.add('authenticated');
                        mainContent.style.display = 'block'; // Force display
                        console.log(' Main content shown');
                    }
                    
                    // Navigate to home screen immediately
                    console.log('Navigating to home screen...');
                    showScreen('home');
                    
                    // Initialize the app
                    if (typeof init === 'function') {
                        init();
                        console.log(' App initialized');
                    }
                    
                    // Verify auth state in background (but don't block UI)
                    setTimeout(async () => {
                        const currentUser = firebaseAuth.getCurrentUser();
                        console.log('Background auth check - currentUser:', currentUser ? currentUser.uid : 'null');
                        if (currentUser) {
                            console.log(' Firebase auth state confirmed');
                        } else {
                            console.warn(' Firebase auth.currentUser is null, but user should be signed in');
                            // Force re-check auth status
                            await checkAuthStatus();
                        }
                    }, 2000);
                } else {
                    // Log the actual error for debugging
                    console.error('Firebase registration error:', result.error);
                    
                    // Handle Firebase auth errors with more specific messages
                    let errorMessage = 'Failed to create account. Please try again.';
                    const errorLower = result.error.toLowerCase();
                    
                    if (errorLower.includes('email-already-in-use') || errorLower.includes('already exists')) {
                        errorMessage = 'An account with this email already exists.';
                    } else if (errorLower.includes('weak-password') || errorLower.includes('password')) {
                        errorMessage = 'Password is too weak. Please use a stronger password (at least 6 characters).';
                    } else if (errorLower.includes('invalid-email')) {
                        errorMessage = 'Invalid email address. Please check and try again.';
                    } else if (errorLower.includes('network') || errorLower.includes('fetch')) {
                        errorMessage = 'Network error. Please check your internet connection and try again.';
                    } else if (errorLower.includes('auth/')) {
                        // Show Firebase auth error code
                        errorMessage = `Registration failed: ${result.error}. Please try again.`;
                    } else {
                        // Show the actual error message
                        errorMessage = `Registration failed: ${result.error}`;
                    }
                    
                    showError('register-error', errorMessage);
                }
            } catch (error) {
                console.error('Registration exception:', error);
                showError('register-error', `An unexpected error occurred: ${error.message}. Please try again.`);
            }
        }

        async function handleSocialAuth(provider) {
            clearMessages();
            
            // Determine which page we're on
            const isRegisterPage = document.getElementById('register-card').style.display !== 'none';
            const successId = isRegisterPage ? 'register-success' : 'signin-success';
            const errorId = isRegisterPage ? 'register-error' : 'signin-error';
            
            if (provider === 'google') {
                try {
                    showSuccess(successId, 'Signing in with Google...');
                    
                    const result = await firebaseAuth.signInWithGoogle();
                    
                    if (result.success && result.user) {
                        const user = result.user;
                        
                        // Wait for auth state to be ready
                        await firebaseAuth.waitForAuthState();
                        
                        // Get user data from Firestore
                        await new Promise(resolve => setTimeout(resolve, 500));
                        const userDataResult = await firebaseUsers.getUser(user.uid);
                        
                        // Store user session locally
                        const userData = {
                            uid: user.uid,
                            name: userDataResult.success ? userDataResult.data.name : (user.displayName || user.email.split('@')[0]),
                            email: userDataResult.success ? userDataResult.data.email : user.email,
                            phone: userDataResult.success ? userDataResult.data.phone : '',
                            photoURL: user.photoURL || ''
                        };
                        
                        await sessionDB.set('homefix_authenticated', 'true');
                        await sessionDB.set('homefix_user', userData);
                        
                        console.log('Google sign-in successful, user session stored:', userData);
                        
                        showSuccess(successId, 'Signed in successfully! Redirecting...');
                        
                        // Update UI
                        const authContainer = document.getElementById('auth-container');
                        const mainContent = document.getElementById('main-content');
                        const landingPage = document.getElementById('landing-page');
                        
                        if (authContainer) authContainer.classList.add('hidden');
                        if (landingPage) landingPage.classList.add('hidden');
                        if (mainContent) {
                            mainContent.classList.add('authenticated');
                            mainContent.style.display = 'block';
                        }
                        
                        // Initialize app
                        setTimeout(async () => {
                            await checkAuthStatus();
                            init();
                        }, 1000);
                    } else {
                        showError(errorId, result.error || 'Failed to sign in with Google');
                    }
                } catch (error) {
                    console.error('Google sign-in error:', error);
                    // Handle popup blocked error
                    if (error.code === 'auth/popup-blocked') {
                        showError(errorId, 'Popup was blocked. Please allow popups for this site and try again.');
                    } else if (error.code === 'auth/popup-closed-by-user') {
                        showError(errorId, 'Sign-in was cancelled.');
                    } else {
                        showError(errorId, error.message || 'Failed to sign in with Google');
                    }
                }
            } else if (provider === 'facebook') {
                alert('Facebook sign-in is coming soon!');
            }
        }

        async function logout() {
            // Sign out from Firebase
            await firebaseAuth.signOut();
            
            // Clear local session
            await sessionDB.remove('homefix_authenticated');
            await sessionDB.remove('homefix_user');
            
            // Explicitly hide main content and show landing page
            const mainContent = document.getElementById('main-content');
            const landingPage = document.getElementById('landing-page');
            
            if (mainContent) {
                mainContent.classList.remove('authenticated');
                mainContent.style.display = 'none'; // Explicitly hide
            }
            if (landingPage) {
                landingPage.classList.remove('hidden');
                landingPage.style.display = 'block'; // Ensure it's visible
            }
            
            // Clear forms
            document.getElementById('signin-form').reset();
            document.getElementById('register-form').reset();
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            await checkAuthStatus();
        }

        // Agent Login Functions
        function showAgentLogin() {
            const landingPage = document.getElementById('landing-page');
            const agentContainer = document.getElementById('agent-container');
            
            landingPage.classList.add('hidden');
            landingPage.style.display = ''; // Remove inline style to allow CSS class to work
            agentContainer.classList.remove('hidden');
        }

        async function handleAgentLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('agent-username').value;
            const password = document.getElementById('agent-password').value;
            
            // Check for agent01 credentials
            if (username === 'agent01' && password === 'agentxyz123') {
                await sessionDB.set('agent_authenticated', 'true');
                await sessionDB.set('agent_username', 'agent01');
                showAgentDashboard();
            } 
            // Check for agent02 credentials
            else if (username === 'agent02' && password === 'agentxyz124') {
                await sessionDB.set('agent_authenticated', 'true');
                await sessionDB.set('agent_username', 'agent02');
                showAgentDashboard();
            } 
            else {
                alert('Invalid credentials. Please try again.');
            }
        }

        async function showAgentDashboard() {
            const landingPage = document.getElementById('landing-page');
            const agentContainer = document.getElementById('agent-container');
            const agentDashboard = document.getElementById('agent-dashboard');
            const agentUsername = await sessionDB.get('agent_username') || 'Agent';
            
            if (landingPage) {
                landingPage.classList.add('hidden');
                landingPage.style.display = ''; // Remove inline style to allow CSS class to work
            }
            agentContainer.classList.add('hidden');
            agentDashboard.classList.add('active');
            
            // Update welcome message with agent username
            const welcomeSpan = document.querySelector('.agent-header-actions span');
            if (welcomeSpan) {
                welcomeSpan.textContent = `Welcome, ${agentUsername}`;
            }
            
            loadAgentRequests();
        }

        async function agentLogout() {
            await sessionDB.remove('agent_authenticated');
            await sessionDB.remove('agent_username');
            document.getElementById('agent-container').classList.remove('hidden');
            document.getElementById('agent-dashboard').classList.remove('active');
            showLandingPage();
        }

        async function loadAgentRequests() {
            const refreshButton = document.querySelector('.section-header button');
            const container = document.getElementById('requests-container');
            
            // Show loading state
            if (refreshButton) {
                const originalText = refreshButton.textContent;
                refreshButton.disabled = true;
                refreshButton.textContent = 'Refreshing...';
            }
            
            if (container) {
                container.innerHTML = '<p style="text-align: center; color: var(--neutral-500); padding: var(--spacing-3xl);">Loading requests...</p>';
            }
            
            try {
                // Load requests from Firestore
                const result = await firebaseRequests.getAllRequests();
                let requests = result.success ? result.data : [];
                
                if (!result.success) {
                    console.error('Error loading requests:', result.error);
                    if (container) {
                        container.innerHTML = `<p style="text-align: center; color: var(--error-500); padding: var(--spacing-3xl);">Error loading requests: ${result.error}</p>`;
                    }
                    return;
                }
                
                // Convert Firestore timestamps to dates
                requests.forEach(request => {
                    if (request.createdAt) {
                        const date = convertTimestamp(request.createdAt);
                        request.createdAt = date.toISOString();
                        if (!request.date) {
                            request.date = date.toLocaleDateString();
                        }
                    }
                    // Ensure all client fields are present
                    if (!request.clientName && request.clientEmail) {
                        // Try to get client name from email if missing
                        request.clientName = request.clientEmail.split('@')[0];
                    }
                });
                
                // Only add sample data if no requests exist (first time)
                if (requests.length === 0) {
                    // Sample requests for demo
                    const sampleRequests = [
                        {
                            clientName: 'John Doe',
                            clientEmail: 'john@example.com',
                            clientPhone: '+1234567890',
                            service: 'Plumbing Repair',
                            description: 'Leaky faucet in kitchen needs immediate attention',
                            location: '123 Main St, Accra',
                            date: new Date().toLocaleDateString(),
                            status: 'pending'
                        },
                        {
                            clientName: 'Jane Smith',
                            clientEmail: 'jane@example.com',
                            clientPhone: '+1234567891',
                            service: 'Electrical Installation',
                            description: 'Need new ceiling fan installed in living room',
                            location: '456 Oak Ave, Accra',
                            date: new Date().toLocaleDateString(),
                            status: 'pending'
                        }
                    ];
                    
                    for (const requestData of sampleRequests) {
                        await firebaseRequests.createRequest(requestData);
                    }
                    
                    // Reload requests
                    const reloadResult = await firebaseRequests.getAllRequests();
                    requests = reloadResult.success ? reloadResult.data : [];
                    
                    // Convert timestamps again
                    requests.forEach(request => {
                        if (request.createdAt) {
                            const date = convertTimestamp(request.createdAt);
                            request.createdAt = date.toISOString();
                            if (!request.date) {
                                request.date = date.toLocaleDateString();
                            }
                        }
                    });
                }
                
                // Sort requests by date (newest first)
                requests.sort((a, b) => {
                    const dateA = a.createdAt ? new Date(a.createdAt) : new Date(a.date || 0);
                    const dateB = b.createdAt ? new Date(b.createdAt) : new Date(b.date || 0);
                    return dateB - dateA;
                });
                
                renderRequests(requests);
            } catch (error) {
                console.error('Error in loadAgentRequests:', error);
                if (container) {
                    container.innerHTML = `<p style="text-align: center; color: var(--error-500); padding: var(--spacing-3xl);">Error: ${error.message}</p>`;
                }
            } finally {
                // Restore button state
                if (refreshButton) {
                    refreshButton.disabled = false;
                    refreshButton.textContent = 'Refresh';
                }
            }
        }

        let currentRequestView = 'grid'; // 'grid' or 'list'

        function switchRequestView(view) {
            currentRequestView = view;
            
            // Update button states
            document.getElementById('grid-view-btn').classList.toggle('active', view === 'grid');
            document.getElementById('list-view-btn').classList.toggle('active', view === 'list');
            
            // Reload requests to render in new view
            const container = document.getElementById('requests-container');
            if (container && container.dataset.requests) {
                const requests = JSON.parse(container.dataset.requests);
                renderRequests(requests);
            } else {
                loadAgentRequests();
            }
        }

        function renderRequests(requests) {
            const container = document.getElementById('requests-container');
            
            if (requests.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--neutral-500); padding: var(--spacing-3xl);">No requests available</p>';
                return;
            }
            
            // Store requests data for view switching
            container.dataset.requests = JSON.stringify(requests);
            
            if (currentRequestView === 'list') {
                renderRequestsList(requests);
            } else {
                renderRequestsGrid(requests);
            }
        }

        function renderRequestsGrid(requests) {
            const container = document.getElementById('requests-container');
            
            container.innerHTML = `
                <div class="requests-grid-view">
                    ${requests.map(request => `
                <div class="request-card" data-id="${request.id}" data-request-id="${request.id}">
                    <div class="request-header">
                        <div class="request-info">
                            <h3>${request.service}</h3>
                            <div class="request-meta">
                                <span> ${request.date}</span>
                                <span> ${request.location}</span>
                            </div>
                        </div>
                        <span class="request-status ${request.status}">${request.status.toUpperCase()}</span>
                    </div>
                    <div class="request-details">
                        <div class="request-detail-row">
                            <span class="request-detail-label">Client Name:</span>
                            <span class="request-detail-value">${request.clientName}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Email:</span>
                            <span class="request-detail-value">${request.clientEmail}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Phone:</span>
                            <span class="request-detail-value">${request.clientPhone}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Description:</span>
                            <span class="request-detail-value">${request.description}</span>
                        </div>
                        ${request.preferredTime ? `
                        <div class="request-detail-row">
                            <span class="request-detail-label">Preferred Time:</span>
                            <span class="request-detail-value">${request.preferredTime}</span>
                        </div>
                        ` : ''}
                        ${request.urgency ? `
                        <div class="request-detail-row">
                            <span class="request-detail-label">Urgency:</span>
                            <span class="request-detail-value">${request.urgency.charAt(0).toUpperCase() + request.urgency.slice(1)}</span>
                        </div>
                        ` : ''}
                        ${request.provider ? `
                        <div class="request-detail-row" style="margin-top: var(--spacing-md); padding-top: var(--spacing-md); border-top: 2px solid var(--neutral-200);">
                            <span class="request-detail-label" style="color: var(--primary-500); font-weight: 700;">Assigned Provider:</span>
                            <span class="request-detail-value" style="font-weight: 600;">${request.provider.name}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Provider Email:</span>
                            <span class="request-detail-value">${request.provider.email}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Provider Phone:</span>
                            <span class="request-detail-value">${request.provider.phone}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Specialization:</span>
                            <span class="request-detail-value">${request.provider.specialization}</span>
                        </div>
                        ` : ''}
                        ${request.invoice ? `
                        <div class="request-detail-row" style="margin-top: var(--spacing-md); padding-top: var(--spacing-md); border-top: 2px solid var(--neutral-200);">
                            <span class="request-detail-label" style="color: var(--success-500); font-weight: 700;">Invoice:</span>
                            <span class="request-detail-value" style="font-weight: 600;">${request.invoice.total.toFixed(2)}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Invoice Date:</span>
                            <span class="request-detail-value">${request.invoice.date}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Payment Status:</span>
                            <span class="request-detail-value">
                                ${getPaymentStatusBadge(request.invoice)}
                            </span>
                        </div>
                        ${(request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid') && request.invoice.paidAt ? `
                        <div class="request-detail-row">
                            <span class="request-detail-label">Paid On:</span>
                            <span class="request-detail-value">${new Date(request.invoice.paidAt).toLocaleDateString()}</span>
                        </div>
                        ` : ''}
                        ` : ''}
                    </div>
                    <div class="request-actions">
                        ${request.status === 'pending' ? `
                            <button class="btn btn-primary" onclick="showAssignProviderForm('${request.id}')">Assign Provider</button>
                            <button class="btn btn-ghost" onclick="showInvoiceForm('${request.id}')">Create Invoice</button>
                        ` : ''}
                        ${request.status === 'assigned' ? `
                            <button class="btn btn-ghost" onclick="showInvoiceForm('${request.id}')">Create Invoice</button>
                        ` : ''}
                        ${request.status === 'completed' && request.invoice ? `
                            <button class="btn btn-primary" onclick="viewInvoice('${request.id}')">View Invoice</button>
                            <button class="btn btn-ghost" onclick="resendInvoice('${request.id}')">Resend Invoice</button>
                        ` : ''}
                    </div>
                    <div class="assign-provider-form" id="assign-form-${request.id}">
                        <h4 style="margin-bottom: var(--spacing-lg); font-size: 18px; font-weight: 600;">Assign Provider</h4>
                        <form onsubmit="assignProvider(event, '${request.id}')">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Provider Name</label>
                                    <input type="text" class="form-input" id="provider-name-${request.id}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Provider Email</label>
                                    <input type="email" class="form-input" id="provider-email-${request.id}" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Provider Phone</label>
                                    <input type="tel" class="form-input" id="provider-phone-${request.id}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Provider Specialization</label>
                                    <input type="text" class="form-input" id="provider-specialization-${request.id}" required>
                                </div>
                            </div>
                            <div class="request-actions">
                                <button type="submit" class="btn btn-primary">Assign Provider</button>
                                <button type="button" class="btn btn-ghost" onclick="hideAssignProviderForm(${request.id})">Cancel</button>
                            </div>
                        </form>
                    </div>
                    <div class="invoice-section" id="invoice-form-${request.id}">
                        <div style="background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%); padding: var(--spacing-lg); border-radius: var(--radius-lg); margin-bottom: var(--spacing-lg); color: white;">
                            <h4 style="margin: 0 0 var(--spacing-sm) 0; font-size: 20px; font-weight: 700;"> Create Invoice</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-sm); margin-top: var(--spacing-sm); font-size: 14px;">
                                <div><strong>Client:</strong> ${request.clientName || 'N/A'}</div>
                                <div><strong>Email:</strong> ${request.clientEmail || 'N/A'}</div>
                                <div><strong>Service:</strong> ${request.service || 'N/A'}</div>
                            </div>
                        </div>
                        <form id="invoice-form-submit-${request.id}">
                            <div style="background: var(--white); border: 1px solid var(--neutral-200); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                                    <label class="form-label" style="font-weight: 700; font-size: 16px; margin: 0;">Invoice Items</label>
                                    <button type="button" class="btn btn-ghost" onclick="addInvoiceItem('${request.id}')" style="padding: var(--spacing-xs) var(--spacing-sm); font-size: 14px;">
                                        + Add Item
                                    </button>
                                </div>
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background: var(--neutral-50); border-bottom: 2px solid var(--neutral-200);">
                                                <th style="padding: var(--spacing-sm); text-align: left; font-weight: 600; font-size: 14px; color: var(--neutral-700);">Description</th>
                                                <th style="padding: var(--spacing-sm); text-align: center; font-weight: 600; font-size: 14px; color: var(--neutral-700); width: 100px;">Quantity</th>
                                                <th style="padding: var(--spacing-sm); text-align: right; font-weight: 600; font-size: 14px; color: var(--neutral-700); width: 120px;">Unit Price ()</th>
                                                <th style="padding: var(--spacing-sm); text-align: right; font-weight: 600; font-size: 14px; color: var(--neutral-700); width: 120px;">Subtotal</th>
                                                <th style="padding: var(--spacing-sm); text-align: center; font-weight: 600; font-size: 14px; color: var(--neutral-700); width: 60px;">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="invoice-items-${request.id}">
                                            <tr>
                                                <td style="padding: var(--spacing-sm);"><input type="text" class="form-input invoice-desc" placeholder="Item description" required style="width: 100%; border: 1px solid var(--neutral-300);" oninput="updateInvoiceRowTotal(this, '${request.id}')"></td>
                                                <td style="padding: var(--spacing-sm);"><input type="number" class="form-input invoice-qty" placeholder="Qty (optional)" min="0" value="1" style="width: 100%; border: 1px solid var(--neutral-300); text-align: center;" oninput="updateInvoiceRowTotal(this, '${request.id}')" onchange="updateInvoiceRowTotal(this, '${request.id}')"></td>
                                                <td style="padding: var(--spacing-sm);"><input type="number" class="form-input invoice-price" placeholder="0.00" min="0" step="0.01" value="0" required style="width: 100%; border: 1px solid var(--neutral-300); text-align: right;" oninput="updateInvoiceRowTotal(this, '${request.id}')" onchange="updateInvoiceRowTotal(this, '${request.id}')"></td>
                                                <td class="item-subtotal" style="padding: var(--spacing-sm); text-align: right; color: var(--neutral-600); font-weight: 600;">0.00</td>
                                                <td style="padding: var(--spacing-sm); text-align: center;"><button type="button" class="btn btn-ghost" onclick="removeInvoiceItem(this)" style="padding: var(--spacing-xs); min-width: auto; color: var(--error-500);"></button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div style="background: var(--neutral-50); border: 2px solid var(--primary-200); padding: var(--spacing-lg); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 20px; font-weight: 700; color: var(--neutral-700);">Total Amount:</span>
                                    <span id="invoice-total-${request.id}" style="color: var(--primary-600); font-size: 32px; font-weight: 800;">0.00</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: var(--spacing-md);">
                                <button type="button" class="btn btn-primary" onclick="calculateInvoiceTotal('${request.id}')" style="flex: 1; padding: var(--spacing-md); font-size: 16px; font-weight: 600;">
                                     Calculate Total
                                </button>
                                <button type="button" class="btn btn-ghost" onclick="hideInvoiceForm('${request.id}')" style="flex: 0.5;">
                                    Cancel
                                </button>
                            </div>
                            <div style="margin-top: var(--spacing-md);">
                                <button type="button" class="btn btn-primary send-invoice-btn" data-request-id="${request.id}" style="width: 100%; padding: var(--spacing-md); font-size: 16px; font-weight: 600; background: var(--success-600);">
                                     Send Invoice to Client
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                    `).join('')}
                </div>
            `;
            
            // Attach event listeners to send invoice buttons using event delegation
            container.addEventListener('click', function(e) {
                if (e.target.classList.contains('send-invoice-btn')) {
                    const requestId = e.target.getAttribute('data-request-id');
                    if (requestId) {
                        handleCreateInvoice(requestId);
                    }
                }
            });
            
            // Initialize totals for all visible invoice forms
            requests.forEach(request => {
                const invoiceForm = document.getElementById(`invoice-form-${request.id}`);
                if (invoiceForm && invoiceForm.classList.contains('active')) {
                    setTimeout(() => {
                        updateInvoiceTotal(request.id);
                    }, 100);
                }
            });
        }

        function showAssignProviderForm(requestId) {
            // Handle both string and number requestId
            const id = String(requestId);
            const form = document.getElementById(`assign-form-${id}`);
            if (!form) {
                console.error('Assign form not found:', id);
                alert('Form not found. Please refresh the page and try again.');
                return;
            }
            form.classList.add('active');
        }

        function hideAssignProviderForm(requestId) {
            const id = String(requestId);
            const form = document.getElementById(`assign-form-${id}`);
            if (form) {
                form.classList.remove('active');
            }
        }

        function renderRequestsList(requests) {
            const container = document.getElementById('requests-container');
            
            container.innerHTML = `
                <div class="requests-list-view active">
                    <div class="requests-table">
                        <div class="requests-table-header">
                            <div>Service</div>
                            <div>Client</div>
                            <div>Status</div>
                            <div>Date</div>
                            <div>Amount</div>
                            <div>Payment</div>
                        </div>
                        ${requests.map(request => {
                            return `
                            <div class="requests-table-row" onclick="expandRequestDetails('${request.id}')">
                                <div class="table-cell table-cell-service">${request.service}</div>
                                <div class="table-cell table-cell-client">${request.clientName || request.clientEmail}</div>
                                <div class="table-cell table-cell-status">
                                    <span class="request-status ${request.status}">${request.status.toUpperCase()}</span>
                                </div>
                                <div class="table-cell">${request.date || 'N/A'}</div>
                                <div class="table-cell">
                                    ${request.invoice ? `${request.invoice.total.toFixed(2)}` : '-'}
                                </div>
                                <div class="table-cell table-cell-payment">
                                    ${getPaymentStatusBadge(request.invoice)}
                                </div>
                            </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function getPaymentStatusBadge(invoice) {
            if (!invoice) {
                return '<span class="payment-badge no-invoice">No Invoice</span>';
            }
            
            const isPaid = invoice.status === 'paid' || invoice.paymentStatus === 'paid';
            
            if (isPaid) {
                return '<span class="payment-badge paid"> Paid</span>';
            } else {
                return '<span class="payment-badge pending"> Pending</span>';
            }
        }

        function expandRequestDetails(requestId) {
            // Switch to grid view and highlight the request
            switchRequestView('grid');
            setTimeout(() => {
                const requestCard = document.querySelector(`[data-request-id="${requestId}"]`);
                if (requestCard) {
                    requestCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    // Highlight the card briefly
                    requestCard.style.boxShadow = '0 0 0 3px rgba(165, 59, 43, 0.3)';
                    requestCard.style.transition = 'box-shadow 0.3s';
                    setTimeout(() => {
                        requestCard.style.boxShadow = '';
                    }, 2000);
                }
            }, 100);
        }

        async function assignProvider(event, requestId) {
            event.preventDefault();
            
            // Handle both string and number requestId
            const id = String(requestId);
            
            // Get form elements
            const providerNameEl = document.getElementById(`provider-name-${id}`);
            const providerEmailEl = document.getElementById(`provider-email-${id}`);
            const providerPhoneEl = document.getElementById(`provider-phone-${id}`);
            const providerSpecializationEl = document.getElementById(`provider-specialization-${id}`);
            
            if (!providerNameEl || !providerEmailEl || !providerPhoneEl || !providerSpecializationEl) {
                alert('Error: Form fields not found. Please refresh the page and try again.');
                console.error('Missing form fields for requestId:', id);
                return;
            }
            
            const providerName = providerNameEl.value.trim();
            const providerEmail = providerEmailEl.value.trim();
            const providerPhone = providerPhoneEl.value.trim();
            const providerSpecialization = providerSpecializationEl.value.trim();
            
            // Validation
            if (!providerName || !providerEmail || !providerPhone || !providerSpecialization) {
                alert('Please fill in all provider details.');
                return;
            }
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(providerEmail)) {
                alert('Please enter a valid email address for the provider.');
                return;
            }
            
            try {
                // Get request from Firestore (use original requestId - could be string or number)
                const firestoreId = typeof requestId === 'string' ? requestId : String(requestId);
                const result = await firebaseRequests.getRequest(firestoreId);
                
                if (!result.success || !result.data) {
                    alert('Error: Request not found. Please refresh the page and try again.');
                    console.error('Request not found:', firestoreId);
                    return;
                }
                
                const request = result.data;
                const providerData = {
                    name: providerName,
                    email: providerEmail,
                    phone: providerPhone,
                    specialization: providerSpecialization,
                    assignedAt: new Date().toISOString()
                };
                
                // Update request in Firestore
                const updateResult = await firebaseRequests.updateRequest(firestoreId, {
                    status: 'assigned',
                    provider: providerData
                });
                
                if (updateResult.success) {
                    // Create notification for the client
                    if (request.clientUid) {
                        await firebaseNotifications.createNotification(request.clientUid, {
                            type: 'provider_assigned',
                            title: 'Provider Assigned',
                            message: `A provider has been assigned to your ${request.service} request. Provider: ${providerName}`,
                            requestId: firestoreId,
                            actionUrl: '#tasks'
                        });
                    }
                    
                    // Hide the form
                    hideAssignProviderForm(id);
                    
                    // Clear form fields
                    providerNameEl.value = '';
                    providerEmailEl.value = '';
                    providerPhoneEl.value = '';
                    providerSpecializationEl.value = '';
                    
                    // Reload requests to show updated status
                    await loadAgentRequests();
                    
                    alert(` Provider assigned successfully!\n\nProvider: ${providerName}\nEmail: ${providerEmail}\nPhone: ${providerPhone}\nSpecialization: ${providerSpecialization}\n\nThe client has been notified.`);
                } else {
                    alert('Failed to assign provider. Please try again.');
                    console.error('Update error:', updateResult.error);
                }
            } catch (error) {
                console.error('Error assigning provider:', error);
                alert('An error occurred while assigning the provider. Please try again.');
            }
        }

        function showInvoiceForm(requestId) {
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            const invoiceForm = document.getElementById(`invoice-form-${id}`);
            if (!invoiceForm) {
                console.error('Invoice form not found:', id);
                alert('Invoice form not found. Please refresh the page and try again.');
                return;
            }
            invoiceForm.classList.add('active');
            
            // Reset invoice form if it was previously filled
            const tbody = document.getElementById(`invoice-items-${id}`);
            if (!tbody) {
                console.error('Invoice items table body not found:', id);
                return;
            }
            
            tbody.innerHTML = `
                <tr>
                    <td style="padding: var(--spacing-sm);"><input type="text" class="form-input invoice-desc" placeholder="Item description" required style="width: 100%; border: 1px solid var(--neutral-300);" oninput="updateInvoiceRowTotal(this, '${id}')"></td>
                    <td style="padding: var(--spacing-sm);"><input type="number" class="form-input invoice-qty" placeholder="Qty (optional)" min="0" value="1" style="width: 100%; border: 1px solid var(--neutral-300); text-align: center;" oninput="updateInvoiceRowTotal(this, '${id}')" onchange="updateInvoiceRowTotal(this, '${id}')"></td>
                    <td style="padding: var(--spacing-sm);"><input type="number" class="form-input invoice-price" placeholder="0.00" min="0" step="0.01" value="0" required style="width: 100%; border: 1px solid var(--neutral-300); text-align: right;" oninput="updateInvoiceRowTotal(this, '${id}')" onchange="updateInvoiceRowTotal(this, '${id}')"></td>
                    <td class="item-subtotal" style="padding: var(--spacing-sm); text-align: right; color: var(--neutral-600); font-weight: 600;">0.00</td>
                    <td style="padding: var(--spacing-sm); text-align: center;"><button type="button" class="btn btn-ghost" onclick="removeInvoiceItem(this)" style="padding: var(--spacing-xs); min-width: auto; color: var(--error-500);"></button></td>
                </tr>
            `;
            
            // Reset total display
            const totalElement = document.getElementById(`invoice-total-${id}`);
            if (totalElement) {
                totalElement.textContent = '0.00';
                totalElement.style.color = 'var(--primary-600)';
                totalElement.style.fontWeight = '700';
            }
            
            // Update total after a short delay to ensure DOM is ready
            setTimeout(() => {
                updateInvoiceTotal(id);
            }, 100);
        }
        
        async function viewInvoice(requestId) {
            const result = await firebaseRequests.getRequest(requestId);
            const request = result.success ? result.data : null;
            
            if (request && request.invoice) {
                const invoice = request.invoice;
                let message = ` INVOICE DETAILS\n`;
                message += `${'='.repeat(50)}\n\n`;
                message += `Invoice ID: ${invoice.id}\n`;
                message += `Service: ${request.service}\n`;
                message += `Client: ${request.clientName}\n`;
                message += `Email: ${request.clientEmail}\n`;
                message += `Date: ${invoice.date} ${invoice.time || ''}\n`;
                message += `\n${'-'.repeat(50)}\n`;
                message += `ITEMS:\n`;
                message += `${'-'.repeat(50)}\n\n`;
                
                invoice.items.forEach((item, index) => {
                    message += `${index + 1}. ${item.description}\n`;
                    message += `   Quantity: ${item.quantity}\n`;
                    message += `   Unit Price: ${item.price.toFixed(2)}\n`;
                    message += `   Subtotal: ${item.total.toFixed(2)}\n\n`;
                });
                
                message += `${'-'.repeat(50)}\n`;
                message += `TOTAL: ${invoice.total.toFixed(2)}\n`;
                message += `${'='.repeat(50)}\n`;
                message += `Status: ${invoice.status.toUpperCase()}\n`;
                
                alert(message);
            }
        }
        
        async function resendInvoice(requestId) {
            const result = await firebaseRequests.getRequest(requestId);
            const request = result.success ? result.data : null;
            
            if (request && request.invoice) {
                const invoice = request.invoice;
                const invoiceMessage = createInvoiceMessage(request, invoice);
                
                const confirmMessage = ` Invoice resent successfully to ${request.clientEmail}\n\n` +
                    `Invoice ID: ${invoice.id}\n` +
                    `Total Amount: ${invoice.total.toFixed(2)}\n\n` +
                    `The client has been notified via email.`;
                
                alert(confirmMessage);
            }
        }

        function hideInvoiceForm(requestId) {
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            const form = document.getElementById(`invoice-form-${id}`);
            if (form) {
                form.classList.remove('active');
            }
        }

        function addInvoiceItem(requestId) {
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            const tbody = document.getElementById(`invoice-items-${id}`);
            if (!tbody) {
                console.error('Invoice items table body not found:', id);
                return;
            }
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td style="padding: var(--spacing-sm);"><input type="text" class="form-input invoice-desc" placeholder="Item description" required style="width: 100%; border: 1px solid var(--neutral-300);" oninput="updateInvoiceRowTotal(this, '${id}')"></td>
                <td style="padding: var(--spacing-sm);"><input type="number" class="form-input invoice-qty" placeholder="Qty (optional)" min="0" value="1" style="width: 100%; border: 1px solid var(--neutral-300); text-align: center;" oninput="updateInvoiceRowTotal(this, '${id}')" onchange="updateInvoiceRowTotal(this, '${id}')"></td>
                <td style="padding: var(--spacing-sm);"><input type="number" class="form-input invoice-price" placeholder="0.00" min="0" step="0.01" value="0" required style="width: 100%; border: 1px solid var(--neutral-300); text-align: right;" oninput="updateInvoiceRowTotal(this, '${id}')" onchange="updateInvoiceRowTotal(this, '${id}')"></td>
                <td class="item-subtotal" style="padding: var(--spacing-sm); text-align: right; color: var(--neutral-600); font-weight: 600;">0.00</td>
                <td style="padding: var(--spacing-sm); text-align: center;"><button type="button" class="btn btn-ghost" onclick="removeInvoiceItem(this)" style="padding: var(--spacing-xs); min-width: auto; color: var(--error-500);"></button></td>
            `;
            tbody.appendChild(row);
            
            // Update total after adding item
            setTimeout(() => {
                updateInvoiceTotal(id);
            }, 50);
        }

        function removeInvoiceItem(button) {
            const row = button.closest('tr');
            if (!row) return;
            
            const tbody = row.parentElement;
            const allRows = tbody.querySelectorAll('tr');
            
            // Don't allow removing the last item
            if (allRows.length <= 1) {
                alert('Invoice must have at least one item.');
                return;
            }
            
            row.remove();
            const requestId = button.closest('.invoice-section').id.replace('invoice-form-', '');
            updateInvoiceTotal(requestId);
        }

        // Update individual row subtotal and total
        function updateInvoiceRowTotal(inputElement, requestId) {
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            const row = inputElement.closest('tr');
            if (!row) return;
            
            const quantityInput = row.querySelector('.invoice-qty');
            const priceInput = row.querySelector('.invoice-price');
            const subtotalCell = row.querySelector('.item-subtotal');
            
            if (!priceInput || !subtotalCell) return;
            
            // Get values - quantity is optional (for service fees)
            const quantity = quantityInput ? (parseFloat(quantityInput.value) || 0) : 1;
            const price = parseFloat(priceInput.value) || 0;
            
            // If quantity is 0 or empty, treat as service fee (quantity = 1)
            const effectiveQuantity = quantity > 0 ? quantity : 1;
            const subtotal = effectiveQuantity * price;
            
            // Update subtotal cell
            subtotalCell.textContent = `${subtotal.toFixed(2)}`;
            
            // Update total
            updateInvoiceTotal(id);
        }
        
        function updateInvoiceTotal(requestId) {
            try {
                // Handle both string and number requestId
                const id = typeof requestId === 'string' ? requestId : String(requestId);
                const tbody = document.getElementById(`invoice-items-${id}`);
                if (!tbody) {
                    console.warn('Invoice items table body not found for updateInvoiceTotal:', id);
                    return;
                }
                
                const rows = tbody.querySelectorAll('tr');
                let total = 0;
                
                rows.forEach(row => {
                    const quantityInput = row.querySelector('.invoice-qty');
                    const priceInput = row.querySelector('.invoice-price');
                    const subtotalCell = row.querySelector('.item-subtotal');
                    
                    if (priceInput) {
                        const quantity = quantityInput ? (parseFloat(quantityInput.value) || 0) : 1;
                        const price = parseFloat(priceInput.value) || 0;
                        
                        // If quantity is 0 or empty, treat as service fee (quantity = 1)
                        const effectiveQuantity = quantity > 0 ? quantity : 1;
                        const subtotal = effectiveQuantity * price;
                        total += subtotal;
                        
                        // Update subtotal cell if not already updated
                        if (subtotalCell && !subtotalCell.textContent.includes('')) {
                            subtotalCell.textContent = `${subtotal.toFixed(2)}`;
                        }
                    }
                });
                
                const totalElement = document.getElementById(`invoice-total-${id}`);
                if (totalElement) {
                    totalElement.textContent = `${total.toFixed(2)}`;
                    // Add visual feedback for non-zero totals
                    if (total > 0) {
                        totalElement.style.color = 'var(--success-600)';
                    } else {
                        totalElement.style.color = 'var(--primary-600)';
                    }
                }
            } catch (error) {
                console.error('Error updating invoice total:', error);
            }
        }
        
        // Calculate and display invoice total with validation
        function calculateInvoiceTotal(requestId) {
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            const tbody = document.getElementById(`invoice-items-${id}`);
            
            if (!tbody) {
                alert('Error: Invoice form not found. Please refresh the page.');
                return;
            }
            
            const rows = tbody.querySelectorAll('tr');
            
            if (rows.length === 0) {
                alert('Please add at least one invoice item before calculating the total.');
                return;
            }
            
            let total = 0;
            let hasErrors = false;
            let errorMessages = [];
            
            rows.forEach((row, index) => {
                const descriptionInput = row.querySelector('.invoice-desc');
                const quantityInput = row.querySelector('.invoice-qty');
                const priceInput = row.querySelector('.invoice-price');
                const subtotalCell = row.querySelector('.item-subtotal');
                
                if (!descriptionInput || !priceInput) {
                    return;
                }
                
                const description = descriptionInput.value.trim();
                const quantityStr = quantityInput ? quantityInput.value.trim() : '';
                const priceStr = priceInput.value.trim();
                
                // Check for required fields (description and price are required)
                if (!description || !priceStr) {
                    hasErrors = true;
                    errorMessages.push(`Row ${index + 1}: Please fill in description and price.`);
                    return;
                }
                
                const quantity = quantityStr ? parseFloat(quantityStr) : 1; // Default to 1 if empty (service fee)
                const price = parseFloat(priceStr);
                
                // Validate price (must be greater than 0)
                if (isNaN(price) || price <= 0) {
                    hasErrors = true;
                    errorMessages.push(`Row ${index + 1}: Please enter a valid price (must be greater than 0).`);
                    return;
                }
                
                // Quantity is optional - if 0 or empty, treat as service fee (quantity = 1)
                const effectiveQuantity = quantity > 0 ? quantity : 1;
                const subtotal = effectiveQuantity * price;
                total += subtotal;
                
                // Update subtotal cell
                if (subtotalCell) {
                    subtotalCell.textContent = `${subtotal.toFixed(2)}`;
                }
            });
            
            // Update the total display
            updateInvoiceTotal(id);
            
            // Show feedback
            if (hasErrors) {
                alert(' Please fix the following errors:\n\n' + errorMessages.join('\n') + '\n\nCurrent calculated total: ' + total.toFixed(2));
            } else {
                // Highlight the total with animation
                const totalElement = document.getElementById(`invoice-total-${id}`);
                if (totalElement) {
                    totalElement.style.transition = 'all 0.3s ease';
                    totalElement.style.transform = 'scale(1.1)';
                    totalElement.style.color = 'var(--success-600)';
                    totalElement.style.fontWeight = '800';
                    
                    setTimeout(() => {
                        totalElement.style.transform = 'scale(1)';
                    }, 300);
                }
                
                alert(` Total calculated successfully!\n\nTotal Amount: ${total.toFixed(2)}\n\nYou can now review and send the invoice.`);
            }
        }

        // Wrapper function for button click
        async function handleCreateInvoice(requestId) {
            console.log('handleCreateInvoice called with requestId:', requestId);
            
            // Disable button to prevent double submission
            const button = document.querySelector(`[data-request-id="${requestId}"].send-invoice-btn`);
            if (button) {
                button.disabled = true;
                button.textContent = 'Sending...';
            }
            
            try {
                await createInvoice(null, requestId);
            } catch (error) {
                console.error('Error in createInvoice:', error);
                alert('An error occurred while creating the invoice. Please try again.');
                // Re-enable button on error
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
            }
        }
        
        async function createInvoice(event, requestId) {
            // Prevent default if event exists (form submission)
            if (event && event.preventDefault) {
                event.preventDefault();
            }
            
            // Keep requestId as string for consistency with DOM IDs
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            
            console.log('createInvoice called with requestId:', id, 'type:', typeof id);
            
            const items = [];
            const tbody = document.getElementById(`invoice-items-${id}`);
            
            if (!tbody) {
                console.error('Invoice items table body not found:', `invoice-items-${id}`);
                alert('Error: Invoice form not found. Please refresh the page and try again.');
                // Re-enable button on error
                const button = document.querySelector(`[data-request-id="${id}"].send-invoice-btn`);
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
                return;
            }
            
            const rows = tbody.querySelectorAll('tr');
            console.log('Found invoice items:', rows.length);
            
            if (rows.length === 0) {
                alert('Please add at least one invoice item.');
                // Re-enable button on error
                const button = document.querySelector(`[data-request-id="${id}"].send-invoice-btn`);
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
                return;
            }
            
            rows.forEach((row, index) => {
                try {
                    const descriptionInput = row.querySelector('.invoice-desc');
                    const quantityInput = row.querySelector('.invoice-qty');
                    const priceInput = row.querySelector('.invoice-price');
                    
                    if (!descriptionInput || !priceInput) {
                        console.warn('Missing required input fields in row', index);
                        return;
                    }
                    
                    const description = descriptionInput.value.trim();
                    const quantityStr = quantityInput ? quantityInput.value.trim() : '';
                    const priceStr = priceInput.value.trim();
                    
                    // Check if required fields are empty (description and price are required)
                    if (!description || !priceStr) {
                        console.warn('Empty required fields in row', index, { description, priceStr });
                        return; // Skip items with empty required fields
                    }
                    
                    const price = parseFloat(priceStr);
                    
                    // Check if price is valid and greater than 0
                    if (isNaN(price) || price <= 0) {
                        console.warn('Invalid price in row', index, { price });
                        return; // Skip invalid items
                    }
                    
                    // Quantity is optional - if empty or 0, treat as service fee (quantity = 1)
                    const quantity = quantityStr ? parseFloat(quantityStr) : 1;
                    const effectiveQuantity = quantity > 0 ? quantity : 1;
                    
                    console.log(`Item ${index}:`, { description, quantity: effectiveQuantity, price });
                    
                    items.push({ 
                        description, 
                        quantity: effectiveQuantity, 
                        price, 
                        total: effectiveQuantity * price 
                    });
                } catch (error) {
                    console.error('Error processing item', index, ':', error);
                }
            });
            
            if (items.length === 0) {
                alert('Please fill in all invoice item fields correctly. All items must have a description and price. Quantity is optional (leave empty for service fees).');
                // Re-enable button on error
                const button = document.querySelector(`[data-request-id="${id}"].send-invoice-btn`);
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
                return;
            }
            
            const total = items.reduce((sum, item) => sum + item.total, 0);
            
            if (total <= 0) {
                alert('Invoice total must be greater than zero. Please check your item prices and quantities.');
                // Re-enable button on error
                const button = document.querySelector(`[data-request-id="${id}"].send-invoice-btn`);
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
                return;
            }
            
            // Get request from Firestore (use original requestId for Firestore)
            const firestoreId = typeof requestId === 'string' && !isNaN(requestId) ? requestId : id;
            const result = await firebaseRequests.getRequest(firestoreId);
            
            if (!result.success || !result.data) {
                alert('Error: Request not found. Please refresh the page and try again.');
                // Re-enable button on error
                const button = document.querySelector(`[data-request-id="${id}"].send-invoice-btn`);
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
                return;
            }
            
            const request = result.data;
            const invoiceData = {
                id: `INV-${Date.now()}`,
                requestId: firestoreId,
                items: items,
                total: total,
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString(),
                status: 'sent',
                sentAt: new Date().toISOString()
            };
            
            // Update request in Firestore
            await firebaseRequests.updateRequest(firestoreId, {
                invoice: invoiceData,
                status: 'completed'
            });
            
            // Create formatted invoice message
            let invoiceMessage = '';
            try {
                invoiceMessage = createInvoiceMessage(request, invoiceData);
            } catch (error) {
                console.error('Error creating invoice message:', error);
                invoiceMessage = `Service: ${request.service}\nTotal: ${total.toFixed(2)}`;
            }
            
            // Show success message with invoice details
            const confirmMessage = ` Invoice sent successfully to ${request.clientEmail}\n\n` +
                `Invoice ID: ${invoiceData.id}\n` +
                `Total Amount: ${total.toFixed(2)}\n\n` +
                `Invoice Details:\n${invoiceMessage}\n\n` +
                `The client has been notified via email.`;
            
            alert(confirmMessage);
            
            try {
                // Re-enable button after success
                const button = document.querySelector(`[data-request-id="${id}"].send-invoice-btn`);
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
                
                loadAgentRequests();
                hideInvoiceForm(id);
            } catch (error) {
                console.error('Error refreshing requests:', error);
                // Still show success even if refresh fails
            }
        }
        
        function createInvoiceMessage(request, invoice) {
            let message = `Service: ${request.service}\n`;
            message += `Client: ${request.clientName}\n`;
            message += `Date: ${invoice.date}\n`;
            message += `\nItems:\n`;
            message += `${'-'.repeat(50)}\n`;
            
            invoice.items.forEach((item, index) => {
                message += `${index + 1}. ${item.description}\n`;
                message += `   Quantity: ${item.quantity} x ${item.price.toFixed(2)} = ${item.total.toFixed(2)}\n`;
            });
            
            message += `${'-'.repeat(50)}\n`;
            message += `Total: ${invoice.total.toFixed(2)}\n`;
            
            return message;
        }

        // Check agent authentication on load
        async function checkAgentAuth() {
            const isAgentAuthenticated = await sessionDB.get('agent_authenticated') === 'true';
            const agentContainer = document.getElementById('agent-container');
            const agentDashboard = document.getElementById('agent-dashboard');
            
            if (isAgentAuthenticated) {
                // Update welcome message before showing dashboard
                const agentUsername = await sessionDB.get('agent_username') || 'Agent';
                const welcomeSpan = document.getElementById('agent-welcome');
                if (welcomeSpan) {
                    welcomeSpan.textContent = `Welcome, ${agentUsername}`;
                }
                showAgentDashboard();
            } else {
                // Make sure agent container and dashboard are hidden if not authenticated
                agentContainer.classList.add('hidden');
                agentDashboard.classList.remove('active');
            }
        }

        // CTA Slideshow functionality
        // Animated Counter for Statistics
        function initStatsCounter() {
            const statsSection = document.getElementById('stats-section');
            if (!statsSection) return;

            const statNumbers = statsSection.querySelectorAll('.stat-number[data-target]');
            let hasAnimated = false;

            // Intersection Observer to trigger animation when section is visible
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !hasAnimated) {
                        hasAnimated = true;
                        statNumbers.forEach(stat => {
                            animateCounter(stat);
                        });
                    }
                });
            }, {
                threshold: 0.3 // Trigger when 30% of section is visible
            });

            observer.observe(statsSection);
        }

        function animateCounter(element) {
            const target = parseFloat(element.getAttribute('data-target'));
            const suffix = element.getAttribute('data-suffix') || '';
            const prefix = element.getAttribute('data-prefix') || '';
            const hasDecimal = element.hasAttribute('data-decimal');
            const duration = 2000; // 2 seconds
            const startTime = performance.now();
            const startValue = 0;

            function updateCounter(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function for smooth animation
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                
                let currentValue = startValue + (target - startValue) * easeOutQuart;
                
                // Format the number based on type
                let displayValue;
                if (hasDecimal) {
                    // For decimal numbers like 4.8
                    displayValue = currentValue.toFixed(1);
                } else {
                    // For whole numbers, convert to K format if >= 1000
                    if (currentValue >= 1000) {
                        displayValue = (currentValue / 1000).toFixed(0);
                    } else {
                        displayValue = Math.floor(currentValue).toString();
                    }
                }
                
                element.textContent = prefix + displayValue + suffix;
                
                if (progress < 1) {
                    requestAnimationFrame(updateCounter);
                } else {
                    // Ensure final value is exact
                    if (hasDecimal) {
                        element.textContent = prefix + target.toFixed(1) + suffix;
                    } else {
                        if (target >= 1000) {
                            element.textContent = prefix + (target / 1000).toFixed(0) + suffix;
                        } else {
                            element.textContent = prefix + target + suffix;
                        }
                    }
                }
            }
            
            requestAnimationFrame(updateCounter);
        }

        function initCTASlideshow() {
            const slides = document.querySelectorAll('.cta-slide');
            let currentSlide = 0;
            
            function showNextSlide() {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }
            
            // Change slide every 4 seconds
            setInterval(showNextSlide, 4000);
        }

        function initStatsSlideshow() {
            const slides = document.querySelectorAll('.stats-slide');
            if (slides.length === 0) return;
            
            let currentSlide = 0;
            
            function showNextSlide() {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }
            
            // Change slide every 4 seconds
            setInterval(showNextSlide, 4000);
        }

        // Initialize function
        async function initializePage() {
            // Initialize stats counter animation
            initStatsCounter();
            
            // Initialize slideshows
            initStatsSlideshow();
            initCTASlideshow();
            
            // Ensure database is initialized first
            if (!idb) {
                try {
                    await initializeDatabase();
                } catch (error) {
                    console.error('Failed to initialize database:', error);
                }
            }
            
            // Set up Firebase auth state listener
            firebaseAuth.onAuthStateChanged(async (user) => {
                // Initialize notifications and chat when user logs in
                if (user) {
                    initNotifications();
                } else {
                    // Clean up listeners when user logs out
                    if (notificationListener) {
                        notificationListener();
                        notificationListener = null;
                    }
                    if (globalChatListener) {
                        globalChatListener();
                        globalChatListener = null;
                    }
                    if (chatMessageListener) {
                        chatMessageListener();
                        chatMessageListener = null;
                    }
                    currentChatId = null;
                    unreadMessageCount = 0;
                    lastMessageTimestamp = null;
                    
                    // Hide floating chat button
                    const floatingButton = document.getElementById('floating-chat-button');
                    if (floatingButton) floatingButton.style.display = 'none';
                }
                console.log('Auth state changed:', user ? user.uid : 'signed out');
                if (user) {
                    // User is signed in
                    const userDataResult = await firebaseUsers.getUser(user.uid);
                    if (userDataResult.success) {
                        await sessionDB.set('homefix_authenticated', 'true');
                        await sessionDB.set('homefix_user', {
                            uid: user.uid,
                            name: userDataResult.data.name,
                            email: userDataResult.data.email,
                            phone: userDataResult.data.phone
                        });
                        console.log('Auth state listener: User data synced');
                    }
                    // Only update UI if main content is not already authenticated
                    const mainContent = document.getElementById('main-content');
                    if (mainContent && !mainContent.classList.contains('authenticated')) {
                        console.log('Auth state listener: Updating UI');
                        await checkAuthStatus();
                    } else {
                        console.log('Auth state listener: UI already authenticated, skipping update');
                    }
                } else {
                    // User is signed out - only update if not already on landing page
                    const landingPage = document.getElementById('landing-page');
                    const mainContent = document.getElementById('main-content');
                    if (landingPage && landingPage.classList.contains('hidden')) {
                        console.log('Auth state listener: User signed out, updating UI');
                        await sessionDB.remove('homefix_authenticated');
                        await sessionDB.remove('homefix_user');
                        // Explicitly hide main content
                        if (mainContent) {
                            mainContent.classList.remove('authenticated');
                            mainContent.style.display = 'none';
                        }
                        await checkAuthStatus();
                    }
                }
            });
            
            // Check agent auth first, then regular auth
            // This ensures proper priority: agent > regular user > landing page
            const isAgentAuthenticated = await sessionDB.get('agent_authenticated') === 'true';
            const currentUser = firebaseAuth.getCurrentUser();
            
            // Get all containers
            const landingPage = document.getElementById('landing-page');
            const authContainer = document.getElementById('auth-container');
            const agentContainer = document.getElementById('agent-container');
            const agentDashboard = document.getElementById('agent-dashboard');
            const mainContent = document.getElementById('main-content');
            
            // Ensure proper initial state
            if (isAgentAuthenticated) {
                await checkAgentAuth();
            } else if (currentUser) {
                await checkAuthStatus();
                await checkAgentAuth(); // Still call to ensure agent containers are hidden
            } else {
                // Not authenticated - show landing page, hide everything else
                if (landingPage) {
                    landingPage.classList.remove('hidden');
                    landingPage.style.display = 'block'; // Force display
                }
                if (authContainer) authContainer.classList.add('hidden');
                if (agentContainer) agentContainer.classList.add('hidden');
                if (agentDashboard) agentDashboard.classList.remove('active');
                if (mainContent) {
                    mainContent.classList.remove('authenticated');
                    mainContent.style.display = 'none'; // Explicitly hide main content
                }
            }
            
            // Only call init if user is authenticated (to avoid errors)
            if (currentUser && !isAgentAuthenticated) {
                init();
            }
            initCTASlideshow();
        }
        
        // Run immediately if DOM is ready, otherwise wait for DOMContentLoaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePage);
        } else {
            // DOM is already loaded
            initializePage();
        }
    </script>
    </div> <!-- End of main-content -->

    <!-- Agent Login Container -->
    <div class="agent-container hidden" id="agent-container">
        <div class="agent-login-card">
            <div style="margin-bottom: var(--spacing-md);">
                <a href="#" class="auth-link" onclick="showLandingPage(); return false;" style="display: inline-flex; align-items: center; gap: var(--spacing-xs);">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Home
                </a>
            </div>
            <div class="auth-header">
                <div class="auth-logo" style="display: flex; align-items: center; gap: var(--spacing-sm); justify-content: center;">
                    <video class="logo-video" autoplay loop muted playsinline preload="auto" style="height: 36px; width: auto;" aria-hidden="true">
                        <source src="images/vidanimation.mp4" type="video/mp4">
                    </video>
                    <span>HomeFix</span>
                </div>
                <h1 class="auth-title">Agent Login</h1>
                <p class="auth-subtitle">Access your agent dashboard</p>
            </div>
            <form class="auth-form" onsubmit="handleAgentLogin(event)">
                <div class="form-group">
                    <label class="form-label" for="agent-username">Username</label>
                    <input 
                        type="text" 
                        id="agent-username" 
                        class="form-input" 
                        placeholder="Enter your username"
                        required
                    >
                </div>
                <div class="form-group">
                    <label class="form-label" for="agent-password">Password</label>
                    <div class="password-wrapper">
                        <input 
                            type="password" 
                            id="agent-password" 
                            class="form-input" 
                            placeholder="Enter your password"
                            required
                        >
                        <button 
                            type="button" 
                            class="password-toggle" 
                            onclick="togglePassword('agent-password', this)"
                        >
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Login
                </button>
            </form>
        </div>
    </div>

    <!-- Agent Dashboard -->
    <div class="agent-dashboard" id="agent-dashboard">
        <div class="agent-header">
            <div class="agent-header-content">
                <div class="agent-header-title">Agent Dashboard</div>
                <div class="agent-header-actions">
                    <span id="agent-welcome" style="color: var(--neutral-600);">Welcome, Agent</span>
                    <button class="btn btn-ghost" onclick="agentLogout()">Logout</button>
                </div>
            </div>
        </div>
        <div class="agent-content">
            <div class="agent-tabs">
                <button class="agent-tab active" onclick="switchAgentTab('requests')">Requests</button>
                <button class="agent-tab" onclick="switchAgentTab('chats')">Live Chats</button>
            </div>

            <div class="agent-tab-content active" id="agent-requests-tab">
                <div class="requests-section">
                    <div class="section-header">
                        <h2 class="section-title">Incoming Requests</h2>
                        <div class="section-header-actions">
                            <div class="view-toggle">
                                <button class="view-toggle-btn active" id="grid-view-btn" onclick="switchRequestView('grid')" title="Grid View">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                                    </svg>
                                </button>
                                <button class="view-toggle-btn" id="list-view-btn" onclick="switchRequestView('list')" title="List View">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                    </svg>
                                </button>
                            </div>
                            <button class="btn btn-primary" onclick="loadAgentRequests()">Refresh</button>
                        </div>
                    </div>
                    <div id="requests-container">
                        <!-- Requests will be loaded here -->
                    </div>
                </div>
            </div>

            <div class="agent-tab-content" id="agent-chats-tab">
                <div class="chats-section">
                    <div class="section-header">
                        <h2 class="section-title">Incoming Chats</h2>
                        <button class="btn btn-primary" onclick="loadAgentChats()">Refresh</button>
                    </div>
                    <div class="chats-list" id="agent-chats-list">
                        <!-- Chats will be loaded here -->
                    </div>
                    <div class="chat-view" id="agent-chat-view" style="display: none;">
                        <div class="chat-view-header">
                            <button class="btn btn-ghost" onclick="closeAgentChatView()"> Back</button>
                            <div class="chat-view-user-info">
                                <div class="chat-view-user-name" id="chat-view-user-name">User</div>
                                <div class="chat-view-user-email" id="chat-view-user-email">user@example.com</div>
                            </div>
                        </div>
                        <div class="chat-view-messages" id="agent-chat-messages">
                            <!-- Messages will be loaded here -->
                        </div>
                        <div class="chat-view-input">
                            <input type="text" class="chat-input" id="agent-chat-input" placeholder="Type your message..." onkeypress="handleAgentChatKeyPress(event)">
                            <button class="chat-send-btn" onclick="sendAgentMessage()">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cookie Consent Banner -->
    <div id="cookie-consent-banner" class="cookie-consent-banner" style="display: none;">
        <div class="cookie-consent-content">
            <div class="cookie-consent-icon"></div>
            <div class="cookie-consent-text">
                <h3 class="cookie-consent-title">We Value Your Privacy</h3>
                <p class="cookie-consent-description">
                    We use cookies to enhance your browsing experience, analyze site traffic, and personalize content. 
                    By clicking "Accept All", you consent to our use of cookies. 
                    <a href="#" onclick="showCookieSettings(); return false;" class="cookie-link">Learn more</a>
                </p>
            </div>
            <div class="cookie-consent-actions">
                <button class="btn btn-ghost cookie-btn" onclick="acceptCookies('essential')">Essential Only</button>
                <button class="btn btn-primary cookie-btn" onclick="acceptCookies('all')">Accept All</button>
            </div>
        </div>
    </div>

    <script>
        // Cookie Consent Management
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = `expires=${date.toUTCString()}`;
            document.cookie = `${name}=${value};${expires};path=/;SameSite=Lax`;
        }

        function checkCookieConsent() {
            const consent = getCookie('cookie_consent');
            if (!consent) {
                // Show banner after a short delay for better UX
                setTimeout(() => {
                    const banner = document.getElementById('cookie-consent-banner');
                    if (banner) {
                        banner.style.display = 'flex';
                        banner.classList.add('cookie-consent-show');
                    }
                }, 1000);
            }
        }

        function acceptCookies(type) {
            const banner = document.getElementById('cookie-consent-banner');
            
            if (type === 'all') {
                setCookie('cookie_consent', 'all', 365);
                setCookie('analytics_cookies', 'enabled', 365);
                setCookie('marketing_cookies', 'enabled', 365);
            } else {
                setCookie('cookie_consent', 'essential', 365);
                setCookie('analytics_cookies', 'disabled', 365);
                setCookie('marketing_cookies', 'disabled', 365);
            }
            
            // Animate out
            if (banner) {
                banner.classList.remove('cookie-consent-show');
                banner.classList.add('cookie-consent-hide');
                setTimeout(() => {
                    banner.style.display = 'none';
                }, 300);
            }
        }

        function showCookieSettings() {
            alert('Cookie Settings:\n\n' +
                  'Essential Cookies: Required for the website to function properly.\n' +
                  'Analytics Cookies: Help us understand how visitors interact with our website.\n' +
                  'Marketing Cookies: Used to deliver personalized advertisements.\n\n' +
                  'You can change your preferences at any time by clearing your browser cookies.');
        }

        // Check cookie consent on page load
        window.addEventListener('load', checkCookieConsent);

        // Ensure logo videos autoplay and loop seamlessly
        function initializeLogoVideos() {
            const logoVideos = document.querySelectorAll('.logo-video');
            logoVideos.forEach(video => {
                // Ensure all required attributes
                video.muted = true;
                video.playsInline = true;
                video.loop = true;
                video.autoplay = true;
                video.setAttribute('muted', '');
                video.setAttribute('playsinline', '');
                video.setAttribute('loop', '');
                video.setAttribute('autoplay', '');
                
                // Remove any controls
                video.controls = false;
                video.removeAttribute('controls');
                
                // Try to play
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        // Auto-play was prevented, but video will play on first user interaction
                        console.log('Video autoplay prevented, will play on interaction');
                    });
                }

                // Ensure seamless looping
                video.addEventListener('ended', () => {
                    video.currentTime = 0;
                    video.play().catch(() => {});
                });

                // Prevent context menu on right-click
                video.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                });
            });
        }

        // Initialize videos when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeLogoVideos);
        } else {
            initializeLogoVideos();
        }
        window.addEventListener('load', initializeLogoVideos);
    </script>
</body>
</html>


