<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HomeFix - Professional Home Services</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Design System Colors */
            --primary-50: #FEF2F2;
            --primary-100: #FEE2E2;
            --primary-200: #FECACA;
            --primary-500: #A53B2B;
            --primary-600: #DC2626;
            --primary-700: #B91C1C;
            
            --neutral-50: #FAFAFA;
            --neutral-100: #F5F5F5;
            --neutral-200: #E5E5E5;
            --neutral-300: #D4D4D4;
            --neutral-400: #A3A3A3;
            --neutral-500: #737373;
            --neutral-700: #404040;
            --neutral-800: #262626;
            --neutral-900: #171717;
            
            --success-500: #22C55E;
            --white: #FFFFFF;
            
            /* Spacing */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-2xl: 48px;
            --spacing-3xl: 64px;
            
            /* Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 8px rgba(0, 0, 0, 0.15);
            --shadow-xl: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--white);
            color: var(--neutral-900);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        * {
            -webkit-tap-highlight-color: transparent;
        }

        /* Top Navigation Bar - Fiverr Style */
        .top-nav {
            background: var(--white);
            border-bottom: 1px solid var(--neutral-200);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            cursor: pointer;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-500);
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .logo img {
            height: 40px;
            width: auto;
        }

        .location-badge {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs) var(--spacing-sm);
            background: var(--neutral-50);
            border-radius: var(--radius-full);
            font-size: 12px;
            color: var(--neutral-700);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            background: var(--success-500);
            border-radius: 50%;
        }

        .nav-search {
            flex: 1;
            max-width: 600px;
            margin: 0 var(--spacing-xl);
            position: relative;
        }

        .search-wrapper {
            display: flex;
            align-items: center;
            background: var(--neutral-50);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: 0 var(--spacing-md);
            transition: all 0.2s;
        }

        .search-wrapper:focus-within {
            border-color: var(--primary-500);
            background: var(--white);
            box-shadow: 0 0 0 3px rgba(165, 59, 43, 0.1);
        }

        .search-input {
            flex: 1;
            padding: var(--spacing-md) 0;
            border: none;
            background: transparent;
            font-size: 15px;
            color: var(--neutral-900);
            outline: none;
        }

        .search-input::placeholder {
            color: var(--neutral-400);
        }

        .search-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: var(--spacing-sm);
            color: var(--neutral-500);
            display: flex;
            align-items: center;
        }

        .search-btn:hover {
            color: var(--primary-500);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .nav-link {
            color: var(--neutral-700);
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }

        .nav-link:hover {
            color: var(--primary-500);
            background: var(--primary-50);
        }

        .premium-badge {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: var(--white);
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .user-menu {
            position: relative;
        }

        .user-avatar,
        .profile-avatar,
        .task-avatar,
        .task-provider-avatar,
        .avatar-preview {
            object-fit: cover;
            border-radius: 50%;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--neutral-200);
            transition: border-color 0.2s;
        }

        .user-avatar:hover {
            border-color: var(--primary-500);
        }

        /* Hero Section - Fiverr Style */
        .hero-section {
            background: linear-gradient(135deg, rgba(165, 59, 43, 0.1) 0%, rgba(255, 255, 255, 0.9) 100%), url('images/bird-s-eye-view-shanghai.png');
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
            padding: var(--spacing-3xl) var(--spacing-lg);
            text-align: center;
            position: relative;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);
            opacity: 0.7;
            z-index: 0;
        }

        .hero-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .hero-title {
            font-size: 48px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
            line-height: 1.2;
        }

        .hero-subtitle {
            font-size: 24px;
            color: var(--neutral-700);
            margin-bottom: var(--spacing-2xl);
            font-weight: 400;
        }

        .hero-search {
            max-width: 700px;
            margin: 0 auto;
            position: relative;
        }

        .hero-search-wrapper {
            display: flex;
            background: var(--white);
            border: 2px solid var(--primary-500);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-xl);
        }

        .hero-search-input {
            flex: 1;
            padding: var(--spacing-lg) var(--spacing-xl);
            border: none;
            font-size: 18px;
            outline: none;
        }

        .hero-search-btn {
            background: var(--primary-500);
            color: var(--white);
            border: none;
            padding: 0 var(--spacing-2xl);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .hero-search-btn:hover {
            background: var(--primary-600);
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-3xl) var(--spacing-lg);
        }

        /* Screen Container */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* Premium Banner */
        .premium-banner {
            background-image: url('images/exclusive.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: var(--white);
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            margin-bottom: var(--spacing-3xl);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .premium-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(165, 59, 43, 0.75) 0%, rgba(220, 38, 38, 0.75) 100%);
            z-index: 0;
        }

        .premium-banner .banner-content,
        .premium-banner .banner-image {
            position: relative;
            z-index: 1;
        }

        .banner-content {
            flex: 1;
        }

        .banner-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }

        .banner-subtitle {
            font-size: 18px;
            opacity: 0.95;
            margin-bottom: var(--spacing-md);
        }

        .coupon-container {
            background: rgba(255, 255, 255, 0.2);
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-full);
            display: inline-block;
            margin-top: var(--spacing-sm);
        }

        .coupon-text {
            font-size: 16px;
            font-weight: 600;
        }

        .banner-image {
            width: 150px;
            height: 150px;
            opacity: 0.9;
        }

        /* Categories Section - Fiverr Style */
        .categories-section {
            margin-bottom: var(--spacing-3xl);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-2xl);
        }

        .section-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--neutral-900);
        }

        .section-subtitle {
            font-size: 18px;
            color: var(--neutral-500);
            margin-top: var(--spacing-xs);
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-xl);
        }

        .category-card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .category-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-500);
        }

        .category-icon-wrapper {
            width: 64px;
            height: 64px;
            background: var(--primary-50);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
        }

        .category-icon {
            width: 36px;
            height: 36px;
            color: var(--primary-500);
        }

        .category-icon-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: var(--radius-lg);
        }

        .category-label {
            font-size: 20px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .category-description {
            font-size: 14px;
            color: var(--neutral-500);
            line-height: 1.5;
        }

        /* Tasks Screen */
        .tasks-header {
            margin-bottom: var(--spacing-2xl);
        }

        .tasks-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
        }

        .tabs-row {
            display: flex;
            gap: var(--spacing-lg);
            border-bottom: 2px solid var(--neutral-200);
            margin-bottom: var(--spacing-2xl);
        }

        .tab {
            padding: var(--spacing-md) var(--spacing-lg);
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
            color: var(--neutral-500);
            position: relative;
            transition: color 0.2s;
        }

        .tab:hover {
            color: var(--neutral-900);
        }

        .tab.active {
            color: var(--primary-500);
            font-weight: 600;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-500);
        }

        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: var(--spacing-xl);
        }

        .task-card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all 0.3s;
        }

        .task-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .task-card-header {
            background: var(--primary-50);
            padding: var(--spacing-md);
            text-align: center;
        }

        .task-card-header-text {
            color: var(--primary-500);
            font-weight: 600;
            font-size: 14px;
        }

        .task-card-body {
            padding: var(--spacing-xl);
        }

        .task-card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--neutral-900);
        }

        .task-card-row {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
            font-size: 15px;
            color: var(--neutral-700);
        }

        .task-assignee {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--neutral-200);
        }

        .task-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
        }

        .assignee-name {
            font-weight: 500;
            color: var(--neutral-900);
        }

        .task-card-footer {
            padding: var(--spacing-md) var(--spacing-xl);
            border-top: 1px solid var(--neutral-200);
            display: flex;
            justify-content: flex-end;
        }

        .btn-text {
            background: none;
            border: none;
            color: var(--primary-500);
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }

        .btn-text:hover {
            background: var(--primary-50);
        }

        /* Profile Screen */
        .profile-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .profile-header {
            margin-bottom: var(--spacing-2xl);
        }

        .profile-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
        }

        .profile-card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .profile-info-card {
            display: flex;
            align-items: center;
            gap: var(--spacing-xl);
            padding-bottom: var(--spacing-xl);
            border-bottom: 1px solid var(--neutral-200);
            margin-bottom: var(--spacing-xl);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            color: var(--neutral-900);
        }

        .profile-email {
            font-size: 16px;
            color: var(--neutral-500);
        }

        .menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            cursor: pointer;
            transition: background 0.2s;
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-sm);
        }

        .menu-item:hover {
            background: var(--neutral-50);
        }

        .menu-item-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .menu-item-icon {
            width: 24px;
            height: 24px;
            color: var(--neutral-500);
        }

        .menu-item-title {
            font-size: 16px;
            color: var(--neutral-900);
            font-weight: 500;
        }

        .menu-item-arrow {
            width: 20px;
            height: 20px;
            color: var(--neutral-400);
        }

        .logout-btn {
            width: 100%;
            color: var(--primary-500);
            background: var(--primary-50);
            border: 1px solid var(--primary-200);
            padding: var(--spacing-md) var(--spacing-lg);
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            border-radius: var(--radius-md);
            margin-top: var(--spacing-lg);
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: var(--primary-100);
        }

        /* Buttons */
        .btn {
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: var(--radius-lg);
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 44px; /* Touch-friendly */
            touch-action: manipulation;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .btn {
                min-height: 48px; /* Larger touch target on mobile */
                padding: var(--spacing-md) var(--spacing-lg);
            }
        }

        .btn-primary {
            background: var(--primary-500);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-600);
        }

        .btn-ghost {
            background: transparent;
            color: var(--primary-500);
            border: 1px solid var(--primary-500);
        }

        .btn-ghost:hover {
            background: var(--primary-50);
        }

        /* Profile Notification */
        .profile-notification {
            background: var(--white);
            border: 1px solid var(--primary-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-2xl);
            position: relative;
            display: none;
        }

        .profile-notification.show {
            display: block;
        }

        .notification-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-xl);
        }

        .notification-text {
            flex: 1;
        }

        .notification-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-500);
            margin-bottom: var(--spacing-xs);
        }

        .notification-desc {
            font-size: 15px;
            color: var(--neutral-500);
        }

        .notification-actions {
            display: flex;
            gap: var(--spacing-md);
        }

        .close-button {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            padding: var(--spacing-xs);
            cursor: pointer;
            color: var(--neutral-500);
            background: none;
            border: none;
            font-size: 20px;
            line-height: 1;
        }

        .close-button:hover {
            color: var(--neutral-900);
        }

        /* Service Detail Page */
        .service-detail-header {
            background: linear-gradient(135deg, rgba(165, 59, 43, 0.1) 0%, rgba(255, 255, 255, 0.9) 100%);
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
            padding: var(--spacing-3xl) var(--spacing-lg);
            margin-bottom: var(--spacing-3xl);
            position: relative;
        }

        .service-detail-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);
            opacity: 0.7;
            z-index: 0;
        }

        .service-detail-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--neutral-700);
            text-decoration: none;
            font-size: 15px;
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }

        .back-button:hover {
            background: var(--neutral-50);
            color: var(--primary-500);
        }

        .service-header-content {
            display: flex;
            align-items: center;
            gap: var(--spacing-2xl);
        }

        .service-icon-large {
            width: 120px;
            height: 120px;
            background: var(--white);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .service-icon-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .service-icon-large svg {
            width: 64px;
            height: 64px;
        }

        .service-header-text h1 {
            font-size: 42px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .service-header-text p {
            font-size: 18px;
            color: var(--neutral-500);
            margin-bottom: var(--spacing-xl);
        }

        .service-features {
            display: flex;
            gap: var(--spacing-xl);
            flex-wrap: wrap;
        }

        .service-feature {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--neutral-700);
            font-size: 15px;
        }

        .service-feature svg {
            width: 20px;
            height: 20px;
            color: var(--primary-500);
        }

        .service-detail-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--spacing-3xl);
            margin-bottom: var(--spacing-3xl);
        }

        .service-info-card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
        }

        .service-info-section {
            margin-bottom: var(--spacing-2xl);
        }

        .service-info-section:last-child {
            margin-bottom: 0;
        }

        .service-info-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-lg);
        }

        .service-info-text {
            font-size: 16px;
            color: var(--neutral-700);
            line-height: 1.8;
        }

        .service-info-list {
            list-style: none;
            padding: 0;
        }

        .service-info-list li {
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--neutral-200);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            font-size: 15px;
            color: var(--neutral-700);
        }

        .service-info-list li:last-child {
            border-bottom: none;
        }

        .service-info-list li svg {
            width: 20px;
            height: 20px;
            color: var(--primary-500);
            flex-shrink: 0;
        }

        .service-cta-card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
            position: sticky;
            top: 90px;
            height: fit-content;
        }

        .service-cta-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-lg);
        }

        .service-cta-price {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary-500);
            margin-bottom: var(--spacing-sm);
        }

        .service-cta-note {
            font-size: 14px;
            color: var(--neutral-500);
            margin-bottom: var(--spacing-xl);
        }

        .service-cta-btn {
            width: 100%;
            padding: var(--spacing-lg);
            font-size: 16px;
            margin-bottom: var(--spacing-md);
        }

        /* Survey Page */
        .survey-container {
            max-width: 800px;
            margin: 0 auto;
            padding: var(--spacing-3xl) var(--spacing-lg);
        }

        .survey-header {
            text-align: center;
            margin-bottom: var(--spacing-3xl);
        }

        .survey-title {
            font-size: 36px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .survey-subtitle {
            font-size: 18px;
            color: var(--neutral-500);
        }

        .survey-form {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
        }

        .form-group {
            margin-bottom: var(--spacing-2xl);
        }

        .form-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
        }

        .form-label .required {
            color: var(--primary-500);
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-md);
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
            background: var(--white);
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(165, 59, 43, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-radio-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .form-radio {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
        }

        .form-radio:hover {
            border-color: var(--primary-500);
            background: var(--primary-50);
        }

        .form-radio input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .form-radio input[type="radio"]:checked + label {
            color: var(--primary-500);
            font-weight: 600;
        }

        .form-checkbox-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .form-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .form-actions {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-3xl);
            padding-top: var(--spacing-2xl);
            border-top: 1px solid var(--neutral-200);
        }

        .form-actions .btn {
            flex: 1;
        }

        /* Task Detail Page */
        .task-detail-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: var(--spacing-3xl) var(--spacing-lg);
        }

        .task-detail-header {
            margin-bottom: var(--spacing-2xl);
        }

        .task-detail-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
        }

        .task-status-badge {
            display: inline-block;
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: var(--spacing-lg);
        }

        .task-status-badge.pending {
            background: var(--primary-50);
            color: var(--primary-500);
        }

        .task-status-badge.completed {
            background: var(--success-500);
            color: var(--white);
        }

        .task-detail-card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
            margin-bottom: var(--spacing-xl);
        }

        .task-detail-section {
            margin-bottom: var(--spacing-2xl);
        }

        .task-detail-section:last-child {
            margin-bottom: 0;
        }

        .task-detail-section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .task-detail-section-title svg {
            width: 20px;
            height: 20px;
            color: var(--primary-500);
        }

        .task-detail-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
        }

        .task-detail-info-item {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .task-detail-info-label {
            font-size: 13px;
            color: var(--neutral-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .task-detail-info-value {
            font-size: 16px;
            color: var(--neutral-900);
            font-weight: 500;
        }

        .task-provider-card {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            padding: var(--spacing-lg);
            background: var(--neutral-50);
            border-radius: var(--radius-md);
        }

        .task-provider-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
        }

        .task-provider-info {
            flex: 1;
        }

        .task-provider-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .task-provider-role {
            font-size: 14px;
            color: var(--neutral-500);
        }

        .task-description {
            font-size: 15px;
            color: var(--neutral-700);
            line-height: 1.8;
            white-space: pre-wrap;
        }

        /* Invoice Page */
        .invoice-container {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--spacing-3xl) var(--spacing-lg);
        }

        .invoice-header {
            text-align: center;
            margin-bottom: var(--spacing-3xl);
        }

        .invoice-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .invoice-card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-3xl);
            margin-bottom: var(--spacing-xl);
        }

        .invoice-header-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-3xl);
            padding-bottom: var(--spacing-2xl);
            border-bottom: 2px solid var(--neutral-200);
        }

        .invoice-company-info h2 {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-500);
            margin-bottom: var(--spacing-sm);
        }

        .invoice-company-info p {
            font-size: 14px;
            color: var(--neutral-500);
            line-height: 1.6;
        }

        .invoice-details {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            text-align: right;
        }

        .invoice-details-label {
            font-size: 13px;
            color: var(--neutral-500);
            text-transform: uppercase;
        }

        .invoice-details-value {
            font-size: 16px;
            color: var(--neutral-900);
            font-weight: 500;
        }

        .invoice-items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-2xl);
        }

        .invoice-items-table th {
            text-align: left;
            padding: var(--spacing-md);
            border-bottom: 2px solid var(--neutral-200);
            font-size: 14px;
            font-weight: 600;
            color: var(--neutral-700);
            text-transform: uppercase;
        }

        .invoice-items-table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--neutral-200);
            font-size: 15px;
            color: var(--neutral-700);
        }

        .invoice-items-table tr:last-child td {
            border-bottom: none;
        }

        .invoice-total-section {
            display: flex;
            justify-content: flex-end;
            margin-top: var(--spacing-xl);
        }

        .invoice-total-table {
            width: 300px;
        }

        .invoice-total-row {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            font-size: 15px;
        }

        .invoice-total-row.total {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-500);
            padding-top: var(--spacing-md);
            border-top: 2px solid var(--neutral-200);
            margin-top: var(--spacing-sm);
        }

        .invoice-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            margin-top: var(--spacing-2xl);
        }

        /* Confirmation Page */
        .confirmation-container {
            max-width: 600px;
            margin: 0 auto;
            padding: var(--spacing-3xl) var(--spacing-lg);
            text-align: center;
        }

        .confirmation-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto var(--spacing-2xl);
            background: var(--success-500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
        }

        .confirmation-icon svg {
            width: 64px;
            height: 64px;
        }

        .confirmation-title {
            font-size: 36px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-md);
        }

        .confirmation-message {
            font-size: 18px;
            color: var(--neutral-500);
            margin-bottom: var(--spacing-3xl);
            line-height: 1.8;
        }

        .confirmation-details {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
            margin-bottom: var(--spacing-2xl);
            text-align: left;
        }

        .confirmation-details-item {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--neutral-200);
        }

        .confirmation-details-item:last-child {
            border-bottom: none;
        }

        .confirmation-details-label {
            font-size: 15px;
            color: var(--neutral-500);
        }

        .confirmation-details-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--neutral-900);
        }

        .confirmation-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
        }

        /* Settings Pages */
        .settings-container {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--spacing-3xl) var(--spacing-lg);
        }

        .settings-header {
            margin-bottom: var(--spacing-2xl);
        }

        .settings-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .settings-subtitle {
            font-size: 16px;
            color: var(--neutral-500);
        }

        .settings-card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
            margin-bottom: var(--spacing-xl);
        }

        .settings-section {
            margin-bottom: var(--spacing-2xl);
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--neutral-200);
        }

        .avatar-upload {
            display: flex;
            align-items: center;
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-2xl);
        }

        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid var(--neutral-200);
            object-fit: cover;
        }

        .avatar-upload-actions {
            flex: 1;
        }

        .avatar-upload-btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            margin-right: var(--spacing-md);
        }

        .avatar-upload-note {
            font-size: 13px;
            color: var(--neutral-500);
            margin-top: var(--spacing-sm);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        .form-group-settings {
            margin-bottom: var(--spacing-xl);
        }

        .form-label-settings {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .form-label-settings .required {
            color: var(--primary-500);
        }

        .form-hint {
            font-size: 13px;
            color: var(--neutral-500);
            margin-top: var(--spacing-xs);
        }

        .settings-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: flex-end;
            padding-top: var(--spacing-xl);
            border-top: 1px solid var(--neutral-200);
            margin-top: var(--spacing-xl);
        }

        /* Payment Methods */
        .payment-methods-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }

        .payment-method-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }

        .payment-method-card:hover {
            border-color: var(--primary-500);
            box-shadow: var(--shadow-sm);
        }

        .payment-method-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .payment-method-icon {
            width: 48px;
            height: 48px;
            background: var(--neutral-50);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-500);
        }

        .payment-method-details {
            flex: 1;
        }

        .payment-method-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .payment-method-number {
            font-size: 14px;
            color: var(--neutral-500);
        }

        .payment-method-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .payment-method-badge {
            padding: var(--spacing-xs) var(--spacing-sm);
            background: var(--success-500);
            color: var(--white);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
        }

        /* Notification Settings */
        .notification-group {
            margin-bottom: var(--spacing-xl);
        }

        .notification-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--neutral-200);
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item-info {
            flex: 1;
        }

        .notification-item-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .notification-item-desc {
            font-size: 14px;
            color: var(--neutral-500);
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--neutral-300);
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: var(--white);
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: var(--primary-500);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* Help & Support */
        .help-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
        }

        .help-category-card {
            background: var(--neutral-50);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            cursor: pointer;
            transition: all 0.2s;
        }

        .help-category-card:hover {
            border-color: var(--primary-500);
            box-shadow: var(--shadow-md);
        }

        .help-category-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-500);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            margin-bottom: var(--spacing-md);
        }

        .help-category-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .help-category-desc {
            font-size: 14px;
            color: var(--neutral-500);
        }

        .faq-section {
            margin-top: var(--spacing-3xl);
        }

        .faq-item {
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            overflow: hidden;
        }

        .faq-question {
            padding: var(--spacing-lg);
            background: var(--white);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .faq-question:hover {
            background: var(--neutral-50);
        }

        .faq-question-text {
            font-size: 16px;
            font-weight: 500;
            color: var(--neutral-900);
        }

        .faq-answer {
            padding: 0 var(--spacing-lg) var(--spacing-lg);
            font-size: 15px;
            color: var(--neutral-700);
            line-height: 1.6;
            display: none;
        }

        .faq-item.active .faq-answer {
            display: block;
        }

        .contact-support {
            background: var(--primary-50);
            border: 1px solid var(--primary-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
            text-align: center;
            margin-top: var(--spacing-2xl);
        }

        .contact-support-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-500);
            margin-bottom: var(--spacing-sm);
        }

        .contact-support-desc {
            font-size: 15px;
            color: var(--neutral-700);
            margin-bottom: var(--spacing-lg);
        }

        /* Security Settings */
        .security-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
        }

        .security-item-info {
            flex: 1;
        }

        .security-item-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .security-item-desc {
            font-size: 14px;
            color: var(--neutral-500);
        }

        .security-status {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            margin-left: var(--spacing-md);
        }

        .security-status.active {
            background: var(--success-500);
            color: var(--white);
        }

        .security-status.inactive {
            background: var(--neutral-200);
            color: var(--neutral-700);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .nav-search {
                max-width: 400px;
            }

            .hero-title {
                font-size: 36px;
            }

            .hero-subtitle {
                font-size: 20px;
            }

            .category-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .nav-container {
                flex-wrap: wrap;
                height: auto;
                padding: var(--spacing-md);
            }

            .nav-search {
                order: 3;
                width: 100%;
                max-width: 100%;
                margin: var(--spacing-md) 0 0 0;
            }

            .hero-title {
                font-size: 28px;
            }

            .hero-subtitle {
                font-size: 18px;
            }

            .hero-search-input {
                font-size: 16px;
                padding: var(--spacing-md) var(--spacing-lg);
            }

            .category-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: var(--spacing-lg);
            }

            .tasks-grid {
                grid-template-columns: 1fr;
            }

            .premium-banner {
                flex-direction: column;
                text-align: center;
            }

            .banner-image {
                width: 100px;
                height: 100px;
            }

            .service-detail-content {
                grid-template-columns: 1fr;
            }

            .service-header-content {
                flex-direction: column;
                text-align: center;
            }

            .survey-form {
                padding: var(--spacing-lg);
            }

            .invoice-card {
                padding: var(--spacing-lg);
            }

            .invoice-header-section {
                flex-direction: column;
                gap: var(--spacing-lg);
            }

            .invoice-details {
                text-align: left;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 24px;
            }

            .nav-right {
                gap: var(--spacing-sm);
            }

            .nav-link {
                font-size: 13px;
                padding: var(--spacing-xs) var(--spacing-sm);
            }

            .category-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Authentication Pages */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);
            padding: var(--spacing-lg);
        }

        .auth-wrapper {
            width: 100%;
            max-width: 450px;
        }

        .auth-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            padding: var(--spacing-3xl);
            border: 1px solid var(--neutral-200);
        }

        .auth-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }

        .auth-logo {
            font-size: 36px;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            justify-content: center;
            font-weight: 700;
            color: var(--primary-500);
            margin-bottom: var(--spacing-sm);
            letter-spacing: -0.5px;
        }

        .auth-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .auth-subtitle {
            font-size: 15px;
            color: var(--neutral-500);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .form-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--neutral-700);
        }

        .form-input {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            border: 1px solid var(--neutral-300);
            border-radius: var(--radius-md);
            font-size: 15px;
            color: var(--neutral-900);
            transition: all 0.2s;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(165, 59, 43, 0.1);
        }

        .form-input::placeholder {
            color: var(--neutral-400);
        }

        .password-wrapper {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: var(--spacing-md);
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--neutral-500);
            cursor: pointer;
            padding: var(--spacing-xs);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .password-toggle:hover {
            color: var(--primary-500);
        }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            cursor: pointer;
        }

        .form-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary-500);
        }

        .form-checkbox-label {
            font-size: 14px;
            color: var(--neutral-700);
            cursor: pointer;
        }

        .auth-link {
            color: var(--primary-500);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }

        .auth-link:hover {
            color: var(--primary-600);
            text-decoration: underline;
        }

        .auth-divider {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin: var(--spacing-lg) 0;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--neutral-200);
        }

        .auth-divider-text {
            font-size: 14px;
            color: var(--neutral-500);
        }

        .social-auth {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .social-btn {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            border: 1px solid var(--neutral-300);
            border-radius: var(--radius-md);
            background: var(--white);
            color: var(--neutral-700);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .social-btn:hover {
            border-color: var(--neutral-400);
            background: var(--neutral-50);
        }

        .auth-footer {
            text-align: center;
            margin-top: var(--spacing-xl);
            font-size: 14px;
            color: var(--neutral-500);
        }

        .error-message {
            background: var(--primary-50);
            border: 1px solid var(--primary-200);
            color: var(--primary-700);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            font-size: 14px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .success-message {
            background: #F0FDF4;
            border: 1px solid #86EFAC;
            color: #166534;
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            font-size: 14px;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .main-content {
            display: none;
        }

        .main-content.authenticated {
            display: block;
        }

        .auth-container.hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .auth-container {
                padding: var(--spacing-md);
            }

            .auth-card {
                padding: var(--spacing-xl);
            }

            .auth-title {
                font-size: 24px;
            }

            .auth-subtitle {
                font-size: 14px;
            }

            .form-input {
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }

        @media (max-width: 480px) {
            .auth-container {
                padding: var(--spacing-sm);
            }

            .auth-card {
                padding: var(--spacing-lg);
            }

            .auth-title {
                font-size: 22px;
            }

            .auth-logo {
                font-size: 28px;
            }

            .social-btn {
                font-size: 14px;
                padding: var(--spacing-sm) var(--spacing-md);
            }
        }

        /* Landing Page Styles */
        .landing-page {
            min-height: 100vh;
            background: var(--white);
            display: block; /* Ensure it's visible by default */
        }

        .landing-nav {
            background: var(--white);
            border-bottom: 1px solid var(--neutral-200);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
        }

        .landing-nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
            width: 100%;
            box-sizing: border-box;
        }

        @media (max-width: 768px) {
            .landing-nav-container {
                padding: 0 var(--spacing-md);
            }
        }

        .landing-logo {
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 700;
            color: var(--primary-500);
            letter-spacing: -0.5px;
            cursor: pointer;
        }

        .landing-nav-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .landing-nav-link {
            color: var(--neutral-700);
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            transition: color 0.2s;
        }

        .landing-nav-link:hover {
            color: var(--primary-500);
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: var(--spacing-sm);
            color: var(--neutral-700);
            min-width: 44px;
            min-height: 44px;
            align-items: center;
            justify-content: center;
        }

        .mobile-menu-toggle svg {
            width: 24px;
            height: 24px;
        }

        .mobile-menu {
            display: none;
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            background: var(--white);
            border-bottom: 1px solid var(--neutral-200);
            box-shadow: var(--shadow-lg);
            z-index: 999;
            padding: var(--spacing-lg);
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .mobile-menu.active {
            display: flex;
        }

        .mobile-menu-link {
            color: var(--neutral-700);
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }

        .mobile-menu-link:hover {
            background: var(--neutral-50);
            color: var(--primary-500);
        }

        .landing-hero {
            background: linear-gradient(135deg, rgba(165, 59, 43, 0.1) 0%, rgba(255, 255, 255, 0.9) 100%), url('images/bird-s-eye-view-shanghai.png');
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
            padding: var(--spacing-3xl) var(--spacing-lg);
            text-align: center;
            position: relative;
        }

        .landing-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);
            opacity: 0.7;
            z-index: 0;
        }

        .landing-hero-container {
            position: relative;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .landing-hero {
                padding: var(--spacing-2xl) var(--spacing-md);
            }
        }

        .landing-hero-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .landing-hero-title {
            font-size: 56px;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-lg);
            line-height: 1.2;
        }

        .landing-hero-subtitle {
            font-size: 24px;
            color: var(--neutral-700);
            margin-bottom: var(--spacing-2xl);
            font-weight: 400;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .landing-hero-cta {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
        }

        .landing-section {
            padding: var(--spacing-3xl) var(--spacing-lg);
        }

        @media (max-width: 768px) {
            .landing-section {
                padding: var(--spacing-2xl) var(--spacing-md);
            }
        }

        .landing-section-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .landing-section-title {
            font-size: 42px;
            font-weight: 700;
            color: var(--neutral-900);
            text-align: center;
            margin-bottom: var(--spacing-md);
        }

        .landing-section-subtitle {
            font-size: 18px;
            color: var(--neutral-500);
            text-align: center;
            margin-bottom: var(--spacing-3xl);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-2xl);
            margin-top: var(--spacing-2xl);
        }

        .feature-card {
            text-align: center;
            padding: var(--spacing-2xl);
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            transition: all 0.3s;
        }

        @media (max-width: 768px) {
            .feature-card {
                padding: var(--spacing-xl);
            }
        }

        .feature-card:hover {
            border-color: var(--primary-500);
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            background: var(--primary-500);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--spacing-lg);
            color: var(--white);
        }

        .feature-icon svg {
            width: 40px;
            height: 40px;
        }

        .feature-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .feature-desc {
            font-size: 15px;
            color: var(--neutral-500);
            line-height: 1.6;
        }

        .how-it-works {
            background: var(--neutral-50);
        }

        .steps-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-2xl);
            margin-top: var(--spacing-2xl);
        }

        .step-card {
            background: var(--white);
            padding: var(--spacing-2xl);
            border-radius: var(--radius-lg);
            border: 1px solid var(--neutral-200);
            position: relative;
        }

        @media (max-width: 768px) {
            .step-card {
                padding: var(--spacing-xl);
            }
        }

        .step-number {
            width: 48px;
            height: 48px;
            background: var(--primary-500);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: var(--spacing-lg);
        }

        .step-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .step-desc {
            font-size: 15px;
            color: var(--neutral-500);
            line-height: 1.6;
        }

        .stats-section {
            background: var(--primary-500);
            color: var(--white);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-2xl);
            margin-top: var(--spacing-2xl);
        }

        .stat-card {
            text-align: center;
        }

        .stat-number {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }

        .stat-label {
            font-size: 18px;
            opacity: 0.9;
        }

        .cta-section {
            position: relative;
            color: var(--white);
            text-align: center;
            padding: var(--spacing-3xl) var(--spacing-lg);
            overflow: hidden;
        }

        .cta-slideshow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .cta-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .cta-slide.active {
            opacity: 1;
        }

        .cta-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(165, 59, 43, 0.85) 0%, rgba(220, 38, 38, 0.85) 100%);
            z-index: 1;
        }

        .cta-section .landing-section-container {
            position: relative;
            z-index: 2;
        }

        @media (max-width: 768px) {
            .cta-section {
                padding: var(--spacing-2xl) var(--spacing-md);
            }
        }

        .cta-title {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: var(--spacing-lg);
        }

        .cta-subtitle {
            font-size: 20px;
            margin-bottom: var(--spacing-2xl);
            opacity: 0.95;
        }

        .cta-buttons {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-white {
            background: var(--white);
            color: var(--primary-500);
            border: none;
        }

        .btn-white:hover {
            background: var(--neutral-100);
        }

        .btn-outline-white {
            background: transparent;
            color: var(--white);
            border: 2px solid var(--white);
        }

        .btn-outline-white:hover {
            background: var(--white);
            color: var(--primary-500);
        }

        .landing-page.hidden {
            display: none;
        }

        /* Agent Login & Dashboard Styles */
        .agent-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);
            padding: var(--spacing-lg);
        }

        .agent-container.hidden {
            display: none;
        }

        .agent-login-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            padding: var(--spacing-3xl);
            border: 1px solid var(--neutral-200);
            max-width: 450px;
            width: 100%;
        }

        .agent-dashboard {
            min-height: 100vh;
            background: var(--neutral-50);
            display: none;
        }

        .agent-dashboard.active {
            display: block;
        }

        .agent-header {
            background: var(--white);
            border-bottom: 1px solid var(--neutral-200);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .agent-header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .agent-header-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-500);
        }

        .agent-header-actions {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }

        .agent-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-2xl) var(--spacing-lg);
        }

        .requests-section {
            margin-bottom: var(--spacing-3xl);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
        }

        .section-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--neutral-900);
        }

        .request-card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            transition: all 0.2s;
        }

        .request-card:hover {
            box-shadow: var(--shadow-md);
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--neutral-200);
        }

        .request-info h3 {
            font-size: 20px;
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .request-meta {
            display: flex;
            gap: var(--spacing-lg);
            flex-wrap: wrap;
            font-size: 14px;
            color: var(--neutral-500);
        }

        .request-status {
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
        }

        .request-status.pending {
            background: #FEF3C7;
            color: #92400E;
        }

        .request-status.assigned {
            background: #DBEAFE;
            color: #1E40AF;
        }

        .request-status.completed {
            background: #D1FAE5;
            color: #065F46;
        }

        .request-details {
            margin-bottom: var(--spacing-lg);
        }

        .request-detail-row {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            font-size: 15px;
        }

        .request-detail-label {
            font-weight: 600;
            color: var(--neutral-700);
            min-width: 120px;
        }

        .request-detail-value {
            color: var(--neutral-600);
        }

        .request-actions {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .assign-provider-form {
            background: var(--neutral-50);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-top: var(--spacing-lg);
            display: none;
        }

        .assign-provider-form.active {
            display: block;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .invoice-section {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-top: var(--spacing-lg);
            display: none;
        }

        .invoice-section.active {
            display: block;
        }

        .invoice-items {
            margin: var(--spacing-lg) 0;
        }

        .invoice-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--neutral-200);
            align-items: center;
        }

        .invoice-item:last-child {
            border-bottom: none;
        }

        .invoice-total {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-lg);
            background: var(--neutral-50);
            border-radius: var(--radius-md);
            font-size: 18px;
            font-weight: 700;
            margin-top: var(--spacing-lg);
        }

        @media (max-width: 768px) {
            .agent-login-card {
                padding: var(--spacing-xl);
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .invoice-item {
                grid-template-columns: 1fr;
                gap: var(--spacing-sm);
            }

            .request-header {
                flex-direction: column;
                gap: var(--spacing-md);
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-md);
            }
        }

        @media (max-width: 768px) {
            .landing-hero-title {
                font-size: 36px;
            }

            .landing-hero-subtitle {
                font-size: 18px;
            }

            .landing-section-title {
                font-size: 32px;
            }

            .landing-section-subtitle {
                font-size: 16px;
            }

            .features-grid,
            .steps-container,
            .stats-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-lg);
            }

            .landing-nav-right {
                gap: var(--spacing-sm);
            }

            .landing-nav-link {
                display: none;
            }

            #desktop-join-btn {
                display: none !important;
            }

            .mobile-menu-toggle {
                display: flex;
            }

            .landing-hero-cta {
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            .landing-hero-cta .btn {
                width: 100%;
            }

            .cta-buttons {
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            .cta-buttons .btn {
                width: 100%;
            }

            .stat-number {
                font-size: 36px;
            }

            .stat-label {
                font-size: 16px;
            }

            .feature-icon {
                width: 64px;
                height: 64px;
            }

            .feature-icon svg {
                width: 32px;
                height: 32px;
            }

            .step-number {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .landing-nav-container {
                padding: 0 var(--spacing-md);
            }

            .landing-logo {
                font-size: 24px;
            }

            .landing-hero {
                padding: var(--spacing-xl) var(--spacing-md);
            }

            .landing-hero-title {
                font-size: 28px;
                margin-bottom: var(--spacing-md);
            }

            .landing-hero-subtitle {
                font-size: 16px;
                margin-bottom: var(--spacing-xl);
            }

            .landing-section {
                padding: var(--spacing-xl) var(--spacing-md);
            }

            .landing-section-title {
                font-size: 28px;
                margin-bottom: var(--spacing-sm);
            }

            .landing-section-subtitle {
                font-size: 14px;
                margin-bottom: var(--spacing-2xl);
            }

            .cta-title {
                font-size: 28px;
            }

            .cta-subtitle {
                font-size: 16px;
            }

            .feature-card {
                padding: var(--spacing-lg);
            }

            .feature-title {
                font-size: 18px;
            }

            .feature-desc {
                font-size: 14px;
            }

            .step-card {
                padding: var(--spacing-lg);
            }

            .step-title {
                font-size: 18px;
            }

            .step-desc {
                font-size: 14px;
            }

            .stat-number {
                font-size: 32px;
            }

            .stat-label {
                font-size: 14px;
            }

            .stats-section {
                padding: var(--spacing-xl) var(--spacing-md);
            }
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Paystack Inline JS -->
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <script>
        // ============================================
        // Firebase Configuration
        // ============================================
        // SETUP INSTRUCTIONS:
        // 1. Go to https://console.firebase.google.com/
        // 2. Create a new project (or select existing)
        // 3. Enable Authentication:
        //    - Go to Authentication > Sign-in method
        //    - Enable "Email/Password"
        // 4. Enable Firestore Database:
        //    - Go to Firestore Database > Create database
        //    - Start in test mode (for development)
        //    - Choose a location
        // 5. Get your config:
        //    - Go to Project Settings > General
        //    - Scroll to "Your apps" section
        //    - Click the </> icon to add a web app
        //    - Copy the firebaseConfig object
        // 6. Replace the values below with your config
        // 7. Set Firestore Security Rules (Firestore > Rules):
        //    rules_version = '2';
        //    service cloud.firestore {
        //      match /databases/{database}/documents {
        //        match /users/{userId} {
        //          allow read, write: if request.auth != null && request.auth.uid == userId;
        //        }
        //        match /requests/{requestId} {
        //          allow read: if request.auth != null;
        //          allow create: if request.auth != null;
        //          allow update, delete: if request.auth != null;
        //        }
        //      }
        //    }
        const firebaseConfig = {
            apiKey: "AIzaSyAIfMwzFE5Kgi1s1n77R8CL66anwR6HPOw",
            authDomain: "homefix-dd9d4.firebaseapp.com",
            projectId: "homefix-dd9d4",
            storageBucket: "homefix-dd9d4.firebasestorage.app",
            messagingSenderId: "634866197350",
            appId: "1:634866197350:web:26a4218947dfe652f05ea7",
            measurementId: "G-S6S707G0G8"
        };

        // Initialize Firebase
        let firebaseInitialized = false;
        try {
            firebase.initializeApp(firebaseConfig);
            firebaseInitialized = true;
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
            alert('Firebase configuration error. Please check your Firebase config.');
        }
        
        // Initialize Firebase services
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Check if Firebase is properly initialized
        if (!firebaseInitialized) {
            console.error('Firebase is not initialized. Please check your configuration.');
        }
        
        // ============================================
        // Firebase Service Functions
        // ============================================
        
        // Authentication Service
        const firebaseAuth = {
            // Sign up new user
            async signUp(email, password, userData) {
                try {
                    console.log('Attempting to create user with email:', email);
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;
                    console.log('User created successfully:', user.uid);
                    
                    // Save user data to Firestore
                    try {
                        await db.collection('users').doc(user.uid).set({
                            email: email,
                            name: userData.name,
                            phone: userData.phone,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        console.log('User data saved to Firestore');
                    } catch (firestoreError) {
                        console.error('Error saving user data to Firestore:', firestoreError);
                        // User is created but data save failed - still return success
                        // The user can update their profile later
                    }
                    
                    return { success: true, user: user };
                } catch (error) {
                    console.error('Firebase signUp error:', error);
                    console.error('Error code:', error.code);
                    console.error('Error message:', error.message);
                    return { success: false, error: error.message || error.code || 'Unknown error' };
                }
            },
            
            // Sign in existing user
            async signIn(email, password) {
                try {
                    const userCredential = await auth.signInWithEmailAndPassword(email, password);
                    return { success: true, user: userCredential.user };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            // Sign out
            async signOut() {
                try {
                    await auth.signOut();
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            // Get current user
            getCurrentUser() {
                const user = auth.currentUser;
                console.log('getCurrentUser called, user:', user ? user.uid : 'null');
                return user;
            },
            
            // Wait for auth state to be ready
            async waitForAuthState() {
                return new Promise((resolve) => {
                    if (auth.currentUser) {
                        resolve(auth.currentUser);
                    } else {
                        const unsubscribe = auth.onAuthStateChanged((user) => {
                            unsubscribe();
                            resolve(user);
                        });
                    }
                });
            },
            
            // Listen to auth state changes
            onAuthStateChanged(callback) {
                return auth.onAuthStateChanged(callback);
            }
        };
        
        // Firestore Service - Users
        const firebaseUsers = {
            async getUser(uid) {
                try {
                    const doc = await db.collection('users').doc(uid).get();
                    if (doc.exists) {
                        return { success: true, data: doc.data() };
                    }
                    return { success: false, error: 'User not found' };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async updateUser(uid, data) {
                try {
                    await db.collection('users').doc(uid).update(data);
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
        };
        
        // Paystack Payment Configuration
        const PAYSTACK_PUBLIC_KEY = 'EQCLfvbkTrdUJ1wfyNI9uOdcK30z1wbWWX060mrXBNwp2Tse'; // Your Paystack Public Key
        
        // Paystack Payment Service
        const paystackAPI = {
            // Initialize Paystack payment
            async initializePayment(email, amount, invoiceId, metadata = {}) {
                return new Promise((resolve, reject) => {
                    const handler = PaystackPop.setup({
                        key: PAYSTACK_PUBLIC_KEY,
                        email: email,
                        amount: Math.round(amount * 100), // Convert to kobo/pesewas (smallest currency unit)
                        currency: 'GHS', // Ghana Cedis
                        ref: `INV-${invoiceId}-${Date.now()}`, // Unique reference
                        metadata: {
                            custom_fields: [
                                {
                                    display_name: "Invoice ID",
                                    variable_name: "invoice_id",
                                    value: invoiceId
                                },
                                ...Object.entries(metadata).map(([key, value]) => ({
                                    display_name: key,
                                    variable_name: key,
                                    value: value
                                }))
                            ]
                        },
                        callback: function(response) {
                            // Payment successful
                            resolve({
                                success: true,
                                reference: response.reference,
                                transactionId: response.reference,
                                status: 'success'
                            });
                        },
                        onClose: function() {
                            // User closed the payment modal
                            reject({
                                success: false,
                                error: 'Payment cancelled by user',
                                cancelled: true
                            });
                        }
                    });
                    
                    handler.openIframe();
                });
            },
            
            // Verify payment (optional - for server-side verification)
            async verifyPayment(reference) {
                // This would typically be done on your backend
                // For now, we'll trust the callback response
                return {
                    success: true,
                    reference: reference,
                    status: 'success'
                };
            }
        };
        
        // Firestore Service - Requests
        const firebaseRequests = {
            async createRequest(requestData) {
                try {
                    console.log(' Creating request in Firestore:', {
                        clientEmail: requestData.clientEmail,
                        clientName: requestData.clientName,
                        service: requestData.service,
                        status: requestData.status
                    });
                    
                    const docRef = await db.collection('requests').add({
                        ...requestData,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    console.log(' Request created successfully with ID:', docRef.id);
                    return { success: true, id: docRef.id };
                } catch (error) {
                    console.error(' Error creating request:', error);
                    return { success: false, error: error.message };
                }
            },
            
            async getRequest(requestId) {
                try {
                    const doc = await db.collection('requests').doc(requestId).get();
                    if (doc.exists) {
                        return { success: true, data: { id: doc.id, ...doc.data() } };
                    }
                    return { success: false, error: 'Request not found' };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async updateRequest(requestId, data) {
                try {
                    await db.collection('requests').doc(requestId).update({
                        ...data,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            async getUserRequests(userUid) {
                try {
                    console.log(' getUserRequests - Searching for user UID:', userUid);
                    
                    if (!userUid) {
                        console.error(' No user UID provided');
                        return { success: false, error: 'No user UID provided' };
                    }
                    
                    const requests = [];
                    
                    // Query requests by user UID
                    try {
                        // Try with orderBy first (faster if index exists)
                        let snapshot;
                        try {
                            snapshot = await db.collection('requests')
                                .where('clientUid', '==', userUid)
                                .orderBy('createdAt', 'desc')
                                .get();
                        } catch (orderByError) {
                            // If orderBy fails (no index), try without it
                            console.warn(' orderBy failed, trying without orderBy:', orderByError.message);
                            try {
                                snapshot = await db.collection('requests')
                                    .where('clientUid', '==', userUid)
                                    .get();
                            } catch (whereError) {
                                // If where also fails, get all and filter client-side
                                console.warn(' where query failed, fetching all and filtering:', whereError.message);
                                const allSnapshot = await db.collection('requests').get();
                                snapshot = {
                                    forEach: (callback) => {
                                        allSnapshot.forEach(doc => {
                                            const data = doc.data();
                                            if (data.clientUid === userUid) {
                                                callback({ id: doc.id, data: () => data });
                                            }
                                        });
                                    },
                                    size: allSnapshot.size
                                };
                            }
                        }
                        
                        console.log(' Total requests found for user:', snapshot.size || 0);
                        
                        snapshot.forEach(doc => {
                            const data = doc.data ? doc.data() : doc;
                            console.log(' Request found:', {
                                id: doc.id,
                                service: data.service,
                                status: data.status,
                                clientUid: data.clientUid
                            });
                            requests.push({ id: doc.id, ...data });
                        });
                        
                        console.log(` Total matching requests: ${requests.length}`);
                    } catch (error) {
                        console.error(' Error fetching requests:', error);
                        return { success: false, error: error.message };
                    }
                    
                    return { success: true, data: requests };
                } catch (error) {
                    console.error(' getUserRequests error:', error);
                    return { success: false, error: error.message };
                }
            },
            
            async getAllRequests() {
                try {
                    const snapshot = await db.collection('requests')
                        .orderBy('createdAt', 'desc')
                        .get();
                    
                    const requests = [];
                    snapshot.forEach(doc => {
                        requests.push({ id: doc.id, ...doc.data() });
                    });
                    
                    return { success: true, data: requests };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
        };
        
        // Helper function to convert Firestore timestamp to date
        function convertTimestamp(timestamp) {
            if (timestamp && timestamp.toDate) {
                return timestamp.toDate();
            }
            return new Date();
        }
    </script>
    <script>
        // ============================================
        // IndexedDB Database Module
        // ============================================
        const DB_NAME = 'HomeFixDB';
        const DB_VERSION = 1;
        let idb = null;

        // Initialize IndexedDB
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    idb = request.result;
                    resolve(idb);
                };

                request.onupgradeneeded = (event) => {
                    const db = event.target.result;

                    // Users store
                    if (!db.objectStoreNames.contains('users')) {
                        const usersStore = db.createObjectStore('users', { keyPath: 'email' });
                        usersStore.createIndex('email', 'email', { unique: true });
                    }

                    // Requests store
                    if (!db.objectStoreNames.contains('requests')) {
                        const requestsStore = db.createObjectStore('requests', { keyPath: 'id', autoIncrement: true });
                        requestsStore.createIndex('clientEmail', 'clientEmail', { unique: false });
                        requestsStore.createIndex('status', 'status', { unique: false });
                        requestsStore.createIndex('createdAt', 'createdAt', { unique: false });
                    }

                    // Sessions store (for authentication state)
                    if (!db.objectStoreNames.contains('sessions')) {
                        const sessionsStore = db.createObjectStore('sessions', { keyPath: 'key' });
                    }

                    // Agents store
                    if (!db.objectStoreNames.contains('agents')) {
                        const agentsStore = db.createObjectStore('agents', { keyPath: 'username' });
                    }
                };
            });
        }

        // Database API - Users
        const userDB = {
            async getAll() {
                if (!idb) await initDB();
                const tx = idb.transaction('users', 'readonly');
                const store = tx.objectStore('users');
                return store.getAll();
            },

            async get(email) {
                if (!idb) await initDB();
                const tx = idb.transaction('users', 'readonly');
                const store = tx.objectStore('users');
                return store.get(email);
            },

            async add(user) {
                if (!idb) await initDB();
                const tx = idb.transaction('users', 'readwrite');
                const store = tx.objectStore('users');
                return store.add(user);
            },

            async update(email, user) {
                if (!idb) await initDB();
                const tx = idb.transaction('users', 'readwrite');
                const store = tx.objectStore('users');
                return store.put({ ...user, email });
            },

            async delete(email) {
                if (!idb) await initDB();
                const tx = idb.transaction('users', 'readwrite');
                const store = tx.objectStore('users');
                return store.delete(email);
            },

            async findByEmail(email) {
                const user = await this.get(email);
                return user;
            }
        };

        // Database API - Requests
        const requestDB = {
            async getAll() {
                if (!idb) await initDB();
                const tx = idb.transaction('requests', 'readonly');
                const store = tx.objectStore('requests');
                return store.getAll();
            },

            async get(id) {
                if (!idb) await initDB();
                const tx = idb.transaction('requests', 'readonly');
                const store = tx.objectStore('requests');
                return store.get(id);
            },

            async add(request) {
                if (!idb) await initDB();
                return new Promise((resolve, reject) => {
                    const tx = idb.transaction('requests', 'readwrite');
                    const store = tx.objectStore('requests');
                    const request_obj = store.add(request);
                    request_obj.onsuccess = () => {
                        resolve(request_obj.result); // Returns the auto-generated ID
                    };
                    request_obj.onerror = () => reject(request_obj.error);
                });
            },

            async update(id, request) {
                if (!idb) await initDB();
                const tx = idb.transaction('requests', 'readwrite');
                const store = tx.objectStore('requests');
                return store.put({ ...request, id });
            },

            async delete(id) {
                if (!idb) await initDB();
                const tx = idb.transaction('requests', 'readwrite');
                const store = tx.objectStore('requests');
                return store.delete(id);
            },

            async getByEmail(email) {
                if (!idb) await initDB();
                const tx = idb.transaction('requests', 'readonly');
                const store = tx.objectStore('requests');
                const index = store.index('clientEmail');
                return index.getAll(email);
            },

            async getByStatus(status) {
                if (!idb) await initDB();
                const tx = idb.transaction('requests', 'readonly');
                const store = tx.objectStore('requests');
                const index = store.index('status');
                return index.getAll(status);
            }
        };

        // Database API - Sessions
        const sessionDB = {
            async get(key) {
                if (!idb) await initDB();
                const tx = idb.transaction('sessions', 'readonly');
                const store = tx.objectStore('sessions');
                const result = await store.get(key);
                return result ? result.value : null;
            },

            async set(key, value) {
                if (!idb) await initDB();
                const tx = idb.transaction('sessions', 'readwrite');
                const store = tx.objectStore('sessions');
                return store.put({ key, value });
            },

            async remove(key) {
                if (!idb) await initDB();
                const tx = idb.transaction('sessions', 'readwrite');
                const store = tx.objectStore('sessions');
                return store.delete(key);
            },

            async clear() {
                if (!idb) await initDB();
                const tx = idb.transaction('sessions', 'readwrite');
                const store = tx.objectStore('sessions');
                return store.clear();
            }
        };

        // Database API - Agents
        const agentDB = {
            async getAll() {
                if (!idb) await initDB();
                const tx = idb.transaction('agents', 'readonly');
                const store = tx.objectStore('agents');
                return store.getAll();
            },

            async get(username) {
                if (!idb) await initDB();
                const tx = idb.transaction('agents', 'readonly');
                const store = tx.objectStore('agents');
                return store.get(username);
            },

            async add(agent) {
                if (!idb) await initDB();
                const tx = idb.transaction('agents', 'readwrite');
                const store = tx.objectStore('agents');
                return store.add(agent);
            },

            async update(username, agent) {
                if (!idb) await initDB();
                const tx = idb.transaction('agents', 'readwrite');
                const store = tx.objectStore('agents');
                return store.put({ ...agent, username });
            }
        };

        // Migrate data from localStorage to IndexedDB
        async function migrateFromLocalStorage() {
            try {
                // Check if migration already done
                const migrationDone = await sessionDB.get('migration_done');
                if (migrationDone) return;

                // Migrate users
                const users = JSON.parse(localStorage.getItem('homefix_users') || '[]');
                for (const user of users) {
                    try {
                        await userDB.add(user);
                    } catch (e) {
                        // User might already exist, skip
                    }
                }

                // Migrate requests
                const agentRequests = JSON.parse(localStorage.getItem('agent_requests') || '[]');
                for (const request of agentRequests) {
                    try {
                        await requestDB.add(request);
                    } catch (e) {
                        // Request might already exist, skip
                    }
                }

                // Migrate user-specific requests
                const keys = Object.keys(localStorage);
                for (const key of keys) {
                    if (key.startsWith('user_requests_')) {
                        const email = key.replace('user_requests_', '');
                        const userRequests = JSON.parse(localStorage.getItem(key) || '[]');
                        for (const request of userRequests) {
                            try {
                                // Check if request already exists
                                const existing = await requestDB.get(request.id);
                                if (!existing) {
                                    await requestDB.add(request);
                                }
                            } catch (e) {
                                // Request might already exist, skip
                            }
                        }
                    }
                }

                // Migrate authentication state
                const isAuthenticated = localStorage.getItem('homefix_authenticated') === 'true';
                if (isAuthenticated) {
                    await sessionDB.set('homefix_authenticated', 'true');
                    const userData = JSON.parse(localStorage.getItem('homefix_user') || '{}');
                    if (userData.email) {
                        await sessionDB.set('homefix_user', userData);
                    }
                }

                const isAgentAuthenticated = localStorage.getItem('agent_authenticated') === 'true';
                if (isAgentAuthenticated) {
                    await sessionDB.set('agent_authenticated', 'true');
                    const agentUsername = localStorage.getItem('agent_username');
                    if (agentUsername) {
                        await sessionDB.set('agent_username', agentUsername);
                    }
                }

                // Mark migration as done
                await sessionDB.set('migration_done', 'true');
                console.log('Data migration completed successfully');
            } catch (error) {
                console.error('Migration error:', error);
            }
        }

        // Initialize database on page load
        async function initializeDatabase() {
            try {
                await initDB();
                await migrateFromLocalStorage();
                console.log('Database initialized successfully');
            } catch (error) {
                console.error('Database initialization error:', error);
            }
        }

        // Ensure landing page is visible immediately on page load
        window.addEventListener('load', async function() {
            await initializeDatabase();
            
            const landingPage = document.getElementById('landing-page');
            const isAgentAuthenticated = await sessionDB.get('agent_authenticated') === 'true';
            const isAuthenticated = await sessionDB.get('homefix_authenticated') === 'true';
            
            if (!isAgentAuthenticated && !isAuthenticated && landingPage) {
                landingPage.classList.remove('hidden');
                landingPage.style.display = 'block';
            }
        });
    </script>
</head>
<body>
    <!-- Landing Page -->
    <div class="landing-page" id="landing-page">
        <!-- Landing Navigation -->
        <nav class="landing-nav">
            <div class="landing-nav-container">
                <div class="landing-logo">
                    <img src="images/logo.png" alt="HomeFix Logo" width=50 height=50>
                    <span>HomeFix</span>
                </div>
                <div class="landing-nav-right">
                    <a href="#" class="landing-nav-link" onclick="scrollToSection('features'); return false;">Services</a>
                    <a href="#" class="landing-nav-link" onclick="scrollToSection('how-it-works'); return false;">How It Works</a>
                    <a href="#" class="landing-nav-link" onclick="showAuthPage('signin'); return false;">Sign In</a>
                    <button class="btn btn-primary" onclick="showAuthPage('register')" id="desktop-join-btn">Join</button>
                    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" id="mobile-menu-btn">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="mobile-menu" id="mobile-menu">
                <a href="#" class="mobile-menu-link" onclick="scrollToSection('features'); toggleMobileMenu(); return false;">Services</a>
                <a href="#" class="mobile-menu-link" onclick="scrollToSection('how-it-works'); toggleMobileMenu(); return false;">How It Works</a>
                <a href="#" class="mobile-menu-link" onclick="showAuthPage('signin'); toggleMobileMenu(); return false;">Sign In</a>
                <button class="btn btn-primary" onclick="showAuthPage('register'); toggleMobileMenu();" style="width: 100%; margin-top: var(--spacing-sm);">Join</button>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="landing-hero">
            <div class="landing-hero-container">
                <h1 class="landing-hero-title">
                    Find the perfect home service professional
                </h1>
                <p class="landing-hero-subtitle">
                    Connect with skilled professionals for all your home service needs. Quality work, fair prices, done right.
                </p>
                <div class="landing-hero-cta">
                    <button class="btn btn-primary" onclick="showAuthPage('register')" style="padding: var(--spacing-md) var(--spacing-2xl); font-size: 18px;">
                        Get Started
                    </button>
                    <button class="btn btn-ghost" onclick="scrollToSection('how-it-works')" style="padding: var(--spacing-md) var(--spacing-2xl); font-size: 18px;">
                        Learn More
                    </button>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="landing-section" id="features">
            <div class="landing-section-container">
                <h2 class="landing-section-title">Why Choose HomeFix?</h2>
                <p class="landing-section-subtitle">
                    We make it easy to find and hire trusted professionals for all your home service needs
                </p>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                        </div>
                        <h3 class="feature-title">Verified Professionals</h3>
                        <p class="feature-desc">
                            All service providers are thoroughly vetted and verified to ensure quality and reliability
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="feature-title">Fair & Transparent Pricing</h3>
                        <p class="feature-desc">
                            Get upfront quotes with no hidden fees. Compare prices and choose what works for your budget
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="feature-title">Quick & Reliable Service</h3>
                        <p class="feature-desc">
                            Book services in minutes and get work done on time. Our professionals are committed to meeting deadlines
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="feature-title">Satisfaction Guaranteed</h3>
                        <p class="feature-desc">
                            We stand behind every job. If you're not happy, we'll make it right or refund your money
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <h3 class="feature-title">Easy Booking</h3>
                        <p class="feature-desc">
                            Book services instantly through our platform. Track progress and communicate with professionals in real-time
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                        <h3 class="feature-title">Wide Range of Services</h3>
                        <p class="feature-desc">
                            From plumbing to electrical, cleaning to repairs - find professionals for every home service need
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section class="landing-section how-it-works" id="how-it-works">
            <div class="landing-section-container">
                <h2 class="landing-section-title">How It Works</h2>
                <p class="landing-section-subtitle">
                    Getting started is simple. Follow these easy steps to get your home services done
                </p>
                <div class="steps-container">
                    <div class="step-card">
                        <div class="step-number">1</div>
                        <h3 class="step-title">Create Your Account</h3>
                        <p class="step-desc">
                            Sign up in seconds with your email or social account. It's free and takes less than a minute
                        </p>
                    </div>
                    <div class="step-card">
                        <div class="step-number">2</div>
                        <h3 class="step-title">Browse Services</h3>
                        <p class="step-desc">
                            Search through our wide range of home services. Filter by category, price, and ratings
                        </p>
                    </div>
                    <div class="step-card">
                        <div class="step-number">3</div>
                        <h3 class="step-title">Book a Professional</h3>
                        <p class="step-desc">
                            Choose a verified professional, see their portfolio, read reviews, and book your service
                        </p>
                    </div>
                    <div class="step-card">
                        <div class="step-number">4</div>
                        <h3 class="step-title">Get It Done</h3>
                        <p class="step-desc">
                            Your professional arrives on time, completes the work, and you pay securely through our platform
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stats Section -->
        <section class="landing-section stats-section">
            <div class="landing-section-container">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">10K+</div>
                        <div class="stat-label">Happy Customers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">5K+</div>
                        <div class="stat-label">Verified Professionals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">50K+</div>
                        <div class="stat-label">Completed Jobs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">4.8</div>
                        <div class="stat-label">Average Rating</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="cta-section">
            <div class="cta-slideshow">
                <div class="cta-slide active" style="background-image: url('images/slide1.jpg');"></div>
                <div class="cta-slide" style="background-image: url('images/slide2.jpg');"></div>
                <div class="cta-slide" style="background-image: url('images/slide3.jpg');"></div>
                <div class="cta-slide" style="background-image: url('images/slide4.jpg');"></div>
                <div class="cta-slide" style="background-image: url('images/slide5.jpg');"></div>
            </div>
            <div class="landing-section-container">
                <h2 class="cta-title">Ready to Get Started?</h2>
                <p class="cta-subtitle">
                    Join thousands of satisfied customers who trust HomeFix for all their home service needs
                </p>
                <div class="cta-buttons">
                    <button class="btn btn-white" onclick="showAuthPage('register')" style="padding: var(--spacing-md) var(--spacing-2xl); font-size: 18px;">
                        Create Free Account
                    </button>
                    <button class="btn btn-outline-white" onclick="showAuthPage('signin')" style="padding: var(--spacing-md) var(--spacing-2xl); font-size: 18px;">
                        Sign In
                    </button>
                </div>
            </div>
        </section>

        <!-- Agent Login Section -->
        <section class="landing-section" id="agent-section" style="background: var(--neutral-50); border-top: 2px solid var(--neutral-200);">
            <div class="landing-section-container" style="text-align: center;">
                <h2 class="landing-section-title" style="font-size: 32px; margin-bottom: var(--spacing-md);">Agent Portal</h2>
                <p class="landing-section-subtitle" style="margin-bottom: var(--spacing-xl);">
                    Are you an agent? Access your dashboard to manage requests and assignments
                </p>
                <button class="btn btn-primary" onclick="showAgentLogin()" style="padding: var(--spacing-md) var(--spacing-2xl); font-size: 16px;">
                    Agent Login
                </button>
            </div>
        </section>
    </div>

    <!-- Authentication Container -->
    <div class="auth-container" id="auth-container">
        <div class="auth-wrapper">
            <!-- Sign In Page -->
            <div class="auth-card" id="signin-card">
                <div style="margin-bottom: var(--spacing-md);">
                    <a href="#" class="auth-link" onclick="showLandingPage(); return false;" style="display: inline-flex; align-items: center; gap: var(--spacing-xs);">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Back to Home
                    </a>
                </div>
                <div class="auth-header">
                    <div class="auth-logo">
                        <img src="images/logo.png" alt="HomeFix Logo" width=50 height=50>
                        <span>HomeFix</span>
                    </div>
                    <h1 class="auth-title">Welcome Back</h1>
                    <p class="auth-subtitle">Sign in to continue to your account</p>
                </div>

                <div class="error-message" id="signin-error"></div>
                <div class="success-message" id="signin-success"></div>

                <form class="auth-form" id="signin-form" onsubmit="handleSignIn(event)">
                    <div class="form-group">
                        <label class="form-label" for="signin-email">Email Address</label>
                        <input 
                            type="email" 
                            id="signin-email" 
                            class="form-input" 
                            placeholder="Enter your email"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="signin-password">Password</label>
                        <div class="password-wrapper">
                            <input 
                                type="password" 
                                id="signin-password" 
                                class="form-input" 
                                placeholder="Enter your password"
                                required
                            >
                            <button 
                                type="button" 
                                class="password-toggle" 
                                onclick="togglePassword('signin-password', this)"
                            >
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="form-group" style="flex-direction: row; justify-content: space-between; align-items: center;">
                        <label class="form-checkbox">
                            <input type="checkbox" id="remember-me">
                            <span class="form-checkbox-label">Remember me</span>
                        </label>
                        <a href="#" class="auth-link" onclick="alert('Password reset feature coming soon!'); return false;">Forgot password?</a>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Sign In
                    </button>
                </form>

                <div class="auth-divider">
                    <span class="auth-divider-text">Or continue with</span>
                </div>

                <div class="social-auth">
                    <button type="button" class="social-btn" onclick="handleSocialAuth('google')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                        </svg>
                        Continue with Google
                    </button>
                    <button type="button" class="social-btn" onclick="handleSocialAuth('facebook')">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                        Continue with Facebook
                    </button>
                </div>

                <div class="auth-footer">
                    Don't have an account? <a href="#" class="auth-link" onclick="switchToRegister(); return false;">Sign up</a>
                </div>
            </div>

            <!-- Register Page -->
            <div class="auth-card" id="register-card" style="display: none;">
                <div style="margin-bottom: var(--spacing-md);">
                    <a href="#" class="auth-link" onclick="showLandingPage(); return false;" style="display: inline-flex; align-items: center; gap: var(--spacing-xs);">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Back to Home
                    </a>
                </div>
                <div class="auth-header">
                    <div class="auth-logo">
                        <img src="images/logo.png" alt="HomeFix Logo" width=50 height=50>
                        <span>HomeFix</span>
                    </div>
                    <h1 class="auth-title">Create Account</h1>
                    <p class="auth-subtitle">Join HomeFix and get started today</p>
                </div>

                <div class="error-message" id="register-error"></div>
                <div class="success-message" id="register-success"></div>

                <form class="auth-form" id="register-form" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label class="form-label" for="register-name">Full Name</label>
                        <input 
                            type="text" 
                            id="register-name" 
                            class="form-input" 
                            placeholder="Enter your full name"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="register-email">Email Address</label>
                        <input 
                            type="email" 
                            id="register-email" 
                            class="form-input" 
                            placeholder="Enter your email"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="register-phone">Phone Number</label>
                        <input 
                            type="tel" 
                            id="register-phone" 
                            class="form-input" 
                            placeholder="Enter your phone number"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="register-password">Password</label>
                        <div class="password-wrapper">
                            <input 
                                type="password" 
                                id="register-password" 
                                class="form-input" 
                                placeholder="Create a password"
                                required
                                minlength="6"
                            >
                            <button 
                                type="button" 
                                class="password-toggle" 
                                onclick="togglePassword('register-password', this)"
                            >
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="register-confirm-password">Confirm Password</label>
                        <div class="password-wrapper">
                            <input 
                                type="password" 
                                id="register-confirm-password" 
                                class="form-input" 
                                placeholder="Confirm your password"
                                required
                                minlength="6"
                            >
                            <button 
                                type="button" 
                                class="password-toggle" 
                                onclick="togglePassword('register-confirm-password', this)"
                            >
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-checkbox">
                            <input type="checkbox" id="terms-checkbox" required>
                            <span class="form-checkbox-label">I agree to the <a href="#" class="auth-link" onclick="alert('Terms of Service'); return false;">Terms of Service</a> and <a href="#" class="auth-link" onclick="alert('Privacy Policy'); return false;">Privacy Policy</a></span>
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Create Account
                    </button>
                </form>

                <div class="auth-divider">
                    <span class="auth-divider-text">Or continue with</span>
                </div>

                <div class="social-auth">
                    <button type="button" class="social-btn" onclick="handleSocialAuth('google')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                        </svg>
                        Continue with Google
                    </button>
                    <button type="button" class="social-btn" onclick="handleSocialAuth('facebook')">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                        Continue with Facebook
                    </button>
                </div>

                <div class="auth-footer">
                    Already have an account? <a href="#" class="auth-link" onclick="switchToSignIn(); return false;">Sign in</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content (Hidden until authenticated) -->
    <div class="main-content" id="main-content">
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="logo-section" onclick="showScreen('home')">
                <div class="logo">
                    <img src="images/logo.png" alt="HomeFix Logo">
                    <span>HomeFix</span>
                </div>
                <div class="location-badge">
                    <div class="status-indicator"></div>
                    <span>Accra, Ghana</span>
                </div>
            </div>
            
            <div class="nav-search">
                <div class="search-wrapper">
                    <input type="text" class="search-input" id="nav-search-input" placeholder="Search for services..." oninput="filterCategories()">
                    <button class="search-btn">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="nav-right">
                <a href="#" class="nav-link" onclick="showScreen('tasks'); return false;">My Tasks</a>
                <div class="premium-badge">PREMIUM</div>
                <div class="user-menu" onclick="showScreen('profile')">
                    <img src="images/person.png" alt="User" class="user-avatar">
                </div>
                <a href="#" class="nav-link" onclick="logout(); return false;" style="margin-left: var(--spacing-md);">Logout</a>
            </div>
        </div>
    </nav>

    <!-- Home Screen -->
    <div class="screen active" id="home-screen">
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-container">
                <h1 class="hero-title">Find the perfect home service professional</h1>
                <p class="hero-subtitle">Get quality services delivered on time, every time</p>
                <div class="hero-search">
                    <div class="hero-search-wrapper">
                        <input type="text" class="hero-search-input" id="hero-search-input" placeholder="What service do you need?" oninput="filterCategories()">
                        <button class="hero-search-btn">Search</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-container">
            <!-- Profile Notification -->
            <div class="profile-notification" id="profile-notification">
                <div class="notification-content">
                    <div class="notification-text">
                        <div class="notification-title">Complete Your Profile</div>
                        <div class="notification-desc">Unlock premium features and personalized recommendations</div>
                    </div>
                    <div class="notification-actions">
                        <button class="btn btn-primary">Complete Profile</button>
                        <button class="btn btn-ghost" onclick="hideProfileNotification()">Later</button>
                    </div>
                </div>
                <button class="close-button" onclick="hideProfileNotification()"></button>
            </div>

            <!-- Premium Banner -->
            <div class="premium-banner">
                <div class="banner-content">
                    <div class="banner-title">EXCLUSIVE</div>
                    <div class="banner-subtitle">Premium Service Access</div>
                    <div class="coupon-container">
                        <div class="coupon-text">CODE: PREMIUM24</div>
                    </div>
                </div>
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='150'%3E%3Ccircle cx='75' cy='75' r='60' fill='white' opacity='0.2'/%3E%3Cpath d='M45 75 L60 90 L105 45' stroke='white' stroke-width='4' fill='none'/%3E%3C/svg%3E" alt="Premium" class="banner-image">
            </div>

            <!-- Categories Section -->
            <div class="categories-section">
                <div class="section-header">
                    <div>
                        <div class="section-title">Professional Services</div>
                        <div class="section-subtitle">Browse our wide range of home services</div>
                    </div>
                </div>
                <div class="category-grid" id="category-grid">
                    <!-- Categories will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Tasks Screen -->
    <div class="screen" id="tasks-screen">
        <div class="main-container">
            <div class="tasks-header">
                <h1 class="tasks-title">My Tasks</h1>
                <div class="tabs-row">
                    <button class="tab active" onclick="switchTaskTab('current', event)">Current Tasks</button>
                    <button class="tab" onclick="switchTaskTab('past', event)">Past Tasks</button>
                </div>
            </div>

            <div class="tasks-grid" id="tasks-container">
                <!-- Tasks will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Profile Screen -->
    <div class="screen" id="profile-screen">
        <div class="main-container">
            <div class="profile-container">
                <div class="profile-header">
                    <h1 class="profile-title">Account Settings</h1>
                </div>

                <div class="profile-card">
                    <div class="profile-info-card">
                        <img src="images/person.png" alt="Avatar" class="profile-avatar">
                        <div class="profile-info">
                            <div class="profile-name">User</div>
                            <div class="profile-email">user@example.com</div>
                        </div>
                    </div>

                    <div class="menu-item" onclick="showScreen('personal-info')">
                        <div class="menu-item-left">
                            <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <span class="menu-item-title">Personal Info</span>
                        </div>
                        <svg class="menu-item-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <div class="menu-item" onclick="showScreen('account-security')">
                        <div class="menu-item-left">
                            <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                            <span class="menu-item-title">Account & Security</span>
                        </div>
                        <svg class="menu-item-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <div class="menu-item" onclick="showScreen('payment-settings')">
                        <div class="menu-item-left">
                            <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                            </svg>
                            <span class="menu-item-title">Payment</span>
                        </div>
                        <svg class="menu-item-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <div class="menu-item" onclick="showScreen('notification-settings')">
                        <div class="menu-item-left">
                            <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                            </svg>
                            <span class="menu-item-title">Notification</span>
                        </div>
                        <svg class="menu-item-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <div class="menu-item" onclick="showScreen('help-support')">
                        <div class="menu-item-left">
                            <svg class="menu-item-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span class="menu-item-title">Help & Support</span>
                        </div>
                        <svg class="menu-item-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <button class="logout-btn" onclick="alert('Logout functionality')">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Service Detail Screen -->
    <div class="screen" id="service-detail-screen">
        <div class="service-detail-header">
            <div class="service-detail-container">
                <a href="#" class="back-button" onclick="showScreen('home'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Services
                </a>
                <div class="service-header-content" id="service-detail-header">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
        <div class="service-detail-content">
            <div class="service-info-card">
                <div class="service-info-section">
                    <h2 class="service-info-title">About This Service</h2>
                    <p class="service-info-text" id="service-about">
                        <!-- Content will be populated by JavaScript -->
                    </p>
                </div>
                <div class="service-info-section">
                    <h2 class="service-info-title">What's Included</h2>
                    <ul class="service-info-list" id="service-includes">
                        <!-- Content will be populated by JavaScript -->
                    </ul>
                </div>
            </div>
            <div class="service-cta-card">
                <h3 class="service-cta-title">Get Started</h3>
                <div class="service-cta-price" id="service-price">Starting at $50</div>
                <p class="service-cta-note">Price may vary based on requirements</p>
                <button class="btn btn-primary service-cta-btn" onclick="startSurvey()">Request Service</button>
                <button class="btn btn-ghost service-cta-btn" onclick="showScreen('home')">Browse More</button>
            </div>
        </div>
    </div>

    <!-- Survey Screen -->
    <div class="screen" id="survey-screen">
        <div class="survey-container">
            <div class="survey-header">
                <h1 class="survey-title">Service Request Form</h1>
                <p class="survey-subtitle">Please provide details about your service needs</p>
            </div>
            <form class="survey-form" id="survey-form" onsubmit="submitSurvey(event)">
                <div class="form-group">
                    <label class="form-label">Service Type <span class="required">*</span></label>
                    <input type="text" class="form-input" id="survey-service" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Preferred Date <span class="required">*</span></label>
                    <input type="date" class="form-input" id="survey-date" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Preferred Time <span class="required">*</span></label>
                    <select class="form-select" id="survey-time" required>
                        <option value="">Select time</option>
                        <option value="morning">Morning (8:00 AM - 12:00 PM)</option>
                        <option value="afternoon">Afternoon (12:00 PM - 5:00 PM)</option>
                        <option value="evening">Evening (5:00 PM - 8:00 PM)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Service Location <span class="required">*</span></label>
                    <input type="text" class="form-input" id="survey-location" placeholder="Enter your address" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Urgency Level <span class="required">*</span></label>
                    <div class="form-radio-group">
                        <label class="form-radio">
                            <input type="radio" name="urgency" value="low" required>
                            <span>Low - Can wait a few days</span>
                        </label>
                        <label class="form-radio">
                            <input type="radio" name="urgency" value="medium" required>
                            <span>Medium - Within 24-48 hours</span>
                        </label>
                        <label class="form-radio">
                            <input type="radio" name="urgency" value="high" required>
                            <span>High - Emergency, need ASAP</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Service Description <span class="required">*</span></label>
                    <textarea class="form-textarea" id="survey-description" placeholder="Describe what you need..." required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Additional Requirements</label>
                    <div class="form-checkbox-group">
                        <label class="form-checkbox">
                            <input type="checkbox" name="requirements" value="materials">
                            <span>I need materials/supplies</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" name="requirements" value="permit">
                            <span>Permit may be required</span>
                        </label>
                        <label class="form-checkbox">
                            <input type="checkbox" name="requirements" value="followup">
                            <span>Follow-up service needed</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Contact Phone <span class="required">*</span></label>
                    <input type="tel" class="form-input" id="survey-phone" placeholder="+1234567890" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-ghost" onclick="goBackFromSurvey()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Submit Request</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Detail Screen -->
    <div class="screen" id="task-detail-screen">
        <div class="task-detail-container">
            <div class="task-detail-header">
                <a href="#" class="back-button" onclick="showScreen('tasks'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Tasks
                </a>
                <h1 class="task-detail-title" id="task-detail-title">Task Details</h1>
                <span class="task-status-badge" id="task-status-badge">Pending</span>
            </div>
            <div class="task-detail-card">
                <div class="task-detail-section">
                    <h2 class="task-detail-section-title">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        Task Information
                    </h2>
                    <div class="task-detail-info" id="task-detail-info">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                </div>
                <div class="task-detail-section">
                    <h2 class="task-detail-section-title">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Description
                    </h2>
                    <p class="task-description" id="task-description"></p>
                </div>
                <div class="task-detail-section">
                    <h2 class="task-detail-section-title">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Assigned Provider
                    </h2>
                    <div class="task-provider-card" id="task-provider-card">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Screen -->
    <div class="screen" id="invoice-screen">
        <div class="invoice-container">
            <div class="invoice-header">
                <h1 class="invoice-title">Invoice</h1>
            </div>
            <div class="invoice-card">
                <div class="invoice-header-section">
                    <div class="invoice-company-info">
                        <h2>HomeFix</h2>
                        <p>123 Service Street<br>Accra, Ghana<br>Phone: +233 XX XXX XXXX</p>
                    </div>
                    <div class="invoice-details">
                        <div>
                            <div class="invoice-details-label">Invoice Number</div>
                            <div class="invoice-details-value" id="invoice-number">INV-2025-001</div>
                        </div>
                        <div>
                            <div class="invoice-details-label">Date</div>
                            <div class="invoice-details-value" id="invoice-date">Mon Mar 10, 2025</div>
                        </div>
                        <div>
                            <div class="invoice-details-label">Status</div>
                            <div class="invoice-details-value">Paid</div>
                        </div>
                    </div>
                </div>
                <table class="invoice-items-table">
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Quantity</th>
                            <th>Unit Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="invoice-items">
                        <!-- Content will be populated by JavaScript -->
                    </tbody>
                </table>
                <div class="invoice-total-section">
                    <div class="invoice-total-table">
                        <div class="invoice-total-row">
                            <span>Subtotal</span>
                            <span id="invoice-subtotal">$0.00</span>
                        </div>
                        <div class="invoice-total-row">
                            <span>Tax (10%)</span>
                            <span id="invoice-tax">$0.00</span>
                        </div>
                        <div class="invoice-total-row total">
                            <span>Total</span>
                            <span id="invoice-total">$0.00</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="invoice-actions">
                <button class="btn btn-primary" onclick="window.print()">Print Invoice</button>
                <button class="btn btn-ghost" onclick="showScreen('tasks')">Back to Tasks</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Screen -->
    <div class="screen" id="confirmation-screen">
        <div class="confirmation-container">
            <div class="confirmation-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h1 class="confirmation-title">Request Submitted Successfully!</h1>
            <p class="confirmation-message">
                Your service request has been received. Our team will review your request and assign a qualified professional to your task. You'll receive a notification once a provider has been assigned.
            </p>
            <div class="confirmation-details" id="confirmation-details">
                <!-- Content will be populated by JavaScript -->
            </div>
            <div class="confirmation-actions">
                <button class="btn btn-primary" onclick="showScreen('tasks')">View My Tasks</button>
                <button class="btn btn-ghost" onclick="showScreen('home')">Browse More Services</button>
            </div>
        </div>
    </div>

    <!-- Personal Info Settings -->
    <div class="screen" id="personal-info-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('profile'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Settings
                </a>
                <h1 class="settings-title">Personal Information</h1>
                <p class="settings-subtitle">Update your personal details and profile information</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">Profile Photo</h2>
                    <div class="avatar-upload">
                        <img src="images/person.png" alt="Avatar" class="avatar-preview" id="avatar-preview">
                        <div class="avatar-upload-actions">
                            <button type="button" class="btn btn-primary avatar-upload-btn" onclick="document.getElementById('avatar-input').click()">Change Photo</button>
                            <button type="button" class="btn btn-ghost avatar-upload-btn" onclick="removeAvatar()">Remove</button>
                            <input type="file" id="avatar-input" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
                            <p class="avatar-upload-note">JPG, PNG or GIF. Max size 2MB</p>
                        </div>
                    </div>
                </div>

                <form onsubmit="savePersonalInfo(event)">
                    <div class="settings-section">
                        <h2 class="settings-section-title">Basic Information</h2>
                        <div class="form-row">
                            <div class="form-group-settings">
                                <label class="form-label-settings">First Name <span class="required">*</span></label>
                                <input type="text" class="form-input" id="first-name" value="User" required>
                            </div>
                            <div class="form-group-settings">
                                <label class="form-label-settings">Last Name <span class="required">*</span></label>
                                <input type="text" class="form-input" id="last-name" value="" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group-settings">
                                <label class="form-label-settings">Email <span class="required">*</span></label>
                                <input type="email" class="form-input" id="email" value="user@example.com" required>
                                <p class="form-hint">This email will be used for account notifications</p>
                            </div>
                            <div class="form-group-settings">
                                <label class="form-label-settings">Phone Number</label>
                                <input type="tel" class="form-input" id="phone" value="" placeholder="+1234567890">
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2 class="settings-section-title">Location</h2>
                        <div class="form-row">
                            <div class="form-group-settings">
                                <label class="form-label-settings">Address</label>
                                <input type="text" class="form-input" id="address" placeholder="Street address">
                            </div>
                            <div class="form-group-settings">
                                <label class="form-label-settings">City</label>
                                <input type="text" class="form-input" id="city" value="Accra">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group-settings">
                                <label class="form-label-settings">State/Region</label>
                                <input type="text" class="form-input" id="state" value="">
                            </div>
                            <div class="form-group-settings">
                                <label class="form-label-settings">Country</label>
                                <input type="text" class="form-input" id="country" value="Ghana">
                            </div>
                        </div>
                    </div>

                    <div class="settings-actions">
                        <button type="button" class="btn btn-ghost" onclick="showScreen('profile')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Account & Security Settings -->
    <div class="screen" id="account-security-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('profile'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Settings
                </a>
                <h1 class="settings-title">Account & Security</h1>
                <p class="settings-subtitle">Manage your account security and privacy settings</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">Password</h2>
                    <form onsubmit="changePassword(event)">
                        <div class="form-group-settings">
                            <label class="form-label-settings">Current Password <span class="required">*</span></label>
                            <input type="password" class="form-input" id="current-password" required>
                        </div>
                        <div class="form-group-settings">
                            <label class="form-label-settings">New Password <span class="required">*</span></label>
                            <input type="password" class="form-input" id="new-password" required>
                            <p class="form-hint">Must be at least 8 characters with letters and numbers</p>
                        </div>
                        <div class="form-group-settings">
                            <label class="form-label-settings">Confirm New Password <span class="required">*</span></label>
                            <input type="password" class="form-input" id="confirm-password" required>
                        </div>
                        <div class="settings-actions">
                            <button type="submit" class="btn btn-primary">Update Password</button>
                        </div>
                    </form>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Security Features</h2>
                    <div class="security-item">
                        <div class="security-item-info">
                            <div class="security-item-title">Two-Factor Authentication</div>
                            <div class="security-item-desc">Add an extra layer of security to your account</div>
                        </div>
                        <span class="security-status inactive">Inactive</span>
                        <button class="btn btn-ghost" style="margin-left: var(--spacing-md);" onclick="alert('Enable 2FA')">Enable</button>
                    </div>
                    <div class="security-item">
                        <div class="security-item-info">
                            <div class="security-item-title">Login Alerts</div>
                            <div class="security-item-desc">Get notified when someone logs into your account</div>
                        </div>
                        <span class="security-status active">Active</span>
                    </div>
                    <div class="security-item">
                        <div class="security-item-info">
                            <div class="security-item-title">Active Sessions</div>
                            <div class="security-item-desc">Manage devices where you're logged in</div>
                        </div>
                        <button class="btn btn-ghost" onclick="alert('View Sessions')">View All</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Settings -->
    <div class="screen" id="payment-settings-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('profile'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Settings
                </a>
                <h1 class="settings-title">Payment Methods</h1>
                <p class="settings-subtitle">Manage your payment methods and billing information</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">Payment Methods</h2>
                    <div style="padding: var(--spacing-lg); background: var(--neutral-50); border-radius: var(--radius-lg);">
                        <p style="margin-bottom: var(--spacing-md); color: var(--neutral-700);">
                            <strong> Paystack Payment Gateway</strong>
                        </p>
                        <p style="color: var(--neutral-600); font-size: 14px; line-height: 1.6; margin-bottom: var(--spacing-md);">
                            We use Paystack for secure payment processing. When you make a payment, you'll be redirected to Paystack's secure payment page where you can choose from:
                        </p>
                        <ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-600); font-size: 14px; line-height: 1.8;">
                            <li> Debit/Credit Cards (Visa, Mastercard, Verve)</li>
                            <li> Mobile Money (MTN, Vodafone, AirtelTigo)</li>
                            <li> Bank Transfer</li>
                            <li> USSD</li>
                        </ul>
                        <p style="margin-top: var(--spacing-md); color: var(--neutral-600); font-size: 14px;">
                            <strong> Security:</strong> Your payment information is securely processed by Paystack. We never store your card or account details.
                        </p>
                    </div>
                </div>

                <div class="settings-section" id="add-payment-section" style="display: none;">
                    <h2 class="settings-section-title">Payment Information</h2>
                    <div style="padding: var(--spacing-lg); background: var(--neutral-50); border-radius: var(--radius-lg); margin-bottom: var(--spacing-lg);">
                        <p style="margin-bottom: var(--spacing-md); color: var(--neutral-700);">
                            <strong> Paystack Payment Gateway</strong>
                        </p>
                        <p style="color: var(--neutral-600); font-size: 14px; line-height: 1.6;">
                            We use Paystack for secure payments. You can pay using:
                        </p>
                        <ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg); color: var(--neutral-600); font-size: 14px;">
                            <li>Debit/Credit Cards (Visa, Mastercard, Verve)</li>
                            <li>Mobile Money (MTN, Vodafone, AirtelTigo)</li>
                            <li>Bank Transfer</li>
                            <li>USSD</li>
                        </ul>
                        <p style="margin-top: var(--spacing-md); color: var(--neutral-600); font-size: 14px;">
                            Your payment information is securely processed by Paystack. We never store your card details.
                        </p>
                    </div>
                    <div class="settings-actions">
                        <button type="button" class="btn btn-ghost" onclick="hideAddPaymentMethod()">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Settings -->
    <div class="screen" id="notification-settings-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('profile'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Settings
                </a>
                <h1 class="settings-title">Notification Preferences</h1>
                <p class="settings-subtitle">Choose how you want to be notified</p>
            </div>

            <div class="settings-card">
                <div class="settings-section">
                    <h2 class="settings-section-title">Email Notifications</h2>
                    <div class="notification-group">
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">Service Updates</div>
                                <div class="notification-item-desc">Get notified about your service requests and appointments</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked onchange="updateNotification('email-service', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">Provider Assignment</div>
                                <div class="notification-item-desc">Notifications when a provider is assigned to your task</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked onchange="updateNotification('email-provider', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">Payment & Invoices</div>
                                <div class="notification-item-desc">Receive invoices and payment confirmations</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked onchange="updateNotification('email-payment', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">Promotions & Offers</div>
                                <div class="notification-item-desc">Special deals and promotional offers</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" onchange="updateNotification('email-promo', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h2 class="settings-section-title">Push Notifications</h2>
                    <div class="notification-group">
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">Enable Push Notifications</div>
                                <div class="notification-item-desc">Receive notifications on your device</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked onchange="updateNotification('push-enabled', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="notification-item">
                            <div class="notification-item-info">
                                <div class="notification-item-title">Task Reminders</div>
                                <div class="notification-item-desc">Reminders for upcoming service appointments</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked onchange="updateNotification('push-reminders', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help & Support -->
    <div class="screen" id="help-support-screen">
        <div class="settings-container">
            <div class="settings-header">
                <a href="#" class="back-button" onclick="showScreen('profile'); return false;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Settings
                </a>
                <h1 class="settings-title">Help & Support</h1>
                <p class="settings-subtitle">Get help and find answers to common questions</p>
            </div>

            <div class="help-categories">
                <div class="help-category-card" onclick="alert('Getting Started Guide')">
                    <div class="help-category-icon">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <div class="help-category-title">Getting Started</div>
                    <div class="help-category-desc">Learn how to use HomeFix</div>
                </div>
                <div class="help-category-card" onclick="alert('Booking Help')">
                    <div class="help-category-icon">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                    <div class="help-category-title">Booking Services</div>
                    <div class="help-category-desc">How to book and manage services</div>
                </div>
                <div class="help-category-card" onclick="alert('Payment Help')">
                    <div class="help-category-icon">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                        </svg>
                    </div>
                    <div class="help-category-title">Payments & Billing</div>
                    <div class="help-category-desc">Payment methods and invoices</div>
                </div>
                <div class="help-category-card" onclick="alert('Account Help')">
                    <div class="help-category-icon">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <div class="help-category-title">Account Settings</div>
                    <div class="help-category-desc">Manage your account</div>
                </div>
            </div>

            <div class="faq-section">
                <h2 class="settings-section-title">Frequently Asked Questions</h2>
                <div class="faq-item" onclick="toggleFAQ(this)">
                    <div class="faq-question">
                        <span class="faq-question-text">How do I book a service?</span>
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="faq-answer">Browse our services, select the one you need, fill out the service request form with your requirements, and submit. Our team will assign a qualified professional to your task.</div>
                </div>
                <div class="faq-item" onclick="toggleFAQ(this)">
                    <div class="faq-question">
                        <span class="faq-question-text">How are service providers assigned?</span>
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="faq-answer">Our admin team reviews your service request and assigns the most qualified provider based on your location, service type, and requirements. You'll be notified once a provider is assigned.</div>
                </div>
                <div class="faq-item" onclick="toggleFAQ(this)">
                    <div class="faq-question">
                        <span class="faq-question-text">What payment methods are accepted?</span>
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="faq-answer">We accept payments through Paystack, which supports multiple payment methods including debit/credit cards, mobile money (MTN, Vodafone, AirtelTigo), bank transfers, and USSD. All payments are processed securely through Paystack's payment gateway.</div>
                </div>
                <div class="faq-item" onclick="toggleFAQ(this)">
                    <div class="faq-question">
                        <span class="faq-question-text">Can I cancel or reschedule a service?</span>
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="faq-answer">Yes, you can cancel or reschedule your service request from the task details page. Please note that cancellation policies may apply depending on the timing.</div>
                </div>
                <div class="faq-item" onclick="toggleFAQ(this)">
                    <div class="faq-question">
                        <span class="faq-question-text">How do I contact support?</span>
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="faq-answer">You can contact our support team through the contact form below, email us at support@homefix.com, or call us at +233 XX XXX XXXX during business hours.</div>
                </div>
            </div>

            <div class="contact-support">
                <h3 class="contact-support-title">Still need help?</h3>
                <p class="contact-support-desc">Our support team is here to assist you</p>
                <div style="display: flex; gap: var(--spacing-md); justify-content: center; margin-top: var(--spacing-lg);">
                    <button class="btn btn-primary" onclick="alert('Contact Support')">Contact Support</button>
                    <button class="btn btn-ghost" onclick="alert('Live Chat')">Live Chat</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Service Categories Data with descriptions
        const serviceCategories = [
            { 
                key: 'cleaning', 
                label: 'Cleaning Services', 
                description: 'Professional cleaning for your home or office',
                icon: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z',
                image: 'images/cleaning-service.png'
            },
            { 
                key: 'plumbing', 
                label: 'Plumbing', 
                description: 'Expert plumbers for repairs and installations',
                icon: 'M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z',
                image: 'images/plumbing.png'
            },
            { 
                key: 'electrical', 
                label: 'Electrical', 
                description: 'Licensed electricians for all your electrical needs',
                icon: 'M13 10V3L4 14h7v7l9-11h-7z',
                image: 'images/electrical.png'
            },
            { 
                key: 'carpentry', 
                label: 'Carpentry', 
                description: 'Skilled carpenters for custom woodwork',
                icon: 'M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4',
                image: 'images/Carpentry.png'
            },
            { 
                key: 'painting', 
                label: 'Painting', 
                description: 'Professional painters for interior and exterior',
                icon: 'M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01',
                image: 'images/Painting.png'
            },
            { 
                key: 'gardening', 
                label: 'Gardening', 
                description: 'Landscaping and garden maintenance services',
                icon: 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253',
                image: 'images/gardener-garden-with-hut-cuts-tree-with-hedgehogs-against-sky.jpg'
            },
        ];

        // Mock Tasks Data
        const mockTasks = {
            current: [
                {
                    id: 't1',
                    title: 'Plumbing Repair',
                    date: 'Wed Apr 23, 2025',
                    time: '11:30 AM',
                    assignee: 'Samuel',
                    status: 'current',
                    hasInvoice: false
                }
            ],
            past: [
                {
                    id: 't0',
                    title: 'TV Mount Installation',
                    date: 'Mon Mar 10, 2025',
                    time: '02:00 PM',
                    assignee: 'Ava',
                    status: 'past',
                    hasInvoice: true
                }
            ]
        };

        let currentTaskTab = 'current';

        // Initialize
        function init() {
            renderCategories();
            renderTasks();
            // Show profile notification if needed
            setTimeout(() => {
                document.getElementById('profile-notification').classList.add('show');
            }, 1000);
        }

        // Screen Navigation
        async function showScreen(screen) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            
            // Show selected screen
            document.getElementById(`${screen}-screen`).classList.add('active');
            
            // Load tasks when tasks screen is shown
            if (screen === 'tasks') {
                renderTasks();
            }
            
            // Load profile data when profile screen is shown
            if (screen === 'profile') {
                await loadProfileData();
            }
            
            // Load personal info when personal-info screen is shown
            if (screen === 'personal-info') {
                await loadPersonalInfo();
            }
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
        
        // Load profile data from Firestore
        async function loadProfileData() {
            try {
                const currentUser = firebaseAuth.getCurrentUser();
                if (!currentUser) {
                    console.warn('No user logged in');
                    return;
                }
                
                const userDataResult = await firebaseUsers.getUser(currentUser.uid);
                if (userDataResult.success) {
                    const userData = userDataResult.data;
                    
                    // Update profile display
                    const profileName = document.querySelector('.profile-name');
                    const profileEmail = document.querySelector('.profile-email');
                    
                    if (profileName) {
                        profileName.textContent = userData.name || 'User';
                    }
                    if (profileEmail) {
                        profileEmail.textContent = userData.email || 'user@example.com';
                    }
                }
            } catch (error) {
                console.error('Error loading profile data:', error);
            }
        }
        
        // Load personal info into form
        async function loadPersonalInfo() {
            try {
                const currentUser = firebaseAuth.getCurrentUser();
                if (!currentUser) {
                    console.warn('No user logged in');
                    return;
                }
                
                const userDataResult = await firebaseUsers.getUser(currentUser.uid);
                if (userDataResult.success) {
                    const userData = userDataResult.data;
                    
                    // Split name into first and last name
                    const nameParts = (userData.name || '').split(' ');
                    const firstName = nameParts[0] || '';
                    const lastName = nameParts.slice(1).join(' ') || '';
                    
                    // Populate form fields
                    const firstNameInput = document.getElementById('first-name');
                    const lastNameInput = document.getElementById('last-name');
                    const emailInput = document.getElementById('email');
                    const phoneInput = document.getElementById('phone');
                    const addressInput = document.getElementById('address');
                    const cityInput = document.getElementById('city');
                    const stateInput = document.getElementById('state');
                    const countryInput = document.getElementById('country');
                    
                    if (firstNameInput) firstNameInput.value = firstName;
                    if (lastNameInput) lastNameInput.value = lastName;
                    if (emailInput) emailInput.value = userData.email || '';
                    if (phoneInput) phoneInput.value = userData.phone || '';
                    if (addressInput) addressInput.value = userData.address || '';
                    if (cityInput) cityInput.value = userData.city || '';
                    if (stateInput) stateInput.value = userData.state || '';
                    if (countryInput) countryInput.value = userData.country || '';
                }
            } catch (error) {
                console.error('Error loading personal info:', error);
            }
        }

        // Render Categories
        function renderCategories(categories = serviceCategories) {
            const grid = document.getElementById('category-grid');
            grid.innerHTML = categories.map(cat => `
                <a href="#" class="category-card" onclick="selectCategory('${cat.key}'); return false;">
                    <div class="category-icon-wrapper">
                        <img src="${cat.image}" alt="${cat.label}" class="category-icon-image">
                    </div>
                    <div class="category-label">${cat.label}</div>
                    <div class="category-description">${cat.description}</div>
                </a>
            `).join('');
        }

        // Filter Categories
        function filterCategories() {
            const query = (document.getElementById('nav-search-input')?.value || 
                          document.getElementById('hero-search-input')?.value || '').toLowerCase();
            const filtered = serviceCategories.filter(cat => 
                cat.label.toLowerCase().includes(query) ||
                cat.description.toLowerCase().includes(query)
            );
            renderCategories(filtered);
        }

        // Service detail data
        const serviceDetails = {
            cleaning: {
                label: 'Cleaning Services',
                description: 'Professional cleaning services for your home or office. Our experienced team ensures a spotless environment.',
                about: 'Our professional cleaning services are designed to keep your space immaculate. We use eco-friendly products and modern techniques to ensure a thorough clean while being safe for your family and pets.',
                includes: [
                    'Deep cleaning of all rooms',
                    'Kitchen and bathroom sanitization',
                    'Dusting and vacuuming',
                    'Window cleaning',
                    'Trash removal',
                    'Eco-friendly cleaning products'
                ],
                price: 'Starting at $50',
                icon: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z',
                image: 'images/cleaning-service.png',
                backgroundImage: 'images/bucket-with-cleaning-products-defocused-father-son.jpg'
            },
            plumbing: {
                label: 'Plumbing',
                description: 'Expert plumbers for all your plumbing repairs and installations.',
                about: 'Our licensed plumbers handle everything from minor leaks to major installations. We provide 24/7 emergency services and guarantee our work.',
                includes: [
                    'Leak detection and repair',
                    'Pipe installation and repair',
                    'Fixture installation',
                    'Drain cleaning',
                    'Water heater service',
                    'Emergency repairs'
                ],
                price: 'Starting at $75',
                icon: 'M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z',
                image: 'images/plumbing.png',
                backgroundImage: 'images/plumber-icon.png'
            },
            electrical: {
                label: 'Electrical',
                description: 'Licensed electricians for all your electrical needs.',
                about: 'Professional electrical services with certified electricians. We ensure all work meets safety standards and local codes.',
                includes: [
                    'Electrical repairs',
                    'Wiring installation',
                    'Outlet and switch installation',
                    'Circuit breaker service',
                    'Light fixture installation',
                    'Safety inspections'
                ],
                price: 'Starting at $80',
                icon: 'M13 10V3L4 14h7v7l9-11h-7z',
                image: 'images/electrical.png',
                backgroundImage: 'images/electric-machines-switches-isolated-white-close-up-connect-marker-cable-device-with-red-screwdriver.jpg'
            },
            carpentry: {
                label: 'Carpentry',
                description: 'Skilled carpenters for custom woodwork and repairs.',
                about: 'Expert carpentry services for custom projects, repairs, and installations. Quality craftsmanship guaranteed.',
                includes: [
                    'Custom furniture',
                    'Cabinet installation',
                    'Door and window repair',
                    'Deck and fence construction',
                    'Trim and molding',
                    'Shelving installation'
                ],
                price: 'Starting at $60',
                icon: 'M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4',
                image: 'images/Carpentry.png',
                backgroundImage: 'images/man-wears-safety-goggles-while-using-chisel-hammer-avoid-injury.jpg'
            },
            painting: {
                label: 'Painting',
                description: 'Professional painters for interior and exterior painting.',
                about: 'Transform your space with professional painting services. We use premium paints and proper preparation techniques.',
                includes: [
                    'Interior painting',
                    'Exterior painting',
                    'Color consultation',
                    'Surface preparation',
                    'Primer application',
                    'Clean-up included'
                ],
                price: 'Starting at $100',
                icon: 'M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01',
                image: 'images/Painting.png',
                backgroundImage: 'images/male-hand-paints-with-white-paint-wood.jpg'
            },
            gardening: {
                label: 'Gardening',
                description: 'Landscaping and garden maintenance services.',
                about: 'Keep your outdoor space beautiful with our professional landscaping and garden maintenance services.',
                includes: [
                    'Lawn mowing and care',
                    'Garden design',
                    'Planting and pruning',
                    'Weed control',
                    'Fertilization',
                    'Seasonal cleanup'
                ],
                price: 'Starting at $40',
                icon: 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253',
                image: 'images/gardener-garden-with-hut-cuts-tree-with-hedgehogs-against-sky.png',
                backgroundImage: 'images/gardener-garden-with-hut-cuts-tree-with-hedgehogs-against-sky.png'
            }
        };

        let currentServiceKey = null;

        // Select Category
        function selectCategory(key) {
            currentServiceKey = key;
            const service = serviceDetails[key];
            if (!service) return;

            // Populate service detail header
            const header = document.getElementById('service-detail-header');
            // Set background image if available
            if (service.backgroundImage) {
                header.style.backgroundImage = `linear-gradient(135deg, rgba(165, 59, 43, 0.1) 0%, rgba(255, 255, 255, 0.9) 100%), url('${service.backgroundImage}')`;
            }
            header.innerHTML = `
                <div class="service-icon-large">
                    <img src="${service.image || 'images/logo.png'}" alt="${service.label}">
                </div>
                <div class="service-header-text">
                    <h1>${service.label}</h1>
                    <p>${service.description}</p>
                    <div class="service-features">
                        <div class="service-feature">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>Licensed Professionals</span>
                        </div>
                        <div class="service-feature">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>24/7 Support</span>
                        </div>
                        <div class="service-feature">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                            <span>Guaranteed Quality</span>
                        </div>
                    </div>
                </div>
            `;

            // Populate service info
            document.getElementById('service-about').textContent = service.about;
            document.getElementById('service-price').textContent = service.price;
            
            const includesList = document.getElementById('service-includes');
            includesList.innerHTML = service.includes.map(item => `
                <li>
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    ${item}
                </li>
            `).join('');

            showScreen('service-detail');
        }

        // Start Survey
        function startSurvey() {
            if (!currentServiceKey) return;
            const service = serviceDetails[currentServiceKey];
            document.getElementById('survey-service').value = service.label;
            showScreen('survey');
        }

        // Go back from survey
        function goBackFromSurvey() {
            showScreen('service-detail');
        }

        // Submit Survey
        async function submitSurvey(event) {
            try {
                event.preventDefault();
                console.log(' Survey form submitted');
                
                // Get form values with error checking
                const serviceEl = document.getElementById('survey-service');
                const dateEl = document.getElementById('survey-date');
                const timeEl = document.getElementById('survey-time');
                const locationEl = document.getElementById('survey-location');
                const urgencyEl = document.querySelector('input[name="urgency"]:checked');
                const descriptionEl = document.getElementById('survey-description');
                const phoneEl = document.getElementById('survey-phone');
                
                if (!serviceEl || !dateEl || !timeEl || !locationEl || !urgencyEl || !descriptionEl || !phoneEl) {
                    console.error(' Missing form elements:', {
                        service: !!serviceEl,
                        date: !!dateEl,
                        time: !!timeEl,
                        location: !!locationEl,
                        urgency: !!urgencyEl,
                        description: !!descriptionEl,
                        phone: !!phoneEl
                    });
                    alert('Error: Some form fields are missing. Please refresh the page and try again.');
                    return;
                }
                
                const formData = {
                    service: serviceEl.value,
                    date: dateEl.value,
                    time: timeEl.value,
                    location: locationEl.value,
                    urgency: urgencyEl.value,
                    description: descriptionEl.value,
                    phone: phoneEl.value,
                    requirements: Array.from(document.querySelectorAll('input[name="requirements"]:checked')).map(cb => cb.value)
                };
                
                console.log(' Form data collected:', formData);
                
                // Validate required fields
                if (!formData.service || !formData.date || !formData.time || !formData.location || !formData.urgency || !formData.description || !formData.phone) {
                    alert('Please fill in all required fields.');
                    console.error(' Missing required fields');
                    return;
                }

                // Get current user - must be logged in
                const currentUser = firebaseAuth.getCurrentUser();
                console.log(' Current user check:', currentUser ? { uid: currentUser.uid, email: currentUser.email } : 'Not logged in');
                
                if (!currentUser || !currentUser.uid) {
                    alert('Please sign in to submit a service request.');
                    showAuthPage('signin');
                    return;
                }
                
                // Get user information
                let userData = await sessionDB.get('homefix_user') || {};
                let userName = userData.name;
                let userEmail = userData.email || currentUser.email;
                
                // If name not available, try to get from Firebase user data
                if (!userName) {
                    const userDataResult = await firebaseUsers.getUser(currentUser.uid);
                    if (userDataResult.success && userDataResult.data) {
                        userName = userDataResult.data.name;
                        userEmail = userDataResult.data.email || userEmail;
                    }
                }
                
                // Fallback to email username if no name
                if (!userName) {
                    userName = userEmail ? userEmail.split('@')[0] : 'User';
                }
                
                console.log('Creating request for user:', { uid: currentUser.uid, userName, userEmail, service: formData.service });
                
                const newRequest = {
                    clientUid: currentUser.uid, // Store user ID for easy querying
                    clientName: userName || 'User',
                    clientEmail: userEmail || '',
                    clientPhone: formData.phone,
                    service: formData.service,
                    description: formData.description,
                    location: formData.location,
                    date: new Date(formData.date).toLocaleDateString(),
                    preferredTime: formData.time,
                    urgency: formData.urgency,
                    requirements: formData.requirements,
                    status: 'pending'
                };
                
                // Save request to Firestore
                console.log(' Saving request to Firestore...');
                const result = await firebaseRequests.createRequest(newRequest);
                
                if (!result.success) {
                    alert('Error creating request: ' + (result.error || 'Unknown error') + '. Please try again.');
                    console.error(' Error creating request:', result.error);
                    return;
                }
                
                newRequest.id = result.id; // Store the generated ID
                console.log(' Request created successfully:', newRequest.id, newRequest);

                // Populate confirmation details
                const confirmationDetails = document.getElementById('confirmation-details');
                if (!confirmationDetails) {
                    console.error(' Confirmation details element not found');
                    alert('Request created but confirmation screen not found. Request ID: ' + newRequest.id);
                    showScreen('tasks'); // Fallback to tasks screen
                    return;
                }
                
                confirmationDetails.innerHTML = `
                    <div class="confirmation-details-item">
                        <span class="confirmation-details-label">Service</span>
                        <span class="confirmation-details-value">${formData.service}</span>
                    </div>
                    <div class="confirmation-details-item">
                        <span class="confirmation-details-label">Date</span>
                        <span class="confirmation-details-value">${new Date(formData.date).toLocaleDateString()}</span>
                    </div>
                    <div class="confirmation-details-item">
                        <span class="confirmation-details-label">Time</span>
                        <span class="confirmation-details-value">${formData.time}</span>
                    </div>
                    <div class="confirmation-details-item">
                        <span class="confirmation-details-label">Location</span>
                        <span class="confirmation-details-value">${formData.location}</span>
                    </div>
                    <div class="confirmation-details-item">
                        <span class="confirmation-details-label">Urgency</span>
                        <span class="confirmation-details-value">${formData.urgency.charAt(0).toUpperCase() + formData.urgency.slice(1)}</span>
                    </div>
                `;

                console.log(' Survey submitted successfully');
                console.log(' Request details:', newRequest);
                
                showScreen('confirmation');
            } catch (error) {
                console.error(' Error in submitSurvey:', error);
                alert('An error occurred while submitting your request: ' + error.message + '. Please try again.');
            }
        }

        // Task Tab Switching
        function switchTaskTab(tab, event) {
            currentTaskTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // Fallback: find the button by tab value
                document.querySelectorAll('.tab').forEach(btn => {
                    if (btn.textContent.trim().toLowerCase().includes(tab === 'current' ? 'current' : 'past')) {
                        btn.classList.add('active');
                    }
                });
            }
            renderTasks();
        }

        // Render Tasks
        async function renderTasks() {
            const container = document.getElementById('tasks-container');
            
            if (!container) {
                console.error('Tasks container not found');
                return;
            }
            
            // Get current user - must be logged in
            const currentUser = firebaseAuth.getCurrentUser();
            
            if (!currentUser || !currentUser.uid) {
                console.error(' No user logged in');
                container.innerHTML = '<div style="text-align: center; padding: 60px; color: var(--neutral-500); font-size: 18px;">Please sign in to view your requests</div>';
                return;
            }
            
            console.log(' Current user UID:', currentUser.uid);
            
            // Show loading state
            container.innerHTML = '<div style="text-align: center; padding: 60px; color: var(--neutral-500); font-size: 18px;">Loading your requests...</div>';
            
            // Load user's actual requests from Firestore using UID
            console.log(' Fetching requests for user UID:', currentUser.uid);
            const result = await firebaseRequests.getUserRequests(currentUser.uid);
            console.log(' getUserRequests result:', {
                success: result.success,
                count: result.data ? result.data.length : 0,
                error: result.error
            });
            
            if (!result.success) {
                console.error(' Error loading requests:', result.error);
                container.innerHTML = `<div style="text-align: center; padding: 60px; color: var(--error-500); font-size: 18px;">Error loading requests: ${result.error}</div>`;
                return;
            }
            
            const userRequests = result.data || [];
            console.log(` User requests found: ${userRequests.length}`, userRequests.map(r => ({
                id: r.id,
                service: r.service,
                status: r.status,
                clientEmail: r.clientEmail
            })));
            
            // Convert Firestore timestamps to dates
            userRequests.forEach(request => {
                if (request.createdAt) {
                    const date = convertTimestamp(request.createdAt);
                    request.createdAt = date.toISOString();
                    if (!request.date) {
                        request.date = date.toLocaleDateString();
                    }
                }
            });
            
            // Filter by tab (current = pending/assigned, past = completed or has invoice)
            let filteredRequests = [];
            console.log(` Filtering requests. Current tab: "${currentTaskTab}"`);
            console.log(' All user requests:', userRequests.map(r => ({ 
                id: r.id, 
                service: r.service, 
                status: r.status, 
                hasInvoice: !!r.invoice,
                clientEmail: r.clientEmail 
            })));
            
            if (currentTaskTab === 'current') {
                // Current tasks: pending or assigned (but not completed and not invoiced)
                filteredRequests = userRequests.filter(r => {
                    const isCurrent = (r.status === 'pending' || r.status === 'assigned') && !r.invoice;
                    if (isCurrent) {
                        console.log(` Current task: ${r.id} - ${r.service} (${r.status})`);
                    }
                    return isCurrent;
                });
            } else {
                // Past tasks: completed OR has invoice (invoiced requests are considered done)
                filteredRequests = userRequests.filter(r => {
                    const isPast = r.status === 'completed' || r.invoice;
                    if (isPast) {
                        console.log(` Past task: ${r.id} - ${r.service} (${r.status}, invoice: ${!!r.invoice})`);
                    }
                    return isPast;
                });
            }
            
            console.log(` Filtered requests: ${filteredRequests.length} for "${currentTaskTab}" tab`);
            
            // Sort by date (newest first)
            filteredRequests.sort((a, b) => new Date(b.createdAt || b.date) - new Date(a.createdAt || a.date));
            
            if (filteredRequests.length === 0) {
                const message = `No ${currentTaskTab === 'current' ? 'active' : 'completed'} requests found. Total requests: ${userRequests.length}`;
                console.log(message);
                container.innerHTML = `<div style="text-align: center; padding: 60px; color: var(--neutral-500); font-size: 18px;">${message}</div>`;
                return;
            }

            container.innerHTML = filteredRequests.map(request => {
                const statusClass = request.status === 'pending' ? 'pending' : request.status === 'assigned' ? 'assigned' : 'completed';
                const statusText = request.status === 'pending' ? 'Pending' : request.status === 'assigned' ? 'Assigned' : 'Completed';
                
                return `
                <div class="task-card">
                    <div class="task-card-header">
                        <div class="task-card-header-text">${request.invoice ? 'Invoice Sent' : statusText}</div>
                    </div>
                    <div class="task-card-body">
                        <div class="task-card-title">${request.service}</div>
                        <div class="task-card-row">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--neutral-500);">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            ${request.date || 'N/A'}
                        </div>
                        <div class="task-card-row">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--neutral-500);">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            ${request.location || 'Location not specified'}
                        </div>
                        ${request.description ? `
                        <div style="padding: var(--spacing-sm) 0; color: var(--neutral-600); font-size: 14px; border-top: 1px solid var(--neutral-200); margin-top: var(--spacing-sm); padding-top: var(--spacing-sm);">
                            ${request.description.length > 100 ? request.description.substring(0, 100) + '...' : request.description}
                        </div>
                        ` : ''}
                        ${request.provider ? `
                        <div style="padding: var(--spacing-md); background: var(--primary-50); border-radius: var(--radius-md); margin-top: var(--spacing-md); border-left: 4px solid var(--primary-500);">
                            <div style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-xs);">
                                <img src="images/person.png" alt="${request.provider.name}" class="task-avatar" style="width: 32px; height: 32px; border-radius: 50%;">
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: var(--primary-700);">${request.provider.name}</div>
                                    <div style="font-size: 13px; color: var(--neutral-600);">${request.provider.specialization}</div>
                                </div>
                            </div>
                            <div style="font-size: 13px; color: var(--neutral-600); margin-top: var(--spacing-xs);">
                                 ${request.provider.phone} |  ${request.provider.email}
                            </div>
                        </div>
                        ` : request.status === 'pending' ? `
                        <div style="padding: var(--spacing-md); background: var(--neutral-50); border-radius: var(--radius-md); margin-top: var(--spacing-md); border-left: 4px solid var(--neutral-400);">
                            <div style="font-size: 14px; color: var(--neutral-600);"> Waiting for provider assignment...</div>
                        </div>
                        ` : ''}
                        ${request.invoice ? `
                        <div style="padding: var(--spacing-md); background: ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? 'linear-gradient(135deg, #F0FDF4 0%, #DCFCE7 100%)' : 'linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%)'}; border: 2px solid ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? '#86EFAC' : '#FCD34D'}; border-radius: var(--radius-md); margin-top: var(--spacing-md);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 12px; color: ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? '#166534' : '#92400E'}; font-weight: 600; text-transform: uppercase; margin-bottom: var(--spacing-xs);">
                                        ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? ' Invoice Paid' : ' Invoice Pending Payment'}
                                    </div>
                                    <div style="font-size: 20px; color: ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? '#166534' : '#92400E'}; font-weight: 800;">${request.invoice.total.toFixed(2)}</div>
                                    <div style="font-size: 12px; color: ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? '#166534' : '#92400E'}; margin-top: var(--spacing-xs);">
                                        Invoice ID: ${request.invoice.id || 'N/A'}
                                        ${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? `  Paid via ${request.invoice.paymentMethod || 'Paystack'}` : ''}
                                    </div>
                                </div>
                                <div style="font-size: 32px;">${request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid' ? '' : ''}</div>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    <div class="task-card-footer" style="display: flex; gap: var(--spacing-sm);">
                        ${request.invoice && request.invoice.status !== 'paid' && request.invoice.paymentStatus !== 'paid' ? `
                        <button class="btn btn-primary" onclick="payInvoiceFromTask('${request.id}')" style="flex: 1; font-weight: 600;">
                             Pay ${request.invoice.total.toFixed(2)}
                        </button>
                        <button class="btn-text" onclick="viewUserRequest('${request.id}')" style="flex: 1; text-align: center;">
                             View Invoice
                        </button>
                        ` : `
                        <button class="btn-text" onclick="viewUserRequest('${request.id}')" style="flex: 1; text-align: center;">
                            ${request.invoice ? ' View Invoice & Details' : ' View Details'}
                        </button>
                        `}
                    </div>
                </div>
            `;
            }).join('');
        }

        // Pay Invoice from Task Card (helper function)
        async function payInvoiceFromTask(requestId) {
            try {
                // Fetch the full request data
                const requestResult = await firebaseRequests.getRequest(requestId);
                if (!requestResult.success || !requestResult.data) {
                    alert('Error: Could not load invoice details. Please try again.');
                    return;
                }
                
                const request = requestResult.data;
                
                // Check if invoice exists
                if (!request.invoice) {
                    alert('No invoice found for this request.');
                    return;
                }
                
                // Check if already paid
                if (request.invoice.status === 'paid' || request.invoice.paymentStatus === 'paid') {
                    alert('This invoice has already been paid.');
                    renderTasks(); // Refresh to show updated status
                    return;
                }
                
                // Initiate payment
                await initiatePaystackPayment(request);
            } catch (error) {
                console.error('Error in payInvoiceFromTask:', error);
                alert('An error occurred while processing your payment. Please try again.');
            }
        }

        // Initiate Paystack Payment
        async function initiatePaystackPayment(request) {
            const invoice = request.invoice;
            const amount = invoice.total;
            
            // Get user information
            const currentUser = firebaseAuth.getCurrentUser();
            if (!currentUser) {
                alert('Please sign in to make a payment.');
                return;
            }
            
            // Get user email
            const userEmail = currentUser.email;
            if (!userEmail) {
                alert('Please ensure your account has an email address to make payments.');
                return;
            }
            
            // Confirm payment
            const confirmMessage = ` Paystack Payment\n\n` +
                `Invoice ID: ${invoice.id}\n` +
                `Amount: ${amount.toFixed(2)}\n` +
                `Email: ${userEmail}\n\n` +
                `You will be redirected to Paystack to complete your payment.\n\n` +
                `Continue?`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            try {
                // Initialize Paystack payment
                const paymentResult = await paystackAPI.initializePayment(
                    userEmail,
                    amount,
                    invoice.id,
                    {
                        request_id: request.id,
                        client_name: request.clientName || 'Customer',
                        service_type: request.serviceType || 'Home Service'
                    }
                );
                
                if (paymentResult.success) {
                    // Payment successful - update invoice
                    const requestResult = await firebaseRequests.getRequest(request.id);
                    if (requestResult.success && requestResult.data) {
                        const updatedInvoice = {
                            ...request.invoice,
                            status: 'paid',
                            paymentStatus: 'paid',
                            paidAt: new Date().toISOString(),
                            transactionId: paymentResult.reference,
                            paymentMethod: 'Paystack'
                        };
                        
                        await firebaseRequests.updateRequest(request.id, {
                            invoice: updatedInvoice
                        });
                        
                        alert(` Payment Successful!\n\n` +
                            `Invoice ID: ${invoice.id}\n` +
                            `Amount Paid: ${amount.toFixed(2)}\n` +
                            `Transaction Reference: ${paymentResult.reference}\n\n` +
                            `Thank you for your payment!`);
                        
                        // Refresh tasks
                        renderTasks();
                    }
                }
            } catch (error) {
                if (error.cancelled) {
                    // User cancelled - no need to show error
                    return;
                }
                
                console.error('Paystack payment error:', error);
                alert(`Payment failed: ${error.error || error.message || 'An error occurred'}\n\nPlease try again or contact support.`);
            }
        }

        // View User Request (new function for actual user requests)
        async function viewUserRequest(requestId) {
            // Check if user is logged in using Firebase auth
            const currentUser = firebaseAuth.getCurrentUser();
            
            if (!currentUser || !currentUser.uid) {
                alert('Please sign in to view request details.');
                return;
            }
            
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            const result = await firebaseRequests.getRequest(id);
            
            if (!result.success || !result.data) {
                alert('Request not found.');
                return;
            }
            
            const request = result.data;
            
            // Convert Firestore timestamp if needed
            if (request.createdAt) {
                const date = convertTimestamp(request.createdAt);
                request.createdAt = date.toISOString();
                if (!request.date) {
                    request.date = date.toLocaleDateString();
                }
            }
            
            if (request.invoice) {
                // Show invoice with full details
                showUserInvoice(request);
            } else {
                // Show request details
                showUserRequestDetail(request);
            }
        }
        
        // Show User Request Detail
        function showUserRequestDetail(request) {
            let message = ` REQUEST DETAILS\n`;
            message += `${'='.repeat(60)}\n\n`;
            message += `Service: ${request.service || 'N/A'}\n`;
            message += `Date: ${request.date || 'N/A'}\n`;
            message += `Location: ${request.location || 'N/A'}\n`;
            if (request.preferredTime) {
                message += `Preferred Time: ${request.preferredTime}\n`;
            }
            if (request.urgency) {
                message += `Urgency: ${request.urgency.charAt(0).toUpperCase() + request.urgency.slice(1)}\n`;
            }
            message += `\nDescription:\n${request.description || 'No description provided'}\n`;
            message += `\n${'-'.repeat(60)}\n`;
            message += `Status: ${request.status.toUpperCase()}\n`;
            
            if (request.provider) {
                message += `\n${'='.repeat(60)}\n`;
                message += ` ASSIGNED PROVIDER\n`;
                message += `${'-'.repeat(60)}\n`;
                message += `Name: ${request.provider.name}\n`;
                message += `Email: ${request.provider.email}\n`;
                message += `Phone: ${request.provider.phone}\n`;
                message += `Specialization: ${request.provider.specialization}\n`;
                if (request.provider.assignedAt) {
                    const assignedDate = new Date(request.provider.assignedAt);
                    message += `Assigned: ${assignedDate.toLocaleDateString()}\n`;
                }
            } else {
                message += `\n Provider assignment pending...\n`;
            }
            
            alert(message);
        }
        
        // Show User Invoice with full details and payment option
        function showUserInvoice(request) {
            const invoice = request.invoice;
            const isPaid = invoice.status === 'paid' || invoice.paymentStatus === 'paid';
            
            let message = ` INVOICE DETAILS\n`;
            message += `${'='.repeat(60)}\n\n`;
            message += `Invoice ID: ${invoice.id || 'N/A'}\n`;
            message += `Service: ${request.service || 'N/A'}\n`;
            message += `Date: ${invoice.date || 'N/A'} ${invoice.time || ''}\n`;
            message += `Status: ${isPaid ? 'PAID ' : (invoice.status ? invoice.status.toUpperCase() : 'PENDING PAYMENT')}\n`;
            
            if (request.provider) {
                message += `\n${'-'.repeat(60)}\n`;
                message += ` ASSIGNED PROVIDER\n`;
                message += `${'-'.repeat(60)}\n`;
                message += `Name: ${request.provider.name}\n`;
                message += `Email: ${request.provider.email}\n`;
                message += `Phone: ${request.provider.phone}\n`;
                message += `Specialization: ${request.provider.specialization}\n`;
            }
            
            message += `\n${'='.repeat(60)}\n`;
            message += `INVOICE ITEMS\n`;
            message += `${'-'.repeat(60)}\n\n`;
            
            if (invoice.items && invoice.items.length > 0) {
                invoice.items.forEach((item, index) => {
                    message += `${index + 1}. ${item.description || 'N/A'}\n`;
                    message += `   Quantity: ${item.quantity || 0}\n`;
                    message += `   Unit Price: ${(item.price || 0).toFixed(2)}\n`;
                    message += `   Subtotal: ${(item.total || 0).toFixed(2)}\n\n`;
                });
            } else {
                message += `No items found in invoice.\n\n`;
            }
            
            message += `${'-'.repeat(60)}\n`;
            message += `TOTAL AMOUNT: ${(invoice.total || 0).toFixed(2)}\n`;
            message += `${'='.repeat(60)}\n`;
            
            if (invoice.sentAt) {
                const sentDate = new Date(invoice.sentAt);
                message += `\nSent: ${sentDate.toLocaleDateString()} ${sentDate.toLocaleTimeString()}\n`;
            }
            
            if (invoice.paidAt) {
                const paidDate = new Date(invoice.paidAt);
                message += `\nPaid: ${paidDate.toLocaleDateString()} ${paidDate.toLocaleTimeString()}\n`;
            }
            
            // Show payment button if not paid
            if (!isPaid) {
                const shouldPay = confirm(message + `\n\nWould you like to pay this invoice now?`);
                if (shouldPay) {
                    initiatePaystackPayment(request);
                }
            } else {
                alert(message);
            }
        }

        // View Task (legacy function for mock tasks - kept for compatibility)
        function viewTask(id) {
            // Find task in current or past tasks
            let task = null;
            for (const taskList of Object.values(mockTasks)) {
                task = taskList.find(t => t.id === id);
                if (task) break;
            }
            
            if (!task) return;

            if (task.hasInvoice) {
                // Show invoice
                showInvoice(task);
            } else {
                // Show task detail
                showTaskDetail(task);
            }
        }

        // Show Task Detail
        function showTaskDetail(task) {
            document.getElementById('task-detail-title').textContent = task.title;
            const statusBadge = document.getElementById('task-status-badge');
            statusBadge.textContent = task.status === 'current' ? 'In Progress' : 'Completed';
            statusBadge.className = `task-status-badge ${task.status === 'current' ? 'pending' : 'completed'}`;

            // Populate task info
            document.getElementById('task-detail-info').innerHTML = `
                <div class="task-detail-info-item">
                    <div class="task-detail-info-label">Date</div>
                    <div class="task-detail-info-value">${task.date}</div>
                </div>
                <div class="task-detail-info-item">
                    <div class="task-detail-info-label">Time</div>
                    <div class="task-detail-info-value">${task.time}</div>
                </div>
                <div class="task-detail-info-item">
                    <div class="task-detail-info-label">Status</div>
                    <div class="task-detail-info-value">${task.status === 'current' ? 'In Progress' : 'Completed'}</div>
                </div>
                <div class="task-detail-info-item">
                    <div class="task-detail-info-label">Service Type</div>
                    <div class="task-detail-info-value">${task.title}</div>
                </div>
            `;

            document.getElementById('task-description').textContent = `Service request for ${task.title}. Professional service provider assigned.`;

            // Populate provider card
            document.getElementById('task-provider-card').innerHTML = `
                <img src="images/person.png" alt="${task.assignee}" class="task-provider-avatar">
                <div class="task-provider-info">
                    <div class="task-provider-name">${task.assignee}</div>
                    <div class="task-provider-role">Service Provider</div>
                </div>
            `;

            showScreen('task-detail');
        }

        // Show Invoice
        function showInvoice(task) {
            document.getElementById('invoice-number').textContent = `INV-2025-${task.id.replace('t', '').padStart(3, '0')}`;
            document.getElementById('invoice-date').textContent = task.date;

            // Mock invoice items
            const invoiceItems = [
                { description: task.title, quantity: 1, unitPrice: 150.00, total: 150.00 },
                { description: 'Labor', quantity: 2, unitPrice: 50.00, total: 100.00 },
                { description: 'Materials', quantity: 1, unitPrice: 30.00, total: 30.00 }
            ];

            const itemsTable = document.getElementById('invoice-items');
            itemsTable.innerHTML = invoiceItems.map(item => `
                <tr>
                    <td>${item.description}</td>
                    <td>${item.quantity}</td>
                    <td>$${item.unitPrice.toFixed(2)}</td>
                    <td>$${item.total.toFixed(2)}</td>
                </tr>
            `).join('');

            const subtotal = invoiceItems.reduce((sum, item) => sum + item.total, 0);
            const tax = subtotal * 0.10;
            const total = subtotal + tax;

            document.getElementById('invoice-subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('invoice-tax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('invoice-total').textContent = `$${total.toFixed(2)}`;

            showScreen('invoice');
        }

        // Hide Profile Notification
        function hideProfileNotification() {
            document.getElementById('profile-notification').classList.remove('show');
        }

        // Settings Page Functions
        // Personal Info
        function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 2 * 1024 * 1024) {
                    alert('File size must be less than 2MB');
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('avatar-preview').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function removeAvatar() {
            document.getElementById('avatar-preview').src = "images/person.png";
        }

        async function savePersonalInfo(event) {
            event.preventDefault();
            
            const currentUser = firebaseAuth.getCurrentUser();
            if (!currentUser) {
                alert('You must be logged in to update your profile.');
                return;
            }
            
            const firstName = document.getElementById('first-name').value.trim();
            const lastName = document.getElementById('last-name').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const address = document.getElementById('address').value.trim();
            const city = document.getElementById('city').value.trim();
            const state = document.getElementById('state').value.trim();
            const country = document.getElementById('country').value.trim();
            
            // Validation
            if (!firstName || !lastName || !email) {
                alert('Please fill in all required fields (First Name, Last Name, Email).');
                return;
            }
            
            // Combine first and last name
            const fullName = `${firstName} ${lastName}`.trim();
            
            const updateData = {
                name: fullName,
                email: email,
                phone: phone || '',
                address: address || '',
                city: city || '',
                state: state || '',
                country: country || '',
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                // Update in Firestore
                const result = await firebaseUsers.updateUser(currentUser.uid, updateData);
                
                if (result.success) {
                    // Update local session
                    await sessionDB.set('homefix_user', {
                        uid: currentUser.uid,
                        name: fullName,
                        email: email,
                        phone: phone
                    });
                    
                    // Update profile display
                    const profileName = document.querySelector('.profile-name');
                    const profileEmail = document.querySelector('.profile-email');
                    
                    if (profileName) profileName.textContent = fullName;
                    if (profileEmail) profileEmail.textContent = email;
                    
                    alert('Personal information updated successfully!');
                    showScreen('profile');
                } else {
                    alert('Failed to update profile. Please try again.');
                    console.error('Update error:', result.error);
                }
            } catch (error) {
                console.error('Error saving personal info:', error);
                alert('An error occurred while saving. Please try again.');
            }
        }

        // Account & Security
        function changePassword(event) {
            event.preventDefault();
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (newPassword !== confirmPassword) {
                alert('New passwords do not match');
                return;
            }

            if (newPassword.length < 8) {
                alert('Password must be at least 8 characters');
                return;
            }

            console.log('Password changed');
            alert('Password updated successfully!');
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
        }

        // Payment Settings
        function showAddPaymentMethod() {
            document.getElementById('add-payment-section').style.display = 'block';
            document.getElementById('add-payment-section').scrollIntoView({ behavior: 'smooth' });
        }

        function hideAddPaymentMethod() {
            document.getElementById('add-payment-section').style.display = 'none';
            document.getElementById('mobile-money-provider').value = '';
            document.getElementById('mobile-money-number').value = '';
            document.getElementById('mobile-money-name').value = '';
            document.getElementById('set-default').checked = false;
        }

        function addPaymentMethod(event) {
            event.preventDefault();
            // Payment methods are handled by Paystack during checkout
            // No need to store payment methods locally
            hideAddPaymentMethod();
        }

        // Notification Settings
        function updateNotification(key, enabled) {
            console.log(`Notification ${key}: ${enabled ? 'enabled' : 'disabled'}`);
            // In real app, this would send to server
        }

        // Help & Support
        function toggleFAQ(item) {
            const isActive = item.classList.contains('active');
            document.querySelectorAll('.faq-item').forEach(faq => faq.classList.remove('active'));
            if (!isActive) {
                item.classList.add('active');
            }
        }

        // Landing Page Functions
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            const menuBtn = document.getElementById('mobile-menu-btn');
            
            mobileMenu.classList.toggle('active');
            
            // Change icon between hamburger and X
            if (mobileMenu.classList.contains('active')) {
                menuBtn.innerHTML = `
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                `;
            } else {
                menuBtn.innerHTML = `
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                `;
            }
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const mobileMenu = document.getElementById('mobile-menu');
            const menuBtn = document.getElementById('mobile-menu-btn');
            
            if (mobileMenu && mobileMenu.classList.contains('active')) {
                if (!mobileMenu.contains(event.target) && !menuBtn.contains(event.target)) {
                    mobileMenu.classList.remove('active');
                    menuBtn.innerHTML = `
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    `;
                }
            }
        });

        function showAuthPage(page) {
            const landingPage = document.getElementById('landing-page');
            const authContainer = document.getElementById('auth-container');
            
            landingPage.classList.add('hidden');
            landingPage.style.display = ''; // Remove inline style to allow CSS class to work
            authContainer.classList.remove('hidden');
            
            if (page === 'register') {
                switchToRegister();
            } else {
                switchToSignIn();
            }
        }

        function showLandingPage() {
            const landingPage = document.getElementById('landing-page');
            const authContainer = document.getElementById('auth-container');
            const agentContainer = document.getElementById('agent-container');
            const agentDashboard = document.getElementById('agent-dashboard');
            const mainContent = document.getElementById('main-content');
            
            landingPage.classList.remove('hidden');
            authContainer.classList.add('hidden');
            agentContainer.classList.add('hidden');
            agentDashboard.classList.remove('active');
            mainContent.classList.remove('authenticated');
        }

        // Authentication Functions
        async function checkAuthStatus() {
            // Check Firebase auth state - try multiple methods
            let currentUser = firebaseAuth.getCurrentUser();
            const isAgentAuthenticated = await sessionDB.get('agent_authenticated') === 'true';
            
            // If currentUser is null, check local session as fallback
            if (!currentUser) {
                const localAuth = await sessionDB.get('homefix_authenticated');
                if (localAuth === 'true') {
                    // User should be authenticated, wait for auth state to be ready
                    try {
                        currentUser = await firebaseAuth.waitForAuthState();
                        console.log('Auth state ready, currentUser:', currentUser ? currentUser.uid : 'null');
                    } catch (error) {
                        console.warn('Error waiting for auth state:', error);
                        // Fall back to getCurrentUser after a short delay
                        await new Promise(resolve => setTimeout(resolve, 300));
                        currentUser = firebaseAuth.getCurrentUser();
                    }
                }
            }
            
            console.log('checkAuthStatus - currentUser:', currentUser ? currentUser.uid : 'null');
            console.log('checkAuthStatus - isAgentAuthenticated:', isAgentAuthenticated);
            
            const landingPage = document.getElementById('landing-page');
            const authContainer = document.getElementById('auth-container');
            const agentContainer = document.getElementById('agent-container');
            const agentDashboard = document.getElementById('agent-dashboard');
            const mainContent = document.getElementById('main-content');
            
            if (isAgentAuthenticated) {
                // Don't interfere with agent dashboard
                console.log('Agent authenticated, skipping user auth check');
                return;
            }
            
            // Check if we have a local session even if currentUser is null (for timing issues)
            const localUser = await sessionDB.get('homefix_user');
            const hasLocalSession = await sessionDB.get('homefix_authenticated') === 'true';
            
            if (currentUser || (hasLocalSession && localUser)) {
                console.log('User is authenticated, updating UI');
                // User is authenticated with Firebase
                const userId = currentUser ? currentUser.uid : localUser.uid;
                
                // Sync user data from Firestore if needed
                if (currentUser) {
                    const userDataResult = await firebaseUsers.getUser(currentUser.uid);
                    if (userDataResult.success) {
                        await sessionDB.set('homefix_authenticated', 'true');
                        await sessionDB.set('homefix_user', {
                            uid: currentUser.uid,
                            name: userDataResult.data.name,
                            email: userDataResult.data.email,
                            phone: userDataResult.data.phone
                        });
                    }
                }
                
                // Show main content, hide everything else
                if (landingPage) {
                    landingPage.classList.add('hidden');
                }
                if (authContainer) authContainer.classList.add('hidden');
                if (agentContainer) agentContainer.classList.add('hidden');
                if (agentDashboard) agentDashboard.classList.remove('active');
                if (mainContent) {
                    mainContent.classList.add('authenticated');
                    mainContent.style.display = 'block'; // Force display
                }
                
                console.log('UI updated for authenticated user');
            } else {
                console.log('No user authenticated, showing landing page');
                // Show landing page by default, hide auth, agent, and main content
                if (landingPage) landingPage.classList.remove('hidden');
                if (authContainer) authContainer.classList.add('hidden');
                if (agentContainer) agentContainer.classList.add('hidden');
                if (agentDashboard) agentDashboard.classList.remove('active');
                if (mainContent) {
                    mainContent.classList.remove('authenticated');
                    mainContent.style.display = 'none'; // Explicitly hide main content
                }
            }
        }

        function switchToRegister() {
            document.getElementById('signin-card').style.display = 'none';
            document.getElementById('register-card').style.display = 'block';
            clearMessages();
        }

        function switchToSignIn() {
            document.getElementById('register-card').style.display = 'none';
            document.getElementById('signin-card').style.display = 'block';
            clearMessages();
        }

        function clearMessages() {
            document.getElementById('signin-error').classList.remove('show');
            document.getElementById('signin-success').classList.remove('show');
            document.getElementById('register-error').classList.remove('show');
            document.getElementById('register-success').classList.remove('show');
        }

        function showError(elementId, message) {
            const errorEl = document.getElementById(elementId);
            errorEl.textContent = message;
            errorEl.classList.add('show');
            setTimeout(() => {
                errorEl.classList.remove('show');
            }, 5000);
        }

        function showSuccess(elementId, message) {
            const successEl = document.getElementById(elementId);
            successEl.textContent = message;
            successEl.classList.add('show');
            setTimeout(() => {
                successEl.classList.remove('show');
            }, 3000);
        }

        function togglePassword(inputId, button) {
            const input = document.getElementById(inputId);
            const isPassword = input.type === 'password';
            input.type = isPassword ? 'text' : 'password';
            
            // Update icon
            button.innerHTML = isPassword 
                ? `<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
                   </svg>`
                : `<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                   </svg>`;
        }

        async function handleSignIn(event) {
            event.preventDefault();
            clearMessages();
            
            const email = document.getElementById('signin-email').value;
            const password = document.getElementById('signin-password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            
            // Simple validation
            if (!email || !password) {
                showError('signin-error', 'Please fill in all fields');
                return;
            }
            
            // Sign in with Firebase
            const result = await firebaseAuth.signIn(email, password);
            
            if (result.success) {
                // Wait for auth state to be fully ready
                await firebaseAuth.waitForAuthState();
                
                // Get user data from Firestore
                const userDataResult = await firebaseUsers.getUser(result.user.uid);
                
                if (userDataResult.success) {
                    const userData = userDataResult.data;
                    
                    // Store user session locally for quick access
                    await sessionDB.set('homefix_authenticated', 'true');
                    await sessionDB.set('homefix_user', {
                        uid: result.user.uid,
                        name: userData.name,
                        email: userData.email,
                        phone: userData.phone
                    });
                    
                    if (rememberMe) {
                        await sessionDB.set('homefix_remember', 'true');
                    }
                    
                    console.log('User signed in successfully:', result.user.uid);
                    
                    showSuccess('signin-success', 'Sign in successful! Redirecting...');
                    
                    // Immediately update UI - don't wait for checkAuthStatus
                    const authContainer = document.getElementById('auth-container');
                    const landingPage = document.getElementById('landing-page');
                    const mainContent = document.getElementById('main-content');
                    const agentContainer = document.getElementById('agent-container');
                    const agentDashboard = document.getElementById('agent-dashboard');
                    
                    // Hide auth and landing, show main content
                    if (authContainer) {
                        authContainer.classList.add('hidden');
                        console.log(' Auth container hidden');
                    }
                    if (landingPage) {
                        landingPage.classList.add('hidden');
                        console.log(' Landing page hidden');
                    }
                    if (agentContainer) agentContainer.classList.add('hidden');
                    if (agentDashboard) agentDashboard.classList.remove('active');
                    if (mainContent) {
                        mainContent.classList.add('authenticated');
                        mainContent.style.display = 'block'; // Force display
                        console.log(' Main content shown');
                    }
                    
                    // Navigate to home screen immediately
                    console.log('Navigating to home screen...');
                    showScreen('home');
                    
                    // Initialize the app
                    if (typeof init === 'function') {
                        init();
                        console.log(' App initialized');
                    }
                    
                    // Verify auth state in background (but don't block UI)
                    setTimeout(async () => {
                        await checkAuthStatus();
                    }, 500);
                } else {
                    showError('signin-error', 'Error loading user data. Please try again.');
                }
            } else {
                // Handle Firebase auth errors
                let errorMessage = 'Invalid email or password. Please try again.';
                if (result.error.includes('user-not-found')) {
                    errorMessage = 'No account found with this email.';
                } else if (result.error.includes('wrong-password')) {
                    errorMessage = 'Incorrect password.';
                } else if (result.error.includes('too-many-requests')) {
                    errorMessage = 'Too many failed attempts. Please try again later.';
                }
                showError('signin-error', errorMessage);
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            clearMessages();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const phone = document.getElementById('register-phone').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            const termsAccepted = document.getElementById('terms-checkbox').checked;
            
            // Validation
            if (!name || !email || !phone || !password || !confirmPassword) {
                showError('register-error', 'Please fill in all fields');
                return;
            }
            
            if (password.length < 6) {
                showError('register-error', 'Password must be at least 6 characters long');
                return;
            }
            
            if (password !== confirmPassword) {
                showError('register-error', 'Passwords do not match');
                return;
            }
            
            if (!termsAccepted) {
                showError('register-error', 'Please accept the Terms of Service and Privacy Policy');
                return;
            }
            
            // Create account with Firebase
            try {
                const result = await firebaseAuth.signUp(email, password, { name, phone });
                
                if (result.success && result.user) {
                    // User is automatically signed in after registration
                    // Firebase automatically signs in the user after createUserWithEmailAndPassword
                    const user = result.user;
                    
                    console.log('User registered and signed in:', user.uid);
                    console.log('User email:', user.email);
                    
                    // Wait for auth state to be fully ready
                    await firebaseAuth.waitForAuthState();
                    
                    // Get user data from Firestore (it should be there since we just saved it)
                    // Wait a bit for Firestore to be ready
                    await new Promise(resolve => setTimeout(resolve, 500));
                    const userDataResult = await firebaseUsers.getUser(user.uid);
                    
                    // Store user session locally
                    const userData = {
                        uid: user.uid,
                        name: userDataResult.success ? userDataResult.data.name : name,
                        email: userDataResult.success ? userDataResult.data.email : email,
                        phone: userDataResult.success ? userDataResult.data.phone : phone
                    };
                    
                    await sessionDB.set('homefix_authenticated', 'true');
                    await sessionDB.set('homefix_user', userData);
                    
                    console.log('User session stored locally:', userData);
                    
                    showSuccess('register-success', 'Account created successfully! Redirecting...');
                    
                    // Immediately update UI - don't wait for checkAuthStatus
                    const authContainer = document.getElementById('auth-container');
                    const landingPage = document.getElementById('landing-page');
                    const mainContent = document.getElementById('main-content');
                    const agentContainer = document.getElementById('agent-container');
                    const agentDashboard = document.getElementById('agent-dashboard');
                    
                    // Hide auth and landing, show main content
                    if (authContainer) {
                        authContainer.classList.add('hidden');
                        console.log(' Auth container hidden');
                    }
                    if (landingPage) {
                        landingPage.classList.add('hidden');
                        console.log(' Landing page hidden');
                    }
                    if (agentContainer) agentContainer.classList.add('hidden');
                    if (agentDashboard) agentDashboard.classList.remove('active');
                    if (mainContent) {
                        mainContent.classList.add('authenticated');
                        mainContent.style.display = 'block'; // Force display
                        console.log(' Main content shown');
                    }
                    
                    // Navigate to home screen immediately
                    console.log('Navigating to home screen...');
                    showScreen('home');
                    
                    // Initialize the app
                    if (typeof init === 'function') {
                        init();
                        console.log(' App initialized');
                    }
                    
                    // Verify auth state in background (but don't block UI)
                    setTimeout(async () => {
                        const currentUser = firebaseAuth.getCurrentUser();
                        console.log('Background auth check - currentUser:', currentUser ? currentUser.uid : 'null');
                        if (currentUser) {
                            console.log(' Firebase auth state confirmed');
                        } else {
                            console.warn(' Firebase auth.currentUser is null, but user should be signed in');
                            // Force re-check auth status
                            await checkAuthStatus();
                        }
                    }, 2000);
                } else {
                    // Log the actual error for debugging
                    console.error('Firebase registration error:', result.error);
                    
                    // Handle Firebase auth errors with more specific messages
                    let errorMessage = 'Failed to create account. Please try again.';
                    const errorLower = result.error.toLowerCase();
                    
                    if (errorLower.includes('email-already-in-use') || errorLower.includes('already exists')) {
                        errorMessage = 'An account with this email already exists.';
                    } else if (errorLower.includes('weak-password') || errorLower.includes('password')) {
                        errorMessage = 'Password is too weak. Please use a stronger password (at least 6 characters).';
                    } else if (errorLower.includes('invalid-email')) {
                        errorMessage = 'Invalid email address. Please check and try again.';
                    } else if (errorLower.includes('network') || errorLower.includes('fetch')) {
                        errorMessage = 'Network error. Please check your internet connection and try again.';
                    } else if (errorLower.includes('auth/')) {
                        // Show Firebase auth error code
                        errorMessage = `Registration failed: ${result.error}. Please try again.`;
                    } else {
                        // Show the actual error message
                        errorMessage = `Registration failed: ${result.error}`;
                    }
                    
                    showError('register-error', errorMessage);
                }
            } catch (error) {
                console.error('Registration exception:', error);
                showError('register-error', `An unexpected error occurred: ${error.message}. Please try again.`);
            }
        }

        function handleSocialAuth(provider) {
            // Placeholder for social authentication
            alert(`${provider.charAt(0).toUpperCase() + provider.slice(1)} authentication will be implemented soon!`);
        }

        async function logout() {
            // Sign out from Firebase
            await firebaseAuth.signOut();
            
            // Clear local session
            await sessionDB.remove('homefix_authenticated');
            await sessionDB.remove('homefix_user');
            
            // Explicitly hide main content and show landing page
            const mainContent = document.getElementById('main-content');
            const landingPage = document.getElementById('landing-page');
            
            if (mainContent) {
                mainContent.classList.remove('authenticated');
                mainContent.style.display = 'none'; // Explicitly hide
            }
            if (landingPage) {
                landingPage.classList.remove('hidden');
                landingPage.style.display = 'block'; // Ensure it's visible
            }
            
            // Clear forms
            document.getElementById('signin-form').reset();
            document.getElementById('register-form').reset();
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            await checkAuthStatus();
        }

        // Agent Login Functions
        function showAgentLogin() {
            const landingPage = document.getElementById('landing-page');
            const agentContainer = document.getElementById('agent-container');
            
            landingPage.classList.add('hidden');
            landingPage.style.display = ''; // Remove inline style to allow CSS class to work
            agentContainer.classList.remove('hidden');
        }

        async function handleAgentLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('agent-username').value;
            const password = document.getElementById('agent-password').value;
            
            // Check for agent01 credentials
            if (username === 'agent01' && password === 'agentxyz123') {
                await sessionDB.set('agent_authenticated', 'true');
                await sessionDB.set('agent_username', 'agent01');
                showAgentDashboard();
            } 
            // Check for agent02 credentials
            else if (username === 'agent02' && password === 'agentxyz124') {
                await sessionDB.set('agent_authenticated', 'true');
                await sessionDB.set('agent_username', 'agent02');
                showAgentDashboard();
            } 
            else {
                alert('Invalid credentials. Please try again.');
            }
        }

        async function showAgentDashboard() {
            const landingPage = document.getElementById('landing-page');
            const agentContainer = document.getElementById('agent-container');
            const agentDashboard = document.getElementById('agent-dashboard');
            const agentUsername = await sessionDB.get('agent_username') || 'Agent';
            
            if (landingPage) {
                landingPage.classList.add('hidden');
                landingPage.style.display = ''; // Remove inline style to allow CSS class to work
            }
            agentContainer.classList.add('hidden');
            agentDashboard.classList.add('active');
            
            // Update welcome message with agent username
            const welcomeSpan = document.querySelector('.agent-header-actions span');
            if (welcomeSpan) {
                welcomeSpan.textContent = `Welcome, ${agentUsername}`;
            }
            
            loadAgentRequests();
        }

        async function agentLogout() {
            await sessionDB.remove('agent_authenticated');
            await sessionDB.remove('agent_username');
            document.getElementById('agent-container').classList.remove('hidden');
            document.getElementById('agent-dashboard').classList.remove('active');
            showLandingPage();
        }

        async function loadAgentRequests() {
            const refreshButton = document.querySelector('.section-header button');
            const container = document.getElementById('requests-container');
            
            // Show loading state
            if (refreshButton) {
                const originalText = refreshButton.textContent;
                refreshButton.disabled = true;
                refreshButton.textContent = 'Refreshing...';
            }
            
            if (container) {
                container.innerHTML = '<p style="text-align: center; color: var(--neutral-500); padding: var(--spacing-3xl);">Loading requests...</p>';
            }
            
            try {
                // Load requests from Firestore
                const result = await firebaseRequests.getAllRequests();
                let requests = result.success ? result.data : [];
                
                if (!result.success) {
                    console.error('Error loading requests:', result.error);
                    if (container) {
                        container.innerHTML = `<p style="text-align: center; color: var(--error-500); padding: var(--spacing-3xl);">Error loading requests: ${result.error}</p>`;
                    }
                    return;
                }
                
                // Convert Firestore timestamps to dates
                requests.forEach(request => {
                    if (request.createdAt) {
                        const date = convertTimestamp(request.createdAt);
                        request.createdAt = date.toISOString();
                        if (!request.date) {
                            request.date = date.toLocaleDateString();
                        }
                    }
                    // Ensure all client fields are present
                    if (!request.clientName && request.clientEmail) {
                        // Try to get client name from email if missing
                        request.clientName = request.clientEmail.split('@')[0];
                    }
                });
                
                // Only add sample data if no requests exist (first time)
                if (requests.length === 0) {
                    // Sample requests for demo
                    const sampleRequests = [
                        {
                            clientName: 'John Doe',
                            clientEmail: 'john@example.com',
                            clientPhone: '+1234567890',
                            service: 'Plumbing Repair',
                            description: 'Leaky faucet in kitchen needs immediate attention',
                            location: '123 Main St, Accra',
                            date: new Date().toLocaleDateString(),
                            status: 'pending'
                        },
                        {
                            clientName: 'Jane Smith',
                            clientEmail: 'jane@example.com',
                            clientPhone: '+1234567891',
                            service: 'Electrical Installation',
                            description: 'Need new ceiling fan installed in living room',
                            location: '456 Oak Ave, Accra',
                            date: new Date().toLocaleDateString(),
                            status: 'pending'
                        }
                    ];
                    
                    for (const requestData of sampleRequests) {
                        await firebaseRequests.createRequest(requestData);
                    }
                    
                    // Reload requests
                    const reloadResult = await firebaseRequests.getAllRequests();
                    requests = reloadResult.success ? reloadResult.data : [];
                    
                    // Convert timestamps again
                    requests.forEach(request => {
                        if (request.createdAt) {
                            const date = convertTimestamp(request.createdAt);
                            request.createdAt = date.toISOString();
                            if (!request.date) {
                                request.date = date.toLocaleDateString();
                            }
                        }
                    });
                }
                
                // Sort requests by date (newest first)
                requests.sort((a, b) => {
                    const dateA = a.createdAt ? new Date(a.createdAt) : new Date(a.date || 0);
                    const dateB = b.createdAt ? new Date(b.createdAt) : new Date(b.date || 0);
                    return dateB - dateA;
                });
                
                renderRequests(requests);
            } catch (error) {
                console.error('Error in loadAgentRequests:', error);
                if (container) {
                    container.innerHTML = `<p style="text-align: center; color: var(--error-500); padding: var(--spacing-3xl);">Error: ${error.message}</p>`;
                }
            } finally {
                // Restore button state
                if (refreshButton) {
                    refreshButton.disabled = false;
                    refreshButton.textContent = 'Refresh';
                }
            }
        }

        function renderRequests(requests) {
            const container = document.getElementById('requests-container');
            
            if (requests.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--neutral-500); padding: var(--spacing-3xl);">No requests available</p>';
                return;
            }
            
            container.innerHTML = requests.map(request => `
                <div class="request-card" data-id="${request.id}" data-request-id="${request.id}">
                    <div class="request-header">
                        <div class="request-info">
                            <h3>${request.service}</h3>
                            <div class="request-meta">
                                <span> ${request.date}</span>
                                <span> ${request.location}</span>
                            </div>
                        </div>
                        <span class="request-status ${request.status}">${request.status.toUpperCase()}</span>
                    </div>
                    <div class="request-details">
                        <div class="request-detail-row">
                            <span class="request-detail-label">Client Name:</span>
                            <span class="request-detail-value">${request.clientName}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Email:</span>
                            <span class="request-detail-value">${request.clientEmail}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Phone:</span>
                            <span class="request-detail-value">${request.clientPhone}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Description:</span>
                            <span class="request-detail-value">${request.description}</span>
                        </div>
                        ${request.preferredTime ? `
                        <div class="request-detail-row">
                            <span class="request-detail-label">Preferred Time:</span>
                            <span class="request-detail-value">${request.preferredTime}</span>
                        </div>
                        ` : ''}
                        ${request.urgency ? `
                        <div class="request-detail-row">
                            <span class="request-detail-label">Urgency:</span>
                            <span class="request-detail-value">${request.urgency.charAt(0).toUpperCase() + request.urgency.slice(1)}</span>
                        </div>
                        ` : ''}
                        ${request.provider ? `
                        <div class="request-detail-row" style="margin-top: var(--spacing-md); padding-top: var(--spacing-md); border-top: 2px solid var(--neutral-200);">
                            <span class="request-detail-label" style="color: var(--primary-500); font-weight: 700;">Assigned Provider:</span>
                            <span class="request-detail-value" style="font-weight: 600;">${request.provider.name}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Provider Email:</span>
                            <span class="request-detail-value">${request.provider.email}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Provider Phone:</span>
                            <span class="request-detail-value">${request.provider.phone}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Specialization:</span>
                            <span class="request-detail-value">${request.provider.specialization}</span>
                        </div>
                        ` : ''}
                        ${request.invoice ? `
                        <div class="request-detail-row" style="margin-top: var(--spacing-md); padding-top: var(--spacing-md); border-top: 2px solid var(--neutral-200);">
                            <span class="request-detail-label" style="color: var(--success-500); font-weight: 700;">Invoice Sent:</span>
                            <span class="request-detail-value" style="font-weight: 600;">${request.invoice.total.toFixed(2)}</span>
                        </div>
                        <div class="request-detail-row">
                            <span class="request-detail-label">Invoice Date:</span>
                            <span class="request-detail-value">${request.invoice.date}</span>
                        </div>
                        ` : ''}
                    </div>
                    <div class="request-actions">
                        ${request.status === 'pending' ? `
                            <button class="btn btn-primary" onclick="showAssignProviderForm('${request.id}')">Assign Provider</button>
                            <button class="btn btn-ghost" onclick="showInvoiceForm('${request.id}')">Create Invoice</button>
                        ` : ''}
                        ${request.status === 'assigned' ? `
                            <button class="btn btn-ghost" onclick="showInvoiceForm('${request.id}')">Create Invoice</button>
                        ` : ''}
                        ${request.status === 'completed' && request.invoice ? `
                            <button class="btn btn-primary" onclick="viewInvoice('${request.id}')">View Invoice</button>
                            <button class="btn btn-ghost" onclick="resendInvoice('${request.id}')">Resend Invoice</button>
                        ` : ''}
                    </div>
                    <div class="assign-provider-form" id="assign-form-${request.id}">
                        <h4 style="margin-bottom: var(--spacing-lg); font-size: 18px; font-weight: 600;">Assign Provider</h4>
                        <form onsubmit="assignProvider(event, '${request.id}')">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Provider Name</label>
                                    <input type="text" class="form-input" id="provider-name-${request.id}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Provider Email</label>
                                    <input type="email" class="form-input" id="provider-email-${request.id}" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Provider Phone</label>
                                    <input type="tel" class="form-input" id="provider-phone-${request.id}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Provider Specialization</label>
                                    <input type="text" class="form-input" id="provider-specialization-${request.id}" required>
                                </div>
                            </div>
                            <div class="request-actions">
                                <button type="submit" class="btn btn-primary">Assign Provider</button>
                                <button type="button" class="btn btn-ghost" onclick="hideAssignProviderForm(${request.id})">Cancel</button>
                            </div>
                        </form>
                    </div>
                    <div class="invoice-section" id="invoice-form-${request.id}">
                        <div style="background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%); padding: var(--spacing-lg); border-radius: var(--radius-lg); margin-bottom: var(--spacing-lg); color: white;">
                            <h4 style="margin: 0 0 var(--spacing-sm) 0; font-size: 20px; font-weight: 700;"> Create Invoice</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-sm); margin-top: var(--spacing-sm); font-size: 14px;">
                                <div><strong>Client:</strong> ${request.clientName || 'N/A'}</div>
                                <div><strong>Email:</strong> ${request.clientEmail || 'N/A'}</div>
                                <div><strong>Service:</strong> ${request.service || 'N/A'}</div>
                            </div>
                        </div>
                        <form id="invoice-form-submit-${request.id}">
                            <div style="background: var(--white); border: 1px solid var(--neutral-200); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                                    <label class="form-label" style="font-weight: 700; font-size: 16px; margin: 0;">Invoice Items</label>
                                    <button type="button" class="btn btn-ghost" onclick="addInvoiceItem('${request.id}')" style="padding: var(--spacing-xs) var(--spacing-sm); font-size: 14px;">
                                        + Add Item
                                    </button>
                                </div>
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background: var(--neutral-50); border-bottom: 2px solid var(--neutral-200);">
                                                <th style="padding: var(--spacing-sm); text-align: left; font-weight: 600; font-size: 14px; color: var(--neutral-700);">Description</th>
                                                <th style="padding: var(--spacing-sm); text-align: center; font-weight: 600; font-size: 14px; color: var(--neutral-700); width: 100px;">Quantity</th>
                                                <th style="padding: var(--spacing-sm); text-align: right; font-weight: 600; font-size: 14px; color: var(--neutral-700); width: 120px;">Unit Price ()</th>
                                                <th style="padding: var(--spacing-sm); text-align: right; font-weight: 600; font-size: 14px; color: var(--neutral-700); width: 120px;">Subtotal</th>
                                                <th style="padding: var(--spacing-sm); text-align: center; font-weight: 600; font-size: 14px; color: var(--neutral-700); width: 60px;">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="invoice-items-${request.id}">
                                            <tr>
                                                <td style="padding: var(--spacing-sm);"><input type="text" class="form-input invoice-desc" placeholder="Item description" required style="width: 100%; border: 1px solid var(--neutral-300);" oninput="updateInvoiceRowTotal(this, '${request.id}')"></td>
                                                <td style="padding: var(--spacing-sm);"><input type="number" class="form-input invoice-qty" placeholder="Qty (optional)" min="0" value="1" style="width: 100%; border: 1px solid var(--neutral-300); text-align: center;" oninput="updateInvoiceRowTotal(this, '${request.id}')" onchange="updateInvoiceRowTotal(this, '${request.id}')"></td>
                                                <td style="padding: var(--spacing-sm);"><input type="number" class="form-input invoice-price" placeholder="0.00" min="0" step="0.01" value="0" required style="width: 100%; border: 1px solid var(--neutral-300); text-align: right;" oninput="updateInvoiceRowTotal(this, '${request.id}')" onchange="updateInvoiceRowTotal(this, '${request.id}')"></td>
                                                <td class="item-subtotal" style="padding: var(--spacing-sm); text-align: right; color: var(--neutral-600); font-weight: 600;">0.00</td>
                                                <td style="padding: var(--spacing-sm); text-align: center;"><button type="button" class="btn btn-ghost" onclick="removeInvoiceItem(this)" style="padding: var(--spacing-xs); min-width: auto; color: var(--error-500);"></button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div style="background: var(--neutral-50); border: 2px solid var(--primary-200); padding: var(--spacing-lg); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 20px; font-weight: 700; color: var(--neutral-700);">Total Amount:</span>
                                    <span id="invoice-total-${request.id}" style="color: var(--primary-600); font-size: 32px; font-weight: 800;">0.00</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: var(--spacing-md);">
                                <button type="button" class="btn btn-primary" onclick="calculateInvoiceTotal('${request.id}')" style="flex: 1; padding: var(--spacing-md); font-size: 16px; font-weight: 600;">
                                     Calculate Total
                                </button>
                                <button type="button" class="btn btn-ghost" onclick="hideInvoiceForm('${request.id}')" style="flex: 0.5;">
                                    Cancel
                                </button>
                            </div>
                            <div style="margin-top: var(--spacing-md);">
                                <button type="button" class="btn btn-primary send-invoice-btn" data-request-id="${request.id}" style="width: 100%; padding: var(--spacing-md); font-size: 16px; font-weight: 600; background: var(--success-600);">
                                     Send Invoice to Client
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `).join('');
            
            // Attach event listeners to send invoice buttons using event delegation
            container.addEventListener('click', function(e) {
                if (e.target.classList.contains('send-invoice-btn')) {
                    const requestId = e.target.getAttribute('data-request-id');
                    if (requestId) {
                        handleCreateInvoice(requestId);
                    }
                }
            });
            
            // Initialize totals for all visible invoice forms
            requests.forEach(request => {
                const invoiceForm = document.getElementById(`invoice-form-${request.id}`);
                if (invoiceForm && invoiceForm.classList.contains('active')) {
                    setTimeout(() => {
                        updateInvoiceTotal(request.id);
                    }, 100);
                }
            });
        }

        function showAssignProviderForm(requestId) {
            // Handle both string and number requestId
            const id = String(requestId);
            const form = document.getElementById(`assign-form-${id}`);
            if (!form) {
                console.error('Assign form not found:', id);
                alert('Form not found. Please refresh the page and try again.');
                return;
            }
            form.classList.add('active');
        }

        function hideAssignProviderForm(requestId) {
            const id = String(requestId);
            const form = document.getElementById(`assign-form-${id}`);
            if (form) {
                form.classList.remove('active');
            }
        }

        async function assignProvider(event, requestId) {
            event.preventDefault();
            
            // Handle both string and number requestId
            const id = String(requestId);
            
            // Get form elements
            const providerNameEl = document.getElementById(`provider-name-${id}`);
            const providerEmailEl = document.getElementById(`provider-email-${id}`);
            const providerPhoneEl = document.getElementById(`provider-phone-${id}`);
            const providerSpecializationEl = document.getElementById(`provider-specialization-${id}`);
            
            if (!providerNameEl || !providerEmailEl || !providerPhoneEl || !providerSpecializationEl) {
                alert('Error: Form fields not found. Please refresh the page and try again.');
                console.error('Missing form fields for requestId:', id);
                return;
            }
            
            const providerName = providerNameEl.value.trim();
            const providerEmail = providerEmailEl.value.trim();
            const providerPhone = providerPhoneEl.value.trim();
            const providerSpecialization = providerSpecializationEl.value.trim();
            
            // Validation
            if (!providerName || !providerEmail || !providerPhone || !providerSpecialization) {
                alert('Please fill in all provider details.');
                return;
            }
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(providerEmail)) {
                alert('Please enter a valid email address for the provider.');
                return;
            }
            
            try {
                // Get request from Firestore (use original requestId - could be string or number)
                const firestoreId = typeof requestId === 'string' ? requestId : String(requestId);
                const result = await firebaseRequests.getRequest(firestoreId);
                
                if (!result.success || !result.data) {
                    alert('Error: Request not found. Please refresh the page and try again.');
                    console.error('Request not found:', firestoreId);
                    return;
                }
                
                const request = result.data;
                const providerData = {
                    name: providerName,
                    email: providerEmail,
                    phone: providerPhone,
                    specialization: providerSpecialization,
                    assignedAt: new Date().toISOString()
                };
                
                // Update request in Firestore
                const updateResult = await firebaseRequests.updateRequest(firestoreId, {
                    status: 'assigned',
                    provider: providerData
                });
                
                if (updateResult.success) {
                    // Hide the form
                    hideAssignProviderForm(id);
                    
                    // Clear form fields
                    providerNameEl.value = '';
                    providerEmailEl.value = '';
                    providerPhoneEl.value = '';
                    providerSpecializationEl.value = '';
                    
                    // Reload requests to show updated status
                    await loadAgentRequests();
                    
                    alert(` Provider assigned successfully!\n\nProvider: ${providerName}\nEmail: ${providerEmail}\nPhone: ${providerPhone}\nSpecialization: ${providerSpecialization}\n\nThe client has been notified.`);
                } else {
                    alert('Failed to assign provider. Please try again.');
                    console.error('Update error:', updateResult.error);
                }
            } catch (error) {
                console.error('Error assigning provider:', error);
                alert('An error occurred while assigning the provider. Please try again.');
            }
        }

        function showInvoiceForm(requestId) {
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            const invoiceForm = document.getElementById(`invoice-form-${id}`);
            if (!invoiceForm) {
                console.error('Invoice form not found:', id);
                alert('Invoice form not found. Please refresh the page and try again.');
                return;
            }
            invoiceForm.classList.add('active');
            
            // Reset invoice form if it was previously filled
            const tbody = document.getElementById(`invoice-items-${id}`);
            if (!tbody) {
                console.error('Invoice items table body not found:', id);
                return;
            }
            
            tbody.innerHTML = `
                <tr>
                    <td style="padding: var(--spacing-sm);"><input type="text" class="form-input invoice-desc" placeholder="Item description" required style="width: 100%; border: 1px solid var(--neutral-300);" oninput="updateInvoiceRowTotal(this, '${id}')"></td>
                    <td style="padding: var(--spacing-sm);"><input type="number" class="form-input invoice-qty" placeholder="Qty (optional)" min="0" value="1" style="width: 100%; border: 1px solid var(--neutral-300); text-align: center;" oninput="updateInvoiceRowTotal(this, '${id}')" onchange="updateInvoiceRowTotal(this, '${id}')"></td>
                    <td style="padding: var(--spacing-sm);"><input type="number" class="form-input invoice-price" placeholder="0.00" min="0" step="0.01" value="0" required style="width: 100%; border: 1px solid var(--neutral-300); text-align: right;" oninput="updateInvoiceRowTotal(this, '${id}')" onchange="updateInvoiceRowTotal(this, '${id}')"></td>
                    <td class="item-subtotal" style="padding: var(--spacing-sm); text-align: right; color: var(--neutral-600); font-weight: 600;">0.00</td>
                    <td style="padding: var(--spacing-sm); text-align: center;"><button type="button" class="btn btn-ghost" onclick="removeInvoiceItem(this)" style="padding: var(--spacing-xs); min-width: auto; color: var(--error-500);"></button></td>
                </tr>
            `;
            
            // Reset total display
            const totalElement = document.getElementById(`invoice-total-${id}`);
            if (totalElement) {
                totalElement.textContent = '0.00';
                totalElement.style.color = 'var(--primary-600)';
                totalElement.style.fontWeight = '700';
            }
            
            // Update total after a short delay to ensure DOM is ready
            setTimeout(() => {
                updateInvoiceTotal(id);
            }, 100);
        }
        
        async function viewInvoice(requestId) {
            const result = await firebaseRequests.getRequest(requestId);
            const request = result.success ? result.data : null;
            
            if (request && request.invoice) {
                const invoice = request.invoice;
                let message = ` INVOICE DETAILS\n`;
                message += `${'='.repeat(50)}\n\n`;
                message += `Invoice ID: ${invoice.id}\n`;
                message += `Service: ${request.service}\n`;
                message += `Client: ${request.clientName}\n`;
                message += `Email: ${request.clientEmail}\n`;
                message += `Date: ${invoice.date} ${invoice.time || ''}\n`;
                message += `\n${'-'.repeat(50)}\n`;
                message += `ITEMS:\n`;
                message += `${'-'.repeat(50)}\n\n`;
                
                invoice.items.forEach((item, index) => {
                    message += `${index + 1}. ${item.description}\n`;
                    message += `   Quantity: ${item.quantity}\n`;
                    message += `   Unit Price: ${item.price.toFixed(2)}\n`;
                    message += `   Subtotal: ${item.total.toFixed(2)}\n\n`;
                });
                
                message += `${'-'.repeat(50)}\n`;
                message += `TOTAL: ${invoice.total.toFixed(2)}\n`;
                message += `${'='.repeat(50)}\n`;
                message += `Status: ${invoice.status.toUpperCase()}\n`;
                
                alert(message);
            }
        }
        
        async function resendInvoice(requestId) {
            const result = await firebaseRequests.getRequest(requestId);
            const request = result.success ? result.data : null;
            
            if (request && request.invoice) {
                const invoice = request.invoice;
                const invoiceMessage = createInvoiceMessage(request, invoice);
                
                const confirmMessage = ` Invoice resent successfully to ${request.clientEmail}\n\n` +
                    `Invoice ID: ${invoice.id}\n` +
                    `Total Amount: ${invoice.total.toFixed(2)}\n\n` +
                    `The client has been notified via email.`;
                
                alert(confirmMessage);
            }
        }

        function hideInvoiceForm(requestId) {
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            const form = document.getElementById(`invoice-form-${id}`);
            if (form) {
                form.classList.remove('active');
            }
        }

        function addInvoiceItem(requestId) {
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            const tbody = document.getElementById(`invoice-items-${id}`);
            if (!tbody) {
                console.error('Invoice items table body not found:', id);
                return;
            }
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td style="padding: var(--spacing-sm);"><input type="text" class="form-input invoice-desc" placeholder="Item description" required style="width: 100%; border: 1px solid var(--neutral-300);" oninput="updateInvoiceRowTotal(this, '${id}')"></td>
                <td style="padding: var(--spacing-sm);"><input type="number" class="form-input invoice-qty" placeholder="Qty (optional)" min="0" value="1" style="width: 100%; border: 1px solid var(--neutral-300); text-align: center;" oninput="updateInvoiceRowTotal(this, '${id}')" onchange="updateInvoiceRowTotal(this, '${id}')"></td>
                <td style="padding: var(--spacing-sm);"><input type="number" class="form-input invoice-price" placeholder="0.00" min="0" step="0.01" value="0" required style="width: 100%; border: 1px solid var(--neutral-300); text-align: right;" oninput="updateInvoiceRowTotal(this, '${id}')" onchange="updateInvoiceRowTotal(this, '${id}')"></td>
                <td class="item-subtotal" style="padding: var(--spacing-sm); text-align: right; color: var(--neutral-600); font-weight: 600;">0.00</td>
                <td style="padding: var(--spacing-sm); text-align: center;"><button type="button" class="btn btn-ghost" onclick="removeInvoiceItem(this)" style="padding: var(--spacing-xs); min-width: auto; color: var(--error-500);"></button></td>
            `;
            tbody.appendChild(row);
            
            // Update total after adding item
            setTimeout(() => {
                updateInvoiceTotal(id);
            }, 50);
        }

        function removeInvoiceItem(button) {
            const row = button.closest('tr');
            if (!row) return;
            
            const tbody = row.parentElement;
            const allRows = tbody.querySelectorAll('tr');
            
            // Don't allow removing the last item
            if (allRows.length <= 1) {
                alert('Invoice must have at least one item.');
                return;
            }
            
            row.remove();
            const requestId = button.closest('.invoice-section').id.replace('invoice-form-', '');
            updateInvoiceTotal(requestId);
        }

        // Update individual row subtotal and total
        function updateInvoiceRowTotal(inputElement, requestId) {
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            const row = inputElement.closest('tr');
            if (!row) return;
            
            const quantityInput = row.querySelector('.invoice-qty');
            const priceInput = row.querySelector('.invoice-price');
            const subtotalCell = row.querySelector('.item-subtotal');
            
            if (!priceInput || !subtotalCell) return;
            
            // Get values - quantity is optional (for service fees)
            const quantity = quantityInput ? (parseFloat(quantityInput.value) || 0) : 1;
            const price = parseFloat(priceInput.value) || 0;
            
            // If quantity is 0 or empty, treat as service fee (quantity = 1)
            const effectiveQuantity = quantity > 0 ? quantity : 1;
            const subtotal = effectiveQuantity * price;
            
            // Update subtotal cell
            subtotalCell.textContent = `${subtotal.toFixed(2)}`;
            
            // Update total
            updateInvoiceTotal(id);
        }
        
        function updateInvoiceTotal(requestId) {
            try {
                // Handle both string and number requestId
                const id = typeof requestId === 'string' ? requestId : String(requestId);
                const tbody = document.getElementById(`invoice-items-${id}`);
                if (!tbody) {
                    console.warn('Invoice items table body not found for updateInvoiceTotal:', id);
                    return;
                }
                
                const rows = tbody.querySelectorAll('tr');
                let total = 0;
                
                rows.forEach(row => {
                    const quantityInput = row.querySelector('.invoice-qty');
                    const priceInput = row.querySelector('.invoice-price');
                    const subtotalCell = row.querySelector('.item-subtotal');
                    
                    if (priceInput) {
                        const quantity = quantityInput ? (parseFloat(quantityInput.value) || 0) : 1;
                        const price = parseFloat(priceInput.value) || 0;
                        
                        // If quantity is 0 or empty, treat as service fee (quantity = 1)
                        const effectiveQuantity = quantity > 0 ? quantity : 1;
                        const subtotal = effectiveQuantity * price;
                        total += subtotal;
                        
                        // Update subtotal cell if not already updated
                        if (subtotalCell && !subtotalCell.textContent.includes('')) {
                            subtotalCell.textContent = `${subtotal.toFixed(2)}`;
                        }
                    }
                });
                
                const totalElement = document.getElementById(`invoice-total-${id}`);
                if (totalElement) {
                    totalElement.textContent = `${total.toFixed(2)}`;
                    // Add visual feedback for non-zero totals
                    if (total > 0) {
                        totalElement.style.color = 'var(--success-600)';
                    } else {
                        totalElement.style.color = 'var(--primary-600)';
                    }
                }
            } catch (error) {
                console.error('Error updating invoice total:', error);
            }
        }
        
        // Calculate and display invoice total with validation
        function calculateInvoiceTotal(requestId) {
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            const tbody = document.getElementById(`invoice-items-${id}`);
            
            if (!tbody) {
                alert('Error: Invoice form not found. Please refresh the page.');
                return;
            }
            
            const rows = tbody.querySelectorAll('tr');
            
            if (rows.length === 0) {
                alert('Please add at least one invoice item before calculating the total.');
                return;
            }
            
            let total = 0;
            let hasErrors = false;
            let errorMessages = [];
            
            rows.forEach((row, index) => {
                const descriptionInput = row.querySelector('.invoice-desc');
                const quantityInput = row.querySelector('.invoice-qty');
                const priceInput = row.querySelector('.invoice-price');
                const subtotalCell = row.querySelector('.item-subtotal');
                
                if (!descriptionInput || !priceInput) {
                    return;
                }
                
                const description = descriptionInput.value.trim();
                const quantityStr = quantityInput ? quantityInput.value.trim() : '';
                const priceStr = priceInput.value.trim();
                
                // Check for required fields (description and price are required)
                if (!description || !priceStr) {
                    hasErrors = true;
                    errorMessages.push(`Row ${index + 1}: Please fill in description and price.`);
                    return;
                }
                
                const quantity = quantityStr ? parseFloat(quantityStr) : 1; // Default to 1 if empty (service fee)
                const price = parseFloat(priceStr);
                
                // Validate price (must be greater than 0)
                if (isNaN(price) || price <= 0) {
                    hasErrors = true;
                    errorMessages.push(`Row ${index + 1}: Please enter a valid price (must be greater than 0).`);
                    return;
                }
                
                // Quantity is optional - if 0 or empty, treat as service fee (quantity = 1)
                const effectiveQuantity = quantity > 0 ? quantity : 1;
                const subtotal = effectiveQuantity * price;
                total += subtotal;
                
                // Update subtotal cell
                if (subtotalCell) {
                    subtotalCell.textContent = `${subtotal.toFixed(2)}`;
                }
            });
            
            // Update the total display
            updateInvoiceTotal(id);
            
            // Show feedback
            if (hasErrors) {
                alert(' Please fix the following errors:\n\n' + errorMessages.join('\n') + '\n\nCurrent calculated total: ' + total.toFixed(2));
            } else {
                // Highlight the total with animation
                const totalElement = document.getElementById(`invoice-total-${id}`);
                if (totalElement) {
                    totalElement.style.transition = 'all 0.3s ease';
                    totalElement.style.transform = 'scale(1.1)';
                    totalElement.style.color = 'var(--success-600)';
                    totalElement.style.fontWeight = '800';
                    
                    setTimeout(() => {
                        totalElement.style.transform = 'scale(1)';
                    }, 300);
                }
                
                alert(` Total calculated successfully!\n\nTotal Amount: ${total.toFixed(2)}\n\nYou can now review and send the invoice.`);
            }
        }

        // Wrapper function for button click
        async function handleCreateInvoice(requestId) {
            console.log('handleCreateInvoice called with requestId:', requestId);
            
            // Disable button to prevent double submission
            const button = document.querySelector(`[data-request-id="${requestId}"].send-invoice-btn`);
            if (button) {
                button.disabled = true;
                button.textContent = 'Sending...';
            }
            
            try {
                await createInvoice(null, requestId);
            } catch (error) {
                console.error('Error in createInvoice:', error);
                alert('An error occurred while creating the invoice. Please try again.');
                // Re-enable button on error
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
            }
        }
        
        async function createInvoice(event, requestId) {
            // Prevent default if event exists (form submission)
            if (event && event.preventDefault) {
                event.preventDefault();
            }
            
            // Keep requestId as string for consistency with DOM IDs
            const id = typeof requestId === 'string' ? requestId : String(requestId);
            
            console.log('createInvoice called with requestId:', id, 'type:', typeof id);
            
            const items = [];
            const tbody = document.getElementById(`invoice-items-${id}`);
            
            if (!tbody) {
                console.error('Invoice items table body not found:', `invoice-items-${id}`);
                alert('Error: Invoice form not found. Please refresh the page and try again.');
                // Re-enable button on error
                const button = document.querySelector(`[data-request-id="${id}"].send-invoice-btn`);
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
                return;
            }
            
            const rows = tbody.querySelectorAll('tr');
            console.log('Found invoice items:', rows.length);
            
            if (rows.length === 0) {
                alert('Please add at least one invoice item.');
                // Re-enable button on error
                const button = document.querySelector(`[data-request-id="${id}"].send-invoice-btn`);
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
                return;
            }
            
            rows.forEach((row, index) => {
                try {
                    const descriptionInput = row.querySelector('.invoice-desc');
                    const quantityInput = row.querySelector('.invoice-qty');
                    const priceInput = row.querySelector('.invoice-price');
                    
                    if (!descriptionInput || !priceInput) {
                        console.warn('Missing required input fields in row', index);
                        return;
                    }
                    
                    const description = descriptionInput.value.trim();
                    const quantityStr = quantityInput ? quantityInput.value.trim() : '';
                    const priceStr = priceInput.value.trim();
                    
                    // Check if required fields are empty (description and price are required)
                    if (!description || !priceStr) {
                        console.warn('Empty required fields in row', index, { description, priceStr });
                        return; // Skip items with empty required fields
                    }
                    
                    const price = parseFloat(priceStr);
                    
                    // Check if price is valid and greater than 0
                    if (isNaN(price) || price <= 0) {
                        console.warn('Invalid price in row', index, { price });
                        return; // Skip invalid items
                    }
                    
                    // Quantity is optional - if empty or 0, treat as service fee (quantity = 1)
                    const quantity = quantityStr ? parseFloat(quantityStr) : 1;
                    const effectiveQuantity = quantity > 0 ? quantity : 1;
                    
                    console.log(`Item ${index}:`, { description, quantity: effectiveQuantity, price });
                    
                    items.push({ 
                        description, 
                        quantity: effectiveQuantity, 
                        price, 
                        total: effectiveQuantity * price 
                    });
                } catch (error) {
                    console.error('Error processing item', index, ':', error);
                }
            });
            
            if (items.length === 0) {
                alert('Please fill in all invoice item fields correctly. All items must have a description and price. Quantity is optional (leave empty for service fees).');
                // Re-enable button on error
                const button = document.querySelector(`[data-request-id="${id}"].send-invoice-btn`);
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
                return;
            }
            
            const total = items.reduce((sum, item) => sum + item.total, 0);
            
            if (total <= 0) {
                alert('Invoice total must be greater than zero. Please check your item prices and quantities.');
                // Re-enable button on error
                const button = document.querySelector(`[data-request-id="${id}"].send-invoice-btn`);
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
                return;
            }
            
            // Get request from Firestore (use original requestId for Firestore)
            const firestoreId = typeof requestId === 'string' && !isNaN(requestId) ? requestId : id;
            const result = await firebaseRequests.getRequest(firestoreId);
            
            if (!result.success || !result.data) {
                alert('Error: Request not found. Please refresh the page and try again.');
                // Re-enable button on error
                const button = document.querySelector(`[data-request-id="${id}"].send-invoice-btn`);
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
                return;
            }
            
            const request = result.data;
            const invoiceData = {
                id: `INV-${Date.now()}`,
                requestId: firestoreId,
                items: items,
                total: total,
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString(),
                status: 'sent',
                sentAt: new Date().toISOString()
            };
            
            // Update request in Firestore
            await firebaseRequests.updateRequest(firestoreId, {
                invoice: invoiceData,
                status: 'completed'
            });
            
            // Create formatted invoice message
            let invoiceMessage = '';
            try {
                invoiceMessage = createInvoiceMessage(request, invoiceData);
            } catch (error) {
                console.error('Error creating invoice message:', error);
                invoiceMessage = `Service: ${request.service}\nTotal: ${total.toFixed(2)}`;
            }
            
            // Show success message with invoice details
            const confirmMessage = ` Invoice sent successfully to ${request.clientEmail}\n\n` +
                `Invoice ID: ${invoiceData.id}\n` +
                `Total Amount: ${total.toFixed(2)}\n\n` +
                `Invoice Details:\n${invoiceMessage}\n\n` +
                `The client has been notified via email.`;
            
            alert(confirmMessage);
            
            try {
                // Re-enable button after success
                const button = document.querySelector(`[data-request-id="${id}"].send-invoice-btn`);
                if (button) {
                    button.disabled = false;
                    button.textContent = ' Send Invoice to Client';
                }
                
                loadAgentRequests();
                hideInvoiceForm(id);
            } catch (error) {
                console.error('Error refreshing requests:', error);
                // Still show success even if refresh fails
            }
        }
        
        function createInvoiceMessage(request, invoice) {
            let message = `Service: ${request.service}\n`;
            message += `Client: ${request.clientName}\n`;
            message += `Date: ${invoice.date}\n`;
            message += `\nItems:\n`;
            message += `${'-'.repeat(50)}\n`;
            
            invoice.items.forEach((item, index) => {
                message += `${index + 1}. ${item.description}\n`;
                message += `   Quantity: ${item.quantity} x ${item.price.toFixed(2)} = ${item.total.toFixed(2)}\n`;
            });
            
            message += `${'-'.repeat(50)}\n`;
            message += `Total: ${invoice.total.toFixed(2)}\n`;
            
            return message;
        }

        // Check agent authentication on load
        async function checkAgentAuth() {
            const isAgentAuthenticated = await sessionDB.get('agent_authenticated') === 'true';
            const agentContainer = document.getElementById('agent-container');
            const agentDashboard = document.getElementById('agent-dashboard');
            
            if (isAgentAuthenticated) {
                // Update welcome message before showing dashboard
                const agentUsername = await sessionDB.get('agent_username') || 'Agent';
                const welcomeSpan = document.getElementById('agent-welcome');
                if (welcomeSpan) {
                    welcomeSpan.textContent = `Welcome, ${agentUsername}`;
                }
                showAgentDashboard();
            } else {
                // Make sure agent container and dashboard are hidden if not authenticated
                agentContainer.classList.add('hidden');
                agentDashboard.classList.remove('active');
            }
        }

        // CTA Slideshow functionality
        function initCTASlideshow() {
            const slides = document.querySelectorAll('.cta-slide');
            let currentSlide = 0;
            
            function showNextSlide() {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }
            
            // Change slide every 4 seconds
            setInterval(showNextSlide, 4000);
        }

        // Initialize function
        async function initializePage() {
            // Ensure database is initialized first
            if (!idb) {
                try {
                    await initializeDatabase();
                } catch (error) {
                    console.error('Failed to initialize database:', error);
                }
            }
            
            // Set up Firebase auth state listener
            firebaseAuth.onAuthStateChanged(async (user) => {
                console.log('Auth state changed:', user ? user.uid : 'signed out');
                if (user) {
                    // User is signed in
                    const userDataResult = await firebaseUsers.getUser(user.uid);
                    if (userDataResult.success) {
                        await sessionDB.set('homefix_authenticated', 'true');
                        await sessionDB.set('homefix_user', {
                            uid: user.uid,
                            name: userDataResult.data.name,
                            email: userDataResult.data.email,
                            phone: userDataResult.data.phone
                        });
                        console.log('Auth state listener: User data synced');
                    }
                    // Only update UI if main content is not already authenticated
                    const mainContent = document.getElementById('main-content');
                    if (mainContent && !mainContent.classList.contains('authenticated')) {
                        console.log('Auth state listener: Updating UI');
                        await checkAuthStatus();
                    } else {
                        console.log('Auth state listener: UI already authenticated, skipping update');
                    }
                } else {
                    // User is signed out - only update if not already on landing page
                    const landingPage = document.getElementById('landing-page');
                    const mainContent = document.getElementById('main-content');
                    if (landingPage && landingPage.classList.contains('hidden')) {
                        console.log('Auth state listener: User signed out, updating UI');
                        await sessionDB.remove('homefix_authenticated');
                        await sessionDB.remove('homefix_user');
                        // Explicitly hide main content
                        if (mainContent) {
                            mainContent.classList.remove('authenticated');
                            mainContent.style.display = 'none';
                        }
                        await checkAuthStatus();
                    }
                }
            });
            
            // Check agent auth first, then regular auth
            // This ensures proper priority: agent > regular user > landing page
            const isAgentAuthenticated = await sessionDB.get('agent_authenticated') === 'true';
            const currentUser = firebaseAuth.getCurrentUser();
            
            // Get all containers
            const landingPage = document.getElementById('landing-page');
            const authContainer = document.getElementById('auth-container');
            const agentContainer = document.getElementById('agent-container');
            const agentDashboard = document.getElementById('agent-dashboard');
            const mainContent = document.getElementById('main-content');
            
            // Ensure proper initial state
            if (isAgentAuthenticated) {
                await checkAgentAuth();
            } else if (currentUser) {
                await checkAuthStatus();
                await checkAgentAuth(); // Still call to ensure agent containers are hidden
            } else {
                // Not authenticated - show landing page, hide everything else
                if (landingPage) {
                    landingPage.classList.remove('hidden');
                    landingPage.style.display = 'block'; // Force display
                }
                if (authContainer) authContainer.classList.add('hidden');
                if (agentContainer) agentContainer.classList.add('hidden');
                if (agentDashboard) agentDashboard.classList.remove('active');
                if (mainContent) {
                    mainContent.classList.remove('authenticated');
                    mainContent.style.display = 'none'; // Explicitly hide main content
                }
            }
            
            // Only call init if user is authenticated (to avoid errors)
            if (currentUser && !isAgentAuthenticated) {
                init();
            }
            initCTASlideshow();
        }
        
        // Run immediately if DOM is ready, otherwise wait for DOMContentLoaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePage);
        } else {
            // DOM is already loaded
            initializePage();
        }
    </script>
    </div> <!-- End of main-content -->

    <!-- Agent Login Container -->
    <div class="agent-container hidden" id="agent-container">
        <div class="agent-login-card">
            <div style="margin-bottom: var(--spacing-md);">
                <a href="#" class="auth-link" onclick="showLandingPage(); return false;" style="display: inline-flex; align-items: center; gap: var(--spacing-xs);">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Home
                </a>
            </div>
            <div class="auth-header">
                <div class="auth-logo">HomeFix</div>
                <h1 class="auth-title">Agent Login</h1>
                <p class="auth-subtitle">Access your agent dashboard</p>
            </div>
            <form class="auth-form" onsubmit="handleAgentLogin(event)">
                <div class="form-group">
                    <label class="form-label" for="agent-username">Username</label>
                    <input 
                        type="text" 
                        id="agent-username" 
                        class="form-input" 
                        placeholder="Enter your username"
                        required
                    >
                </div>
                <div class="form-group">
                    <label class="form-label" for="agent-password">Password</label>
                    <div class="password-wrapper">
                        <input 
                            type="password" 
                            id="agent-password" 
                            class="form-input" 
                            placeholder="Enter your password"
                            required
                        >
                        <button 
                            type="button" 
                            class="password-toggle" 
                            onclick="togglePassword('agent-password', this)"
                        >
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Login
                </button>
            </form>
        </div>
    </div>

    <!-- Agent Dashboard -->
    <div class="agent-dashboard" id="agent-dashboard">
        <div class="agent-header">
            <div class="agent-header-content">
                <div class="agent-header-title">Agent Dashboard</div>
                <div class="agent-header-actions">
                    <span id="agent-welcome" style="color: var(--neutral-600);">Welcome, Agent</span>
                    <button class="btn btn-ghost" onclick="agentLogout()">Logout</button>
                </div>
            </div>
        </div>
        <div class="agent-content">
            <div class="requests-section">
                <div class="section-header">
                    <h2 class="section-title">Incoming Requests</h2>
                    <button class="btn btn-primary" onclick="loadAgentRequests()">Refresh</button>
                </div>
                <div id="requests-container">
                    <!-- Requests will be loaded here -->
                </div>
            </div>
        </div>
    </div>
</body>
</html>


